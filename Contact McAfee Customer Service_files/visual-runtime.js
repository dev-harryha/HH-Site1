!function(){"use strict";var e,t,i,r,n;define("vbc/private/constants",[],(()=>{const e={Severity:{ERROR:"error",INFO:"info",FINE:"fine",FINER:"finer",WARNING:"warn"}};return e.SeverityOrder=[e.Severity.ERROR,e.Severity.WARNING,e.Severity.INFO,e.Severity.FINE,e.Severity.FINER],e.PATH_SEPARATOR="/",e.VbProtocols={CATALOG:"vb-catalog"},e.Headers={CONTENT_TYPE:"content-type",VB_INFO_EXTENSION:"vb-info-extension",ALLOW_ANONYMOUS_ACCESS_HEADER:"vb-allow-anonymous-access",PROTOCOL_OVERRIDE_HEADER:"vb-protocol",VB_DT_AUTHENTICATION:"dt-serviceAuthentication",INHERIT:"inherit-authentication"},e.InitParams={PLUGIN_PASSTHROUGHS:"services.security.handlers.passthroughs"},e})),define("vb/private/constants",["vbc/private/constants"],(e=>{const t=Object.assign({},e);return t.MessageType={ERROR:"error",WARNING:"warning",INFO:"info",CONFIRMATION:"confirmation",NONE:"none"},t.VariableNamespace={VARIABLES:"variables",METADATA:"metadata",BUILTIN:"builtin",CONSTANTS:"constants"},t.VariableClassification={REGULAR:"regular",INSTANCE_FACTORY:"instanceFactory"},t.VariableTypePrefixes={INSTANCE_FACTORY:"vb/InstanceFactory"},t.BuiltinVariableName={VALUE:"_value",INTERNAL_STATE:"_internalState"},t.VariableLifecycleStage={INIT:1,ACTIVE:2,DISPOSE:4},t.VariableWritablePropertyOptions={ALL:"all",NONE:"none"},t.VariableProperties={INPUT:"input",WRITEBACK:"writeback"},t.VariablePropertyInput={FROM_CALLER:"fromCaller",FROM_URL:"fromUrl",NONE:"none"},t.InitParams.SERVICES_SERVER_OVERRIDES="services.server.overrides",t.ContextName={PARAMETERS:"$parameters",EVENT:"$event",PREVIOUS:"$previous",CURRENT:"$current",BINDING_CONTEXT:"$bindingContext",INIT_PARAMS:"$initParams"},t.ContextNameInternal={DISPATCH_EVENT:"$dispatchEvent"},t.ExtensionNamespaces={BASE:"base"},t.CatalogNamespaces={BASE:t.ExtensionNamespaces.BASE,TENANT:"tenant"},t.ExtensionFolders={BASE:"base",SELF:"self"},t.RESULTS_VARIABLE_KEY="vb_results",t.CURRENT_PAGE_VARIABLE="currentPage",t.CURRENT_FLOW_VARIABLE="currentFlow",t.LOCALE_VARIABLE="locale",t.PATH_VARIABLE="path",t.PROFILE_CONSTANT="profile",t.DEPLOYMENT_CONSTANT="deployment",t.RESPONSIVE_CONTEXT="responsive",t.TRANSLATIONS_CONTEXT="translations",t.COMPONENTS_CONTEXT="components",t.INFO_CONTEXT="info",t.APPLICATION_USER_VARIABLE="user",t.GLOBAL_CURRENT_APPUI_VARIABLE="currentAppUi",t.INIT_PARAM_CONTEXT="initParams",t.PARENT_FOLDER=`..${t.PATH_SEPARATOR}`,t.CURRENT_FOLDER=`.${t.PATH_SEPARATOR}`,t.RELATIVE_FOLDER_PREFIX=".",t.GLOBAL_PREFIX="global",t.APPLICATION_PREFIX="application",t.FLOW_PREFIX="flow",t.PAGE_PREFIX="page",t.LAYOUT_PREFIX="layout",t.APP_UI_PREFIX="application",t.THIS_PREFIX="this",t.FRAGMENT_PREFIX="fragment",t.VB_EVENT_MARKER="vb",t.ENTER_EVENT="vbEnter",t.EXIT_EVENT="vbExit",t.BEFORE_ENTER_EVENT="vbBeforeEnter",t.BEFORE_EXIT_EVENT="vbBeforeExit",t.INTERACTABLE_EVENT="vbInteractable",t.NOTIFICATION_EVENT="vbNotification",t.AFTER_NAVIGATE_EVENT="vbAfterNavigate",t.INSTALL_PROMPT_EVENT="vbBeforeAppInstallPrompt",t.RESUME_EVENT="vbResume",t.PAUSE_EVENT="vbPause",t.DATAPROVIDER_NOTIFICATION_EVENT="vbDataProviderNotification",t.RESOURCE_CHANGED_EVENT="vbResourceChanged",t.NEW_CONTENT_AVAILABLE="vbNewContentAvailable",t.VALUE_CHANGED="onValueChanged",t.ContainerState={CREATED:"created",ENTERED:"entered",EXITED:"exited",REFRESHING:"refreshing",DISPOSED:"disposed"},t.FragmentState={COMPONENT_CONNECTED:"componentConnected",MODULE_CONNECTED:"moduleConnected",COMPONENT_DISCONNECTED:"componentDisconnected",MODULE_DISCONNECTED:"moduleDisconnected"},t.FragmentCapability={ALLOWS_SLOTS:"ALLOWS_SLOTS"},t.RouterStrategy={QUERY:"query",PATH:"path"},t.appModuleConfig="vbApplication",t.routerModuleConfig="vbRouterFlow",t.componentBridge="vbBridge",t.DirtyDataBehavior={TRACK:"track",NONE:"none"},t.ComponentBridgeType={FRAGMENT:"fragment",FRAGMENT_SLOT:"fragment-slot",SWITCHER:"switcher"},t.blankModuleConfig={view:[],viewModel:null},t.errorPageDescriptor={pageModelVersion:"1.0.0",description:"Error Page"},t.Services={definitionTimeout:3e4},t.DEFAULT_RATE_LIMIT=1,t.MAX_DEFAULT_VALUE_RECURSION_DEPTH=1,t.ContentTypes={MULTIPART:"multipart/form-data"},t.Decorators={PREFIX:"@decorators"},t.DefaultPaths={UI:"ui/",APPLICATIONS:"applications/",SERVICES:"services/",LAYOUTS:"dynamicLayouts/",TRANSLATIONS:"translations/",CATALOG_JSON:"services/catalog.json"},t.EXTENSION_PATH_NAME="vx",t.EXTENSION_PATH=`${t.EXTENSION_PATH_NAME}${t.PATH_SEPARATOR}`,t.EventTargets={CURRENT:"current",LEAF:"leaf"},t.EventBehaviors={NOTIFY:"notify",NOTIFY_WAIT:"notifyAndWait",CHECK_CANCEL:"checkForCancel",TRANSFORM:"transform",DYNAMIC_COMP:"dynamicComponent"},t.EventPropagationBehaviors={SELF:"self",CONTAINER:"container"},t.EventMode={LISTENABLE:"listenable",TRIGGERABLE:"triggerable"},t.NO_EVENT_LISTENER_RESPONSE="__no_listener__",t.User={DEFAULT:"anonymous",TESTER:"tester"},t.TestMode={ACTION_CHAIN:"actionChain",UNIT_TEST:"unitTest"},t.ALL_SCOPES=["$global","$application","$flow","$page","$base","$extension","$chain","$variables","$layout","$fragment","$enums"],t.APP_INTERNAL_PROPERTY_NAME="__application",t.CHAIN_INTERNAL_CONTEXT=Symbol("chain-internal-context"),t.BUILTIN_ACTION_PATH_PREFIX="vb/action/builtin/",t.NavigateOperation={PAGE:"navigateToPage",PAGE_OLD:"oldNavigateToPage",FLOW:"navigateToFlow",APP_UI:"navigateToAppUi"},t.HistoryMode={PUSH:"push",SKIP:"skip",REPLACE:"replace"},t.FROM_EXTERNAL_NAVIGATION_ENABLED="enabled",t})),define("vb/errors/httpError",[],(()=>{const e=401,t=403,i=404,r="statusCode";class n extends Error{constructor(e,t,i=t.message,...s){super(i,...s),Object.defineProperties(this,{[r]:{get:()=>e,enumerable:!0},cause:{get:()=>t,enumerable:!0}}),Error.captureStackTrace&&Error.captureStackTrace(this,n)}isUnauthorized(){return this.statusCode===e}isForbidden(){return this.statusCode===t}isFileNotFound(){return this.statusCode===i}static isHttpError(e){return e&&!!e.statusCode}static isFileNotFound(e){return e&&e.statusCode===i}}return n})),define("vbc/private/utils",["vbc/private/constants"],(e=>{class t{static generateUniqueId(){return Math.random().toString(36).substr(2,9)}static isWorkerThread(){return void 0===globalThis.window}static isOldEdge(e=navigator.userAgent){return/Edge\//i.test(e)}static isMobile(){return"undefined"!=typeof cordova}static isIos(){return t.isMobile()&&"ios"===cordova.platformId}static isAndroid(){return t.isMobile()&&"android"===cordova.platformId}static isObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}static getResource(e){return new Promise(((t,i)=>{requirejs([e],(e=>{t(e)}),(e=>{i(e)}))}))}static safelyGet(e,...t){return t.reduce(((e,t)=>e&&e[t]),e)}static safelyCall(e,...t){const[i,r]=t.reduce((([e,t],i)=>[t,t&&t[i]]),[null,e])||[];return r&&r.apply(i)}static getTraceOptions(e){if(e&&e.TRACE_CONFIG){const t=Object.assign({},e.TRACE_CONFIG.tracerOptions);return t.applicationId=t.applicationId||e.APP_ID,Object.assign({},e.TRACE_CONFIG,{tracerOptions:t})}}static isOnline(){return!!navigator.onLine&&!(navigator.connection&&"none"===navigator.connection.type)}static addTrailingSlash(t){let i=t||"";return i&&i[i.length-1]!==e.PATH_SEPARATOR&&(i=`${i}/`),i}static removeTrailingSlash(e){return e&&"/"===e.slice(-1)?e.slice(0,-1):e}static cleanString(e){return"string"==typeof e&&e.trim()||""}}return t})),
/**
 * Original @license MIT
 * Forked and adapted from https://github.com/futurist/replace-css-url on Mar 15, 2022 ( tag 1.2.6 ).
 */
function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define("vb/private/utils/cssUrlReplacer",["require","exports"],e)}((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=/^\s*('|")/;t.default=function(e,t){return[/(@import\s+)(')(.+?)(')/gi,/(@import\s+)(")(.+?)(")/gi,/(url\s*\()(\s*')([^']+?)(')/gi,/(url\s*\()(\s*")([^"]+?)(")/gi,/(url\s*\()(\s*)([^\s'")].*?)(\s*\))/gi].reduce((function(e,r){return e.replace(r,(function(e,r,n,s,a){var o=t(s,n);return i.test(o)&&i.test(n)&&(n=a=""),r+n+o+a}))}),e)}})),define("vb/private/utils/intersectionObserverUtils",[],(()=>{const e={rootMargin:"0px 0px 50px 0px",threshold:0};return new class{constructor(){this.observer=void 0}createObserver(t){let i=e;return t&&(i=Object.assign({},e,{root:t})),new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&(console.log(`ojModule ${e.target} is in the viewport!`),t.unobserve(e.target))}))}),i)}static applyStyle(e){const t=e.getAttribute("style"),i=`#${Math.floor(16777215*Math.random()).toString(16)}`;e.setAttribute("style",`${t}; border: 3px dashed ${i}`)}getIntersectionObserver(e){return!this.observer&&e&&(this.observer=this.observer||this.createObserver(e),Object.freeze(this.observer)),this.observer}clearIntersectionObserver(){this.observer=void 0}}})),define("vb/private/utils",["knockout","vb/private/constants","vb/errors/httpError","jsondiff","vbc/private/utils","vb/private/utils/cssUrlReplacer","urijs/URI","vb/private/utils/intersectionObserverUtils"],((e,t,i,r,n,s,a,o)=>{let c;const l=r.create({arrays:{detectMove:!1},cloneDiffValues:!1});class h{static isNotDecorator(e){return e&&!e.startsWith(t.Decorators.PREFIX)}}class p extends n{static isHostApplication(e=window.vbInitConfig){return e&&"unified"===e.APP_TYPE}static cleanUpExtraSlashes(e){return e.replace(/([^:]\/)\/+/g,"$1").replace(/\/+$/,"")}static isAbsoluteUrl(e){return e&&new a(e).is("absolute")}static isAbsolutePath(e=""){return"/"===e[0]||p.isAbsoluteUrl(e)}static getResource(e){return new Promise(((t,r)=>{requirejs([e],(e=>{t(e)}),(e=>{let t;t=e.requireType?e:new i(e.xhr.status,e),r(t)}))}))}static getResources(e){return new Promise(((t,r)=>{requirejs(e,((...e)=>{t(e)}),(e=>{e.xhr&&e.xhr.status?r(new i(e.xhr.status,e)):r(e)}))}))}static resourceExists(e){return new Promise(((t,i)=>{const r=new XMLHttpRequest,n=`${require.toUrl("")}${e.substr(5)}`;r.open("HEAD",n),r.onload=function(){t(404!==this.status)},r.onerror=function(){i({status:this.status,statusText:r.statusText})},r.send()}))}static getTextResource(e){return p.getResource(`text!${e}`)}static parseJsonResource(e,t="Unknown resource"){if(!e)throw new i(404,new Error(`Empty file content for ${t}.`));try{return JSON.parse(e)}catch(e){throw(()=>{if(!c){const e=requirejs("vb/private/log");c=e.getLogger("/vb/private/utils")}return c})().error("Error when parsing",t,e),e}}static loadAndParse(e){return p.getTextResource(e).then((t=>p.parseJsonResource(t,e)))}static getRuntimeEnvironment(){return p.runtimeEnvironmentPromise||(p.runtimeEnvironmentPromise=this.getResource("vbRuntimeEnvironmentClass").then((e=>new e))),p.runtimeEnvironmentPromise}static cloneObject(e,t){let i=t;if(void 0===t){if(!p.isCloneable(e))return e;i=Array.isArray(e)?[]:{}}for(const t in e){const r=e[t],n=i[t];let s;if(i===r)return i;const a=Array.isArray(r);p.isCloneable(r)?(s=a?[]:n&&p.isObject(n)?n:{},i[t]=p.cloneObject(r,s)):i[t]=r}return i}static emptyArrays(e,t=!1){if(!e)return e;let i=e;return Array.isArray(e)?(i=[],t&&!p.isStructureEmpty(e)&&Object.keys(e).forEach((r=>{const n=e[r];i.push(p.emptyArrays(n,t))}))):p.isObject(e)&&Object.keys(e).forEach((r=>{const n=e[r];i[r]=p.emptyArrays(n,t)})),i}static isStructureEmpty(e){if(void 0===e)return!0;if(Array.isArray(e)){if(e.length>1)return!1;return!e.some((e=>!p.isStructureEmpty(e)))}if(p.isObject(e)){const t=Object.keys(e);for(let i=0;i<t.length;i+=1){const r=e[t[i]];if(!p.isStructureEmpty(r))return!1}return!0}return!1}static isPrototypeOfObject(e){try{return e&&(Object.getPrototypeOf(e)===Object.prototype||null===e.prototype)}catch(e){}return!1}static deepResolve(e,t={freeze:!0}){if(p.isObjectOrArray(e)){return Object.keys(e).forEach((i=>{e[i]=p.deepResolve(e[i],t)})),t&&!0===t.freeze?Object.freeze(e):e}return p.resolveIfObservable(e)}static resolveIfObservable(t){return e.isObservable(t)?t():t}static isPrimitive(e){return e!==Object(e)}static isObjectOrArray(e){return e&&"object"==typeof e}static isExtendedType(e){return e&&"function"==typeof e.isExtendedType&&e.isExtendedType()}static isTypeDefInstanceFactory(e){return"string"==typeof e&&0===e.indexOf(t.VariableTypePrefixes.INSTANCE_FACTORY)}static isInstanceType(e){return"string"==typeof e&&e.substring(e.indexOf(":")+1).indexOf("/")>=0}static isObjectType(e){return"string"==typeof e?"object"===e:p.isObject(e)}static isArrayType(e){return!("string"!=typeof e||!e.endsWith("[]"))||Array.isArray(e)}static isPrimitiveType(e){return["string","number","boolean"].some((t=>e===t))}static isObjectOrArrayType(e){return p.isObjectType(e)||p.isArrayType(e)}static isWildcardType(e){return"any"===e||"object"===e}static isAnyType(e){return"any"===e}static getArrayRowType(e){return p.isArrayType(e)?Array.isArray(e)?e[0]:e.substring(0,e.length-2):null}static isCloneable(e){return p.isObjectOrArray(e)&&(Array.isArray(e)||p.isPrototypeOfObject(e))}static mergeObject(e,...t){if(!t.length)return e;const i=t.shift();if(p.isObject(e)&&p.isObject(i))for(const t in i)p.isObject(i[t])?(e[t]||Object.assign(e,{[t]:{}}),p.mergeObject(e[t],i[t])):Object.assign(e,{[t]:i[t]});return p.mergeObject(e,...t)}static getWebStorageItemName(e,t,i,r){return`orcl.vbcs.${e}.${t}.${i}.${r}`}static replaceUrlPathname(e){if(!this.isMobile()){const t=document.createElement("a");return t.href=window.location.href,t.pathname=e,window.history.replaceState(window.history.state,"",t.href),t.href}return e}static injectStyleTag(e){if(!e)return;if(!(e=e.trim()))return;const t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.head.appendChild(t)}static diff(e,t){return l.diff(e,t)}static changeBrowserState(e,t,i){return window.history[i](e,"",t),t!==window.location.href||this.diff(e,window.history.state)?new Promise((e=>{window.setTimeout((()=>{e()}),1e3)})).then((()=>this.changeBrowserState(e,t,i))):Promise.resolve()}static appendToUrlPathname(e){this.replaceUrlPathname(`${n.addTrailingSlash(window.location.pathname)}${e}`)}static getTimeoutPromise(e,t){return new Promise(((i,r)=>{const n=t||new Error("timeout");setTimeout((()=>r(n)),e)}))}static promiseRaceWithTimeout(e,t,i=new Error("promise timed out")){const r=p.getTimeoutPromise(t,i);return Promise.race([e,r])}static formatLoadError(e){const t={error:e};if(e&&e.message){if(t.message=e.message,e.statusCode){const i=e.message.indexOf("status: ");if(i>=0){const r=e.message.substring(i);t.message=`HTTP error ${r}`}}}else t.message="Unknown error";return t.message}static isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}static isMobileSafari(){return/mobile\/.*safari/i.test(navigator.userAgent)}static readBlob(e,t){const i=t||p.getMimeType(e),r=i?{type:i}:void 0;return p.isMobile()?new Promise(((t,i)=>{window.resolveLocalFileSystemURL(e,(e=>{e.file((e=>{const i=new FileReader;i.onloadend=()=>{t(new Blob([new Uint8Array(i.result)],r))},i.readAsArrayBuffer(e)}),(function(e){i(e)}))}),(function(e){i(e)}))})):fetch(e).then((e=>e.ok?e.blob():null))}static getMimeType(e){switch(e.substr(e.lastIndexOf(".")+1)){case"jpe":case"jpeg":case"jpg":return"image/jpeg";case"svg":return"image/svg+xml";case"bmp":return"image/bmp";case"gif":return"image/gif"}return"application/octet-stream"}static parseVersionString(e){if("string"!=typeof e)return null;const t=e.split(".");return{major:parseInt(t[0],10)||0,minor:parseInt(t[1],10)||0,patch:parseInt(t[2],10)||0}}static getTemplateParameterNames(e,t="{",i="}"){const r={},n=t[0],s=i[0],a=e.match(new RegExp(`\\${n}([^\\${s}]*)\\${s}`,"g"));return a&&a.forEach((e=>{if(e.length>2){const t=e.substring(1,e.length-1);r[t]=!0}})),Object.keys(r)}static removeDecorators(e,t=h.isNotDecorator){if(e){const i=e;Object.keys(e||{}).forEach((e=>{t(e)||delete i[e]}))}return e}static flatten(e){return Object.assign({},...function e(t,i=""){return t?[].concat(...Object.keys(t).map((r=>"object"==typeof t[r]?e(t[r],`${i}${i?".":""}${r}`):{[`${i}${i?".":""}${r}`]:t[r]}))):[]}(e))}static fileToBlob(e){return new Blob([e],{type:e.type,name:e.name,size:e.size,lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate})}static removeFileExtension(e){const t=e.split(".");return t.length>1&&t.pop(),t.join(".")}static removeFileName(e){return a(e).filename("").toString()}static createFunctionWrappers(e){const t={};return Object.keys(e).forEach((i=>{Object.defineProperty(t,i,{get:()=>e[i]({})})})),t}static hyphenatedToCamelCase(e){return p.removeFileExtension(e).split("-").map(((e,t)=>t?e.charAt(0).toUpperCase()+e.slice(1):e)).join("")}static toFlatUniqueArray(...e){const t=(e,i,r)=>(r.forEach((r=>{if(Array.isArray(r)){const n=i||new Set;n.has(r)||(n.add(r),t(e,n,r))}else void 0!==r&&e.add(r)})),e);return[...t(new Set,void 0,e)]}static parseQualifiedIdentifier(e,{prefixToken:t=":",suffixToken:i="/"}={}){if("string"==typeof e){let r,n,s="";const a=e.indexOf(i.length>0?i:null);a>=0?(a>0&&(s=e.substring(0,a)),n=e.substring(a+1)):s=e;const o=s.indexOf(t.length>0?t:null);let c;return o>=0&&(o>0&&(r=s.substring(0,o)),s=s.substring(o+1)),r&&((c||(c={})).prefix=r),s&&((c||(c={})).main=s),n&&((c||(c={})).suffix=n),c}}static setToJSONReplacer(e,t){return"object"==typeof t&&t instanceof Set?[...t]:t}static uriSafeOperation(e){const t=a.ensureValidPort;try{return a.ensureValidPort=()=>{},e(a)}finally{a.ensureValidPort=t}}static replacePathInCSS(e,t){return s.default(e,t)}static createNamespaceMap(e=t.ExtensionNamespaces.BASE){const i={},r=(t,i,r)=>{let n=r;if(r&&"string"!=typeof r){const e=Object.keys(r);n=e.length>0?e.map((e=>`${e}:${r[e]}`)).join():void 0}return`${t}:${i||e}:${n||""}`};return{get:(e,t)=>i[r(e,t)],getAll:(e,t)=>{const n=r(e,t),s=[];return Object.keys(i).forEach((e=>{e.startsWith(n)&&s.push(i[e])})),s},set:(e,t,n)=>{i[r(e,t)]=n},setWithVariables:(e,t,n,s)=>{i[r(e,t,n)]=s},has:(e,t)=>!!i[r(e,t)],hasWithVariables:(e,t,n)=>!!i[r(e,t,n)],getWithVariables:(e,t,n)=>i[r(e,t,n)],getKeys:()=>Object.keys(i),getValues:()=>Object.values(i),delete:e=>{const t=[];Object.keys(i).forEach((i=>{const r=i&&i.split(":");e(r[0],r[1])&&t.push(i)})),t.forEach((e=>{delete i[e]}))}}}}return p.servicesGlobalVariableSupplier=()=>[],p.nameFilters=h,p.vbModuleObserver=o,p})),define("vbc/private/logConfig",["vbc/private/constants"],(e=>{const t={};t[e.Severity.ERROR]={display:"ERROR",style:"background-color: #EB2A64; color: white"},t[e.Severity.INFO]={display:"INFO",style:"font-weight:normal;background-color: #CED6F0; color: #0C40ED"},t[e.Severity.FINE]={display:"FINE",style:"font-weight:normal;background-color: #C4C6CC; color: #4A4A4A"},t[e.Severity.FINER]={display:"FINER",style:"font-weight:normal;background-color: #E9EAF0; color: #616060"},t[e.Severity.WARNING]={display:"WARN",style:"background-color: #F2F2A7; color: black"},t.code={display:"FINER",style:"font-weight:bold;background-color: #E9EAF0; color: #616060"};return{Loggers:{"/":{error:!0,info:!0,fine:!1,finer:!1,warn:!0},"/vb/stateManagement/variable":{finer:!0},"/vb/stateManagement/instanceFactoryVariable":{finer:!0},"/vb/stateManagement/container":{finer:!0},"/vb/action":{fine:!0},"/vb/types/ServiceDataProvider":{finer:!0},"/vb/types/ServiceDataProvider.AsyncIterator":{finer:!0},"/vb/helpers/rest":{fine:!0}},Styles:t,FancyStyles:{"fancy-yellow":"font-weight:normal;background-color: #ffed00; color:#020200;padding:2px;font-size:11px;","fancy-yellow-end":"font-weight:normal;color:#FFCC00;padding:2px;font-weight:bolder;font-size:11px;","fancy-orange":"font-weight:normal;background-color: #EC9A29; color: #143642;padding:2px;font-size:11px;","fancy-orange-end":"font-weight:normal;color:#A56B1C;padding:2px;font-weight:bolder;font-size:11px;","fancy-calm":"font-weight:normal;background-color: #8BD8C6; color: black;font-size:14px;","fancy-green":"font-weight:normal;background-color: #3E8914; color: #E8FCCF;padding:2px;font-size:11px;","fancy-coral":"font-weight:normal;background-color: #ff9999; color: #ffffff;padding:2px;font-size:11px;","fancy-bluegreen":"font-weight:normal;background-color: #00cccc; color:#E8FCCF;padding:2px;font-size:11px;","fancy-bluegreen-end":"font-weight:normal;color:#009999;padding:2px;font-weight:bolder;font-size:11px;","fancy-purple":"font-weight:normal;color: transparent;text-shadow: 0 0 0 #9FAE68;background-color:#7768AE;color: #fff;padding:2px;font-size:11px;","fancy-purple-end":"font-weight:normal;color: transparent;text-shadow: 0 0 0 #9FAE68;color:#551A8B;padding:2px;font-weight:bolder;font-size:11px;"},Emojis:{"fancy-orange":"ðŸ¬","fancy-orange-end":"ðŸ¬","fancy-green":"ðŸ","fancy-coral":"ðŸ¦‰","fancy-bluegreen":"ðŸ¿","fancy-bluegreen-end":"ðŸ¿","fancy-purple":"ðŸ‡","fancy-purple-end":"ðŸ‡","fancy-start":"âœ…ï¸","fancy-end":"âŒ","fancy-calm":"ðŸ","fancy-yellow":"ðŸŽ","fancy-yellow-end":"ðŸŽ"},CodeFontColors:{$string:"color:#CD0000",$number:"color:#0000FF",$boolean:"color:#CC7832",$null:"color:magenta",$key:"color:#660E7A"},FancyStyleByFeature:{containerStart:"orange",containerEnd:"orange-end",actionChainStart:"purple",actionChainEnd:"purple-end",restHelperStart:"yellow",restHelperEnd:"yellow-end",serviceDataProviderStart:"bluegreen",serviceDataProviderEnd:"bluegreen-end"}}})),define("vbc/private/performance/performanceCategory",[],(()=>{const e=e=>Promise.resolve(e([]));class t{getLogger(){if(!this.logger){const e=requirejs("vbc/private/log");this.logger=e.getLogger("/vbc/private/performance/performanceCategory")}return this.logger}constructor(t,i){this.name=t,"function"==typeof i?this.entriesCallback=i:(this.getLogger().warn(`A specified entriesCallback: ${i} is not a function and won't be used`),this.entriesCallback=e)}getName(){return this.name}getEntries(e=(e=>e)){return this.entriesCallback(e)}}return t.EMPTY_ENTRIES_PROMISE=e,t})),define("vbc/private/performance/immediateCategory",["vbc/private/performance/performanceCategory"],(e=>{const t=e=>e([]);return class extends e{constructor(e,i){super(e,(e=>Promise.resolve(this.getEntriesNow(e)))),this.entriesNowCallback="function"==typeof i?i:t}getEntriesNow(e=(e=>e)){return this.entriesNowCallback(e)}}})),define("vbc/private/trace/spanContext",[],(()=>class{addStartSpan(e){return this.startSpan=e,this}addEndSpan(e){return this.endSpan=e,this}addOperationName(e){return this.operationName=e,this}addError(e){return this.error=e,this}addSpanFunction(e){return this.fn=e,this}startSpanOptions(){let e;return"function"==typeof this.startSpan&&(e=this.startSpan(),this.operationName&&(e=Object.assign({},this.startSpan(),{operationName:this.operationName}))),e&&e.operationName?e:void 0}spanFunction(){return this.fn}endSpanOptions(){let e;return"function"==typeof this.endSpan&&(e=this.endSpan(),e&&this.error&&(e=Object.assign({},e,{error:this.error}))),e}})),define("vbc/private/trace/tracer",["vbc/private/utils","vbc/private/trace/spanContext"],((e,t)=>{let i,r;const n=()=>{if(!r){const e=requirejs("vbc/private/log");r=e.getLogger("/vbc/private/trace/tracer")}return r},s=()=>{},a={startSpan:s,span:(e,t)=>t(),finishSpan:s,shutdown:s,inject:e=>e,isBlacklisted:()=>!1,blacklist:s};class o{constructor(){this.reset(),this._blacklist=[]}init(e){return i||(i=Promise.resolve().then((()=>(o.checkOptions(e)&&(this.options=e,this.isTelemetryLoaded()&&(this.tracer,this.isEnabled=!0)),n().info("Tracer",this.isEnabled?"enabled":"disabled","on",globalThis.toString()),this))).catch((e=>{n().error("Failed to load tracer on",globalThis.toString(),e),this.reset()}))),i}isTelemetryLoaded(){return void 0!==globalThis.GlobalTracer}get tracer(){if(this.isTelemetryLoaded()){if(!this.globalTracer){const e=globalThis.GlobalTracer.get();if(!e)return a;this.globalTracer=e}return this.globalTracer}return a}reset(){i=null,delete this.options,this.globalTracer=null,delete this.isEnabled,this._blacklist=[]}static checkOptions(e){return!e||!e.disabled||(n().info("Tracer options check: tracing is disabled",e,"on",globalThis.toString()),!1)}startSpan(e){let i;if(this.isEnabled&&e instanceof t)try{const t=e.startSpanOptions();t&&(i=this.tracer.startSpan(t))}catch(t){n().error("Failed to start trace span",e,"on",globalThis.toString(),t)}return i}finishSpan(e,i){try{if(this.isEnabled&&e){let r;i instanceof t&&(r=i.endSpanOptions()),e.finish(r)}}catch(t){n().error("Failed to finish trace span",e,"on",globalThis.toString(),t)}}span(e){if(e instanceof t){if(this.isEnabled)try{const t=e.startSpanOptions()||{},i=e.spanFunction();if(t&&i)return this.tracer.span(t,i)}catch(t){n().error("Failed to start trace span",e,"on",globalThis.toString(),t)}const t=e.spanFunction();if(t)return t()}}inject(e){return this.options&&this.options.injectEnabled&&!this.isBlacklisted(e)?new Promise((t=>{t(this.tracer.inject(e.clone()))})):Promise.resolve(e)}isBlacklisted(e){return this._blacklist.includes(e.url)}blacklist(e){this._blacklist.push(e.url)}}return new o})),define("vbc/private/performance/webVitalsCategory",["vbc/private/utils","vbc/private/performance/performanceCategory","vbc/private/trace/tracer","vbc/private/trace/spanContext"],((e,t,i,r)=>{const n="web vitals (ms)";class s{constructor(e){e(this.onReport.bind(this))}getMetric(){return this.metric}onReport(e){this.metric=e;const t=(new r).addOperationName(`metric/${e.name}`),n={msg:e};t.addStartSpan((()=>n)),t.addEndSpan((()=>n));const s=i.startSpan(t);s&&s.finish()}}class a extends t{constructor(t){super(n,(e=>Promise.resolve(this.getEntriesNow(e)))),this.vitals=[],this.addWebVitalsPromise=Promise.resolve().then((()=>{if(e.isWorkerThread())return null;return(t?Promise.resolve(t):e.getResource("web-vitals")).then((e=>{this.vitals.push(new s(e.getCLS)),this.vitals.push(new s(e.getFCP)),this.vitals.push(new s(e.getFID)),this.vitals.push(new s(e.getLCP)),this.vitals.push(new s(e.getTTFB))}))}))}getEntries(i=(e=>e)){return this.addWebVitalsPromise.then((()=>{if(e.isWorkerThread())return t.EMPTY_ENTRIES_PROMISE(i);const r=[];return this.vitals.forEach((e=>{const t=e.getMetric();if(t){const e=Math.round("CLS"===t.name?1e3*t.delta:t.delta),i={[t.name]:Math.round(e)};r.push(i)}})),r}))}}return a.WEB_VITALS_CATEGORY_NAME=n,a})),define("vbc/private/performance/reporter",["vbc/private/constants"],(e=>{let t;const i=()=>{if(!t){const e=requirejs("vbc/private/log");t=e.getLogger("/vbc/private/performance/reporter")}return t};let r;class n{report(e,t){}isEnabled(){return!0}}class s extends n{constructor(e=!0){super(),this.logObject=e}report(t="",r=[]){i().info(`${t}:`);const n={};r.forEach((e=>Object.assign(n,e))),i().table({severity:e.Severity.INFO,groupTitle:t,obj:n,logObject:this.logObject})}isEnabled(){return void 0===r&&(r=i().isEnabled(e.Severity.INFO)),r}}return n.CONSOLE_REPORTER=new s,n.TABLE_CONSOLE_REPORTER=new class extends s{constructor(){super(!1)}},n})),define("vbc/private/performance/performanceReport",["vbc/private/performance/reporter"],(e=>{class t{getLogger(){if(!this.logger){const e=requirejs("vbc/private/log");this.logger=e.getLogger("/vbc/private/performance/performanceReport")}return this.logger}processCategory(e,t,i){const r=e.getName();e.getEntries(i).then((e=>t.report(r,e)))}forEachCategory(e,t,i){const r=[];return e&&e.forEach((e=>{r.push(this.processCategory(e,t,i))})),Promise.all(r)}reportEachCategory(i,r=e.CONSOLE_REPORTER,n=t.SIMPLE_FORMAT){return r.isEnabled()?this.forEachCategory(i,r,n):Promise.resolve()}}return t.SIMPLE_FORMAT=e=>{const t={};return Object.getOwnPropertyNames(e).forEach((i=>{t[`\r${i}`]=e[i]})),t},t})),define("vbc/private/performance/performance",["vbc/private/performance/performanceCategory","vbc/private/performance/immediateCategory","vbc/private/performance/webVitalsCategory","vbc/private/performance/performanceReport","vbc/private/performance/reporter"],((e,t,i,r,n)=>{const s="_vbMarkStart",a="mark",o="resource",c=["connectEnd","connectStart","domComplete","domContentLoadedEventEnd","domContentLoadedEventStart","domInteractive","domainLookupEnd","domainLookupStart","domainLookupEnd","fetchStart","loadEventEnd","loadEventStart","requestStart","responseEnd","responseStart"];let l;const h=()=>{if(!l){const e=requirejs("vbc/private/log");l=e.getLogger("/vbc/private/performance/performance")}return l};class p{constructor({resourceTimingBufferSize:r=150,maxResEntries:n=r}){performance?("function"==typeof performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(r),performance.onresourcetimingbufferfull=this.onResourceBufferFull.bind(this),p.INFO=new t("info",this.getInfo.bind(this)),p.NAVIGATION=new t("navigation (ms)",this.getNavigation.bind(this)),p.CUSTOM=new e("custom (ms)",this.getCustom.bind(this)),p.TIMESTAMPS=new t("timestamps (ms)",this.getTimestamps.bind(this)),p.DURATIONS=new t("durations (ms)",this.getDurations.bind(this)),p.RESOURCES_BY_DURATION=new t("resorcesByDuration (ms)",this.getResourcesByDuration.bind(this)),p.RESOURCES_BY_SIZE=new t("resourcesBySize (Kb)",this.getResourcesBySize.bind(this)),p.WEB_VITALS=new i,this.categories=[],this.categories.push(p.INFO),this.categories.push(p.NAVIGATION),this.categories.push(p.CUSTOM),this.categories.push(p.TIMESTAMPS),this.categories.push(p.DURATIONS),this.categories.push(p.RESOURCES_BY_DURATION),this.categories.push(p.RESOURCES_BY_SIZE),this.categories.push(p.WEB_VITALS),this.maxResEntries=n,this.resourceTimingBufferSize=r):h().warn("Browser does not support Web Performance")}getCategories(){return this.categories}onResourceBufferFull(){performance&&(h().warn("Resource timing buffer full"),this.logResources(),performance.getEntriesByType&&h().info("Clearing",performance.getEntriesByType(o).length,"resource entries"),performance.clearResourceTimings(),performance.setResourceTimingBufferSize(this.resourceTimingBufferSize))}getReport(){return this.report||(this.report=new r),this.report}log(){this.getReport().reportEachCategory(this.categories)}logTable(){this.getReport().reportEachCategory(this.categories,n.TABLE_CONSOLE_REPORTER,void 0)}logCustom(){this.getReport().reportEachCategory([p.CUSTOM])}logTimestamps(){this.getReport().reportEachCategory([p.TIMESTAMPS])}logDurations(){this.getReport().reportEachCategory([p.DURATIONS])}logResources(){this.getReport().reportEachCategory([p.RESOURCES_BY_DURATION,p.RESOURCES_BY_SIZE])}logVitals(){this.getReport().reportEachCategory([p.WEB_VITALS])}logVB(){this.logDurations(),this.logTimestamps()}static isEnabled(e){return!(null==e||e.disabled&&!1!==e.disabled||void 0===performance)}static init(e,t){if(e&&p.isEnabled(t)){p.enabled=!0;const i=new p(t);Object.defineProperty(e,"perf",{enumerable:!0,configurable:!0,value:i}),p.perf=i}else p.enabled=!1}static timestamp(...e){p.enabled&&e&&Array.isArray(e)&&e.length>0&&performance.mark(e.join(":"))}static markStart(e=[]){p.enabled&&e&&Array.isArray(e)&&e.length>0&&performance.mark(`${e.join(":")}:_vbMarkStart`)}static markEnd(e=[]){if(p.enabled&&e&&Array.isArray(e)&&e.length>0&&performance.getEntriesByName){const t=e.join(":"),i=`${t}:_vbMarkStart`,r=performance.getEntriesByName(i,a);r&&r[0]&&(performance.measure(t,i),performance.clearMarks(i))}}static clear(e=!1){p.enabled&&(performance.clearMeasures(),performance.clearMarks(),delete performance.onresourcetimingbufferfull,e&&p.perf&&p.perf.onResourceBufferFull(this))}static getPerformanceTimingEntry(){let e,t=[];return performance.getEntriesByType&&(t=performance.getEntriesByType("navigation"),t&&t.length>0&&(e=t[0])),0===t.length&&performance.timing&&(e=performance.timing),e}static getNavigationStart(e){let t=0;return e&&(void 0!==e.navigationStart?t=e.navigationStart:e.startTime&&(t=e.startTime)),t}getInfo(e){const t=[];return t.push(e({name:globalThis.location.href})),t.push(e({userAgent:navigator.userAgent})),t.push(e({globalObject:globalThis.toString()})),t}getNavigation(e){const t=[],i=p.getPerformanceTimingEntry();if(i){const r=p.getNavigationStart(i)||0;c.forEach((n=>{const s=i[n]-r,a={};a[n]=Math.round(s),t.push(e(a))}))}return t}getCustom(e){const t=[];return Promise.resolve().then((()=>{const i=p.getPerformanceTimingEntry();return i&&(t.push(e({connectTime:Math.round(i.responseEnd-i.requestStart)})),t.push(e({domLoadTime:Math.round(i.domContentLoadedEventEnd-i.fetchStart)})),t.push(e({domParsingTime:Math.round(i.domContentLoadedEventEnd-i.domInteractive)})),t.push(e({renderTime:Math.round(i.domComplete-i.domContentLoadedEventEnd)}))),t})).catch((e=>(h().warn(e),t)))}getDurations(e){const t=[];if(performance.getEntriesByType){const i=performance.getEntriesByType("measure");i&&i.forEach((i=>{const r={};r[i.name]=Math.round(i.duration),t.push(e(r))}))}return t}getTimestamps(e){const t=[];if(performance.getEntriesByType){const i=performance.getEntriesByType(a);i&&i.forEach((i=>{if(!i.name.endsWith(s)){const r={};r[i.name]=Math.round(i.startTime),t.push(e(r))}}))}return t}getResourcesBySize(e){const t=[];if(performance.getEntriesByType){const i=performance.getEntriesByType(o),r=i[0];r&&r instanceof PerformanceResourceTiming&&void 0!==r.encodedBodySize&&(i.sort(((e,t)=>e.encodedBodySize<t.encodedBodySize?1:-1)),i.slice(0,i.length>this.maxResEntries?this.maxResEntries:i.length).forEach((i=>{const r=Math.round(i.encodedBodySize/1024);if(r>0){const n={};n[i.name]=Math.round(r),t.push(e(n))}})))}return t}getResourcesByDuration(e){const t=[];if(performance.getEntriesByType){const i=performance.getEntriesByType(o);i&&(i.sort(((e,t)=>e.duration<t.duration?1:-1)),i.slice(0,i.length>this.maxResEntries?this.maxResEntries:i.length).forEach((i=>{if(!t[i.name]||t[i.name]<i.duration){const r={};r[i.name]=Math.round(i.duration),t.push(e(r))}})))}return t}}return p.perf=void 0,p.enabled=void 0,p.WEB_VITALS=void 0,p.RESOURCES_BY_SIZE=void 0,p.RESOURCES_BY_DURATION=void 0,p.DURATIONS=void 0,p.TIMESTAMPS=void 0,p.CUSTOM=void 0,p.NAVIGATION=void 0,p.INFO=void 0,p})),define("vbc/private/monitorOptions",[],(()=>{const e={LOAD_APPLICATION:"ApplicationLoad",LOAD_FLOW:"FlowLoad",LOAD_PAGE:"pageLoad",LOAD_APPUI:"AppPackageLoad",LOAD_PACKAGE_FLOW:"PackageFlowLoad",LOAD_FRAGMENT:"FragmentLoad",LOAD_PACKAGE_FRAGMENT:"PackageFragmentLoad",LOAD_LAYOUT:"LayoutLoad",LOAD_APPLICATION_EXTENSION:"ApplicationExtensionLoad",LOAD_FLOW_EXTENSION:"FlowExtensionLoad",LOAD_PAGE_EXTENSION:"PageExtensionLoad",LOAD_FRAGMENT_EXTENSION:"FragmentExtensionLoad",LOAD_LAYOUT_EXTENSION:"LayoutExtensionLoad",LOAD_APPUI_EXTENSION:"AppPackageExtensionLoad",LOAD_PACKAGEFLOW_EXTENSION:"PackageFlowLoad",LOAD_EXTENSION_BUNDLE:"extensionBundleLoading",LOAD_EXTENSION_MANIFEST:"extensionManifestLoad",ACTIVATE_PAGE:"pageActivate",ACTIVATE_FRAGMENT:"FragmentActivate",ACTIVATE_PACKAGE_FRAGMENT:"PackageFragmentActivate",ACTION:"action",ACTION_CHAIN:"actionChain",EVENT_COMPONENT:"componentEvent",EVENT_RUNTIME:"runtimeEvent",EVENT_VARIABLE:"variableEvent",FETCH:"fetch",SDP_FETCH_BY_OFFSET_ITERATION:"sdp.fetchByOffsetIteration",SDP_FETCH_BY_OFFSET:"sdp.fetchByOffset",SDP_FETCH_BY_KEYS_ITERATION:"sdp.fetchByKeysIteration",SDP_FETCH_BY_SINGLE_KEY:"sdp.fetchBySingleKey",SDP_FETCH_BY_KEYS:"sdp.fetchByKeys",SDP_FETCH_FIRST:"sdp.fetchFirst",CACHE_JET_MONITOR:"cacheJet"};Object.freeze(e);const t=Object.values(e);Object.freeze(t);return class{constructor(e,i){if(this.operationName=e,this.message=i,!t.includes(e))throw new Error(`Span ${e} is not valid.`);this.operationName=e,this.message=i}static get SPAN_NAMES(){return e}static get pageLoadSpanName(){return"pageLoad"}static get pageActivateSpanName(){return"pageActivate"}addMessage(e){return this.message=e,this}addStartMessage(e){return this.startMessage=e,this}addEndMessage(e){return this.endMessage=e,this}addTags(e){return this.tags=e,this}addStartFields(e){return this.startFields=e,this}addEndFields(e){return this.endFields=e,this}getStartMessage(){let e=this.startMessage;return!e&&this.message&&(e=`starting ${this.message}`),e}getEndMessage(){let e=this.endMessage;return!e&&this.message&&(e=`ending ${this.message}`),e}getTags(){let e;return"function"==typeof this.tags&&(e=this.tags()),e}getStartFields(){let e;return"function"==typeof this.startFields&&(e=this.startFields()),e||{}}getEndFields(){let e;return"function"==typeof this.endFields&&(e=this.endFields()),e||{}}}})),define("vbc/private/log",["vbc/private/constants","vbc/private/logConfig","vbc/private/utils","vbc/private/performance/performance","vbc/private/trace/tracer","vbc/private/trace/spanContext","vbc/private/monitorOptions"],((e,t,i,r,n,s,a)=>{const o={};let c={};const l=()=>{},h=()=>{const t=console&&console.log?console.log:l,i=console&&console.info?console.info:t,r=console&&console.error?console.error:t,n=console&&console.warn?console.warn:t,s=console&&console.debug?console.debug:t;return{[e.Severity.ERROR]:r,[e.Severity.WARNING]:n,[e.Severity.INFO]:i,[e.Severity.FINE]:s,[e.Severity.FINER]:s}};let p=h();const u=!(void 0!==console.table),d=!!(console.group&&console.groupCollapsed&&console.groupEnd),g=console.table&&!i.isOldEdge(),v=e=>!u&&"simple"!==e.mode,f=e=>"on"===e.emoji;class m{constructor(i,r,n={}){this._display=i,this._showLog=(i=>{const r={};let n=i;for(;n.length>0;){const i=t.Loggers[n];if(i&&e.SeverityOrder.forEach((e=>{void 0===r[e]&&void 0!==i[e]&&(r[e]=i[e])})),e.SeverityOrder.every((e=>void 0!==r[e])))break;const s=n.lastIndexOf("/");n=-1===s?"":0===s?"/":n.substring(0,s)}return r})(i),this.customLoggers=r,this.options=n,this.options.wrapErrorIfNeeded=this.options.wrapErrorIfNeeded||l,e.SeverityOrder.forEach((e=>{const i=!((e=>!(!t.Styles[e]||!t.Styles[e].disabled))(e)||!0!==this._showLog[e]);this._showLog[e]=i;let r=e.charAt(0).toUpperCase()+e.slice(1);r=`is${r}`,this[r]=i,this[e]=this.getLoggerMethod(e)})),this.options.wrapErrorIfNeeded(this),r&&r.forEach((e=>{this[e.name]=this.getLoggerMethod(e.severity,e.style)}))}getLoggerMethod(e,t){if(!0===this._showLog[e]){return p[e].bind(console,...this._buildParams(e,t))}return l}table({severity:e,obj:t,groupTitle:r="",group:n=!0,logObject:s=!1}){if(this.isEnabled(e)&&i.isObject(t)){let i=!1;n&&d&&(console.groupCollapsed(r),i=!0),!s&&g?console.table(t):this.getLoggerMethod(e)(t),i&&console.groupEnd()}}isEnabled(e){return this[e]!==l}monitor(e,t){const i=(new Date).getTime();let o,c,l;const h=e=>{const t=(new Date).getTime()-i;return o&&r.markEnd(o),c&&(e instanceof a?c.addEndSpan((()=>Object.assign({msg:e.getEndMessage()},e.getEndFields()))):c.addError(e),n.finishSpan(l,c)),`(completed in ${t} ms)`};if(e instanceof a){if(o=[e.operationName,e.message],r.markStart(o),c=(new s).addOperationName(e.operationName),c.addStartSpan((()=>Object.assign({msg:e.getStartMessage(),tags:e.getTags()},e.getStartFields()))),c.addEndSpan((()=>Object.assign({msg:e.getEndMessage()},e.getEndFields()))),t)return c.addSpanFunction((e=>(l=e,t(h)))),n.span(c);l=n.startSpan(c)}return h}_buildParams(e,i){const r=[],n="[VB (%s), %s]:";if(!this.options.useTemplate)return r.push(`[VB (${t.Styles[e].display}), ${this._display}]:`),r;if(this.options.useFancyMode)if(i){const e=`fancy-${i}`;let n="";this.options.useEmoji&&(n=t.Emojis[e],n=n?`${n} `:""),r.push(`%c${n}[VB (%s), %s]:`),r.push(t.FancyStyles[e])}else r.push("%c[VB (%s), %s]:"),r.push(t.Styles[e].style);else r.push(n);return r.push(t.Styles[e].display),r.push(this._display),r}}class b{static getLogger(e,t,i=l){let r=o[e];if(!r){const n={};n.useTemplate="test"!==c.mode,n.useEmoji=f(c),n.useFancyMode=v(c),n.wrapErrorIfNeeded=i,r=new m(e,t,n),o[e]=r}return r}static getCachedLoggers(){return o}static rebuildLoggers(e){p=h(),Object.keys(o).forEach((t=>{const i=o[t],r=i.options;e&&(r.useEmoji=f(e),r.useFancyMode=v(e));const n=new m(t,i.customLoggers,r);Object.assign(i,n)}))}static setMinimumLevel(i){const r="warning"===i?"warn":i,n=e.SeverityOrder.indexOf(r);return-1!==n&&(e.SeverityOrder.forEach(((e,i)=>{const r=t.Styles[e];r&&(r.disabled=i>n)})),b.rebuildLoggers(),!0)}static compareConfigs(e={},t={}){return e.mode===t.mode&&e.emoji===t.emoji}static setConfig(e={}){null===e||b.compareConfigs(c,e)||(c=e||{},b.rebuildLoggers(c))}}return b.NOOP=l,b})),define("vb/private/log",["vb/private/constants","vb/private/utils","vbc/private/log"],((e,t,i)=>{const r=window.vbInitConfig||{};let n;i.setConfig(r.LOG||{});const s=t=>{const i=t[e.Severity.ERROR];i&&(t[e.Severity.ERROR]=(...e)=>{i(...e),n.notifyError(...e)})},a=e=>!(!e||"RuntimeEnvironment"!==Object.getPrototypeOf(e).constructor.name);t.getRuntimeEnvironment().then((e=>{if(n=e,!a(n)){const e=i.getCachedLoggers();Object.keys(e).forEach((t=>{s(e[t])}))}}));const o=e=>{a(n)||s(e)};return class extends i{static getLogger(e,t){return i.getLogger(e,t,o)}}})),define("vb/binding/expression",["knockout","vb/private/log","vb/private/utils"],((e,t,i)=>{const r=t.getLogger("/vb/binding/expression"),n=/^(?:\{\{)([^]+)(?:\}\})$/,s=/^(?:\[\[)([^]+)(?:\]\])$/,a=/\s/g,o=/(((\$global|\$application|\$page|\$flow)\.constants\.)|(\$constants\.))[\\$A-Z_a-z]/g,c=/(((\$global|\$application|\$page|\$flow)\.variables\.)|(\$variables\.))[\\$A-Z_a-z]/g,l=/((((\$global|\$application|\$page|\$flow)\.variables)|(\$variables))\[(.*?)\])/g;class h{static get WHITESPACE_REGEX(){return a}static create(t){return new e.pureComputed(t.bind(null))}static createFromString(e,t,i=!0){let n="";const s=[];if(t){let r=0;Object.keys(t).forEach((a=>{const o=t[a];n+=`const ${a} = injectedContext[${r}]; `;const c=i?this.preventWritesToStructure(o,e):o;s.push(c),r+=1}))}n+=`return ${e};`;try{const e=new Function("injectedContext",n);return h.create(e.bind(null,s))}catch(t){return r.error("Could not evaluate expression",e,t),()=>{}}}static preventWritesToStructure(e,t){const r={get(e,t){const r=e[t],s=Object.getOwnPropertyDescriptor(e,t);return s&&!1===s.configurable&&!1===s.writable?r:i.isObjectOrArray(r)&&i.isPrototypeOfObject(r)?n(r):r},set(){throw new Error(`The expression '${t}' has a method that has mutated a variable. This can lead to unexpected behavior when this expression is evaluated. Consider using the 'callModuleFunctionAction' instead for a safe way of mutating variables.`)}},n=e=>new Proxy(e,r);try{return n(e)}catch(t){return e}}static isExpression(e){return!("string"!=typeof e||!h.getExpression(e))}static getExpression(e){let t;if(e){const i=e.trim();t=n.exec(i),t=t?t[1]:null,t||(t=s.exec(i),t=t?t[1]:null)}return t}static getEvaluated(e,t){if(!e)return e;if("string"==typeof e){const i=h.getExpression(e);if(i){return h.createFromString(i,t)()}}else{if(Array.isArray(e))return e.map((e=>h.getEvaluated(e,t)));if(!i.isPrototypeOfObject(e))return e;if(i.isObject(e)){const i={};return Object.keys(e).forEach((r=>{i[r]=h.getEvaluated(e[r],t)})),i}}return e}static getEvaluatedSafe(e,t={}){try{return e?h.getEvaluated(e,t):e}catch(t){r.error("unable to create expression",e,t)}return null}static hasConstantsInExpr(e){return h.hasTokenInExpr(e,o)}static hasVariablesInExpr(e){return h.hasTokenInExpr(e,c)||h.hasTokenInExpr(e,l)}static hasTokenInExpr(e,t){const i=e&&"string"==typeof e&&h.getExpression(e);return i&&i.replace(a,"").match(t)}}return h})),define("vb/private/pathHandler",["urijs/URI","vb/private/constants","vb/private/utils"],((e,t,i)=>{function r(e){return e&&e[0]===t.RELATIVE_FOLDER_PREFIX}return class{constructor(e,t="",i){const{allowParent:r,allowSelfRelative:n}=i;this.filePath=e,this.resolvedFilePath=null,this.allowParent=r||!1,this.allowSelfRelative=!1!==n,this.containerPath=t+(t.endsWith("/")?"":"/")}isAllowed(){return!!this.filePath&&(!(this.isContainerRelative()&&!this.allowSelfRelative)&&(this.allowParent||-1===this.filePath.indexOf(t.PARENT_FOLDER)))}isAbsolute(){return i.isAbsolutePath(this.filePath)}isContainerRelative(){return this.filePath&&r(this.filePath)}getResolvedPath(){if(!this.resolvedFilePath){let n,s=this.filePath,a=i.isAbsolutePath(s);if(a||!this.allowParent&&!r(s)||this.containerPath===t.PATH_SEPARATOR?n=s:(n=this.containerPath+s,a=i.isAbsolutePath(n)),n=new e(n).normalizePath().toString(),!a){if(-1!==n.indexOf(t.PARENT_FOLDER)){n=new e(n).normalizePath().toString()}n.startsWith(t.CURRENT_FOLDER)&&(n=e(n).normalizePath().toString())}this.resolvedFilePath=n}return this.resolvedFilePath}static startsWithDot(e){return r(e)}}})),define("vb/private/services/serviceConstants",[],(()=>{const e={ExtensionTypes:{SERVICES:"services",BACKENDS:"backends"},VB_EXTENSIONS:"x-vb",AUTH_DECL_NAME:"authentication"};return e})),define("vb/private/services/swaggerUtils",["vb/private/log","vb/private/utils","vb/private/services/serviceConstants"],((e,t,i)=>{const r=["put","post","patch"],n=e.getLogger("/vb/private/services/swaggerUtils");let s,a=[];class o{static getEndpointId(e,t,i,r){let n=r.operationId;if(!n){n=`${i}${e.replace(/\//g,"")}`}return n}static hasRequestBody(e){return-1!==r.indexOf((e||"").toLowerCase())}static resolveReferences(e,t,i=e,r={names:[],map:{}}){if(t&&!t(i,r))return i;function n(i){return i.map((i=>Array.isArray(i)?n(i):i&&"object"==typeof i?o.resolveReferences(e,t,i,r):i))}const s={},a=Object.assign({},o.resolveReference(e,i,r));if(a.$ref)return a;const c=a.reference;return a.inMap?c:(Object.keys(c).forEach((i=>{const a=c[i];r.names.push(i),Array.isArray(a)?s[i]=n(a):s[i]=a&&"object"==typeof a?o.resolveReferences(e,t,a,r):a,r.names.pop()})),s)}static resolveReference(e,t={},i={}){const r=i.map,s=i.names.join("/");if(r[s]||(r[s]=t),t&&t.$ref){let a=t.$ref;if("string"!=typeof a)return t;if(!a||a.startsWith("http"))return{inMap:!1,reference:t};if(a.startsWith("#/")&&(a=a.substring(2)),r[a])return{inMap:!0,reference:r[a]};let c=e;if(a.split("/").some((e=>(c=c&&c[e],!c))),c){const t=o.resolveReference(e,c,i);return r[a]=t.reference,r[s]=t.reference,{inMap:!1,reference:t.reference}}n.info("unable to resolve reference:",a)}return{inMap:!1,reference:t}}static expandSchema(e){const t=[];return e&&(e.allOf&&Array.isArray(e.allOf)?e.allOf.forEach((e=>{const i=o.expandSchema(e);t.push(...i)})):t.push(e)),t}static getParameterDefault(e={}){let t=e[i.VB_EXTENSIONS]&&e[i.VB_EXTENSIONS][o.VB_DEFAULT_VALUE];return void 0===t&&(t=e[o.VB_DEPRECATED_DEFAULT_VALUE]),void 0===t&&(t=e.schema&&e.schema.default),t}static separateParameters(e=[]){const t={};return e.forEach((e=>{t[e.in]=t[e.in]||{};const i=Object.assign({defaultValue:o.getParameterDefault(e)},e);t[e.in][e.name]=i})),t}static getRequiredParameters(e){const t=[];return o.URL_PARAM_TYPES.forEach((i=>{const r=e[i];Object.keys(r||{}).forEach((e=>{const n=r[e];"path"!==i&&!0!==n.required||t.push(Object.assign({type:i},n))}))})),t}static servicesGlobalVariableTokensSupplier(){const e=t.servicesGlobalVariableSupplier();return e!==s&&(a=e.map((e=>{const[t,i]=e;return[`{@${t}}`,i]})),s=e),a}static parseServiceText(e){const t=o.servicesGlobalVariableTokensSupplier();if(Array.isArray(t)&&t.length>0&&"string"==typeof e&&e.includes("{@")){let i=e;return t.forEach((([e,t])=>{i=i.replaceAll(e,t)})),JSON.parse(i)}return JSON.parse(e)}static splitVariables(e){let t;const i={};return"object"!=typeof e||Array.isArray(e)||Object.keys(e).forEach((r=>{const n=e[r];r.startsWith("server:")?o.isValidServerVariableValue(n)&&(t||(t={}),t[r.substring("server:".length)]=e[r]):i[r]=n})),{serverVariables:t,variables:i}}static isValidServerVariableValue(e,t,i){if(null!=e&&""!==e){const r=t&&t.variables&&t.variables[i];return r&&Array.isArray(r.enum)&&!r.enum.includes(e)&&n.warn("The enumeration for the server variable",i,"does not include the value",e,"used by the request."),!0}return!1}}return o.VB_DEPRECATED_DEFAULT_VALUE=`${i.VB_EXTENSIONS}-defaultValue`,o.VB_DEFAULT_VALUE="defaultValue",o.URL_PARAM_TYPES=["path","query"],o})),define("vb/private/services/uriTemplate",["vb/private/services/swaggerUtils","vb/private/log","vb/private/constants","urijs/URI"],((e,t,i,r)=>{r.escapeQuerySpace=!1;const n=/[/]/,s=t.getLogger("/vb/private/service/uriTemplate"),a=/{(.*?)}/gi;class o{constructor(e){const t=e;this.isForm=t.startsWith("?"),this.expr=this.isForm?t.substring(1):t}getNames(){return this.expr.split(",").map((e=>{const t=e.indexOf(":");return-1!==t?e.substring(0,t):e}))}getReplacement(e={}){let t;return this.isForm?(s.warn("warning: {?q} template syntax not supported in service definitions"),t=function(e=[],t={}){let i="",r=!0;return e.forEach((e=>{let n=e,s=0;const a=n.indexOf(":");if(a>=0&&(n=e.substring(0,a),s=parseInt(e.substring(a+1),10)),void 0!==t[n]&&null!==t[n]){const e=`${t[n]}`,a=s>0?e.substring(0,s):e;i=`${i}${r?"?":"&"}${n}=${a}`,r=!1}})),i}(this.expr.split(","),e)):t=e[this.expr]||`{${this.expr}}`,t}}class c{constructor(t,i={},r=!1){this.uri=t||"",this.doNotAppendExtras=r,this.parameterDefs=i,this.requiredParameters=e.getRequiredParameters(this.parameterDefs),this.defaultValueMap={},e.URL_PARAM_TYPES.forEach((t=>{const i=this.parameterDefs[t]||{};Object.values(i).forEach((t=>{const i=e.getParameterDefault(t);t&&void 0!==i&&(this.defaultValueMap[t.name]&&s.warn(`found conflicting parameter names with default values: ${t.name}`),this.defaultValueMap[t.name]=i)}))}))}replace(e={},t=!1){const s="object"!=typeof e||Array.isArray(e)?{}:e,l=Object.assign({},this.defaultValueMap,s);let h=0;const p={},u={};let d=this.uri.replace(a,((e,t)=>{const i=new o(t);let r=i.getReplacement(l);if(r){const e=this._findParameterDefinition(t),i=`___ph${h+=1}___`;if(e&&"path"===e.in&&n.test(r))p[i]=encodeURIComponent(r),r=i;else{!(t in l)&&(p[i]=r,r=i)}}return i.getNames().forEach((e=>{u[e]="merged"})),r}));Object.keys(u).forEach((e=>{delete l[e]}));const g=Object.keys(l).sort(),v=new r(d);if(g.length){const e=(e,t)=>{null===t?v.addSearch(e,"null"):void 0===t?v.addSearch(e,"undefined"):v.addSearch(e,t)};g.forEach((t=>{const i=l[t];if("object"!=typeof i||null===i){const r=this._findParameterDefinition(t);(!r&&!this.doNotAppendExtras||r&&"query"===r.in)&&e(t,i)}else if(Array.isArray(i)){const r=this._findParameterDefinition(t);if(!r||"query"===r.in)if(r&&"multi"===r.collectionFormat)i.forEach((i=>{e(t,i)}));else if(r||!this.doNotAppendExtras){const r=i.map((e=>"function"==typeof e.replace?e.replace(/,/g,"%2C"):e)).join();e(t,r)}}})),d=v.toString()}if(!t){const e=c.encode(d);d=e===`${d}${i.PATH_SEPARATOR}`?e.substring(0,e.length-1):e}return Object.keys(p).forEach((e=>{d=d.replace(e,p[e])})),d}_findParameterDefinition(e){let t=this.parameterDefs.query&&this.parameterDefs.query[e];return t||Object.keys(this.parameterDefs).some((i=>(t=this.parameterDefs[i][e],t))),t}_getExpressionInfo(){const e=[];let t=this.uri.indexOf("?"),i=a.exec(this.uri);for(;null!=i;){let r=!1,n=i[1]||"";n.startsWith("?")&&(s.warn("warning: {?} template syntax not supported in service definitions"),r=!0,n=n.substring(1),t<0&&(t=i.index));const o=r||i.index>=t&&t>=0;n.split(",").forEach((t=>{let i=t;const n=i.indexOf(":");let s=-1;n>=0&&(i=t.substring(0,n),s=parseInt(t.substring(n+1),10));const a={isQuery:o,name:i,isRequired:!r};s>-1&&(a.length=s),e.push(a)})),i=a.exec(this.uri)}return e}getMissingRequiredParameters(e){const t=[];return this.requiredParameters.forEach((i=>{const r=i.name,n=!e||void 0===e[r]||null===e[r],s=void 0===this.defaultValueMap[r]||null===this.defaultValueMap[r];n&&s&&t.push(i)})),t}static encode(e,t=!0){const i=r.parse(e),n=r.parseQuery(i.query);return n?(Object.keys(n).forEach((e=>{const t=n[e];"string"==typeof t?n[e]=r.decodeQuery(t):t&&Array.isArray(t)&&(n[e]=t.map((e=>r.decodeQuery(e))))})),i.query=r.buildQuery(n,!0),i.path&&t&&(i.path=r.recodePath(i.path)),r.build(i).toString()):e}}return c})),define("vb/private/services/catalogRegistry",["signals","vb/private/log","vb/private/utils","vb/private/constants","vb/private/services/serviceConstants","vb/private/services/swaggerUtils","vb/private/services/uriTemplate","urijs/URI"],((e,t,i,r,n,s,a,o)=>{const c=t.getLogger("/vb/private/services/catalogRegistry"),l=["services","catalog"],h=["services","catalog","common"],p=(e,t)=>{t&&(t.path&&"."===t.path[0]&&(t.path=new o(t.path,e).path()),t.originalPath&&"."===t.originalPath[0]&&(t.originalPath=new o(t.originalPath,e).path()))},u=e=>{Array.isArray(e)&&e.forEach((e=>{const t=e.url;delete e.url,e.getUrl=(n,o,p,u,d,g={})=>{if(!n)return t;const v=((e,t,n,o,p,u,d)=>{const g=i.uriSafeOperation((e=>new e(t))),v=g.clone().search("").toString(),f=v.endsWith(r.PATH_SEPARATOR),m=(o.path.startsWith(r.PATH_SEPARATOR)?o.path.substring(1):o.path).split(r.PATH_SEPARATOR);m.shift();let b,y=m.join(r.PATH_SEPARATOR);y.startsWith(r.PATH_SEPARATOR)&&(y=y.substring(1)),b=y?`${v}${f?"":r.PATH_SEPARATOR}${y}`:f&&v===`${t}${r.PATH_SEPARATOR}`?v.substring(0,v.length-1):v;const E=[o.query,g.query()].filter((e=>!!e));E.length&&(b=`${b||""}?${E.join("&")}`);const P=l.slice();P.push(p,u);const x=P.reduce(((e,t)=>e[t]||{}),n)||{},T=h.reduce(((e,t)=>e[t]||{}),n)||{},A={},C={},O=h.join("."),S=P.join(".");Object.keys(n).forEach((e=>{if(e.startsWith(O)){const t=n[e];null!=t&&(A[e.substring(O.length+1)]=t)}if(e.startsWith(S)){const t=n[e];null!=t&&(C[e.substring(S.length+1)]=t)}}));let w="";const I={},R={};Object.keys(e.variables||{}).forEach((t=>{e.variables[t].default&&(R[t]=e.variables[t].default);const i=d[t];s.isValidServerVariableValue(i,e,t)&&(w+=`\n  '${t}': '${i}'`,I[t]=i)})),w&&c.info("The server url of",`'${p}/${u}'`,"has been modified by the following request-specific variables:",w);const _=Object.assign(R,i.flatten(T),i.flatten(x),A,C,I);return{url:new a(b||"",{},!0).replace(_),template:b,variables:_}})(e,t,n,o,p,u,d||{});return d&&d[Symbol.for("RestHelper.addServerUrlInfo")]&&d[Symbol.for("RestHelper.addServerUrlInfo")](v),Object.assign(g,v.variables||{}),v.url}}))},d=(e,t)=>e.id===t||e.getRequiredExtensions().some((e=>d(e,t))),g=(e,t={})=>{Object.keys(t).forEach((n=>{try{const s=t[n],{protocol:a,type:l,extensionId:h=r.ExtensionNamespaces.BASE,name:p}=(e=>{const t=o.parse(e),n=t.hostname,s=(t.path||"").split(r.PATH_SEPARATOR)[1]||"",{prefix:a=r.ExtensionNamespaces.BASE,main:c}=i.parseQualifiedIdentifier(s);return{protocol:t.protocol,type:n,extensionId:a,name:c}})(n);if(l&&p&&a===r.VbProtocols.CATALOG&&s.url){const t=e[l]||(e[l]={});(t[h]||(t[h]={}))[p]=s}else c.warn("Invalid catalog override",n)}catch(e){c.error("Error processing service catalog override",n,e)}}))};class v{constructor(t={}){this.loadPromise=Promise.resolve(),this.pending=[],this.catalogs={},this.overrides=t,this.extensionRegistry=null,this.registryModified=new e.Signal}register(e,t){this.pending.push({path:t,name:e}),1===this.pending.length&&this.registryModified.dispatch()}getNames(e=v.ROOT_CATALOG){return this.get(e).then((e=>({backends:Object.keys(e.backends||{}),services:Object.keys(e.services||{})})))}getAllNames(){return this.getNamespaces().then((e=>e.map((e=>({namespace:e,backends:Object.keys(this.catalogs[e].backends||{}),services:Object.keys(this.catalogs[e].services||{})})))))}getNamespaces(){return this.loadPending().then((()=>Object.keys(this.catalogs)))}get(e=v.ROOT_CATALOG){return this.loadPending().then((()=>this.catalogs[e]||{}))}loadPending(){if(0===this.pending.length)return this.loadPromise;const e=this.pending;return this.pending=[],this.loadPromise=this.loadPromise.then((()=>{const t=e.map((({path:e,name:t})=>this.catalogs[t]?(c.warn("catalog already loaded, skipping",t,e),null):Promise.all([this.load(e),this.getCatalogOverrides()]).then((([r,n={}])=>{try{const a=s.parseServiceText(r);if(a.backends){const r=n.backends&&n.backends[t]||{};Object.keys(a.backends).forEach((t=>{const n=a.backends[t],s=r[t];s&&(n.servers=[i.cloneObject(s,{})]),p(e,n.transforms),u(n.servers)}))}if(a.services){const r=n.services&&n.services[t]||{};Object.keys(a.services).forEach((t=>{const n=a.services[t],s=r[t];s&&(n.servers=[i.cloneObject(s,{})]);const o=n.info&&n.info["x-vb"]&&n.info["x-vb"].transforms;p(e,o),u(n.servers)}))}this.catalogs[t]=a}catch(i){c.error("Invalid JSON for catalog",t,e,i)}}))));return Promise.all(t)})).then((()=>this.catalogs)).catch((e=>(c.error("Error loading catalogs",e),this.catalogs))),this.loadPromise}load(e){return i.getRuntimeEnvironment().then((t=>t.getServiceExtensionCatalog(e)))}getCatalogOverride(e,t,r){return this.getCatalogOverrides().then(((n={})=>{const s=n[e]&&n[e][t]&&n[e][t][r];if(s){const e=i.cloneObject(s,{});return u([e]),e}return null}))}getCatalogOverrides(){return this._catalogOverridePromise||(this._catalogOverridePromise=Promise.resolve().then((()=>i.getRuntimeEnvironment())).then((e=>e.getCatalogOverride())).then((e=>{const t={};g(t,this.overrides);const i=JSON.parse(e);return g(t,i),t})).catch((e=>(c.error("Error loading service catalog overrides",e),{})))),this._catalogOverridePromise}isVisibleExtension(e,t){if(this.extensionRegistry){const i=this.extensionRegistry.extensions;if(i){const n=i[e];if(n){if(t===r.ExtensionNamespaces.BASE)return!0;if(e!==r.ExtensionNamespaces.BASE)return d(n,t)}}}return!1}ignoreExtensionAccessFlag(e){return e===n.ExtensionTypes.BACKENDS&&this.extensionRegistry&&"v1"===this.extensionRegistry.constructor.extensionManagerVersion}getRequiredExtensionIds(e){if(this.extensionRegistry){const t=this.extensionRegistry.extensions;if(t){const i=t[e];if(i)return i.getRequiredExtensions().map((e=>e.id))}}return[]}dispose(){this.registryModified.removeAll(),this.extensionRegistry=null,this.loadPromise=Promise.resolve(),this.catalogs={}}}return v.ROOT_CATALOG=r.CatalogNamespaces.BASE,v})),define("vb/private/services/protocolRegistry",["signals","urijs/URI","vb/private/log","vb/private/utils","vb/private/services/catalogRegistry","vb/private/services/serviceConstants"],((e,t,i,r,n,s)=>{const a=i.getLogger("/vb/private/services/protocolRegistry"),o=["vb/private/services/catalogHandler","vb/extensions/protocol/vbExtensionHandler"],c=[s.ExtensionTypes.BACKENDS,s.ExtensionTypes.SERVICES];class l{constructor(t,i,r,s){this._registry={},this._config=t,this._activeProfile=i,this._tenantConfig=r,this._initPromise=null,this._listeners=[],this.opened=new e.Signal,this.registryModified=new e.Signal,this.catalogRegistry=s||new n}get extensionRegistry(){return this.catalogRegistry.extensionRegistry}init(){return this._initPromise||(this._initPromise=Promise.resolve().then((()=>r.getResources(o))).then((e=>(e.forEach((e=>{e.shouldInstall(this._config)&&e.PROTOCOLS.forEach((t=>{this._registry[t]=new e(this._config,this._activeProfile,this._tenantConfig,this.catalogRegistry)}))})),this.catalogRegistry.registryModified.add((()=>this.handleCatalogsChanged())),this)))),this._initPromise}get activeProfile(){return this._activeProfile}getTree(){return this.treePromise||(this.treePromise=this.getNames().then((e=>{const t=[];return e.forEach((e=>{e.namespaces.forEach((i=>{c.forEach((r=>{(i[r]||[]).forEach((n=>{const s=`${e.protocol}://${r}/${n}`,o=this.getResolvedInfo(s,i.namespace).then((e=>{const t={catalogUrl:s,type:r};return Object.assign(e,t)})).catch((e=>{a.warn("Ignoring missing catalog reference for mapping:",s,e)}));t.push(o)}))}))}))})),Promise.all(t).then((e=>e.filter((e=>!!e))))}))),this.treePromise}getResolvedInfoOrDefault(e,t,i){return this.getResolvedInfo(e,t,i).then((i=>{const r=i||l.createDefault(e);return this.opened.dispatch(e,r,t),r}))}getResolvedInfo(e,i,r){let n,a;return Promise.resolve().then((()=>this.init())).then((()=>{const n=t.parse(e);return n.protocol&&this._registry[n.protocol]?(a=this._registry[n.protocol],a.getResolvedObject(e,i,n,r).then((e=>{if(e){const t=[],i=this.extensionRegistry&&this.extensionRegistry.extensions[e.namespace],r=i&&i.version;return t.push({type:e.type,name:e.name,namespace:e.namespace,serviceType:e.serviceType,version:r,extensionAccess:e.extensionAccess,variables:e.variables}),Object.assign(e,{chain:t})}return null}))):null})).then((e=>(n=e,n?this.getResolvedInfo(n.url,e.namespace,r):null))).then((e=>{if(e){const t={};t[s.ExtensionTypes.SERVICES]=a.mergeExtensions(e.extensions[s.ExtensionTypes.SERVICES]||{},n.extensions[s.ExtensionTypes.SERVICES]||{});const i=a.getPropertiesForCrossObjectMerge(n,t[s.ExtensionTypes.SERVICES],s.ExtensionTypes.SERVICES,s.ExtensionTypes.BACKENDS);t[s.ExtensionTypes.BACKENDS]=a.mergeExtensions(e.extensions[s.ExtensionTypes.BACKENDS]||{},n.extensions[s.ExtensionTypes.BACKENDS]||{},i);const r=n.chain.slice().concat(e.chain),o=this.extensionRegistry&&this.extensionRegistry.extensions[n.namespace],c=o&&o.version;n={url:e.url,extensions:t,metadata:n.metadata,chain:r,name:n.name,namespace:n.namespace,version:c}}else n&&n.extensions&&n.extensions.services&&!n.extensions.backends&&(n.extensions.backends=Object.assign({},n.extensions.services));return n}))}getNames(){return this.namesPromise||(this.namesPromise=this.init().then((()=>{const e=[];return Object.keys(this._registry).forEach((t=>{if(this._registry[t].getNames){const i=this._registry[t].getNames().then((e=>Object.assign({protocol:t},{namespaces:e})));e.push(i)}})),Promise.all(e)})).catch((e=>(a.info("no catalog.json, continuing",e.toString()),[])))),this.namesPromise}handleCatalogsChanged(){this.namesPromise=null,this.treePromise=null,this.registryModified.dispatch()}disposeHandler(e){this._registry[e].dispose&&this._registry[e].dispose()}disposeCatalog(){Object.keys(this._registry).forEach((e=>{this.disposeHandler(e)})),this.catalogRegistry&&(this.catalogRegistry.dispose(),this.catalogRegistry=null)}static createDefault(e){return{url:e,extensions:{[s.ExtensionTypes.SERVICES]:{},[s.ExtensionTypes.BACKENDS]:{}},chain:[]}}}return l})),define("vb/private/configLoader",["vb/private/utils","vb/binding/expression","vb/private/log","vb/private/constants","vb/private/pathHandler","vb/private/services/protocolRegistry","vb/private/services/catalogRegistry","vbc/private/trace/tracer"],((e,t,i,r,n,s,a,o)=>{const c=i.getLogger("/vb/private/configLoader"),l=/^{@([A-Za-z][.\w-]*)}$/,h=(e,t=[],i)=>{if(e&&t.length){let r=e;return t.forEach((e=>{r=r&&r[e]})),!(!r||r===i)}return!1},p=(e,t,i)=>{c.warn("An extension has tried to replace an existing",e,'requireJS "paths" entry, ignoring:',t,":",i)},u=(e,t)=>{c.warn("Ignoring services global variable",e,"because its",t)};let d,g,v,f=!0;class m{constructor(){const e=window.vbInitConfig||{};this.requirePath=e.TEST_MODE===r.TestMode.UNIT_TEST?e.TEST_FIXTURE_PATH:"",this.userConfig=null,this.activeProfile=null,this.initParams=null,this.configurationDeclaration=null,this.servicesMap=null,this.catalogConfiguration=null,this.dtConfig={},this.runtimeEnvironment=null,this.extensionRegistry=null,this.currentRequireConfig={},this._servicesPromise=null,this.loadSecurityProviderPromise=null,this.servicesGlobalVariabless=null}static checkIfOverwrites(e,t,i){return h(e,t,i)}static get extensionRegistryModule(){return`vb/private/vx/${e.isHostApplication()?"v2":"v1"}/extensionRegistry`}init(){let t,i={};return m.initTracer(window.vbInitConfig).then((()=>this.getExtensionRegistry())).then((e=>{this.extensionRegistry=e})).then((()=>this.loadConfiguration())).then((r=>{let s;this.initParams=m.createInitParams(r),this.configurationDeclaration=m.createConfigurationDeclaration(r),this.servicesMap=r&&r.services||{},this.servicesGlobalVariables=m._getServiceGlobalVariables(r),this.catalogConfiguration=Object.assign({relativePath:this.requirePath,initConfig:window.vbInitConfig||{}},this.configurationDeclaration),this.activeProfile=this.catalogConfiguration.profile||"",t=this.configureLogging(r),r.localization&&(s=this.getEvaluatedSafe(r.localization.locale));const a={};if(r.translations&&Object.keys(r.translations).forEach((e=>{const t=r.translations[e],i=this.getEvaluatedSafe(t.merge);if(i&&"string"==typeof i&&t.path){const e=i,r=this.getEvaluatedSafe(t.path);if(r){const t=new n(r,"",{allowParent:!0});a[e]=t.getResolvedPath()}}})),r.requirejs&&"object"==typeof r.requirejs&&(i=this.getEvaluatedSafe(r.requirejs)),s&&(i.config=i.config||{},i.config.ojL10n=i.config.ojL10n||{},i.config.ojL10n.locale=s||i.config.ojL10n),Object.keys(a).length){i.config=i.config||{},i.config.ojL10n=i.config.ojL10n||{};const e=Object.assign({},i.config.ojL10n.merge,a);i.config.ojL10n.merge=e}return this.initializeUserConfig(r),this.dtConfig=r.dtConfig||{},e.getResource("vb/private/urlMapper").then((e=>{const t=window.vbInitConfig&&window.vbInitConfig.SERVICE_WORKER_CONFIG;g=new e(this.protocolRegistry,this.activeProfile,t)}))})).then((()=>this.getRuntimeEnvironment())).then((e=>e.getServiceWorkerRequireConfig())).then((r=>(r&&(i=e.cloneObject(r,i)),this.setConfiguration(i),this._getExternalPlugins().then((e=>{const r={requireConfig:i,logConfig:t,userConfig:this.userConfig};return(e&&e.length>0||Object.keys(i).length>0)&&(r.plugins=e),r})))))}static initTracer(t){return e.getRuntimeEnvironment().then((i=>{if("function"==typeof i.isOpenTraceEnabled&&i.isOpenTraceEnabled()){const i=e.getTraceOptions(t);return o.init(i)}return t&&t.TRACE_CONFIG&&(t.TRACE_CONFIG.disabled=!0),Promise.resolve()}))}loadConfiguration(){return this.getRuntimeEnvironment().then((e=>e.getApplicationDescriptor(`${this.requirePath}app`)))}getRuntimeEnvironment(){return this.runtimeEnvironment?Promise.resolve(this.runtimeEnvironment):e.getRuntimeEnvironment().then((e=>(this.runtimeEnvironment=e,e)))}getExtensionRegistry(){return e.getResource(this.constructor.extensionRegistryModule).then((e=>{const t=new e(this.loadConfiguration.bind(this),this.getRuntimeEnvironment.bind(this));return t.initialize().then((()=>t))}))}static createInitParams(e){const i=window&&window.vbInitParams||{},r=t.getEvaluatedSafe(e.configuration&&e.configuration.initParams||{},{});return Object.assign({},i,r)}static createConfigurationDeclaration(e){const t=window&&window.vbInitParams||{},i=e.configuration||{};return Object.assign(t,i)}getEvaluatedSafe(e){return t.getEvaluatedSafe(e,this.getExpressionContext())}getExpressionContext(){return{[r.ContextName.INIT_PARAMS]:this.initParams}}setConfiguration(t){e.isObjectOrArray(t)&&Object.keys(t).length>0&&(this.currentRequireConfig=m._mergeRequirejsConfig(this.currentRequireConfig,t),requirejs.config(t))}addRequirejsConfigFromContainer(t,i=!1){let r=t.definition&&t.definition.requirejs||{paths:{},bundles:{}};r=e.mergeObject(r,t.extension.componentsRequirejs);const n=this.getEvaluatedSafe(r);let s={};return n?(s=this.addRequirejsPaths(n,t.baseUrl,t.getResourceFolder(),i),this._addRequirejsBundles(n)):c.warn("Evaluation of requirejs configuration provided by extension",t.extensionId,"failed."),s}_addRequirejsBundles(e){const t=Object.assign({},e&&e.bundles);Object.keys(t).length>0&&this.setConfiguration({bundles:t})}addRequirejsPaths(t,i,r=i,n=!1){const s=Object.assign({},t&&t.paths),a=Object.keys(s);if(0===a.length)return{};const o={},c=this._getExistingRequirejsConfig(),l=c.map;a.forEach((t=>{let n=s[t];if(!e.isAbsoluteUrl(n)){delete s[t];const a="/"===n[0]?i:r,c=e.removeTrailingSlash(a),u=`${r}${t}`;"/"===n[0]&&(n=n.substring(1));const d=a+n;if(h(l,["*",u],d)||h(l,[c,t],d))p("",t,d);else{(o[c]||(o[c]={}))[t]=d;const e=o["*"]||(o["*"]={});e[u]=d;d.includes("/components/")&&(h(l,["*",t],d)?p("CCA",t,d):e[t]=d)}}else h(c,["paths",t],s[t])&&(p("",t,s[t]),delete s[t])}));const u=e.removeTrailingSlash(r);if(n){(o[u]||(o[u]={})).resources=`${u}/resources`}this.setConfiguration({paths:s,map:o});const d=e.cloneObject(this._getExistingRequirejsConfig());return d.containerContextPath=u,d}isResourceBundled(e){const t=this._getExistingRequirejsConfig();return!!t.bundles&&!!Object.keys(t.bundles).find((i=>t.bundles[i].find((t=>t===e))))}_getExistingRequirejsConfig(){if(f)try{return requirejs.s.contexts._.config}catch(e){c.warn("Unable to get requirejs configuration, using internal configuration and continuing."),f=!1}return this.currentRequireConfig}static _mergeRequirejsConfig(e,t){const i={};return(e.paths||t.paths)&&(i.paths=Object.assign({},e.paths,t.paths)),e.map&&(i.map={},Object.keys(e.map).forEach((r=>{i.map[r]=Object.assign({},e.map[r],t.map&&t.map[r])}))),t.map&&(i.map=Object.assign({},t.map,i.map)),i}_getExternalPlugins(){return this.loadSecurityProvider().then((t=>{if(t)return e.getResource("vb/private/types/defaultSecurityProvider").then((e=>t instanceof e?this.userConfig.configuration?this.userConfig.configuration.plugins:void 0:t.getServiceWorkerPlugins(this.userConfig.configuration))).then((t=>e.getRuntimeEnvironment().then((e=>e.getServiceWorkerPlugins().then((e=>e?t?t.concat(e):e.length>0?e:void 0:t))))))})).catch((e=>{c.error("Failed to load security provider",this.userConfig.type,e)})).finally((()=>{this.loadSecurityProviderPromise=null}))}configureLogging(e){let t;return e&&e.logConfig&&e.logConfig.level&&(t=this.getEvaluatedSafe(e.logConfig.level),i.setMinimumLevel(t)),{level:t}}getServices(){return this._servicesPromise||(this._servicesPromise=e.getResource("vb/private/services/services").then((e=>new e({relativePath:this.requirePath,serviceFileMap:this.servicesMap,expressionContext:this.getExpressionContext(),isUnrestrictedRelative:!0,protocolRegistry:this.protocolRegistry})))),this._servicesPromise}initializeUserConfig(e){this.userConfig=e.userConfig;const i=this.userConfig&&this.userConfig.configuration;if(i&&i.url){const e={[r.ContextName.INIT_PARAMS]:this.initParams};this.userConfig.configuration=Object.assign({},i,{url:t.getEvaluatedSafe(i.url,e)})}return this.userConfig}loadSecurityProvider(){return this.userConfig?(this.loadSecurityProviderPromise=this.loadSecurityProviderPromise||Promise.resolve().then((()=>{const{type:t}=this.userConfig;if(!t)throw new Error("Missing type in userConfig");return e.getResource(t).then((e=>new e))})),this.loadSecurityProviderPromise):Promise.resolve()}get protocolRegistry(){if(!d){const e={},t=this.userConfig&&this.userConfig.configuration&&this.userConfig.configuration.idcsInfo||this.dtConfig.idcsInfo;t&&(e.idcsInfo=t),d=new s(this.catalogConfiguration,this.activeProfile,e,this.catalogRegistry)}return d}get catalogRegistry(){return v||(v=new a(this.initParams[r.InitParams.SERVICES_SERVER_OVERRIDES])),v}get urlMapper(){return g||c.error("No UrlMapper available; ConfigLoader.init must be called first"),g}set protocolRegistry(e){d=e}static _collectServicesGlobalVariables(e){if(e){if(Object.keys(e).length>0)return Object.keys(e).filter((e=>"string"==typeof e&&e.length>"services.global.".length&&e.startsWith("services.global."))).map((t=>{const i=t.substring("services.global.".length),r=`{@${i}}`;if(l.test(r)){const r=e[t];return"string"==typeof r?[i,r]:void u(t,"value is not a string.")}u(t,"name is not valid.")})).filter((e=>e))}return[]}static _getServiceGlobalVariables(e){const t=window&&window.vbInitParams||{},i=e.configuration&&e.configuration.initParams,r=Object.assign({},t,i);return this._collectServicesGlobalVariables(r)}}return new m})),define("vb/private/configuration",[],(()=>{class e{static init(t){e.calculateApplicationUrl=t.calculateApplicationUrl,e.applicationUrl=t.applicationUrl,e.urlMarker=t.urlMarker||"vp",e.appName=t.appName,e.getBaseUrlFromConfig=t.getBaseUrlFromConfig}static getSandboxId(){const e=window.vbInitConfig||{};let t=(e.BASE_URL_TOKEN||"").split("sb:")[1];return t||(t=e.SANDBOX),t}}return e})),define("vb/private/history",["vb/private/utils","vb/private/constants","urijs/URI"],((e,t,i)=>{const r="vbState",n="replaceState";let s,a,o,c,l,h,p=null;class u{static init(e,t){window.onpopstate=e=>{u.popStateEventHandler(e),t&&t()},s={},a=new i,e||(c=i.parseQuery(a.search())),a.search(""),o=n,h=!1}static popStateEventHandler(t){if(p={state:u.state,url:a.href()},null===t.state){const e=new i(a).hash("");(new i).hash("").equals(e)||u.replaceState(null)}else u.replaceState(t.state.vbState);l&&(s.inputParameters=s.inputParameters||{},e.cloneObject(l,s.inputParameters),l=void 0),a=new i,c=i.parseQuery(a.search()),o=n}static resetUri(){if(!h){const e=u.getSearch(),t=u.getHash();a=new i,u.setSearch(e),u.setHash(t)}}static resetUrlParameters(){h||(u.setSearch(""),c={})}static setSkipMode(e){h=e}static getSkipMode(){return h}static get state(){return e.cloneObject(s)}static pushState(){o="pushState"}static replaceState(t){s=t?e.cloneObject(t):{}}static setUrlParameters(e){h||a.addSearch(e)}static addUrlParameter(e,t){h||void 0!==t&&a.addSearch(e,t)}static setUrlParameter(e,t){h||(void 0!==t?a.setSearch(e,t):a.removeSearch(e))}static getUrlParameter(e){return c[e]}static getSearch(){return a.search()}static setSearch(e=""){h||a.search(e)}static getHash(){return a.hash()}static setHash(e=""){a.hash(e)}static setInputParameters(t){s.inputParameters={},e.cloneObject(t,s.inputParameters)}static getInputParameters(){return s.inputParameters||{}}static setNavNavBackParams(e){l=e}static setPagePath(e){s.pagePath=e}static getPagePath(){return s.pagePath}static setVariable(e,t,i){const r=`${e}.${t}`;void 0!==i?(s.variables||(s.variables={}),s.variables[r]=i):s.variables&&delete s.variables[r]}static getVariable(e,t){const i=`${e}.${t}`;return s.variables&&s.variables[i]}static getVariables(){return s.variables||{}}static back(){window.history.back()}static sync(){const t=a.href();if(p=null,o===n){let i=window.history.state;const r=i&&i.vbState;return t!==window.location.href||e.diff(s,r)?(Object.keys(s).length>0?(i||(i={}),i.vbState=s):i&&delete i.vbState,e.changeBrowserState(i,t,o)):Promise.resolve()}return e.changeBrowserState({[r]:s},t,o).then((()=>{o=n}))}static restoreStateBeforeHistoryPop(){return p?(s=p.state,a=new i(p.url),u.sync()):Promise.resolve()}}return u})),define("vb/private/stateManagement/navigationContext",["vb/private/log","vb/private/utils"],((e,t)=>{const i=e.getLogger("/vb/stateManagement/navigationContext"),r="active",n="cancelled";return class{constructor(e,i){this.status=r,this.container=e,this.options=i,this.id=t.generateUniqueId(),this.navigatePromise=null,this.pages=[]}navigate(){return this.navigatePromise=this.navigatePromise||this.container.navigateOperation(this.options,this),this.navigatePromise}cancel(){i.info("A new navigation cancelled navigation to",this.options.page),this.status=n}isActive(){return this.status===r}isCancelled(){return this.status===n}equals(e,i){return this.container===e&&!t.diff(this.options,i)}clean(){for(;this.pages.length;)this.pages.pop().dispose()}}})),define("vb/private/stateManagement/router",["ojs/ojrouter","ojs/ojcontext","vb/private/log","vb/private/utils","vb/private/constants","vb/private/configuration","vb/private/history","vb/private/stateManagement/navigationContext","urijs/URI"],((e,t,i,r,n,s,a,o,c)=>{const l=/^(tel:|sms:|mailto:|geo:)/,h=new RegExp("^(http|https):","i"),p=new Map([["txt","text/plain"],["text","text/plain"],["rtf","text/rtf"],["csv","text/csv"],["pdf","application/pdf"],["doc","application/msword"],["xls","application/vnd.ms-excel"],["ppt","application/vnd.ms-powerpoint"],["mp4","video/mp4"],["mp3","audio/mpeg"]]),u=()=>new Error("The target option is only valid with flow");class d{constructor(){this.log=i.getLogger("/vb/stateManagement/router"),a.init(!1,this.popStateEventListener.bind(this)),this.removeAccessTokenFromUrlFragment(),this.pendingNavigations={},this.application=null,this._baseUrl=requirejs.toUrl(""),this.log.info("Loading application resources from",this.baseUrl),this.sync=e.sync}get baseUrl(){return this._baseUrl}init(t,i){this.router=t,this.stateId=t.stateId,e.defaults.baseUrl=s.applicationUrl,this.log.info("Application URL is",s.applicationUrl);let r=d.prototype.goWithoutUrlMarker;if(i===n.RouterStrategy.QUERY){const t=e.defaults;t.rootInstanceName="page",t.urlAdapter=new e.urlParamAdapter}else s.appName||(this.log.info("Using navigation with URL marker:",s.urlMarker),r=d.prototype.goWithUrlMarker);d.prototype.go=r,this.setBusyState()}popStateEventListener(){this.setBusyState();const e=this.getCurrentPage();e&&e.fullPath===a.getPagePath()&&Promise.resolve().then((()=>(e.refreshInputParameters(),e.invokeAfterNavigateEvent()))).finally((()=>{this.clearBusyState()}))}pushState(e){this.historyStack||Object.defineProperty(this,"historyStack",{value:[this.application.getCurrentPagePath()],enumerable:!0,configurable:!0}),this.historyStack.push(e)}popState(){return this.historyStack&&this.historyStack.length>0?this.historyStack.pop():null}peekState(){return this.historyStack&&this.historyStack.length>0?this.historyStack[this.historyStack.length-1]:null}goWithoutUrlMarker(...e){return this.router.go(...e)}goWithUrlMarker(...e){const t=[...e];let i=t[0];return i=`/${s.urlMarker}/${i}`,t[0]=i,this.router.go(...t)}validateNavigationOptions(e,t){let{page:i,flow:r,application:s,target:a,operation:o}=t;if("string"==typeof i&&(i=i.trim()),"string"==typeof r&&(r=r.trim(),r.indexOf("/")>0))throw new Error(`The flow parameter "${r}" cannot be a path, it should be a flow id.`);if("string"==typeof a&&(a=a.trim()),o===n.NavigateOperation.PAGE_OLD){if(!i)throw new Error("Cannot navigate to an undefined path.")}else if("string"==typeof s){if(a)throw u();if(s=s.trim(),s.length>0&&!this.application.doesAppUiExist(s))throw new Error(`The App UI ${s} does not exist.`);o=n.NavigateOperation.APP_UI}else if("string"==typeof r)o=n.NavigateOperation.FLOW;else{if("string"!=typeof i)throw new Error("Cannot navigate to an undefined location.");if(a)throw u();o=n.NavigateOperation.PAGE}const c={page:i,flow:r,application:s,target:a,operation:o,params:t.params,history:t.history};return e.validateNavigation(c),c}queueNavigate(e,t){return Promise.resolve().then((()=>this.validateNavigationOptions(e,t))).then((t=>e.validateNavigationInDt(t).then((i=>{if(!i)return{navigated:!1};let r=this.getPendingNavigation(e,t);return r?r.navigatePromise:(this.cancelPendingNavigations(),r=this.addPendingNavigation(e,t),this.setBusyState(),r.navigate().then((e=>(e&&!1===e.navigated&&this.clearBusyState(),e))).catch((e=>{throw this.clearBusyState(),e})).finally((()=>{this.deletePendingNavigation(r)})))})))).catch((e=>{throw this.log.error(e),e}))}addPendingNavigation(e,t){const i=new o(e,t);return this.pendingNavigations[i.id]=i,i}deletePendingNavigation(e){e.isCancelled()?this.log.info("Ending cancelled navigation to:",e.options):this.log.info("Ending executed navigation to:",e.options),delete this.pendingNavigations[e.id]}getPendingNavigation(e,t){const i=Object.values(this.pendingNavigations);for(let r=0;r<i.length;r+=1){const n=i[r];if(n.equals(e,t))return n}return null}cancelPendingNavigations(){Object.values(this.pendingNavigations).forEach((e=>{e.isActive()&&e.cancel()}))}navigateToExternal(e){const t=r.resolveIfObservable(e.url);if(!t)throw new Error("The property url is a required parameter for navigateToExternal action.");const i=this.application.getCurrentPagePath();this.application.runtimeEnvironment.canNavigateToUrl(i,t).then((i=>{if(i){const i=new c(t);e.params&&i.addSearch(e.params),e.hash&&i.hash(e.hash),e.history===n.HistoryMode.REPLACE?window.location.replace(i.href()):window.location.assign(i.href())}}))}openUrl(e){const t=r.resolveIfObservable(e.url);if(null==t)throw new Error('The property "url" is required for openUrl.');let i=e.windowName||"_self";if(i.indexOf(" ")>=0)throw new Error('The property "windowName" should not contain whitespace.');return this.application.runtimeEnvironment.canOpenUrl(this.application.getCurrentPagePath(),t,e.windowName).then((s=>{if(s){const s=new c(t);e.params&&s.addSearch(e.params),e.hash&&s.hash(e.hash);const a=s.href();if(r.isMobile()){if(this.canOpenMobileFile(a))return this.openMobileFile(a);a.match(l)&&!e.windowName&&(i="_system"),window.open(a,i)}else"_self"===i?e.history===n.HistoryMode.REPLACE?window.location.replace(a):window.location.assign(a):window.open(a,i)}return Promise.resolve()}))}navigateBack(e,t){this.setBusyState(),this.application.runtimeEnvironment.canNavigateBack(e.fullPath).then((e=>{e?(a.setNavNavBackParams(t.params),this.doNavigateBack()):this.clearBusyState()}))}doNavigateBack(){a.back()}getPageInternal(e){if(!e)return null;const t=e.currentState();if(!t)return null;const i=t.id,r=t.value;if(!r||!r.router)return null;const n=r.router.getChildRouter(encodeURIComponent(i)),s=this.getPageInternal(n);return s||r.getContainer(i)}getCurrentPage(){return this.getPageInternal(this.router)}getContainer(e,t){const i=t.indexOf("/");if(i>0){const r=t.substring(0,i);return this.getContainer(e.getContainer(r),t.substr(i+1))}return e.getContainer(t)}buildSearch(e,t=[],i=[]){const r=e.currentState();if(r){const n=e.name,s=r.id;t.push({name:n,id:s}),s!==e.defaultStateId&&(i=i.concat(t),t=[]);const a=r.value.router.getChildRouter(s);if(a)return this.buildSearch(a,t,i)}return i}updateState(e){if(this.application.isQueryStrategy()){this.buildSearch(this.router).forEach((e=>{a.addUrlParameter(e.name,e.id)}))}a.setPagePath(e)}getUrlFromPath(t=""){let i;if("/"===t[0]&&(t=t.substring(1)),i=this.application.started?new c(""):new c,this.application.isQueryStrategy()){if(t){const r=t.split("/");let n=e.defaults.rootInstanceName;r.forEach((e=>{i.addSearch(n,e),n=e}))}return i.search()}return s.appName?`${t}${i.search()}`:`${s.urlMarker}/${t}${i.search()}`}parseFragment(e){const t=new c(e);return c.parseQuery(t.fragment())}removeAccessTokenFromUrlFragment(){const{location:e}=window,t=e.hash;t&&!r.isMobile()&&(t.indexOf("token_type")>0||t.indexOf("access_token")>0)&&window.history.replaceState(window.history.state,"",e.pathname+e.search)}getUrlSegmentAfterAppName(){let e;if(s.appName){const t=window.location.pathname;e=t.substring(t.indexOf(s.appName)+s.appName.length+1);const i=e.indexOf("/");i>=0&&(e=e.substring(0,i))}return e}setBusyState(){if(!this.busyStateResolver){const e=t.getPageContext().getBusyContext();this.busyStateResolver=e.addBusyState({description:"VB Router"})}}clearBusyState(){this.busyStateResolver&&(this.busyStateResolver(),delete this.busyStateResolver)}canOpenMobileFile(e){if(!h.test(e)){const t=e.substr(e.lastIndexOf(".")+1);return!(!t||!p.get(t))}return!1}getMobileFileExtensionMimeType(e){const t=e.substr(e.lastIndexOf(".")+1);return t&&p.get(t)?p.get(t):""}openMobileFile(e){const t=this.getMobileFileExtensionMimeType(e);return t?new Promise(((i,r)=>{cordova.plugins.fileOpener2.open(e,t,{error(e){r(e)},success(){i()}})})):Promise.reject(new Error("Cannot open unsupported file."))}}return new d})),define("vb/private/mobile/customUrlScheme",["vb/private/configLoader","vb/private/stateManagement/router","urijs/URI"],((e,t,i)=>new class{handleDeepLinkUrl(i){if(!i)return;const r=e.userConfig;r&&r.configuration&&r.configuration.idcsInfo&&r.configuration.idcsInfo.oAuthRedirectEndpoint&&i.startsWith(r.configuration.idcsInfo.oAuthRedirectEndpoint)||(this.deepLinkUrl=i,t.application&&this.performNavigationIfNeeded())}performNavigationIfNeeded(){if(this.deepLinkUrl){const e=new URL(this.deepLinkUrl),{protocol:r}=e,{search:n}=e,{hash:s}=e;let a=this.deepLinkUrl.replace(r,"");a=a.replace(n,""),a=a.replace(s,""),a&&a.startsWith("//")&&(a=a.substring(2));const o=new i(t.getUrlFromPath(a)),c=new i(this.deepLinkUrl);c.addSearch(o.search(!0));const l=c.search();window.location.href=`index.html${l}`}}})),define("vb/private/debug/constants",[],(()=>{const e={MessageType:{DEBUGGEE:"vbDebuggeeMessage",DEBUGGER:"vbDebuggerMessage"},ResponseType:{DEBUGGEE:"vbDebuggeeResponse",DEBUGGER:"vbDebuggerResponse"},DebuggeeType:{APPLICATION:"application",ACTION_CHAIN:"actionChain"},DebugState:{CHAIN_STARTING:"chainStarting",CHAIN_FINISHED:"chainFinished",ACTION_STARTING:"actionStarting",ACTION_RUNNING:"actionRunning",ACTION_SUSPENDED:"actionSuspended",ACTION_FINISHED:"actionFinished",DESCRIPTORS_LOADED:"descriptorsLoaded"}};return e})),define("vb/private/debug/debugStream",["vb/private/utils","vb/private/debug/constants","vb/private/constants"],((e,t,i)=>{class r{constructor(t){this.vbConfig=window.vbInitConfig||{},this.id=e.generateUniqueId(),this.type=t,this.isDebuggerInstalled&&this.installDebuggeeMessageListener()}get isDebuggerInstalled(){return this.vbConfig.debuggerInstalled}get isTestMode(){return this.vbConfig.TEST_MODE===i.TestMode.ACTION_CHAIN}get isEnabled(){return this.isDebuggerInstalled||this.isTestMode}postDebuggeeResponse(e,i,r){const n={type:t.ResponseType.DEBUGGEE,debuggeeId:this.id,debuggeeType:this.type,method:i};Promise.resolve(r).then((t=>{n.success=!0,n.result=t,e.postMessage(n)})).catch((t=>{n.success=!1,n.error=JSON.stringify(t),e.postMessage(n)}))}invokeDebuggeeMethod(e,t){const i=e.method,r=e.args||[];this.postDebuggeeResponse(t,i,this[i](...r))}installDebuggeeMessageListener(){this.debuggeeMsgListener=e=>{const i=e.data,r=i.type;if("vbDebuggerUninstalled"===r)this.debuggerUninstalled();else if(r===t.MessageType.DEBUGGEE){const t=i.message;t.debuggeeId===this.id&&this.invokeDebuggeeMethod(t,e.ports[0])}},window.addEventListener("message",this.debuggeeMsgListener,!1)}postDebuggerMessage(e){return new Promise((i=>{const r=new MessageChannel;r.port1.onmessage=e=>{console.log("Response received from the debugger",e.data);const t=e.data;t.success?i(t.result):(console.log(t.err),i())},r.port1.onmessageerror=()=>{console.log("Failed to send message to the debugger."),i()},window.postMessage({type:t.MessageType.DEBUGGER,message:e},"*",[r.port2])}))}invokeDebuggerMethod(e,...t){return this.postDebuggerMessage({debuggeeId:this.id,method:e,args:t})}registerDebuggee(e){return this.invokeDebuggerMethod("registerDebuggee",this.type,e)}fireStateChanged(e,t){if(this.isDebuggerInstalled){const i={state:e,data:t};return this.invokeDebuggerMethod("fireStateChanged",i)}return Promise.resolve()}debuggerUninstalled(){}dispose(){this.debuggeeMsgListener&&window.removeEventListener("message",this.debuggeeMsgListener)}static sanitize(t){if(e.isExtendedType(t))return r.cloneObject(t.value);if("function"==typeof t)return t.toString();if(t instanceof Headers){const e={};for(const i of t.entries())i&&i.length>=2&&(e[i[0].toLowerCase()]=i[1]);return e}return!t||e.isPrimitive(t)||e.isPrototypeOfObject(t)?t:t.toString()}static cloneObject(t,i){let n=i;if(void 0===i){if(!e.isCloneable(t))return r.sanitize(t);n=Array.isArray(t)?[]:{}}for(const i in t){const s=t[i],a=n[i];let o;if(n===s)return n;const c=Array.isArray(s);e.isCloneable(s)?(o=c?[]:a&&e.isObject(a)?a:{},n[i]=r.cloneObject(s,o)):n[i]=r.sanitize(s)}return n}}return r})),define("vb/private/debug/applicationDebugStream",["vb/private/debug/debugStream","vb/private/utils","vb/private/debug/constants","vb/private/configuration"],((e,t,i,r)=>new class extends e{constructor(){super(i.DebuggeeType.APPLICATION),this.loadedDescriptorMap={},this.installDebuggeeMessageListener()}handShake(){return this.invokeDebuggerMethod("handShake").then((e=>(e&&(console.log("Debugger hand shake successful",e),window.vbInitConfig.debuggerInstalled=!0,this.registerDebuggee().then((()=>this.descriptorsLoaded(this.loadedDescriptorMap)))),e))).catch((e=>{}))}registerDebuggee(){const t={vb:e.cloneObject(window.vb),vbInitConfig:e.cloneObject(window.vbInitConfig),debuggerState:this.loadDebuggerState()};return super.registerDebuggee(t)}get debuggerStateStorageId(){return this.storageId||(this.storageId=`vb-debugger-state-${r.applicationUrl}`),this.storageId}loadDebuggerState(){const e=localStorage.getItem(this.debuggerStateStorageId);return e?JSON.parse(e):{}}storeDebuggerState(e){localStorage.setItem(this.debuggerStateStorageId,JSON.stringify(e))}updateDebuggerState(e,t){const i=this.loadDebuggerState();i[e]=t,this.storeDebuggerState(i)}descriptorLoaded(e,t,i){let r;return r="Page"===i.className?`${e}-page.json`:`${e}-flow.json`,this.loadedDescriptorMap[r]=t,this.isDebuggerInstalled?this.descriptorsLoaded({[r]:t}):Promise.resolve()}descriptorsLoaded(e){return this.fireStateChanged(i.DebugState.DESCRIPTORS_LOADED,e)}})),define("text!vbVersions/versions.json",[],(function(){return'{\n  "visualDevelopmentPlatform": {\n    "version": "2304.0.2",\n    "sprint": "Kamori",\n    "commit": "a30133b00 2023-03-24T13:45:25-07:00"\n  },\n  "jet": {\n    "version": "13.1.5",\n    "cdnPath": "https://static.oracle.com/cdn/jet/",\n    "revision": "2023-01-11_10-21-51"\n  },\n  "workbox": {\n    "version": "6.5.4",\n    "cdnPath": "https://static.oracle.com/cdn/vb/workbox/releases/"\n  }\n}\n'})),define("vb/versions",["text!vbVersions/versions.json"],(e=>{const t=JSON.parse(e);return window.vb=window.vb||{},Object.assign(window.vb,t.visualDevelopmentPlatform),window.vb.jet=t.jet,window.vb.workbox=t.workbox,t})),define("vb/private/rtEnvConfig",[],(()=>{class e{constructor(){const t=e.getCommunicationConfig(window.vbInitConfig||{},window.location.href);this.module=t.module,this.environmentClass=t.environmentClass,requirejs.config({map:{"*":{vbRuntimeEnvironmentClass:t.environmentClass}}})}static getCommunicationConfig(e,t){const i=Object.assign({},e),r={environmentClass:i.RUNTIME_ENV_CLASS||"vb/private/helpers/runtimeEnvironment",module:""};try{if(i.EDITOR_URL&&t){const{searchParams:e}=new URL(t),n=e.get("vbdt:editModeComChannelUrl"),s=e.get("vbdt:editModeComChannelClass");if(n&&s){if(!n.startsWith(i.EDITOR_URL))try{const e=new URL(i.EDITOR_URL),t=`${e.protocol}//${e.hostname}${e.pathname}`;if(!n.startsWith(t))return r}catch(e){return console.warn("Invalid Editor URL:",i.EDITOR_URL),r}r.module=n,r.environmentClass=s}}}catch(e){}return r}}return e})),function(){window.oj_whenReady=!0;const e=window.vbInitConfig||{};e.IS_MOBILE&&(window.handleOpenURL=e=>{console.log(`handleOpenURL is invoked with: ${e}`),requirejs(["vb/private/mobile/customUrlScheme"],(t=>{t.handleDeepLinkUrl(e)}))});const t=document.currentScript.src,i=t.substring(0,t.indexOf("visual-runtime")),r=(e,t={},i="vp")=>{const r=t.APP_NAME;if(r){const t=new RegExp(`/${r}$|/${r}/`,"g").exec(e.pathname);if(t){let i=e.origin+e.pathname.substring(0,t.index+1+r.length);return"/"!==i.slice(-1)&&(i+="/"),i}}let n=e.origin+e.pathname;const s=n.indexOf(`/${i}/`);if(s>0)n=n.substring(0,s+1);else if(n.substring(n.length-i.length-1)===`/${i}`)n=n.substring(0,n.length-i.length-1);else for(const e of["index.html","sw.js","debug.html","context.html"]){const t=n.indexOf(e);if(t>0){n=n.substring(0,t);break}}return n.endsWith("/")||(n+="/"),n},n={calculateApplicationUrl:r,appName:e.APP_NAME,urlMarker:"vp",applicationUrl:r(window.location,e),getBaseUrlFromConfig:(e,t,i)=>{if(t.IS_MOBILE)return i;let r=t.BASE_URL;if(!r){r=i;const n=t.BASE_URL_TOKEN;n&&(r="/"===n[0]?`${e.origin}${n}`:`${r}${n}`)}return r.endsWith("/")||(r+="/"),r}};function s(){var t;navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&window.addEventListener("message",(t=>{const i=t.data.type;"vbDebuggerHandShake"===i?requirejs(["vb/private/debug/applicationDebugStream","vb/versions"],(e=>{e.handShake()})):"vbDebuggerUninstalled"===i&&(console.log("Debugger extension uninstalled"),e.debuggerInstalled=!1)}),!1),t=()=>{requirejs(["vb/private/constants"],(t=>{navigator.webdriver&&requirejs.config({paths:{vbtu:`${i}vb-test-utils`,chai:`${i}vb-test-utils`},bundles:{vbtu:["vbtu/testUtils"]}}),requirejs(["vb/private/utils","vb/private/configuration","vb/private/configLoader"],((r,s,a)=>{s.init(n),e.TEST_MODE===t.TestMode.ACTION_CHAIN?(console.log("Starting VB in action chain test mode."),window.postMessage({type:"vbActionChainTesterHandShake"},window.location.origin)):a.init().then((t=>function(t,r,n){if(e.SERVICE_WORKER_CONFIG&&e.SERVICE_WORKER_CONFIG.skipInstall)return Promise.resolve();let s;return t.getResource("vb/private/serviceWorker/serviceWorkerManagerFactory").then((t=>t.createServiceWorkerManager(e))).then((e=>(s=e.getInstance(),s.installServiceWorkers(i,r,n)))).then((()=>s.installOfflineHandler()))}(r,t,s).then((()=>r.getResource("vb/bootstrap"))).then((e=>e())))).then((()=>{e.TEST_MODE===t.TestMode.UNIT_TEST&&(console.log("Starting VB in unit test mode."),window.postMessage({type:"vbUnitTestHandShake"},window.location.origin))}))}))}))},requirejs(["vb/private/rtEnvConfig"],(e=>{const i=e&&(new e).module;i?requirejs([i],t):t()}))}Object.keys(e).length>0&&requirejs.config(function(t){const r={config:{text:{useXhr:()=>!0}}};return"actionChain"!==e.TEST_MODE&&"unitTest"!==e.TEST_MODE&&(r.baseUrl=n.getBaseUrlFromConfig(window.location,e,n.applicationUrl)),r.map={"*":{"vb/ServiceDataProvider":"vb/private/types/serviceDataProvider","vb/ServiceDataProvider2":"vb/private/types/dataProviders/serviceDataProvider2","vb/MultiServiceDataProvider":"vb/private/types/multiServiceDataProvider","vb/MultiServiceDataProvider2":"vb/private/types/dataProviders/multiServiceDataProvider2","vb/ArrayDataProvider":"vb/private/types/arrayDataProvider","vb/ArrayDataProvider2":"vb/private/types/arrayDataProvider2","vb/MetadataDescriptor":"vb/private/types/metadataDescriptor","vb/DefaultSecurityProvider":t?"vb/private/types/mobileDefaultSecurityProvider":"vb/private/types/defaultSecurityProvider","vb/UserSecurityProvider":"vb/private/types/defaultSecurityProvider","vb/RestHookHandler":"vb/helpers/restHookHandler","vb/extensions/process/ProcessDataProvider":"vb/extensions/process/private/types/processDataProvider","vb/ServiceRampTransforms":"vb/private/services/ramp/rampTransforms","vb/BusinessObjectsTransforms":"vb/private/services/ramp/rampTransforms","vb/BusinessObjectServiceTransforms":"vb/private/services/boss/bossTransforms","vb/FactoryMetadataProviderDescriptor":"vb/private/types/factoryMetadataProviderDescriptor","vb/extensions/dynamic/ServiceMetadataProviderFactory":"vb/extensions/dynamic/private/factories/serviceMetadataProviderFactoryBridge","vb/extensions/dynamic/JsonMetadataProviderFactory":"vb/extensions/dynamic/private/factories/jsonMetadataProviderFactoryBridge","vb/extensions/dynamic/DynamicLayoutMetadataProviderFactory":"vb/extensions/dynamic/private/factories/dynamicLayoutMetadataProviderFactoryBridge","vb/JsonMetadataProviderDescriptor":"vb/extensions/dynamic/private/types/jsonMetadataProviderDescriptor","vb/ServiceMetadataProviderDescriptor":"vb/extensions/dynamic/private/types/serviceMetadataProviderDescriptor","vb/DynamicLayoutMetadataProviderDescriptor":"vb/extensions/dynamic/private/types/dynamicLayoutMetadataProviderDescriptor","vb/ContainerMetadataProviderDescriptor":"vb/extensions/dynamic/private/types/containerMetadataProviderDescriptor","vb/HeterogeneousMetadataProviderDescriptor":"vb/extensions/dynamic/private/types/heterogeneousMetadataProviderDescriptor",main:"vb/main",vbIconFontCss:`css!${i}resources/vb-icon-font`,opt:"persist"}},r}(e.IS_MOBILE)),e.IS_MOBILE?document.addEventListener("deviceready",(function(){s(),window.open=cordova.InAppBrowser.open,document.body.classList.add(`oj-platform-${cordova.platformId}`),navigator.splashscreen.hide(),function(){if(window.Keyboard){window.Keyboard.shrinkView(!0);const e=e=>{const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)};window.addEventListener("keyboardDidShow",(()=>{const t=document.activeElement;t&&window.innerHeight<window.screen.height&&window.setTimeout((()=>{e(t)||t.scrollIntoView()}),100)}),!1)}}()}),!1):!function(){try{return window.self!==window.top&&"vb-refresh-access-token-iframe"===window.frameElement.id}catch(e){return!1}}()?s():window.parent.postMessage({method:"vbRefreshAuthToken",args:[window.location.hash]},window.location.origin)}(),define("generated/vb/main",(function(){})),define("vb/private/stateManagement/scopeResolver",["vb/private/constants"],(e=>class{constructor(e={}){Object.assign(this,e)}isThis(t){return this[t]===this[e.THIS_PREFIX]}})),define("vb/private/stateManagement/stateUtils",["vb/private/constants","vb/binding/expression","vb/private/utils","vb/private/stateManagement/scopeResolver","vb/private/log","acorn","acorn-walk"],((e,t,i,r,n,s,a)=>{const o=n.getLogger("/vb/stateManagement/stateUtils");class c{static isVariableDefInstanceFactoryType(e,t){const r=c.getVariableDefConstructorFactoryType(e,t);return r&&i.isTypeDefInstanceFactory(r)}static getVariableDefConstructorFactoryType(e,t){const r=i.isInstanceType(e.type)&&c.resolveType(e.type,t,!0),n=r&&r.type;return n&&n.type&&n.type.constructorType}static createVariableDefaultValue(e,t,n=new r,s=null,a={},o,l){return Promise.resolve().then((()=>{const r=c.isVariableDefInstanceFactoryType(t,n),h=i.isInstanceType(t.type);return r?l?c.createNonInstanceTypeDefaultValue(e,{type:"any",defaultValue:void 0},n,a):c.createNonInstanceTypeDefaultValue(e,{type:"any",defaultValue:t.constructorParams},n,a):h?c.instantiateType(e,t,n,s,a,o,l).catch((()=>{throw new Error(`Unknown built-in type: ${t.type}.`)})):c.createNonInstanceTypeDefaultValue(e,t,n,a)}))}static createNonInstanceTypeDefaultValue(e,t,i,r){const n=c.getType(e,t,i),s={};if(!t.resolved&&!c.typeCheck(e,n,t,t.defaultValue,s))throw o.warn(`${s.message}:`,s),new Error(`${s.message}.`);return c.buildVariableDefaults(e,r,n,t.defaultValue)}static getDepVarExpressions(e,i,r={original:[],functions:[]}){if(!i)return r;if(t.isExpression(i)){const n=(t=>{let i="";i+=`return ${t};`;try{return new Function("injectedContext",i)}catch(i){return o.warn("Unable to parse expression:",t,"set on variable",e,". The variable will","not have a default value"),()=>{}}})(t.getExpression(i));r.original.push(i),r.functions.push(n)}else"object"==typeof i&&(Array.isArray(i)?i.forEach((t=>c.getDepVarExpressions(e,t,r))):Object.keys(i).forEach((t=>c.getDepVarExpressions(e,i[t],r))));return r}static buildVariablesDependenciesGraph(t,i){const r={},n={};return Object.keys(t).forEach((e=>{const n=t[e],s=c.isVariableDefInstanceFactoryType(n,i)?n.constructorParams:n.defaultValue,a=c.getDepVarExpressions(e,s);a&&a.original.length>0&&(r[e]={expressions:a})})),Object.keys(r).forEach((t=>{const i=r[t],c=r[t].expressions;(c&&c.functions||[]).forEach(((r,l)=>{let h;const p=c.original[l],u=n[p];try{h=u||s.parse(r,{ecmaVersion:"latest"}),u||(n[p]=h),a.fullAncestor(h,((t,r)=>{const n=t.name;((e=[],t)=>{let i=e.length-1;for(i=i<0?0:i;i;){const r=e[i-1]||null,n=e[i-2]||null;t(e[i],r,n),i-=1}})(r,((t,r,s)=>{if("Identifier"===t.type&&-1!==e.ALL_SCOPES.indexOf(n)){let e,t;if(i.variables=i.variables||[],"$variables"!==n?r&&"MemberExpression"===r.type&&r.object.name===n&&r.property&&"variables"===r.property.name&&(t={scopeName:n},e=s):(t={},e=r),e&&e&&"MemberExpression"===e.type){const r=e.property;r&&("Identifier"===r.type?t.variableName=r.name:"Literal"===r.type&&(t.variableName=r.value)),t.variableName&&i.variables.push(t)}}}))}))}catch(e){o.warn("Unable to parse expression:",p,"set on variable",t,"using Acorn parser!")}}))})),r}static parseChain(t){const i=t.split(":");return 1===i.length&&i.unshift(e.THIS_PREFIX),i}static parseChainModulePath(t){const i=t.split("/");let r;return r="chains"===i[0]?"application":"flows"===i[0]?"flow":e.THIS_PREFIX,[r,i[i.length-1],!1]}static parseType(t){let r,n;const s=i.parseQualifiedIdentifier(t,{prefixToken:":",suffixToken:""}),a=s.main;if(s.prefix){let t=s.prefix;t.startsWith("/")&&(t=`${e.ExtensionNamespaces.BASE}${t}`);const a=i.parseQualifiedIdentifier(t,{prefixToken:"/",suffixToken:""});r=a.prefix,n=a.main}return n||(n=e.THIS_PREFIX),{extId:r,scope:n,name:a}}static retrieveScope(t,i,r,n){const s=t[e.THIS_PREFIX];if(!i){const i=t[r];return r===e.GLOBAL_PREFIX&&s.package?i&&i.isInterfaceType(n)?i:null:i}const a=s.base;if(!a)return null;if(i===e.ExtensionNamespaces.BASE||i===a.extensionId){const e=a.scopeResolver[r];return e&&e.isInterfaceType(n)?e:null}return c.retrieveScope(a.scopeResolver,i,r,n)}static resolveType(e,t=new r,i=!1){const n=c.parseType(e),s=n.scope,a=n.name,o=c.retrieveScope(t,n.extId,s,a);let l;return o?(l=i?o.hasType(a)?o.getType(a):void 0:o.getType(a),{scopeResolver:o.scopeResolver,type:l,scopeName:s}):{}}static resolveChain(e,t=new r,i){return Promise.resolve().then((()=>{const r=c.parseChain(e),n=t[r[0]];return n?n.loadChain(r[1],i):null}))}static resolveContainer(e,t=new r){return t[c.parseChain(e)[0]]}static getType(e,t,n=new r,s={}){if(t.resolved)return t.type;if(!t||!t.type)throw new Error(`Type for '${e}' was not defined.`);let a=t.type;if(a.enumType&&(a=a.enumType),"string"==typeof a){if(a=a.trim(),["string","boolean","number","any"].some((e=>a===e)))return a;if(i.isInstanceType(a)){const e=c.getVariableDefConstructorFactoryType(t,n);return e&&i.isTypeDefInstanceFactory(e)?e:a}if("object"===a&&!t.definition)return a;if("object"===a||"array"===a)return a=c.resolveLegacyType(e,t,n),o.warn(`Deprecated type definition for variable '${e}'.`),a;const r=a.endsWith("[]");if(r&&["string","boolean","number","any","object"].some((e=>a.startsWith(e))))return a;let l=a;r&&(l=l.substring(0,l.length-2));let h=s[l];if(!h){const t=c.resolveType(l,n),i=t&&t.type;if(!i)throw new Error(`Type for '${e}' references '${l}' which is not defined.`);i.constructedType={},s[l]=i.constructedType;const r=n.isThis(t.scopeName);h=c.getType(e,i,t.scopeResolver,r?s:{})}return r?[h]:h}if(i.isObject(a)){const i=t.constructedType||{},r=Object.entries(a);if(0===r.length)throw new Error(`Type for '${e}' contains an empty map, did you mean to use 'object'?`);return r.forEach((e=>{const t=e[0],r=e[1];i[t]=c.getType(t,{type:r},n,s)})),i}if(Array.isArray(a)){if(0===a.length)throw new Error(`Type for '${e}' contains an empty array, did you mean to use 'string[]'?`);if(a.length>1)throw new Error(`Type for '${e}' contains an array type that contains more than one item.`);const t=a[0];if(!i.isObjectOrArray(t))throw new Error(`Type for '${e}' contains an invalid array type, did you mean to use 'string[]'?`);return[c.getType(e,{type:t},n,s)]}throw new Error(`Type for '${e}' was not recognized.`)}static resolveLegacyType(e,t,i){const r=t.type,n=t.definition;if(!n)throw new Error(`The '${e}' variable has a complex type but no definition, did you mean 'object' ('*') type?`);if("string"==typeof n){let t;return t="*"===n?"object":["string","boolean","number"].some((e=>n===e))?n:c.getType(e,{type:n},i),"string"==typeof t?"array"===r?`${t}[]`:t:"array"===r?[t]:t}const s={},a=Object.entries(n);return 0===a.length?"object"===r?"object":"object[]":(a.forEach((t=>{const r=t[0],n=t[1];s[r]=c.getType(e,n,i)})),"object"===r?s:[s])}static typeCheck(e,r,n,s,a){const o=a;o.Type=r,o.message=`Default value for ${e} does not match its type`;const l="Mismatched Value(s)";o[l]=s;let h=!0;if(r)if(null==s||t.isExpression(s)||"any"===r)h=!0;else if("any[]"===r)h=Array.isArray(s);else if("object"===r)h=i.isObjectType(s);else if("object[]"===r)Array.isArray(s)?(o[l]=[],s.forEach((t=>{const i={};c.typeCheck(e,"object",n,t,i)||(o[l].push(i),h=!1)}))):h=!1;else if(i.isObjectType(r)&&i.isObject(s))o[l]={},Object.keys(s).forEach((t=>{const i={};c.typeCheck(e,r[t],n,s[t],i)||(o[l][t]=i,h=!1)}));else if(i.isArrayType(r)&&Array.isArray(s)){if(n.uniqueItems&&new Set(s).size!==s.length)return delete o[l],o.message=`Duplicate array values for ${e} have been detected`,o["Duplicate array entries"]=s,!1;const t=i.getArrayRowType(r);o[l]=[],s.forEach((i=>{const r={};c.typeCheck(e,t,n,i,r)||(o[l].push(r),h=!1)}))}else{const e=typeof s;h="number"===r&&"string"===e&&s.trim()?!isNaN(s):r===e}else h=!1;return h}static buildVariableDefaults(r,n,s,a,o={}){if(void 0===a){if("any[]"===s||"object[]"===s)return[];if("object"===s)return{};if("any"===s)return}if(t.isExpression(a))return c.getValueOrExpression(a,n);if(i.isArrayType(s)){const e=i.getArrayRowType(s),t=[];if(void 0===a)return t;if(Array.isArray(a))return a.forEach((i=>{const s=c.buildVariableDefaults(r,n,e,i,o);t.push(s)})),t}if(i.isObjectType(s)){if(null===a)return null;const t={},l=c.isWildCardType(s);if(i.isObject(a)&&Object.keys(a).forEach((e=>{const i=a[e],h=l?"any":s[e];t[e]=c.buildVariableDefaults(r,n,h,i,o)})),!l){let i=o[s];i||(i={},o[s]=i),Object.keys(s).forEach((l=>{if(!a||!Object.prototype.hasOwnProperty.call(a,l)){i[l]=i[l]||0;const a=i[l];a<e.MAX_DEFAULT_VALUE_RECURSION_DEPTH?(i[l]+=1,t[l]=c.buildVariableDefaults(r,n,s[l],void 0,o),i[l]=a):t[l]=void 0}}))}return t}return a?"number"===s&&"string"==typeof a?Number(a):c.getValueOrExpression(a,n):a}static getValueOrExpression(e,r,n=!0){if(!e)return e;if("string"==typeof e){const i=t.getExpression(e);return i?t.createFromString(i,r,n):e.trim()}if(Array.isArray(e))return e.map((e=>c.getValueOrExpression(e,r,n)));if(!i.isPrototypeOfObject(e))return e;if(i.isObject(e)){const t={};return Object.keys(e).forEach((i=>{t[i]=c.getValueOrExpression(e[i],r,n)})),t}return e}static deepEval(e,r){if(!e)return e;if("string"==typeof e){const i=t.getExpression(e);return i?t.createFromString(i,r)():e.trim()}if(Array.isArray(e))return e.map((e=>c.deepEval(e,r)));if(!i.isPrototypeOfObject(e))return e;if(i.isObject(e)){const t={};return Object.keys(e).forEach((i=>{t[i]=c.deepEval(e[i],r)})),t}return e}static instantiateType(t,n,s=new r,a,l,h=e.VariableNamespace.VARIABLES,p){return new Promise((e=>{if(p&&p.isExtendedType&&p.isExtendedType())return e(p);requirejs([n.type],(r=>{const p=new r;if(!i.isExtendedType(p))return void e(p);let u=Promise.resolve();const d=p.getTypeDefinition(n,s);if(d){const e={type:d.type,definition:d.definition,defaultValue:n.defaultValue,persisted:n.persisted,resolved:d.resolved},r=p.isBuiltinType&&p.isBuiltinType();u=c.createVariableDefaultValue(t,e,s,a,l,h).then((e=>Promise.resolve(p.init(t,n,e,a.container)).then((()=>e)))).then((o=>{const u=c.getType(t,e,s),g=c.addInstancePropertyToScope(p,t,h,"value",u,o,a,e.persisted),v=a;i.isObject(o)&&!Array.isArray(o)&&i.isPrototypeOfObject(o)&&d&&"object"==typeof u&&p.hoistValueObjectProperties()&&(r?p.setupVariableProperties(o,v,h,g):c.setupVariableProperties(p,o,v,h,g)),g.onValueChanged&&(g.onValueChanged.add((e=>{p.handlePropertyVariableChangeEvent(e)}),p),a.container.addValueChangedListeners(g,n,l));const f={value:{getType:(e,t)=>c.getType(t,{type:e},a.container.scopeResolver),invokeEvent:(e,t)=>a.container.invokeEventWithBubbling(e,t)}};r&&(f.value=Object.assign(f.value,{callActionChain:(e,t,i)=>a.container.callActionChain(e,t,i)})),Object.defineProperty(p,"handler",f)}))}u.then((()=>{c.addInstancePropertyToScope(p,t,h,"internalState","object",{},a,n.persisted),e(p)})).catch((e=>{throw o.error(e),new Error(`Error creating value for variable '${t}'.`)}))}))}))}static setupVariableProperties(e,t,i,r,n){Object.keys(t).forEach((t=>{Object.defineProperty(e,t,c.getVariablePropertyDefinition(e,t,i,r,n))}))}static getVariablePropertyDefinition(e,t,i,r,n){const s=i,a=t;return{get:()=>e.getValue()[a],set:e=>{s.variableNamespaces[r][n.name][a]=e},enumerable:!0,configurable:!0}}static addInstancePropertyToScope(e,t,i,r,n,s,a,o){const c=a,l=`${t}_${r}`,h=a.createVariable(l,i,n,s,void 0,{persisted:o,writableOptions:e.getWritableOptions()});return Object.defineProperty(e,r,{get:()=>a.variableNamespaces[i][l],set:e=>{c.variableNamespaces[i][l]=e},enumerable:!0,configurable:!0}),h}static createVariableInitialValue(e,t){return void 0!==t?i.cloneObject(t):i.isObjectOrArray(e)&&(Array.isArray(e)||i.isPrototypeOfObject(e))?i.cloneObject(e):e}static restorePersistedValue(e,t){const r=e;return"function"==typeof t?t:(i.isObjectOrArray(t)&&Object.keys(t).forEach((e=>{(!Array.isArray(t)||r&&Object.prototype.hasOwnProperty.call(r,e))&&(r[e]=c.restorePersistedValue(r[e],t[e]))})),r)}static isWildCardType(e){return"any"===e||"object"===e||"any[]"===e||"object[]"===e}}return c})),define("vb/action/action",["vb/private/constants","vb/private/log","vb/private/stateManagement/stateUtils","vb/private/utils"],((e,t,i,r)=>{const n=t.getLogger("/vb/action/action");return class{constructor(e,t){this.log=n,this.id=`${e}_${r.generateUniqueId()}`,this.label=t||this.id,this.logLabel=this.label===this.id?this.id:`${this.label} [${this.id}]`,this.metadataKey=e,this.containerLifecycleState=null,this.options={}}start(e){return this.isCancelled()?Promise.reject("cancelled because the page has exited due to navigation"):Promise.resolve().then((()=>this.perform(e))).catch((e=>{this.log.error("Action",this.logLabel,"failed.",e);let t=e||new Error("error in executing action");throw"string"==typeof e&&(t=new Error(e)),t}))}perform(e){throw new TypeError("Subclass needs to override execute method.")}setOptions(e){this.options=Object.assign(this.options,e)}isCancelled(){return this.containerLifecycleState===e.ContainerState.EXITED}static get Outcome(){return{SUCCESS:"success",FAILURE:"failure",TRUE:"true",FALSE:"false"}}static buildParamValue(e,t,r){return i.buildVariableDefaults(e,r,"any",t)}static createOutcome(e,t){return{name:e,result:t}}static createSuccessOutcome(e){return{name:this.Outcome.SUCCESS,result:e}}static createFailureOutcome(e,t,i){const r={message:{summary:e},error:t,payload:i};return{name:this.Outcome.FAILURE,result:r}}}})),define("vb/action/actionChain",[],(()=>class{async run(e,t){return Promise.reject(new Error("Not implemented"))}})),define("vb/helpers/actionHelpers",["vb/private/stateManagement/router","vb/private/constants"],((e,t)=>class{constructor(i){i&&Object.assign(this,{navigateToPage(e){return this.navigate(Object.assign(e,{operation:t.NavigateOperation.PAGE_OLD}))},navigate:t=>e.queueNavigate(i.container,t),navigateBack(t){e.navigateBack(i.container,t)}})}})),define("vb/private/stateManagement/variable",["knockout","signals","vb/private/log","vb/private/utils","jsondiff","vb/private/constants"],((e,t,i,r,n,s)=>{const a=i.getLogger("/vb/stateManagement/variable"),o="update",c=Symbol("undefined"),l="__vb_skip_eval_expr",h="__vb_retrieve_old_eval_value",p="__vb_retrieve_new_value",u=e=>!(r.isPrimitive(e)||r.isPrototypeOfObject(e)||Array.isArray(e)),d=n.create({arrays:{detectMove:!1},cloneDiffValues:!1});d.processor.pipes.diff.before("trivial",(e=>{const t=e.left,i=e.right;if("function"==typeof t||"function"==typeof i)e.setResult(void 0).exit();else if(u(t)||u(i)){let r;t!==i&&(r="isDifferent"),e.setResult(r).exit()}}));class g{constructor(i,r,n,o,c,l,h){this.log=a,this.scope=i,this.name=r,this.namespace=n,this.descriptor=h,this.type=o,this.initialValue=l,this.defaultValue=c,this.dirtyDataBehavior=h&&void 0!==h.dirtyDataBehavior?h.dirtyDataBehavior:s.DirtyDataBehavior.NONE,!1===this.scope.silent&&(this.onValueChanged=new t.Signal),this.triggerObservable=e.observable(),this.notifySubscribers=!1,this.extendedType=!1,this.eventThrottle=null,this.writableOptions=h&&h.writableOptions||{},this.namespace||(this.namespace=s.VariableNamespace.VARIABLES,this.log.warn("variable created without a namespace, using",this.namespace,":",r)),this.lifecycleStage=s.VariableLifecycleStage.INIT,this.log.finer("initializing variable",this.name),this.typeClassification=s.VariableClassification.REGULAR,this.computedValue=null,this.oldComputedValue=null,this.disposeStateSubscription=null,this._isUpdated=!1}get stateProperty(){return`${this.namespace}@${this.name}`}static get UNDEFINED_MARKER(){return c}static get UPDATE_ACTION_TYPE(){return o}static isPrototypeInstance(e){return u(e)}createReducer(){return(e,t)=>void 0===e?void 0===this.initialValue?c:this.getReducerInitialValue():t.type===o&&this===t.variable?(this.notifySubscribers=!0,void 0===t.value?c:r.cloneObject(t.value)):e}getReducerInitialValue(){return this.initialValue}createUpdateAction(e){return{type:o,variable:this,value:e}}isDirtyDataTrackingEnabled(){return this.dirtyDataBehavior===s.DirtyDataBehavior.TRACK}isUpdated(){if(this.extendedType){return this.scope.getVariable(`${this.name}${s.BuiltinVariableName.VALUE}`)._isUpdated}return this._isUpdated}resetUpdatedState(){if(this.extendedType){this.scope.getVariable(`${this.name}${s.BuiltinVariableName.VALUE}`)._isUpdated=!1}this._isUpdated=!1}getValueForDirtyData(){if(this.extendedType){const e=this.scope.getVariable(`${this.name}${s.BuiltinVariableName.VALUE}`);if(e)return r.cloneObject(e.getValue())}return r.cloneObject(this.getValue())}isDirty(e){return!!this.isUpdated()&&!!g.diff(e,this.getValueForDirtyData())}getValue(e=!1){return this.computedValue||(this.computedValue=this.getComputedValueObservable(e),this.computedValue.subscribe((e=>{this.oldComputedValue=e}),null,"beforeChange"),this.computedValue.subscribe((e=>{this._isUpdated=!0;const t=this.oldComputedValue;this.oldComputedValue=null;const i=g.cloneWithMarkers(t,[h]);this.handleValueObservableChange(i,e)}))),this.computedValue()}getComputedValueObservable(t=!1){return e.computed((()=>(this.triggerObservable(),this.getValueFromStore(t))))}getValueFromStore(e=!1){const t=this.scope.getState();if(t){let i=t[this.stateProperty];if(i===c)return;return e||(i=this.getWrappedValue(i)),i}return null}getWrappedValue(e){let t=e;return t=r.resolveIfObservable(t),this.extendedType||r.isExtendedType(t)?(this.extendedType=!0,t):(t=r.cloneObject(t),this.wrapObject(t),t)}serialize(e){return JSON.stringify(e,((e,t)=>r.isCloneable(t)||r.isPrimitive(t)?t:void 0))}setValueInternal(t){if(!this.scope.store)return void(this.initialValue=t);const i=this.getValueFromStore(),r=g.unwrapAndClone(t);if(this.log.isFiner&&(e.isObservable(t)?this.log.finer("Updating variable",this.name,"to an expression =",t()):this.log.finer("Updating variable",this.name,"to",r)),this.scope.store.dispatch(this.createUpdateAction(r)),!1===this.scope.silent){const e=this.getValue();this.dispatchChangeEvent(i,e)}}setValue(e){this.isWritable()&&this.setValueInternal(e)}handleValueObservableChange(e,t){this.onValueChanged&&this._throttleValueChangeEvent(e,t)}dispatchChangeEvent(e,t){this.onValueChanged&&this._throttleValueChangeEvent(e,t)}_throttleValueChangeEvent(e,t,i="eventThrottle"){if(this.onValueChanged.getNumListeners()>0)if(this[i])g.diff(this[i].value,t)&&(this[i].value=t);else{const r=this.descriptor&&this.descriptor.rateLimit?this.descriptor.rateLimit:{},n=void 0!==r.timeout?r.timeout:s.DEFAULT_RATE_LIMIT;this[i]={oldValue:e,value:t,timer:setTimeout((()=>{const e=this[i].oldValue,t=this[i].value;let r;this[i]=null,"function"!=typeof e&&"function"!=typeof t&&(r=g.diff(e,t)),r&&this.onValueChanged.dispatch({name:this.name,namespace:this.namespace,type:s.VALUE_CHANGED,oldValue:e,value:t,diff:r})}),n)}}}createNewValue(){return r.cloneObject(this.defaultValue)}getType(){return this.type}subscribeToStore(e){this.disposeStateSubscription||(this.disposeStateSubscription=e.subscribe((()=>{!0===this.notifySubscribers&&(this.trigger(),this.notifySubscribers=!1)})),this.getValue())}trigger(){this.triggerObservable.notifySubscribers()}static diff(e,t){return r.isCloneable(e)&&r.isCloneable(t)?d.diff(e,t):e!==t}wrapObject(t){this.traverseObject(t,t,((i,n,a)=>{const o=t,c=a,u=i;if(Object.getOwnPropertyDescriptor(i,n).configurable){if(delete u[n]){const i=c;let a,d=!1,g=i;e.isObservable(g)&&(g=r.cloneObject(g()));const v={get:()=>!0===Object.prototype.hasOwnProperty.call(o,p)&&d?a:!0===Object.prototype.hasOwnProperty.call(o,h)?g:"function"==typeof i&&"function"==typeof i.subscribe&&!1===Object.prototype.hasOwnProperty.call(o,l)?(g=r.cloneObject(i()),g):i,enumerable:!0,configurable:!0};this.writableOptions.propertiesWritable===s.VariableWritablePropertyOptions.NONE?v.set=e=>{this.log.error("Cannot set the value",e,"to property ",n,"of the variable '",this.name,"'as it disallows property writes. Use VB actions like assignVariablesAction to update the variable instead.")}:v.set=e=>{d=!0,a=e,this.setValue(t)},Object.defineProperty(u,n,v)}}}))}traverseObject(e,t=e,i){(Array.isArray(t)||r.isObject(t)&&r.isPrototypeOfObject(t))&&Object.keys(t).forEach((r=>{this.setupPropertyHandler(t,r,i,e)}))}setupPropertyHandler(e,t,i,r){const n=e[t],s=typeof n;"boolean"===s||"number"===s||"string"===s||"function"===s||null==n?i.call(this,e,t,n):"object"===s&&Array.isArray(n)?(i.call(this,e,t,n),this.traverseObject(r,n,i)):"object"===s&&this.traverseObject(r,n,i)}isWritable(){return!this.descriptor||!1!==this.descriptor.writable}activate(e,t){if(this.lifecycleStage===s.VariableLifecycleStage.INIT){if((this.extendedType||r.isExtendedType(this.initialValue))&&"function"==typeof this.initialValue.activate){const e=this.initialValue.activate();return Promise.resolve(e).then((()=>{this.lifecycleStage=s.VariableLifecycleStage.ACTIVE}))}this.lifecycleStage=s.VariableLifecycleStage.ACTIVE}return Promise.resolve()}dispose(){this.log.finer("disposing variable",this.name),this.lifecycleStage=s.VariableLifecycleStage.DISPOSE,(this.extendedType||r.isExtendedType(this.initialValue))&&"function"==typeof this.initialValue.dispose&&this.initialValue.dispose(),this.disposeStateSubscription&&this.disposeStateSubscription(),!1===this.scope.silent&&this.onValueChanged.removeAll(),this.computedValue&&this.computedValue.dispose()}cloneData(){return g.unwrapAndClone(this.getValue())}static unwrapAndClone(e){return g.cloneWithMarkers(e,[l,p])}static cloneWithMarkers(e,t=[]){if(r.isCloneable(e)){const i=e;t.forEach((e=>{Object.defineProperty(i,e,{enumerable:!1,configurable:!0,value:!0})}));try{const e=Array.isArray(i)?[]:{};return r.cloneObject(i,e),t.forEach((t=>{delete e[t]})),e}finally{t.forEach((e=>{delete i[e]}))}}return e}}return g})),define("vb/private/action/assignmentHelper",["vb/binding/expression","vb/private/utils","vb/private/stateManagement/stateUtils"],((e,t,i)=>{class r{constructor(i,r){this.targetType=r,this.get=r=>t.cloneObject(e.createFromString(r,i)())}pick(e,...t){return t.reduce(((e,t)=>this.pickRecursive(e,t,this.targetType)),e)}pickRecursive(e,n,s){if("object"===s){if(Array.isArray(n))throw new Error("Cannot assign an array to a target with 'object' type.");if(!t.isObject(n))throw new Error("Cannot assign a primitive value to a target with 'object' type.")}const a=t.isObject(n),o=Array.isArray(n);if("any"===s||"object"===s)return a&&t.isObject(e)?t.cloneObject(n,e):n;const c=t.isObjectType(s),l=t.isArrayType(s);let h=e;if(l){h=h||[];const e=t.getArrayRowType(s);(o?n:[n]).forEach((t=>{h.push(this.pickRecursive(null,t,e))}))}else if(c&&a)h=h||i.buildVariableDefaults(null,null,s),Object.keys(s).forEach((e=>{Object.prototype.hasOwnProperty.call(n,e)?h[e]=this.pickRecursive(h[e],n[e],s[e]):Object.prototype.hasOwnProperty.call(h,e)||(h[e]=void 0)}));else{if(!t.isObjectOrArray(s)&&!t.isObjectOrArray(n))return r.coerceType(n,s);if(t.isInstanceType(s))return n}return h}static coerceType(e,i){if(null==e||"function"==typeof e)return e;if("string"===i)return String(e);if("boolean"===i)return("string"!=typeof e||"false"!==e.toLocaleLowerCase()&&"0"!==e)&&Boolean(e);if("number"===i)return Number(e);if(t.isInstanceType(i))return e;return new r(null,i).pick(null,e)}}return r})),define("vb/private/stateManagement/context/variableBridge",["vb/private/stateManagement/stateUtils"],(e=>class{constructor(e,t){this.instanceFactoryTypeInstance=t,this.scope=e,this.scopeResolver=e.container.scopeResolver}getType(t,i){return e.getType(t,{type:i},this.scopeResolver)}invokeEvent(e,t){return this.scope.container.invokeEventWithBubbling(e,t)}callActionChain(e,t,i){return this.scope.container.callActionChain(e,t,i)}activateAsync(){return this.instanceFactoryTypeInstance&&"function"==typeof this.instanceFactoryTypeInstance.activateAsync?this.instanceFactoryTypeInstance.activateAsync():Promise.resolve()}})),define("vb/private/stateManagement/instanceFactoryVariable",["knockout","vb/private/stateManagement/variable","vb/private/constants","vb/private/utils","vb/binding/expression","vb/private/stateManagement/context/variableBridge","vb/private/log","signals","vb/private/utils","vb/private/constants"],((e,t,i,r,n,s)=>{const a=/<(.*?)>/,o=(e,t,i)=>{const n=e,s=n.instance,a=r.cloneObject(n.constructorParams);n.instance=t;const o=r.cloneObject(i);return n.constructorParams=o,{instance:s,constructorParams:a}};return class extends t{constructor(e,t,r,n,s,a,o,c){super(e,t,r,n,s,a,o),this.variableDef=c,this.dependencies=o.dependencies,this.instanceFactoryTypeClass=void 0,this.prevValueWrapped=void 0,this.variableBridge=void 0,this.defaultValue={constructorParams:s||[]},a&&!Array.isArray(a)?(this.initialValue=a.constructorParams||[],this.instanceInitialValue=a.instance||(a.constructorParams?void 0:a),this.instanceInitialValue&&this.log.finer("variable",this.name,"was provided an instance of type",this.instanceInitialValue.constructor.name,"as its initial value")):this.initialValue=a||[],this.writableOptions={propertiesWritable:i.VariableWritablePropertyOptions.NONE},this.typeClassification=i.VariableClassification.INSTANCE_FACTORY}getReducerInitialValue(){return{instance:this.instanceInitialValue,constructorParams:this.initialValue}}createUpdateAction(e){const i=this.getValueFromStore(!0);return i&&(i.instance=e.instance,e.constructorParams&&(i.constructorParams=e.constructorParams)),{type:t.UPDATE_ACTION_TYPE,variable:this,value:i}}activate(e,t){return this.activateAsync(e,t)}activateAsync(e,t){return this.activatePromise=this.activatePromise||this.activateReferencedVariables(e,t).then((()=>{const e=this.getValueFromStore(),{instance:t,constructorParams:r}=e||{};return t?(this.lifecycleStage=i.VariableLifecycleStage.ACTIVE,this.log.finer("activated variable",this.name,"using the instance that was provided"),Promise.resolve()):this.createInstanceAsync(r).then((e=>{this.lifecycleStage=i.VariableLifecycleStage.ACTIVE,this.setValue({instance:e}),this.log.finer("activated variable",this.name)}))})),this.activatePromise}activateReferencedVariables(e,t){const r=this.dependencies&&this.dependencies.variables||[];if(r.length>0){const n=[];return r.forEach((r=>{const s=r;if(s){const r=(t[s.scopeName]||e).getVariable(s.variableName,i.VariableNamespace.VARIABLES);s.variable=r,n.push(r.activate(e,t))}})),Promise.all(n)}return Promise.resolve()}serialize(){const e=this.getValueFromStore(),t=e&&e.constructorParams;return JSON.stringify(t,((e,t)=>r.isCloneable(t)||r.isPrimitive(t)?t:void 0))}getComputedValueObservable(t=!1){return e.computed((()=>{let e=this.getValueFromStore(t);if(this.prevValueWrapped&&this.prevValueWrapped.constructorParams)if(this.prevValueWrapped.instance===e.instance){const i=this.createInstance(e.constructorParams),r=o(this.prevValueWrapped,i,e.constructorParams),n=this.createUpdateAction({instance:i});this.log.finer("Updating variable",this.name,"with a new instance value,",n),this.scope.store.dispatch(n),!1===this.scope.silent&&(e=this.getValueFromStore(t),this.dispatchChangeEvent(r,e))}else o(this.prevValueWrapped,e.instance,e.constructorParams);return!this.prevValueWrapped&&e.instance&&(this.prevValueWrapped=this.prevValueWrapped||{},o(this.prevValueWrapped,e.instance,e.constructorParams),e=this.getValueFromStore(t)),this.triggerObservable(),e}))}setValueInternal(i){if(!this.scope.store)return void(this.initialValue=i);const r=this.fixupValue(i),n=this.getValueFromStore(),s=t.unwrapAndClone(r);if(!s.instance||s.instance===n.instance){const e=this.getWrappedValue(s.constructorParams||n.constructorParams),t=this.createInstance(e);s.instance=t}const a=this.createUpdateAction(s),o=a.value;if(this.log.isFiner&&(e.isObservable(i)?this.log.finer("Updating variable",this.name,"to an expression =",o()):this.log.finer("Updating variable",this.name,"to",o)),this.scope.store.dispatch(a),!1===this.scope.silent){const e=this.getValue();this.dispatchChangeEvent(n,e)}}fixupValue(t){return Array.isArray(t)?{constructorParams:e.isObservable(t)?t():t}:!t||t.instance||t.constructorParams?t:{instance:e.isObservable(t)?t():t}}createInstanceAsync(e){return Promise.resolve().then((()=>{const t=this.type.match(a);if(Array.isArray(t)&&t[1])this.type=t[1];else{const e=r.parseQualifiedIdentifier(this.variableDef.type);e&&(this.type=`${e.main}/${e.suffix}`)}return r.getResource(this.type).then((t=>{this.instanceFactoryTypeClass=t;const i=e||this.initialValue,r=this.createInstance(i);return(this.variableBridge?this.variableBridge.activateAsync():Promise.resolve()).then((()=>r))}))}))}createInstance(e){const t=this.type,i=this.createMethod,r=this.instanceFactoryTypeClass;let n;n=i?r[this.createMethod].call(null,...e):new r(...e),this.addContextToVBTypes(n);const s=this.createMethod?`factory method ${this.createMethod}`:"constructor";return this.log.isFiner&&this.log.finer(" Created new instance for variable",this.name,"of type",t,"using",s,"and args",...e),n}addContextToVBTypes(e){switch(this.type){case"vb/MultiServiceDataProvider2":case"vb/ServiceDataProvider2":this.variableBridge=new s(this.scope,e),e.setVariableBridge(this.variableBridge)}}setupPropertyHandler(e,i,r,n){const s=e[i];"instance"===i&&s&&t.isPrototypeInstance(s)?r.call(this,e,i,s):super.setupPropertyHandler(e,i,r,n)}}})),define("vb/private/stateManagement/variableFactory",["vb/private/stateManagement/variable","vb/private/stateManagement/instanceFactoryVariable","vb/private/stateManagement/stateUtils","vb/private/constants","vb/private/utils"],((e,t,i,r,n)=>class{static createVariable(i,r){const s=r&&Object.values(r)||[];return new(n.isTypeDefInstanceFactory(i)?t:e)(...s)}})),define("vb/private/stateManagement/scope",["knockout","vb/private/stateManagement/variable","vb/private/stateManagement/stateUtils","vb/private/stateManagement/router","vb/private/utils","vb/private/constants","vb/private/log","vb/private/action/assignmentHelper","vb/private/history","vb/private/stateManagement/variableFactory"],((e,t,i,r,n,s,a,o,c,l)=>{const h=a.getLogger("/vb/scope");class p{constructor(e,t,i={}){this.log=h,!0===i.unique?this.name=`${e}/${n.generateUniqueId()}`:this.name=e,this.variablesDef=[],this.trackedDirtyDataVariables={},this.variableNamespaces={},Object.values(s.VariableNamespace).forEach((e=>{this.variableNamespaces[e]={},Object.defineProperty(this,e,{value:this.variableNamespaces[e],enumerable:!0})})),this.silent=i.silent||!1,t&&(this.appId=t.application.definition.id,this.container=t),this.persistedVariablesListeners=[],this.storageInterface=window}initVariableReducers(){const e={};return this.variablesDef.forEach((t=>{e[t.stateProperty]=t.createReducer().bind(t)})),e}initVarsMarkedForDirtyDataTracking(e=!1){Object.keys(this.trackedDirtyDataVariables).forEach((t=>{const i=this.getVariable(t);i&&(!e||e&&i.isUpdated())&&(this.trackedDirtyDataVariables[t]=i.getValueForDirtyData(),i.resetUpdatedState())}))}checkForDirtyData(){return!!Object.keys(this.trackedDirtyDataVariables).find((e=>{const t=this.getVariable(e);return t&&t.isDirty(this.trackedDirtyDataVariables[e])}))}resetDirtyData(){this.initVarsMarkedForDirtyDataTracking(!0)}syncWithStore(e){this.store=e,this.container&&this.container.extensions&&0!==Object.keys(this.container.extensions).length||this.subscribeVariablesToStore()}subscribeVariablesToStore(){this.variablesDef.forEach((e=>e.subscribeToStore(this.store)))}getState(){let e;return this.store&&(e=this.store.getState()[this.name]),e}createVariable(e,t,i,r,s,a={},o){let h,p=this.getVariable(e,t);if(p)return p;if(this.store)throw new Error(`Cannot create a variable ${e} because the scope ${this.name} has been added to the store.`);const u="fromUrl"===a.input,d=a.persisted;d&&"none"!==d&&(h=d),t?void 0===this[t]&&this.log.error("The namespace",t,"is not valid for the variable",e):this.log.error("A namespace should be provided for the variable",e);const g=this.calculateInitialValue(e,t,i,r,s,h);if(p=l.createVariable(i,{scope:this,name:e,namespace:t,type:i,defaultValue:r,initialValue:g,descriptor:a,variableDef:o}),this.variablesDef.push(p),p.isDirtyDataTrackingEnabled()&&(this.trackedDirtyDataVariables[p.name]=void 0),Object.defineProperty(this.variableNamespaces[t],e,{get:()=>p.getValue(),set(e){p.setValue(e)},enumerable:!0}),h||u){const e={eventSource:p.onValueChanged,eventListener:e=>{if(e.diff){if(h){const t=p.serialize(e.value);try{this.storePersistedValue(this.name,e.namespace,e.name,h,t)}catch(e){this.log.error(e)}}if(u){const t=n.resolveIfObservable(r);let i;if(e.value!==t){const t=c.getInputParameters();t[e.name]=e.value,c.setInputParameters(t),i=e.value}c.setUrlParameter(e.name,i),c.sync()}}}};p.onValueChanged.add(e.eventListener,this),this.persistedVariablesListeners.push(e)}return p}calculateInitialValue(e,t,r,s,a,c){let l;try{if(void 0!==a)l=a;else if(c){const r=this.loadPersistedValue(this.name,t,e,c);null!=r&&(l=i.restorePersistedValue(r,s),this.log.info("Loaded",c,"persisted",t,n.getWebStorageItemName(this.appId,this.name,t,e),"value:",l))}void 0!==l&&(l=o.coerceType(l,r)),l=i.createVariableInitialValue(s,l)}catch(t){this.log.error("Error calculating initial value of variable",e,"of",this.container&&this.container.fullPath,t)}return l}static getVariablePropertyDescriptors(e){if("function"==typeof Object.getOwnPropertyDescriptors)return Object.getOwnPropertyDescriptors(e);const t={};return Object.getOwnPropertyNames(e).forEach((i=>{t[i]=Object.getOwnPropertyDescriptor(e,i)})),t}createReferenceVariable(e,t,i){const r=Object.create(Object.getPrototypeOf(i),p.getVariablePropertyDescriptors(i));r.name=e,r.namespace=t,r.dispose=()=>{},this.variablesDef.push(r),Object.defineProperty(this.variableNamespaces[t],e,{get:()=>i.getValue(),set(e){i.setValue(e)},enumerable:!0})}removeVariable(e,t=s.VariableNamespace.VARIABLES){for(let i=0;i<this.variablesDef.length;i+=1){const r=this.variablesDef[i];if(r.name===e&&r.namespace===t)return this.variablesDef.splice(i,1),this.variableNamespaces[t]?delete this.variableNamespaces[t].name:this.log.error("Unable to remove variable",e,"in the namespace",t,"because this namespace does not exist"),r.isDirtyDataTrackingEnabled()&&t===s.VariableNamespace.VARIABLES&&delete this.trackedDirtyDataVariables[e],r.dispose(),!0}return!1}getVariable(e,t=s.VariableNamespace.VARIABLES){for(let i=0;i<this.variablesDef.length;i+=1){const r=this.variablesDef[i];if(r.name===e&&r.namespace===t)return r}}loadPersistedValue(e,t,i,r){let s;switch(r){case"history":{const e=c.getVariable(t,i);let r;return e&&(r=JSON.parse(e)),r}case"device":s="local";break;case"local":case"session":s=r;break;default:return}const a=n.getWebStorageItemName(this.appId,e,t,i),o=`${s}Storage`;let l=this.storageInterface[o].getItem(a);if(null==l){const r=n.getWebStorageItemName("app",e,t,i);l=this.storageInterface[o].getItem(r),l&&(this.storageInterface[o].setItem(a,l),this.storageInterface[o].removeItem(r))}return JSON.parse(l)}storePersistedValue(e,t,i,r,s){let a;const o=s;switch(r){case"history":return c.setVariable(t,i,o),void c.sync();case"device":a="local";break;case"local":case"session":a=r;break;default:return}const l=n.getWebStorageItemName(this.appId,e,t,i);this.storageInterface[`${a}Storage`].setItem(l,o)}createConstant(i,r,a,o,c,l,h={freeze:!0}){let p;if(l&&"none"!==l&&(p=l),r!==s.VariableNamespace.CONSTANTS&&r!==s.VariableNamespace.BUILTIN)return;const u=this.calculateInitialValue(i,r,a,o,c,p),d=new t(this,i,r,a,o,u);let g;return this.container&&e.isObservable(u)?(this.variablesDef.push(d),g=()=>d.getValue(),Object.defineProperty(this.variableNamespaces[r],i,{get:g,enumerable:!0}),d):(Object.defineProperty(this.variableNamespaces[r],i,{get(){const e=n.deepResolve(u,{freeze:h.freeze});return Object.defineProperty(this,i,{value:e,enumerable:!0}),e},configurable:!0,enumerable:!0}),d.onValueChanged=null,d)}activateVariables(e){this.log.info("Activate variables for scope",this.name);const t=[];return this.variablesDef.forEach((i=>{t.push(i.activate(this,e))})),Promise.all(t)}dispose(){this.log.info("Disposing scope",this.name),this.variablesDef.forEach((e=>{e.dispose()})),this.variablesDef=[],this.trackedDirtyDataVariables=[],this.variableNamespaces={},Object.values(s.VariableNamespace).forEach((e=>{this.variableNamespaces[e]={}})),this.persistedVariablesListeners.forEach((e=>{e.eventSource.remove(e.eventListener)}))}}return{createScope:(e,t,i)=>new p(e,t,i)}})),define("vb/private/debug/actionChainDebugStream",["vb/private/debug/debugStream","vb/private/utils","vb/private/debug/constants","vb/private/constants","vb/binding/expression"],((e,t,i,r,n)=>{class s extends e{constructor(e,t){super(i.DebuggeeType.ACTION_CHAIN),this.chainId=e,this.executionContext=t,this.content={type:"actionChainExecution",chainId:e,execId:this.id,$chain:{results:{},actions:[]}}}setChainLocator(e){this.chainLocator=`/${e}/${this.chainId}/`}cloneState(){const e=this.getScopes(),t=s.cloneScopes(e),{$base:i}=e;return i&&(t.$base=s.cloneScopes(i,!0)),t}getScopes(){return this.executionContext[r.CHAIN_INTERNAL_CONTEXT].availableContexts||this.executionContext}static cloneScopes(t,i){const r={};return["$chain","$fragment","$layout","$page","$flow","$application","$global"].forEach((n=>{const s=i?n.substring(1):n,a=t[s];a&&(r[s]={variables:e.cloneObject(a.variables),constants:e.cloneObject(a.constants)})})),r}suspendIfBreakpointReached(e){if(this.isDebuggerInstalled){const t=Object.keys(this.breakpoints).some((t=>{const i=this.breakpoints[t]||{};return e.id.startsWith(`${t}_`)&&i.isSet&&this.evalCondition(i.condition)}));if(!this.runUntilFinish&&(this.stopAtNextAction||t)){this.stopAtNextAction=!1;const t=this.content.$chain.actions.find((t=>t.id===e.id));return this.fireStateChanged(i.DebugState.ACTION_SUSPENDED,t),this.suspend()}}return Promise.resolve()}evalCondition(e){if(e)try{return!e||n.createFromString(e,this.getScopes())()}catch(e){return!1}return!0}start(e){return this.isEnabled?(this.content.$chain.parameters=t.cloneObject(e),this.content.$chain.beforeContext=this.cloneState(),this.registerDebuggee().then((()=>this.fireStateChanged(i.DebugState.CHAIN_STARTING)))):Promise.resolve()}actionStart(t,r){if(this.isEnabled){const n={id:t.id,parameters:e.cloneObject(r),beforeContext:this.cloneState()};return this.content.$chain.actions.push(n),this.fireStateChanged(i.DebugState.ACTION_STARTING,n).then((()=>this.suspendIfBreakpointReached(t))).then((()=>{n.startTime=(new Date).getTime()})).then((()=>this.fireStateChanged(i.DebugState.ACTION_RUNNING,n)))}return Promise.resolve()}actionEnd(t,r){if(this.isEnabled){const n=(new Date).getTime(),s=this.content.$chain.actions.find((e=>e.id===t.id));s&&(s.outcome=e.cloneObject(r),s.afterContext=this.cloneState(),s.completionTime=n-s.startTime+" ms");let a=t.id;const o=a.lastIndexOf("_");-1!==o&&(a=a.substring(0,o)),this.content.$chain.results[a]=r.result,this.fireStateChanged(i.DebugState.ACTION_FINISHED,s)}}logError(e){this.content.$chain.error=e}end(e){this.isEnabled&&(this.content.$chain.return=e,this.content.$chain.afterContext=this.content.$chain.afterContext||this.cloneState(),this.fireStateChanged(i.DebugState.CHAIN_FINISHED))}suspend(){return this.isDebuggerInstalled?(this.suspendPromise||(this.suspendPromise=new Promise((e=>{this.resumeResolver=e}))),this.suspendPromise):Promise.resolve()}resume(){this.resumeResolver&&(this.resumeResolver(),this.suspendPromise=null)}registerDebuggee(){return this.isDebuggerInstalled?super.registerDebuggee({chainLocator:this.chainLocator}):Promise.resolve()}updateBreakpoints(e){this.breakpoints=e||{}}continue(){this.resume()}step(){this.suspendPromise&&(this.stopAtNextAction=!0,this.resume())}finish(){this.suspendPromise&&(this.runUntilFinish=!0,this.resume())}debuggerUninstalled(){this.resume(),super.debuggerUninstalled()}}return s})),define("vb/action/builtin/assignVariablesAction",["vb/action/action","vb/binding/expression","vb/private/utils","vb/private/action/assignmentHelper","vb/private/stateManagement/stateUtils","vb/private/constants","acorn","vb/private/log","vb/private/stateManagement/instanceFactoryVariable","vb/private/stateManagement/variable"],((e,t,i,r,n,s,a,o,c,l)=>{const h=o.getLogger("/vb/action/builtin/assignVariablesAction"),p={NONE:"none",TO_DEFAULT:"toDefault",EMPTY:"empty"},u="always",d="ifNoMapping",g="_assigned",v=["application","flow","page","fragment","global"];class f extends e{constructor(e,t){super(e,t),this.availableContexts=null,this.log=h}perform(t){const i=f.transformParams(t);let r;if(Object.keys(i).some((e=>{const t=i[e];try{if(t.functionName)this.assignUsingFunction(e,t.module,t.functionName,t.params);else{const i=t.reset||p.TO_DEFAULT,r=t.auto||d,n=this.assignUsingMetadata(e,t.source,t.mapping,{resetOption:i,autoOption:r,availableContexts:this.availableContexts});if(n.rootObj&&n.rootPropName){const t=n.rootValue;this.log.info("Action",this.logLabel,"assigning variable",e,"to",t),n.rootObj[n.rootPropName]=t}}return!1}catch(e){return r=e,!0}})),r)throw r;return e.createSuccessOutcome()}static transformParams(e){if(e.variable){let t=i.cloneObject(e);return t.source=t.value,delete t.variable,delete t.value,t={[e.variable]:t},t}return e}setAvailableContext(e){this.availableContexts=e}static buildParamValue(t,r,s){return i.isObject(r)&&r.functionName&&r.module?n.getValueOrExpression(r,s,!1):e.buildParamValue(t,r,s)}assignUsingFunction(e,n,a,o){const c=o||[],l=n||this.availableContexts.$functions||this.availableContexts.$page.functions,h=l[a];if(!h)throw new Error(`Custom function ${a} does not exist.`);const p=this.analyzeTargetExpr(e,{availableContexts:this.availableContexts}),u=new r(this.availableContexts,p.type),d=i.emptyArrays(i.cloneObject(p.defaultValue)),g=p.typeClassification===s.VariableClassification.INSTANCE_FACTORY,v=h.apply(l,[u,d,...c]);if(g){const t=this.performAutoAssignment(e,v,void 0,p);if(t.rootObj&&t.rootPropName){const i=p.rootValue;this.log.info("Action",this.logLabel,"assigning variable",e,"to",v),t.rootObj[t.rootPropName]=i}}else{const i=Object.assign({},this.availableContexts,{$source:v}),r=t.createFromString(`${e} = $source`,i,!1);this.log.info("Action",this.logLabel,"assigning variable",e,"to",v),r()}}assignUsingMetadata(e,t,r,s){let a=this.analyzeTargetExpr(e,s);if(r&&a.autoOption!==u||(a=this.performAutoAssignment(e,t,r,a)),r){const e=a.type;let s=a.leafObj[a.leafPropName];const o=t;if(a.resetOption=p.NONE,i.isArrayType(e)){s=s||[];const t=i.getArrayRowType(e),c=Array.isArray(o)?o:[o];for(let e=0;e<c.length;e+=1){const o=c[e];let l;if(a.autoOption===g){const r=s.length-c.length+e;l=s[r],null==l&&i.isObjectType(t)&&(l=n.buildVariableDefaults(null,null,t),s[r]=l)}else i.isArrayType(t)?l=[]:i.isObjectType(t)?l=n.buildVariableDefaults(null,null,t):i.isAnyType(t)&&(Array.isArray(o)?l=[]:i.isObject(o)&&(l={}));const h={type:t,availableContexts:a.availableContexts,leafObj:l};this.assignUsingMapping(r,{$target:l,$source:o},h),a.autoOption!==g&&s.push(h.rootValue)}a.leafObj[a.leafPropName]=s}else this.assignUsingMapping(r,{$target:s,$source:o},a)}return a}performAutoAssignment(e,t,n,s){const a=s;if(!n||a.autoOption===u){const n=new r(this.availableContexts,a.type),s=a.leafObj[a.leafPropName];s&&!i.isCloneable(t)&&("object"===a.type?h.warn("Assigning ",t," to ",e," will result in data being copied into an empty or existing object. If you intend to have the variable reference the source instance, change the variable type to any or make the instance directly available on $page.functions instead."):"any"===a.type&&h.warn("Assigning ",t," to ",e," will result in data being copied into the existing instance held by the variable.  If you intend to replace the variable with the new source instance, set the reset option to empty.")),a.leafObj[a.leafPropName]=n.pick(s,t),a.autoOption===u&&(a.autoOption=g)}return a}assignUsingMapping(e,i,r){const n=Object.assign({},r.availableContexts,i),s=Object.assign(r,{availableContexts:n});Object.keys(e).forEach((i=>{const a=e[i];let o,c;"string"==typeof a?(o=t.createFromString(a,n,!1)(),s.resetOption=r.resetOption):"object"==typeof a&&(o=t.createFromString(a.source,n,!1)(),c=a.mapping,s.resetOption=a.reset||r.resetOption,s.autoOption=a.auto||r.autoOption);const l=this.assignUsingMetadata(i,o,c,s);s.leafPropName?s.leafObj[s.leafPropName]=l.rootValue:s.rootValue=l.rootValue}))}analyzeExprAst(e,t){const i=a.parse(e,{ecmaVersion:"latest"});if(1!==i.body.length)throw new Error(`The target of an assignment must be a single expression: ${e}`);const r=i.body[0];if("ExpressionStatement"!==r.type)throw new Error(`The target of an assignment must be an expression: ${e}`);const n=[{name:"contexts",value:t}];return this.analyzeExprNode(r.expression,e,n),n.splice(0,1),n}analyzeExprNode(e,t,i){const r=e.type;if("Identifier"===r)this.evalAndPushPropValue(e.name,i);else{if("MemberExpression"!==r)throw new Error(`Invalid expression: ${this.getExprFragment(e,t)}`);this.analyzeObjNode(e.object,t,i),this.analyzePropNode(e.property,t,i)}}analyzeObjNode(e,t,i){const r=e.type;if("Identifier"===r)this.evalAndPushPropValue(e.name,i);else{if("MemberExpression"!==r)throw new Error(`Invalid object expression: ${this.getExprFragment(e,t)}`);this.analyzeExprNode(e,t,i)}}analyzePropNode(e,i,r){const n=e.type;let s;if("Literal"===n)s=e.value;else if("Identifier"===n)s=e.name;else{const n=r[0].value,a=this.getExprFragment(e,i);s=t.createFromString(a,n)()}this.evalAndPushPropValue(s,r)}evalAndPushPropValue(e,t){const i=t[t.length-1],r=i&&i.value?i.value[e]:void 0;t.push({name:e,value:r})}getExprFragment(e,t){return t.substring(e.start,e.end)}static isValidTargetNamespace(e){return e===s.VariableNamespace.VARIABLES||e===s.TRANSLATIONS_CONTEXT}static actualNamespace(e){return e===s.VariableNamespace.VARIABLES?e:s.VariableNamespace.BUILTIN}static getMissingNamespaceError(e){return new Error(`No namespace provided for target expression ${e}.`)}static getInvalidNamespaceError(e,t){return new Error(`Invalid namespace ${e} in target expression ${t}.`)}static getMissingVariableNameError(e){return new Error(`No variable name provided in target expression ${e}.`)}static checkBase(e,t){let i=t[0].value;if(t.length<3)throw f.getMissingNamespaceError(e);const r=t[1].name;if(r!==s.VariableNamespace.VARIABLES){if(!v.includes(r))throw f.getInvalidNamespaceError(r,e);i=t[1].value,t.splice(1,1)}return i}analyzeTargetExpr(e,t){const r=Object.assign({},t);let a,o,c,l,h;const u=this.analyzeExprAst(e,t.availableContexts);if(u.length<1)throw new Error("Invalid empty target expression.");const d=u[0].name;if(-1!==s.ALL_SCOPES.indexOf(d)){if("$variables"!==d){if(a=u[0].value,u.length<2)throw f.getMissingNamespaceError(e);if("$base"===d)a=f.checkBase(e,u);else if("$extension"===d){const t=u[1].name;if("base"!==t)throw f.getInvalidNamespaceError(t,e);u.splice(0,1),a=f.checkBase(e,u)}if(!a)throw new Error(`${d} is not accessible in target expression ${e} from the current action chain.`);if(r.rootObj=u[1].value,r.namespace=u[1].name,r.namespace===s.VariableNamespace.CONSTANTS)throw new Error(`Cannot assign a value to a constant in target expression ${e}.`);if(!f.isValidTargetNamespace(r.namespace))throw f.getInvalidNamespaceError(r.namespace,e);if(u.length<3)throw f.getMissingVariableNameError(e);r.rootPropName=u[2].name,u.splice(0,3)}else{if(a=r.availableContexts.$chain,r.namespace=d.substring(1),r.rootObj=u[0].value,u.length<2)throw f.getMissingVariableNameError(e);r.rootPropName=u[1].name,u.splice(0,2)}const t=r.rootObj[r.rootPropName];i.isExtendedType(t)&&(r.rootPropName+=s.BuiltinVariableName.VALUE);const n=a.getVariable(r.rootPropName,f.actualNamespace(r.namespace));if(!n)throw new Error(`Variable ${r.rootPropName} does not exist in target expression ${e}.`);r.typeClassification=n.typeClassification,r.rootValue=n.cloneData(),o=n.createNewValue(),c=n.getType()}else r.rootObj=r.leafObj,r.rootPropName=r.leafPropName,r.rootValue=u[0].value,o=r.defaultValue,c=r.type,u.splice(0,1);if(u.length>0){l=r.rootValue;for(let t=0;t<u.length;t+=1){const r=u[t].name;if(t<u.length-1&&(l=l[r]),h=r,i.isWildcardType(c)?c="any":i.isArrayType(c)?c=i.getArrayRowType(c):i.isObjectType(c)&&(c=c[r]),o)if(Array.isArray(o))o=n.buildVariableDefaults(null,null,c);else{if("function"==typeof o){const i=u[t>0?t-1:0].name;throw`Detected an unsupported assignment: ${e}! Either assign a literal value  to '${i}' directly, or assign to the variable that ${i}' references!`}o=o[r]}}}else l=r,h="rootValue";if(r.resetOption===p.TO_DEFAULT)l[h]=i.cloneObject(o);else if(r.resetOption===p.EMPTY){let e;e=i.isArrayType(c)?[]:i.isObjectType(c)?n.buildVariableDefaults(null,null,c):void 0,l[h]=e}return r.leafObj=l,r.leafPropName=h,r.defaultValue=o,r.type=c,r}static get RESET_OPTION(){return p}}return f})),define("vb/private/action/actionChainUtils",["ojs/ojcontext","vb/action/action","vb/helpers/actionHelpers","vb/private/stateManagement/scope","vb/private/stateManagement/stateUtils","vb/private/utils","vb/private/log","vbc/private/logConfig","vb/private/constants","vb/private/debug/actionChainDebugStream","vbc/private/monitorOptions","vb/action/builtin/assignVariablesAction","vb/binding/expression"],((e,t,i,r,n,s,a,o,c,l,h,p,u)=>{const d=a.getLogger("/vb/action/actionChain",[{name:"startChain",severity:c.Severity.INFO,style:o.FancyStyleByFeature.actionChainStart},{name:"endChain",severity:c.Severity.INFO,style:o.FancyStyleByFeature.actionChainEnd}]),g=[c.ContextName.EVENT,c.ContextName.BINDING_CONTEXT,"$current",c.ContextName.PREVIOUS];class v extends h{constructor(e,t,i){super("action",`${t} ${i.logLabel}`),this.addTags((()=>({actionId:e,actionType:t})))}}class f extends Error{constructor(e,t){super(e),this.payload=t}}class m{static extractChainId(e){const t=e.split(":");return 1===t.length?t[0]:t[1]}static startChain(t,i={},r,s,a,o){const c=this.createExecutionContext(t,r,s,a);return Promise.resolve().then((()=>{if(!t)throw new Error("Required 'id' parameter missing for starting action chain.");const o=r.targetScopeResolver||r.container.scopeResolver;return n.resolveChain(t,o,a).then((r=>{if(!r)throw new Error(`Action chain ${t} does not exist.`);return this.createChain(t,r).then((r=>{const a=n.deepEval(i,s),o=e.getPageContext().getBusyContext().addBusyState({description:t}),l=this.getDebugStream(c);return l.start(a),r.run(c,a).then((e=>(l.end(e),e))).finally((()=>{this.runFinallyCallbacks(c),o()}))}))}))})).catch((e=>(d.error("Chain",t,"failed.",e),this.handleError(e,c,a,o))))}static createChain(e,t){return Promise.resolve().then((()=>{if("function"==typeof t){return new t}return this.loadJsonActionChain().then((i=>new i(this.extractChainId(e),t)))}))}static loadJsonActionChain(){return this.loadJsonActionChainPromise||(this.loadJsonActionChainPromise=s.getResource("vb/private/action/actionChain")),this.loadJsonActionChainPromise}static createExecutionContext(e,t={},i={},r){const s={},a=t.container,o=a&&a.scopeResolver;let h,p,u=i;if(e&&o){h=n.resolveContainer(e,o),p=h.scopeResolver;h.package||h.base&&h.base.package||(h=a),h!==a&&(u=h.getAvailableContexts())}const d=new l(this.extractChainId(e),s),v=Object.assign({},t,{chainId:e,callingContexts:i,targetScopeResolver:p,targetContainer:h,internalContext:{},finallyCallbacks:[],debugStream:d});return s[c.CHAIN_INTERNAL_CONTEXT]=v,Object.getOwnPropertyNames(u).forEach((e=>{const t=Object.getOwnPropertyDescriptor(u,e);-1===g.indexOf(e)?Object.prototype.hasOwnProperty.call(s,e)||Object.defineProperty(s,e,t):Object.defineProperty(v.internalContext,e,t)})),r?(["$chains","$imports","$listeners","$constants","$enums","$functions","$metadata","$translations","$variables"].forEach((e=>{delete s[e]})),m.proxyContext(s)):s}static runAction(e,i,r,n={}){return this.loadActionModule(e).then((s=>{const a=this.getInternalContext(i),{chainId:o}=a,c=this.createAction(s,e,i,n),l=this.getDebugStream(i);return this.monitorAction(c,e,o,r,(i=>l.actionStart(c,r).then((()=>c.start(r))).then((n=>{let s=n;"vb/action/builtin/callChainAction"===e&&r.chain&&(s=t.createSuccessOutcome(n)),l.actionEnd(c,s);const a=this.handleActionOutcome(e,s);return d.info("Chain",o,"ending action",c.logLabel,"with result",a,i()),a})).catch((e=>{throw d.error("Chain",o,"action step",c.logLabel,"failed.",e,i(e)),e}))))}))}static runActionSync(e,t,i,r,n={}){const s=this.getInternalContext(i),{chainId:a}=s,o=this.createAction(e,t,i,n),c=this.getDebugStream(i);return this.monitorAction(o,t,a,r,(e=>{try{c.actionStart(o,r);const i=o.perform(r);c.actionEnd(o,i);const n=this.handleActionOutcome(t,i);return d.info("Chain",a,"ending action",o.logLabel,"with result",n,e()),n}catch(t){throw d.error("Chain",a,"action step",o.logLabel,"failed.",t,e(t)),t}}))}static createAction(e,t,i,r){const n=r.id||r.alias,s=this.getInternalContext(i),a=new e(n,n,this.getActionConfig(n,s));return this.addOptionsToAction(t,a),this.addHelpersToAction(a,s),this.addContextToAction(t,a,i),a}static monitorAction(e,t,i,r,n){const s=new v(e.id,t,e);return d.info("Chain",i,"starting action",e.logLabel,"with parameters:",r),d.monitor(s,n)}static handleActionOutcome(e,t){if("success"===t.name)return t.result;const{result:i}=t,{message:r,error:n,payload:s}=i;throw n||new f(r.summary,s)}static handleError(e,t,i,r){if(i&&!r)return this.runAction("vb/action/builtin/fireNotificationEventAction",t,{summary:e.message,type:"error"},{id:"fireNotificationEvent"});throw e}static loadActionModule(e){return this.actionModules=this.actionModules||{},Promise.resolve().then((()=>{const t=this.actionModules[e];return t||s.getResource(e).then((e=>e))}))}static addHelpersToAction(e,t){Object.defineProperty(e,"helpers",{value:new i(t)})}static addContextToAction(e,t,i){const r=this.getInternalContext(i),n=this.getWritableExecutionContext(i);if(e.startsWith(c.BUILTIN_ACTION_PATH_PREFIX))switch(e.substr(c.BUILTIN_ACTION_PATH_PREFIX.length)){case"assignVariablesAction":case"resetVariablesAction":t.setAvailableContext(n);break;case"callChainAction":{const e=n.clone();t.setContext(e,r);break}case"restAction":case"fireNotificationEventAction":case"loginAction":case"logoutAction":case"editorUrlAction":case"restartApplicationAction":case"getDirtyDataStatusAction":case"resetDirtyDataStatusAction":t.setContext(r);break;case"fireCustomEventAction":t.setInternalContext(r,r.internalContext)}r&&r.container&&Object.defineProperty(t,"containerLifecycleState",{get:()=>r.container.lifecycleState})}static addOptionsToAction(e,t){if(e.startsWith(c.BUILTIN_ACTION_PATH_PREFIX))switch(e.substr(c.BUILTIN_ACTION_PATH_PREFIX.length)){case"restAction":case"barcodeAction":t.setOptions({mirrorBrowserApiBehavior:!0})}}static getInternalContext(e){return e[c.CHAIN_INTERNAL_CONTEXT]}static getWritableExecutionContext(e){return this.getInternalContext(e).writableContext||e}static getDebugStream(e){return this.getInternalContext(e).debugStream}static getActionConfig(e,t){return{registrar:{setFinallyCallback:(i,r)=>{this.setFinallyCallback(t,e,i,r)}}}}static setFinallyCallback(e,t,i,r){const n=this.getInternalContext(e),{finallyCallbacks:s}=n,a=s.find((e=>e.id===t));a?(a.name=i,a.fnc=r):s.push({id:t,name:i,fnc:r})}static runFinallyCallbacks(e){const t=this.getInternalContext(e),{finallyCallbacks:i}=t;let r=Promise.resolve();i.forEach((e=>{r=r.then((()=>{if("function"==typeof e.fnc)try{return d.info("calling",e.name,"callback for action",e.id),Promise.resolve(e.fnc())}catch(t){d.error("error in Action callback for",e.id,":",e.name,t)}return null}))}))}static proxyContext(e){const t={},i=this.getInternalContext(e);return i.writableContext=e,new Proxy(e,{get(r,n){const s=r[n];if(s)return s===i?s:(t[n]=t[n]||m.proxyScope(s,n,e),t[n])},set(e,t){throw new Error(`Cannot write into ${String(t)}`)}})}static proxyScope(e,t,i){const r={},n=t=>{let i;i=s.isExtendedType(e.variables[t])?`${t}${c.BuiltinVariableName.VALUE}`:t;const r=e.getVariable(i,c.VariableNamespace.VARIABLES);if(r)return r.typeClassification===c.VariableClassification.INSTANCE_FACTORY?{constructorParams:["any"]}:r.getType()};return new Proxy(e,{get(e,a){let o=r[a];if(!o){const l=e[a];if(a===c.VariableNamespace.VARIABLES)o=m.proxyVariableAssignment(l,`${String(t)}.variables`,n,i,!0);else{if(!s.isObjectOrArray(l)||!s.isPrototypeOfObject(l))return l;o=m.preventWritesToObject(l)}r[a]=o}return o},set(e,i){throw new Error(`Cannot write into ${String(t)}.${String(i)}`)}})}static runAssignVariableActionSync(e,t){return this.runActionSync(p,"vb/action/builtin/assignVariablesAction",e,t,{alias:"Actions.assignVariable"})}static proxyVariableAssignment(e,t,i,r,n){const a={},o=e=>Number.isNaN(Number(e))?`${t}.${e}`:`${t}[${e}]`,c=new Proxy(e,{get(e,l){let h=n?a[l]:null;if(!h){const p=u.createFromString(t,m.getWritableExecutionContext(r),!1)(),d=p[l];if("function"==typeof d)return Array.isArray(e)?m.proxyArrayOperation(p,c,t,l,r):d;if(!(s.isObject(d)&&s.isPrototypeOfObject(d)||Array.isArray(d)||s.isExtendedType(d)))return d;{const e=i(l);if(!e)return d;const t=t=>s.isWildcardType(e)?"any":s.isArrayType(e)?s.getArrayRowType(e):s.isObjectType(e)?e[t]:void 0;h=m.proxyVariableAssignment(d,o(l),t,r)}n&&(a[l]=h)}return h},set(e,t,n){if(i(t)){const i={variable:o(t),value:n,auto:"always",reset:"empty"};if(Array.isArray(e[t])&&!Array.isArray(n))throw new Error(`Cannot assign non-array to an array property, ${String(t)}`);m.runAssignVariableActionSync(r,i)}else e[t]=n;return!0}});return c}static proxyArrayOperation(e,t,i,r,n){return(...s)=>{const a={variable:i,value:s,auto:"always",reset:"none"};let o,c;switch(r){case"push":return m.runAssignVariableActionSync(n,a),t.length;case"fill":case"pop":case"reverse":case"shift":case"sort":case"splice":case"unshift":return o=[...e],c=o[r](...s),a.value=o,a.reset="empty",m.runAssignVariableActionSync(n,a),"fill"===r||"reverse"===r||"sort"===r?t:c;default:return e[r](...s)}}}static preventWritesToObject(e){return new Proxy(e,{get(e,t){const i=e[t],r=Object.getOwnPropertyDescriptor(e,t);return r&&!1===r.configurable&&!1===r.writable?i:s.isObjectOrArray(i)&&s.isPrototypeOfObject(i)?m.preventWritesToObject(i):i},set(e,t){throw new Error(`Cannot write into ${String(t)}`)}})}}return m})),define("vb/action/actions",["vb/private/action/actionChainUtils","vb/private/utils"],((e,t)=>class{static async assignVariable(i,r,n){const s=t.cloneObject(r);s.auto=s.auto||"always",s.reset=s.reset||"none";const a=Object.assign({},n,{alias:"Actions.assignVariable"});return e.runAction("vb/action/builtin/assignVariablesAction",i,s,a)}static async barcode(t,i,r){const n=Object.assign({},r,{alias:"Actions.barcode"});return e.runAction("vb/action/builtin/barcodeAction",t,i,n)}static async callChain(t,i,r){const n=Object.assign({},r,{alias:"Actions.callChain"});return e.runAction("vb/action/builtin/callChainAction",t,i,n)}static async callComponentMethod(t,i,r){const n=Object.assign({},r,{alias:"Actions.callComponentMethod"});return e.runAction("vb/action/builtin/callComponentMethodAction",t,i,n)}static async fireEvent(t,i,r){const n=Object.assign({},r,{alias:"Actions.fireEvent"});return e.runAction("vb/action/builtin/fireCustomEventAction",t,i,n)}static async fireDataProviderEvent(t,i,r){const n=Object.assign({},r,{alias:"Actions.fireDataProviderEvent"});return e.runAction("vb/action/builtin/fireDataProviderEventAction",t,i,n)}static async fireNotificationEvent(i,r,n){const s=t.cloneObject(r);s.target=s.target||"leaf";const a=Object.assign({},n,{alias:"Actions.fireNotificationEvent"});return e.runAction("vb/action/builtin/fireNotificationEventAction",i,s,a)}static async geolocation(t,i,r){const n=Object.assign({},r,{alias:"Actions.geolocation"});return e.runAction("vb/action/builtin/geolocationAction",t,i,n)}static async login(t,i,r){const n=Object.assign({},r,{alias:"Actions.login"});return e.runAction("vb/action/builtin/loginAction",t,i,n)}static async getDirtyDataStatus(t,i,r){const n=Object.assign({},r,{alias:"Actions.getDirtyDataStatus"});return e.runAction("vb/action/builtin/getDirtyDataStatusAction",t,i,n)}static async resetDirtyDataStatus(t,i,r){const n=Object.assign({},r,{alias:"Actions.resetDirtyDataStatus"});return e.runAction("vb/action/builtin/resetDirtyDataStatusAction",t,i,n)}static async logout(t,i,r){const n=Object.assign({},r,{alias:"Actions.logout"});return e.runAction("vb/action/builtin/logoutAction",t,i,n)}static async navigateToPage(t,i,r){const n=Object.assign({},r,{alias:"Actions.navigateToPage"});return e.runAction("vb/action/builtin/navigateAction",t,i,n)}static async navigateToFlow(t,i,r){const n=Object.assign({},r,{alias:"Actions.navigateToFlow"});return e.runAction("vb/action/builtin/navigateAction",t,i,n)}static async navigateToApplication(t,i,r){const n=Object.assign({},r,{alias:"Actions.navigateToApplication"});return e.runAction("vb/action/builtin/navigateAction",t,i,n)}static async openUrl(t,i,r){const n=Object.assign({},r,{alias:"Actions.openUrl"});return e.runAction("vb/action/builtin/openUrlAction",t,i,n)}static async resetVariables(t,i,r){const n=Object.assign({},r,{alias:"Actions.resetVariables"});return e.runAction("vb/action/builtin/resetVariablesAction",t,i,n)}static async callRest(t,i,r){const n=Object.assign({},r,{alias:"Actions.callRest"});return e.runAction("vb/action/builtin/restAction",t,i,n)}static async navigateBack(t,i,r){const n=Object.assign({},r,{alias:"Actions.navigateBack"});return e.runAction("vb/action/builtin/navigateBackAction",t,i,n)}static async webShare(t,i,r){const n=Object.assign({},r,{alias:"Actions.webShare"});return e.runAction("vb/action/builtin/webShareAction",t,i,n)}static async runAction(t,i,r){return e.runAction(i.module,t,i.parameters,r)}})),define("vb/action/actionUtils",[],(()=>class{static async forEach(e,t,{mode:i="serial"}={}){if("serial"===i){const i=[];for(let r=0;r<e.length;r+=1)i.push(await t(e[r],r));return i}if("parallel"===i){const i=e.map(((e,i)=>t(e,i)));return Promise.all(i)}throw new Error(`Unsupported mode ${i}`)}})),define("vb/action/builtin/barcodeAction",["vb/action/action","vb/private/log"],((e,t)=>{const i=t.getLogger("/vb/action/builtin/barcodeAction"),r="Shape Detection API is not supported in the browser";let n;return class extends e{static get NOT_SUPPORTED_MSG(){return r}constructor(e,t){super(e,t),this.log=i}perform(t){if(!("BarcodeDetector"in window)||!("getSupportedFormats"in BarcodeDetector))return e.createFailureOutcome(r,new Error(r));const i=t.image,n=t.formats;return this.checkImage(i)?BarcodeDetector.getSupportedFormats().then((r=>{if(this.checkFormats(r,n)){let r;const s=this.getBarcodeDetector(n);return this.optionallyConvertBlob(i,t.convertBlob).then((e=>s.detect(e))).then((t=>{if(t&&t.length>0)r=e.createSuccessOutcome(t[0]);else if(this.options.mirrorBrowserApiBehavior)r=e.createSuccessOutcome({});else{const t="No barcodes detected";r=e.createFailureOutcome(t,new Error(t))}return r}))}const s=`${n} ${n&&n.length>1?"are":"is"} not supported by the browser`;return e.createFailureOutcome(s,new Error(s))})).catch((t=>(this.log.error(`(${this.logLabel}): ${t.message}`),e.createFailureOutcome(t.message,t,t.code)))):(this.log.error(`(${this.logLabel}): ${this.errorMessage}`),e.createFailureOutcome(this.errorMessage,new TypeError(this.errorMessage)))}getBarcodeDetector(e){let t;return void 0===e?(void 0===n&&(n=new BarcodeDetector),t=n):t=new BarcodeDetector({formats:e}),t}checkImage(e){return!!e||(this.errorMessage="BarcodeAction image parameter must be specified",!1)}checkFormats(e,t){return!Array.isArray(t)||0!==t.length&&t.reduce(((t,i)=>t&&e.find((e=>e===i))),!0)}optionallyConvertBlob(e,t){return t?window.createImageBitmap(e):Promise.resolve(e)}}})),define("vb/action/builtin/callChainAction",["vb/action/action","vb/private/action/actionChainUtils","vb/private/utils","vb/private/log"],((e,t,i,r)=>class extends e{constructor(e,t){super(e,t),this.log=r.getLogger("/vb/action/action/CallChainAction"),this.scopes=null,this.context=null}perform(e){return new Promise(((i,r)=>{const{id:n,chain:s,params:a}=e,o=n||s,c=!!s;o||(this.log.error("Required 'id' parameter missing."),r()),this.log.info("Calling action chain",o,"with parameters:",a),t.startChain(o,a,this.context,this.scopes,c,!0).catch(r).then(i)}))}setContext(e,t){this.scopes=e,this.context=t}})),define("vb/action/builtin/callComponentMethodAction",["vb/action/action","vb/private/log","ojs/ojcomponentcore","vb/private/utils"],((e,t,i,r)=>{const n=t.getLogger("/vb/private/stateManagement/callComponentMethodAction");return class extends e{perform(t){const s=t.selector?document.querySelector(t.selector):t.component,a=t.method,o=t.params||[];if(s&&a){const t=[];let n;o&&r.cloneObject(o,t);try{n=i.callComponentMethod(s,a,...t)}catch(t){return e.createFailureOutcome("Error during CallElementMethod",t)}return Promise.resolve(n).then((t=>e.createSuccessOutcome(t))).catch((t=>e.createFailureOutcome("Error during CallElementMethod",t)))}const c=`Missing parameter, element='${s}', methodName='${a}'`;return n.error(c),e.createFailureOutcome("Error during CallElementMethod",new Error(c))}}})),define("vb/action/builtin/callModuleFunctionAction",["vb/action/action","vb/private/utils","vb/private/stateManagement/stateUtils","vb/private/action/assignmentHelper","vb/private/log"],((e,t,i,r,n)=>class extends e{constructor(e,t){super(e,t),this.log=n.getLogger("/vb/action/action/CallModuleAction"),this.context=null}perform(i){const r=i.module,n=i.functionName,s=i.params,a=i.paramTypes,o=i.returnType;if(s&&!Array.isArray(s)){const e=`Action ${this.logLabel}: Inputs to CallModuleFunctionActionshould be an array, even if it is a single item.`;return this.log.error(e),Promise.reject(e)}if(a&&(!Array.isArray(a)||!s||!s.length===a.length)){const e=`Action ${this.logLabel}: Parameters to CallModuleFunctionAction doesnot match the parameter types.`;return this.log.error(e),Promise.reject(e)}a&&s.forEach(((e,t)=>{const i=a[t];s[t]=this.coerceToType(`${n}:param[${t}]`,e,i)}));const c=[];if(s&&t.cloneObject(s,c),!r||!r[n]){const e=`Action ${this.logLabel}: The module does not exist or the function '${n}' does not exist in the module`,t=this.context&&this.context.container,i=t?` for ${t.className} '${t.id}'`:"";return Promise.reject(`${e}${i}.`)}const l=r[n];let h;try{h=l.apply(r,c)}catch(t){const i=`Action ${this.logLabel}: error calling function: ${n}(${s})`;return this.log.error(i,t),Promise.resolve(e.createFailureOutcome(i,t))}return Promise.resolve(h).then((t=>{let i=t;return o&&(i=this.coerceToType(`${n}:returnType`,i,o)),e.createSuccessOutcome(i)})).catch((t=>{const i=`Action ${this.logLabel}: error calling function: ${n}(${s||""})`;return e.createFailureOutcome(i,t)}))}static buildParamValue(t,r,n){return"module"===t?i.getValueOrExpression(r,n,!1):e.buildParamValue(t,r,n)}coerceToType(e,t,n){const s=i.getType(e,{type:n},this.context.container.scopeResolver),a=r.coerceType(t,s);return this.log.finer("Action",this.logLabel,e,t,"was coerced to",a),a}setContext(e){this.context=e}})),define("vb/action/builtin/callVariableMethodAction",["vb/action/action","vb/private/utils","vb/private/stateManagement/stateUtils","vb/private/log","vb/private/constants","vb/action/builtin/assignVariablesAction"],((e,t,i,r,n,s)=>class extends s{constructor(e,t){super(e,t),this.log=r.getLogger("/vb/action/action/CallVariableFunctionAction")}perform(i){const r=i.variable,s=i.method,a=i.params,o=this.analyzeTargetExpr(r,{availableContexts:this.availableContexts});if(!(o.typeClassification===n.VariableClassification.INSTANCE_FACTORY)){const e=`Action ${this.logLabel} cannot be used with non instance factory variable ${r}`;return this.log.error(e),Promise.reject(e)}const c=o.rootValue;if(!c){const e=`Action ${this.logLabel} could not read the value of variable ${r}`;return this.log.error(e),Promise.reject(e)}const l=c.instance;if(!l||!s||"function"!=typeof l[s]){const e=`Action ${this.logLabel} cannot call method ${s} on variable ${r}`;return this.log.error(e),Promise.reject(e)}if(a&&!Array.isArray(a)){const e=`Action ${this.logLabel}: Inputs to CallVariableFunctionAction should be an array, even if it is a single item.`;return this.log.error(e),Promise.reject(e)}const h=[];a&&t.cloneObject(a,h);const p=l[s];let u;try{u=p.apply(l,h)}catch(t){const i=`Action ${this.logLabel}: error calling function: ${s}(${a})`;return this.log.error(i,t),Promise.resolve(e.createFailureOutcome(i,t))}return Promise.resolve(u).then((t=>e.createSuccessOutcome(t))).catch((t=>{const i=`Action ${this.logLabel}: error calling function: ${s}(${a||""})`;return e.createFailureOutcome(i,t)}))}setAvailableContext(e){this.availableContexts=e}})),define("vb/action/builtin/editorUrlAction",["vb/action/action","vb/private/log","vb/private/configuration","vb/private/utils","vb/private/stateManagement/router","urijs/URI"],((e,t,i,r,n,s)=>{const a=t.getLogger("/vb/action/builtin/editorUrlAction"),o="app",c="appUrl",l="extId",h="extMngr",p="pageUrl",u="domain",d="base",g="sandbox",v="stripe",f="pageContainer",m="pagePath",b="componentId",y="dynamicLayout",E="ruleset",P="podName";class x extends e{constructor(e,t){super(e,t),this.log=a}perform(t){const a=window.vbInitConfig||{},x=window.faConfig||{},T=this.scopes.application;let{editorUrl:A}=t;if(!A&&(A=a.EDITOR_URL,!A))throw new Error("The property EDITOR_URL is missing from vbInitConfig.");const C=new s(A);C.search("");const O=r.addTrailingSlash(C.path());C.path(O);const S={_h:"saas"};let w=a.APP_ID;w||(w=T.definition.id),S[o]=w,S[u]=window.location.host;const I=a.BASE_URL||requirejs.toUrl("");S[d]=I;let R=I;i.applicationUrl!==I&&(R=i.applicationUrl,S[c]=R);let _=window.location.href;_.startsWith(R)&&(_=_.substring(R.length)),S[p]=_;const N=i.getSandboxId();N&&(S[g]=N);const F=x.APP_STRIPE;F&&(S[v]=F);const j=T.extensionRegistry.constructor.extensionManagerVersion;"v2"===j&&(S[h]=j);const M="v2"===j?"services.global.oraPodName":"services.catalog.common.faPodName",D=T.initParams[M];D&&(S[P]=D);const L=n.getCurrentPage();if(L){const e=L.getNavPath();S[f]=e,S[m]=`${L.path}${L.id}`,L.package&&(S[l]=L.extensionId)}const{componentId:k}=t;if(k){const e=document.getElementById(k);if(e){S[b]=k,S[E]=e.getAttribute("layout");const t=e.getAttribute("metadata");if(t){const e=this.getDynamicLayout(t);e?S[y]=e:this.log.warn("Component",k,"is missing its DynamicLayoutMetadataProviderDescriptor definition")}}else this.log.warn("Component",k,"is not found in the document.")}return this.log.info("Using VB editor URL:",A,"with params:",S),C.setSearch(S),e.createSuccessOutcome(C.href())}getDynamicLayout(e){let t;const i=x.getMetadataProviderFromBinding(e);if(i){const{definition:e}=this.scopes.container,r=e.metadata[i];r&&(t=r.defaultValue&&r.defaultValue.endpoint)}return t}static getMetadataProviderFromBinding(e){const t=".metadata.",i=e.indexOf(t);let r;if(i){const n=i+t.length;r=e.substring(n,e.indexOf(".",n))}return r}setContext(e){this.scopes=e}}return x})),define("vb/action/eventAction",["vb/private/constants","vb/private/log","vb/action/action","vb/private/stateManagement/router"],((e,t,i,r)=>{const n=t.getLogger("/vb/action/eventAction"),s=[e.ENTER_EVENT,e.EXIT_EVENT,e.BEFORE_ENTER_EVENT,e.BEFORE_EXIT_EVENT,e.INTERACTABLE_EVENT,e.AFTER_NAVIGATE_EVENT,e.RESOURCE_CHANGED_EVENT];return class extends i{perform(){throw new Error("Cannot instantiate EventAction.")}setContext(e){this.context=e,e&&e.container&&e.container.invokeEventWithBubbling&&"function"==typeof e.container.invokeEventWithBubbling&&(this.eventContainer=e.container)}static isValidTarget(t){return null==t||t===e.EventTargets.LEAF||t===e.EventTargets.CURRENT}static fireEvent(t,i,s,a){let o;return a&&a.target===e.EventTargets.LEAF?(o=t&&t.getLeafContainer()||r.getCurrentPage(),o||n.warn(`Could not get the current page for event: ${i}`)):o=t,o?o.invokeEventWithBubbling(i,s):null}static isValid(e){return e&&-1===s.indexOf(e)}}})),define("vb/private/events/eventBehavior",["vb/private/constants","vb/private/log","vb/action/action","vb/private/action/assignmentHelper","vb/private/stateManagement/router","vb/private/stateManagement/stateUtils","vb/private/utils"],((e,t,i,r,n,s,a)=>{const o=t.getLogger("/vb/private/events/eventBehavior");class c{constructor(t,i,r){i&&(this.name=t,this.behavior=i.behavior,this.payloadType=i.payloadType,this.returnType=i.returnType,this.mode=i.mode,this.eventModel=i),this.registry=r,this.behavior=this.behavior||e.EventBehaviors.NOTIFY}start(e,t,i){let n;if(e.isExtension()){const i=this.findEventDefinition(e,t,e),r=i&&i.container;r&&(e===r||r.isExtension())&&(n=e)}if(n||(n=this.startingContainer(e)||e),n){const s=this.findEventDefinition(n,t,e);if(s){const a=s&&s.payloadType?r.coerceType(i,s.payloadType):i,o={callerName:t,name:this.eventModel.fullName,origin:e,payload:i,coercedPayload:a,eventModel:s},c=this.recurseContainmentAndCreateFunctions(n,o);return this.eventModel.behavior.execute(c)}return Promise.reject(new Error(`unable to fire event ${t}: no event model found for ${n.className}, fired from ${e.className}.`))}return Promise.reject(new Error(`unable to fire event ${t}: no event source found,  fired from ${e.className}.`))}startingContainer(e){return e?e.getLeafContainer():n.getCurrentPage()}listenableBy(t){return!t.isExtension()||this.mode===e.EventMode.TRIGGERABLE||this.mode===e.EventMode.LISTENABLE}triggerableBy(t){return!t.isExtension()||this.eventModel&&this.eventModel.container===t||this.mode===e.EventMode.TRIGGERABLE}findEventDefinition(e,t,i){let r=this.registry.get(e,i,t);if(!r){const n=e.parent;n&&(r=this.findEventDefinition(n,t,i))}return r}callChainFunctions(e,t,i,r){return this.callChainFunctionsInternal(e,t,i,r)}callChainFunctionsInternal(e,t,i,r){return e.callListenerChainFunctionsInParallel(t,i).then((e=>e&&e.map(((e,i)=>({chainId:t[i].chainId,result:e})))))}execute(e){return o.info("Triggering declared event, name:",this.name,"behavior:",this.behavior,"payloadType:",this.payloadType),this.executeInternal(e).then((()=>{}))}executeInternal(e){return Promise.all(e.map((e=>e.fnc(this))))}static shape(e,t){return t?r.coerceType(e,t):e}curryListeners(e,t,i){const r=[],n=e.invokeEvent.bind(e,i.name,i.coercedPayload);if(r.push({container:e,fnc:n}),t.isInterface){const t=this.recurseExtensionsAndCreateFunctions(e,i);Array.prototype.push.apply(r,t)}return r}recurseContainmentAndCreateFunctions(t,i){const r=t.getAvailableContexts().clone();r[e.ContextName.EVENT]=i.payload;const n=[];let s;const a=this.registry.get(t,i.origin,i.name);if(a&&this.listenableBy(t)){const e=this.curryListeners(t,a,i);Array.prototype.push.apply(n,e)}return t!==i.eventModel.container&&(s=this.getNextContainerForBubbling(t,i.name,r)),s&&this.addFunctionWrappers(n,this.recurseContainmentAndCreateFunctions(s,i)),n}addFunctionWrappers(e,t){const i=[];t.forEach((t=>{e.find((e=>t.container===e.container))||i.push(t)})),Array.prototype.push.apply(e,i)}recurseExtensionsAndCreateFunctions(e,t){const i=[];return e.extensionsArray&&e.extensionsArray.forEach((e=>{const r=this.recurseContainmentAndCreateFunctions(e,t);Array.prototype.push.apply(i,r)})),i}getNextContainerForBubbling(e,t,i){return this.checkStopPropagationExpression(e,t,i)?null:e.parent}checkStopPropagationExpression(e,t,i){const r=e.findEventListener(t),n=(()=>{if(r&&r.stopPropagation){const e=s.getValueOrExpression(r.stopPropagation,i);return a.resolveIfObservable(e)}return!1})();if(n){const i="Event listener 'stopPropagation' returned true";o.info("Event bubbling stopped at container",e.name,"for event",t,":",i)}return n}}return c.ResultProperties={RETURN:"return"},c})),define("vb/private/events/transformEventBehavior",["vb/private/events/eventBehavior","vb/private/constants","vb/private/log","vb/action/action"],((e,t,i,r)=>{const n=i.getLogger("/vb/private/events/transformEventBehavior");class s extends e{execute(t){return n.info("Triggering declared event, name:",this.name,"behavior:",this.behavior,"payloadType:",this.payloadType),this.executeInternal(t).then((t=>({[e.ResultProperties.RETURN]:t})))}executeInternal(e){let t={name:r.Outcome.SUCCESS,result:void 0};return e.reduce(((e,i)=>Promise.resolve(e).then((e=>(t=s.resultToPrevious(e,this.returnType,t),i.fnc(this,t))))),Promise.resolve()).then((e=>s.resultToPrevious(e,this.returnType,t)))}callChainFunctionsInternal(e,i,n,a){const o=n;o[t.ContextName.PREVIOUS]=a;const c={name:r.Outcome.SUCCESS,result:n[t.ContextName.PREVIOUS]};return i.reduce(((e,i)=>Promise.resolve(e).then((e=>(o[t.ContextName.PREVIOUS]=s.resultToPrevious(e,this.returnType),i.fnc(o))))),Promise.resolve(c))}static resultToPrevious(i,n,s){if(i){if(i.name===r.Outcome.SUCCESS)return e.shape(i.result,n);if(i===t.NO_EVENT_LISTENER_RESPONSE)return s}}}return s})),define("vb/private/events/checkCancelEventBehavior",["vb/private/events/eventBehavior","vb/private/constants","vb/private/log"],((e,t,i)=>{const r=i.getLogger("/vb/private/events/checkCanceleventBehavior");class n extends e{executeInternal(e){const i=[];let s=!1;return e.reduce(((e,t)=>e.then((e=>{if(!s){if(!n.isCancelResult(e))return Promise.resolve(t.fnc(this)).then((e=>(i.push(e),e)));r.info(`Event propagation cancelled for event ${this.name}`),s=!0}return null}))),Promise.resolve(t.NO_EVENT_LISTENER_RESPONSE))}static isCancelResult(e){return Array.isArray(e)&&e.some((e=>e&&"success"===e.result.name&&e.result.result&&!0===e.result.result.stopPropagation))}curryListeners(e,t,i){const r=[];if(t.isInterface){const t=this.recurseExtensionsAndCreateFunctions(e,i);Array.prototype.push.apply(r,t)}const n=e.invokeEvent.bind(e,i.name,i.coercedPayload);return r.push({container:e,fnc:n}),r}}return n})),define("vb/private/events/notifyEventBehavior",["vb/private/constants","vb/private/log","vb/action/action","vb/private/action/assignmentHelper","vb/private/events/eventBehavior"],((e,t,i,r,n)=>class extends n{executeInternal(e){return super.executeInternal(e),Promise.resolve(null)}})),define("vb/private/events/notifyWaitEventBehavior",["vb/private/events/eventBehavior"],(e=>class extends e{executeInternal(e){return e.reduce(((e,t)=>Promise.resolve(e).then((()=>Promise.resolve(t.fnc(this)).then((e=>e))))),Promise.resolve())}})),define("vb/private/events/undeclaredEventBehavior",["vb/private/constants","vb/private/log","vb/action/action","vb/private/action/assignmentHelper","vb/private/events/eventBehavior"],((e,t,i,r,n)=>{const s=[e.APPLICATION_PREFIX,e.FLOW_PREFIX,e.PAGE_PREFIX,e.LAYOUT_PREFIX,e.FRAGMENT_PREFIX];class a extends n{startingContainer(e){return a.isNamespaced(this.name)?null:e}static isNamespaced(e){const t=(e||"").split(":");if(2===t.length){const e=t[0].split("/");return s.indexOf(e[e.length-1])>=0}return!1}triggerableBy(){return!0}listenableBy(){return!a.isNamespaced(this.name)}curryListeners(e,t,i){const r=[],n=e.invokeEvent.bind(e,i.name,i.coercedPayload);return r.push({container:e,fnc:n}),r}}return a})),define("vb/private/events/eventBehaviorFactory",["vb/private/events/eventBehavior","vb/private/events/transformEventBehavior","vb/private/events/checkCancelEventBehavior","vb/private/events/notifyEventBehavior","vb/private/events/notifyWaitEventBehavior","vb/private/events/undeclaredEventBehavior","vb/private/constants"],((e,t,i,r,n,s,a)=>class{static create(o,c,l){const h=c&&c.behavior;switch(h){case a.EventBehaviors.TRANSFORM:return new t(o,c,l);case a.EventBehaviors.CHECK_CANCEL:return new i(o,c,l);case a.EventBehaviors.NOTIFY_WAIT:return new n(o,c,l);case a.EventBehaviors.NOTIFY:return new r(o,c,l);case a.EventBehaviors.DYNAMIC_COMP:return new e(o,c,l);default:if(h)throw new Error(`Event declaration has an invalid "behavior": ${h}`);return c&&c.isDeclared?new r(o,c,l):new s(o,c||{},l)}}})),define("vb/private/events/baseEventModel",["vb/private/constants","vb/private/log"],((e,t)=>{const i=t.getLogger("/vb/private/events/eventModel"),r=["application","flow","page","apppackage","packageflow","packagepage","applicationextension","apppackageextension","flowextension","pageextension"];class n{constructor(t,i,r,s,a=!1){this.name=t,Object.assign(this,r),this.container=s,this.isDeclared=!!s,this.fullName=s?`${s.extensionId||e.ExtensionNamespaces.BASE}/${n.basePrefix(s)}:${t}`:t,this.isInterface=a}accessibleBy(e,t){if("Application"===this.container.className)return!0;const i=n.parseName(e,t);if(e.isExtension()){const t=n.parseName(this.container,this.name);if(i.ext!==t.ext)return!1;const r=e.scopeResolver[i.prefix];if(r&&!!r.hasEvent(i.name))return!0}const s=n.baseContainer(e).scopeResolver;return!(!s||s[this.container.eventPrefix]!==this.container)&&r.indexOf(e.className.toLowerCase())>=r.indexOf(this.container.eventPrefix)}static baseContainer(e){return e.base||e}static basePrefix(e){return n.baseContainer(e).eventPrefix}static parseName(t,r){const s=r.split(":");let a,o;if(2===s.length)[a,o]=s;else{if(1!==s.length)return i.error("Invalid event name",r),null;[o]=s;a=`${t.extensionId||e.ExtensionNamespaces.BASE}/${n.basePrefix(t)}`}const c=a.split("/");if(2===c.length)c[0]||(c[0]=e.ExtensionNamespaces.BASE);else if(1===c.length){const i=t.extensionId||e.ExtensionNamespaces.BASE;c.unshift(i)}return c[1]||(c[1]=n.basePrefix(t)),{ext:c[0],prefix:c[1],name:o}}}return n})),define("vb/private/events/eventModel",["vb/private/events/baseEventModel","vb/private/stateManagement/stateUtils","vb/private/events/eventBehaviorFactory"],((e,t,i)=>class extends e{constructor(e,t,r,n,s=!1){super(e,t,r,n,s),this.behavior=i.create(e,this,t)}})),define("vb/private/events/eventRegistry",["vb/private/constants","vb/private/log","vb/private/utils","vb/private/stateManagement/stateUtils","vb/private/events/eventBehaviorFactory","vb/private/events/baseEventModel","vb/private/events/eventModel","vb/private/events/undeclaredEventBehavior"],((e,t,i,r,n,s,a,o)=>{const c=t.getLogger("/vb/private/events/eventRegistry");function l(t){return t===e.EventBehaviors.DYNAMIC_COMP?t:"vb"}class h{constructor(){this.registeredMap={}}register(t,n,o,p=!1){if(n){const u=o||{};if(u.payloadType){if(i.isInstanceType(u.payloadType))return c.error(`Declared events do not allow builtin types, skipping: ${n}, type: ${u.payloadType}`),null;try{r.getType(n,{type:u.payloadType})}catch(e){return c.error(`Declared events error, skipping: ${e}`),null}}const d=t.extensionId||"",g=h.key(d,t.fullPath,n),v=l(u.behavior);this.registeredMap[v]=this.registeredMap[v]||{};const f=u.behavior===e.EventBehaviors.DYNAMIC_COMP?s:a;return this.registeredMap[v][g]=new f(n,this,u,t,p),this.registeredMap[v][g]}return null}get(t,i,r,n){const s=a.parseName(i,r),c=h.findEventDecl(i,this.registeredMap,s,n);if(c){const e=a.parseName(c.container,c.fullName);return s.ext!==e.ext?c.accessibleBy(t,c.fullName)?c:null:c.accessibleBy(t,r)?c:null}if(o.isNamespaced(r))return null;const l=function(t){return t===e.EventBehaviors.DYNAMIC_COMP?null:a}(n);return l?new l(r,this):null}static findEventDecl(t,i,r,n){if(!t)return null;let s=t,o=r.ext;r.ext===e.ExtensionNamespaces.BASE&&(s=a.baseContainer(t),o=s.extensionId);const c=s.scopeResolver||{};if(c&&c[r.prefix]){const t=h.key(o,c[r.prefix].fullPath,r.name),a=l(n),p=i[a]&&i[a][t];if(p)return p;if(r.ext===e.ExtensionNamespaces.BASE)return h.findEventDecl(s.base,i,r,n)}return null}findListener(t,i){const r=t.definition&&t.definition.eventListeners||{};if(!r)return null;if(r[i])return r[i];const n=a.parseName(t,i);if(n.ext===t.extensionId){const e=`${n.prefix}:${n.name}`;if(r[e])return r[e]}if(n.ext===e.ExtensionNamespaces.BASE||h.isInExtensionHierarchy(t,n.ext)){const i=`${t.isExtension()?"/":""}${n.prefix}:${n.name}`;if(r[i])return r[i];const s=`${e.ExtensionNamespaces.BASE}/${n.prefix}:${n.name}`;if(r[s])return r[s]}return n.prefix===a.basePrefix(t)&&r[n.name]?r[n.name]:r[i]}static isInExtensionHierarchy(e,t){let i=e;return!(!i||!i.base)&&(i=i.base,i.extensionId===t||h.isInExtensionHierarchy(i,t))}static key(t,i,r){const n=i||"";return`${t||e.ExtensionNamespaces.BASE}/${n.toLowerCase()}:${r}`}}return new h})),define("vb/action/builtin/fireCustomEventAction",["vb/action/eventAction","vb/action/action","vb/private/log","vb/private/constants","vb/private/events/eventRegistry","vb/private/action/assignmentHelper","vb/private/utils"],((e,t,i,r,n,s,a)=>{const o=i.getLogger("/vb/private/stateManagement/fireCustomEventAction"),c=/^[a-z][A-Za-z]*$/;return class extends e{perform(t){const i=t.name||t.event,{payload:s}=t;let c=s;if(s&&(c=a.cloneObject(s)),o.info("FireCustomEventAction",this.logLabel,"with event name",i,"and payload",c),!e.isValid(i))return e.createFailureOutcome(`Unable to fire invalid event: ${i}`);const l=n.get(this.context.container,this.context.container,i,r.EventBehaviors.DYNAMIC_COMP);if(l)return l.isInterface?this.performDynamicComponentBehavior(i,c,l):e.createFailureOutcome(`Events with "template" behavior must be declared in the "interface" section: ${t.target}`);if(t&&!e.isValidTarget(t.target))return e.createFailureOutcome(`invalid "target" for event action: ${t.target}`);if(this.eventContainer){const r=n.get(this.eventContainer,this.eventContainer,i);if(r&&!this.eventContainer.canFireEvent(r))return e.createFailureOutcome(`Unable to find event declaration for: ${i}`);const s=e.fireEvent(this.eventContainer,i,c,t);if(!s)return e.createFailureOutcome(`Unable to find target: ${t.target}`);return Promise.resolve(s).then((t=>(this.performPropagationBehavior(i,c,r),e.createSuccessOutcome(t))))}return e.createFailureOutcome(`FireCustomEventAction ${this.logLabel}: unable to fire event ${i}, no page context`)}performDynamicComponentBehavior(t,i,r){if(!t||!e.isValid(t))return e.createFailureOutcome(`Unable to fire invalid event: ${t}`);if(!this.eventContainer||!this.eventContainer.allowsDynamicComponentEventBehavior(r.behavior)){const i=`Unable to fire event: ${t}. Events with 'dynamicComponent' behavior must be fired from a container that supports the behavior, such as Layout`;return o.error(i),e.createFailureOutcome(i)}if(o.warn("The dynamicComponent behavior is being deprecated in favor of propagationBehavior:container.",`Please update event '${t}' to use the propagationBehavior:container behavior.`),c.test(t)||o.info("About to fire an event",t,"that might be invalid. The name must be all lowercase or","camelCased!"),!this.context)return e.createFailureOutcome(`vb/fireCustomEventAction does not have a valid context for event: ${t}.`);if(!r||!r.isDeclared)return e.createFailureOutcome(`Unable to find event declaration for: ${t}`);const n=r.payloadType?s.coerceType(i,r.payloadType):i;return this.raiseEvent(t,n)}performPropagationBehavior(t,i,n){if(!t||!e.isValid(t))return e.createFailureOutcome(`Unable to fire invalid event: ${t}`);if(this.eventContainer&&this.eventContainer.allowsEventPropagation(r.EventPropagationBehaviors.CONTAINER,n)){if(!this.context)return e.createFailureOutcome(`vb/fireCustomEventAction does not have a valid context for event: ${t}.`);if(!n||!n.isDeclared)return e.createFailureOutcome(`Unable to find event declaration for: ${t}`);c.test(t)||o.info("About to fire an event",t,"that might be invalid. The name must be all lowercase or","camelCased!");const r=n.payloadType?s.coerceType(i,n.payloadType):i;return this.raiseEvent(n.name,r,!1)}return!0}raiseEvent(t,i,r=!0){const n=this.getDispatcher();if(!n){const i=`Unable to fire event '${t}', as no component event dispatcher provided.`;return e.createFailureOutcome(i)}try{let e;void 0===console.table?(e=document.createEvent("Event"),e.initEvent(t,!1,!0)):e=new Event(t,{bubbles:!1}),e.detail=i,n(e);const s=r?"Dynamic":"";o.info("Dispatched",s,"Container event: ",t,"result")}catch(i){return e.createFailureOutcome(`Exception firing DOM event: ${t}`,i)}return e.createSuccessOutcome()}getDispatcher(){const e=this.internalContext&&this.internalContext[r.ContextName.BINDING_CONTEXT];let t=e&&e.$data&&e.$data[r.ContextNameInternal.DISPATCH_EVENT];return!t&&this.eventContainer&&(t="function"==typeof this.eventContainer.getEventDispatcher&&this.eventContainer.getEventDispatcher()),t}setInternalContext(e,t){super.setContext(e),this.internalContext=t}}})),define("vb/private/types/dataProviderConstants",[],(()=>{const e={Common:{IMPLEMENTATION:"implementation",ITERATION:"iteration"},DataProviderFetchType:{FETCH_BY_KEYS:"fetchByKeys",FETCH_FIRST:"fetchFirst",FETCH_BY_OFFSET:"fetchByOffset"},CAPABILITIES_KEY:"capabilities",TOTAL_SIZE:"totalSize"};return e.CapabilityType={SORT:"sort",FILTER:"filter",FETCH_BY_KEYS:e.DataProviderFetchType.FETCH_BY_KEYS,FETCH_BY_OFFSET:e.DataProviderFetchType.FETCH_BY_OFFSET,FETCH_FIRST:e.DataProviderFetchType.FETCH_FIRST},e.CapabilityKeys={FETCH_BY_KEYS_IMPLEMENTATION:e.Common.IMPLEMENTATION,FETCH_BY_KEYS_MULTI_KEY_LOOKUP:"multiKeyLookup",FETCH_BY_OFFSET_IMPLEMENTATION:e.Common.IMPLEMENTATION,FETCH_FIRST_IMPLEMENTATION:e.Common.IMPLEMENTATION,FETCH_FIRST_ITERATE_AFTER_DONE:"iterateAfterDone",FILTER_OPERATORS:"operators",SORT_ATTRIBUTES:"attributes"},e.CapabilityValues={FETCH_BY_KEYS_IMPLEMENTATION_LOOKUP:"lookup",FETCH_BY_KEYS_IMPLEMENTATION_ITERATION:e.Common.ITERATION,FETCH_BY_KEYS_MULTI_KEY_LOOKUP_YES:"yes",FETCH_BY_KEYS_MULTI_KEY_LOOKUP_NO:"no",FETCH_BY_OFFSET_IMPLEMENTATION_RANDOM_ACCESS:"randomAccess",FETCH_BY_OFFSET_IMPLEMENTATION_ITERATION:e.Common.ITERATION,FETCH_FIRST_IMPLEMENTATION_ITERATION:e.Common.ITERATION,FETCH_FIRST_ITERATE_AFTER_DONE_NOT_ALLOWED:"notAllowed",FILTER_OPERATORS_OPS:["$co","$eq","$ew","$pr","$gt","$ge","$lt","$le","$ne","$sw","$and","$or"],SORT_ATTRIBUTES_MULTIPLE:"multiple"},e.DataProviderIdAttributeProperty={ID_ATTRIBUTE:"idAttribute",KEY_ATTRIBUTES:"keyAttributes"},e.DataProviderIsEmptyValues={YES:"yes",NO:"no",UNKNOWN:"unknown"},e.DataProviderEvent={REFRESH:"refresh",MUTATE:"mutate"},e.DataProviderMutationEvent={ADD:"add",UPDATE:"update",REMOVE:"remove"},e.DataProviderIdAttribute={AT_INDEX:"@index",AT_VALUE:"@value"},e.DEFAULT_ANY_ARRAY_TYPE="any[]",e.DEFAULT_ANY_TYPE="any",e.DEFAULT_OBJECT_TYPE="object",e.DEFAULT_OBJECT_ARRAY_TYPE="object[]",e.DEFAULT_PRIMITIVE_ARRAY_TYPES=["string[]","number[]","boolean[]"],e})),define("vb/private/types/utils/dataProviderUtils",["knockout","vb/private/utils","vb/private/log","vb/binding/expression","vb/private/types/dataProviderConstants"],((e,t,i,r,n)=>{const s=i.getLogger("/vb/private/types/utils/dataProviderUtils"),a={innerEquals:(e,t)=>{if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;const i=Object.prototype.hasOwnProperty,r=Object.keys(e);let n;r.forEach((s=>{if(n=r[s],i.call(e,n)){if(!i.call(t,n))return!1;if(e[n]!==t[n]){if("object"!=typeof e[n])return!1;if(!a.innerEquals(e[n],t[n]))return!1}}}));const s=Object.keys(t);return s.forEach((r=>{if(n=s[r],i.call(t,n)&&!i.call(e,n))return!1})),0!==r.length||0!==s.length||JSON.stringify(e)===JSON.stringify(t)},compareValues:(e,t)=>{if(e===t)return!0;if(typeof e!==typeof t)return!1;if(null===e||null===t)return!1;if(e.constructor===t.constructor){if(Array.isArray(e))return a.compareArrayValues(e,t);if(e.constructor===Object)return a.innerEquals(e,t);if(e.valueOf&&"function"==typeof e.valueOf)return e.valueOf()===t.valueOf()}return!1},compareArrayValues:(e,t)=>{if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(!a.compareValues(e[i],t[i]))return!1;return!0}};function o(e,t){let i=e,r=t;return i instanceof Set&&r instanceof Set&&(i=[],e.forEach((e=>{i.push(e)})),r=[],t.forEach((e=>{r.push(e)}))),function(e,t){return a.compareValues(e,t)}(i,r)}const c={getKeys:"auto"};class l{getKey(e){throw new Error("getKey unimplemented")}getKeys(e){throw new Error("getKeys unimplemented")}getIndices(e,t){throw new Error("getIndices unimplemented")}compare(e,t){return e===t}getCapabilities(){return c}}class h extends l{constructor(e){super(),this.idAttr=e}getKey(e){return e[this.idAttr]}getKeys(e){return new Set(e.map((e=>this.getKey(e))))}getIndices(e,t){return e.map(((e,i)=>i+t))}compare(e,t){return o(e,t)}}class p extends l{constructor(e){super(),this.idAttrs=e}getKey(e){return this.idAttrs.map((t=>e[t]))}getKeys(e){return new Set(e.map((e=>this.getKey(e))))}getIndices(e,t){return e.map(((e,i)=>i+t))}compare(e,t){return o(e,t)}}class u extends l{constructor(e){super(),this.idAttrs=e}getKey(e){let t;try{t=Object.getOwnPropertyNames(e)}catch(i){t=Object.getOwnPropertyNames.prototype.call(e)}return t.map((t=>e[t]))}getKeys(e){return new Set(e.map((e=>this.getKey(e))))}getIndices(e,t){return e.map(((e,i)=>i+t))}compare(e,t){return o(e,t)}}class d extends l{getKey(){return null}getKeys(){return null}getIndices(e,t=0){return e.map(((e,i)=>i+t))}getCapabilities(){return{getKeys:"none"}}}class g{constructor(e){this.key=e}fixupKey(e){this.key=e}}const v="$eq",f="$ne",m="$gt",b="$ge",y="$lt",E="$le",P="$sw",x="$ew",T="$co",A="$pr",C="$and",O="$or";class S{static createFetchByKeysResultItemMetadata(e){const t=[];return(e||[]).forEach((e=>t.push(new g(e)))),t}static getIdAttributeHelper(e){return e&&"string"==typeof e?e===n.DataProviderIdAttribute.AT_INDEX?new d(e):e===n.DataProviderIdAttribute.AT_VALUE?new u(e):new h(e):Array.isArray(e)?new p(e):new d}static unwrapData(t){let i=t;return e.isObservable(i)&&(i=e.utils.unwrapObservable(t)),i}static getObjectByPath(e,t=""){let i=e;if(t&&t.length>0){t.split(".").forEach((r=>{if(i){const n=r.match(/\[(.*?)\]/g);if(n){let a;n.forEach(((n,o)=>{0===o&&(a=r.substr(0,r.indexOf(n)),i=a?i[a]||[]:i);const c=n&&n.match(/\[(.*?)\]/)||[],l=c[1]?Number(c[1]):null;Number.isNaN(l)?(s.error("there was an issue evaluating",r,"within the itemPath",t,"for the data provided",e),i=void 0):i=i[l]}))}else i=i[r],i||(s.error("there was an issue evaluating",r,"within the itemPath",t,"for the data provided",e),i=void 0)}}))}return i||[]}static setObjectByPath(e,t="",i){let r=e;if(t&&t.length>0){const n=t.split(".");n.forEach(((a,o)=>{const c=`there was an issue evaluating '${a}' within the itemPath ${t}, for the data provided ${e}`;if(r){const e=a.match(/\[(.*?)\]/g);if(e){let t;e.forEach(((e,l)=>{0===l&&(t=a.substr(0,a.indexOf(e)),r=t?r[t]||[]:r);const h=e&&e.match(/\[(.*?)\]/)||[],p=h[1]?Number(h[1]):null;Number.isNaN(p)?(s.error(c),r=void 0):o===n.length-1?r[p]=i:r=r[p]}))}else o===n.length-1?r[a]=i:(r=r[a],r||(s.error(c),r=void 0))}else s.error(c)}))}return r}static getResolvedType(e,i,r=!1){return e&&(!t.isObjectOrArray(e)||Object.keys(e).length>0)?i.getType(e,`${i.getId()}:response`):r?n.DEFAULT_ANY_TYPE:e}static isTypeDefIncomplete(e){const t=[n.DEFAULT_OBJECT_TYPE,n.DEFAULT_OBJECT_ARRAY_TYPE,n.DEFAULT_ANY_TYPE,n.DEFAULT_ANY_ARRAY_TYPE];return"string"==typeof e&&t.includes(e)}static getTypeWithLeafProps(e){let t;if(Array.isArray(e)&&(t=t||[],t[0]=S.getTypeWithLeafProps(e[0])),"object"==typeof e){Object.keys(e).forEach((i=>{"object"!=typeof e[i]&&(t=t||{},t[i]=e[i])}))}else"string"==typeof e&&(t=e.includes(n.DEFAULT_PRIMITIVE_ARRAY_TYPES)&&e||n.DEFAULT_ANY_TYPE);return t}static hasDefaultKeyword(e){return!!e.find((e=>"string"==typeof e&&"@default"===e||"object"==typeof e&&"@default"===e.name))}static getFilteredTypeDef(e,t){let i;if(S.isTypeDefIncomplete(t)&&e.length>0)return i=t||n.DEFAULT_ANY_TYPE,i;if("object"!=typeof t)return i=t||n.DEFAULT_ANY_TYPE,i;i=S.getTypeWithLeafProps(t);const r=S.hasDefaultKeyword(e),s=S.getFlattenedAttrs(e);if(r){const e=s.filter((e=>e&&e.startsWith("!"))).map((e=>e.startsWith("!")?e.substr(1):e));e&&e.length>0&&(Array.isArray(i)?i[0]=S.getFilteredItemTypeDef(i[0],e,!0):i=S.getFilteredItemTypeDef(i,e,!0))}else{const e=s.filter((e=>"string"==typeof e));e&&e.length>0&&(Array.isArray(i)?i[0]=S.getFilteredItemTypeDef(i[0],e):i=S.getFilteredItemTypeDef(i,e))}return e.filter((e=>"object"==typeof e&&Object.keys(e).length>1)).forEach((e=>{if(e.name&&e.attributes&&e.attributes.length>0){let r;Array.isArray(t)?(r=t[0][e.name],i[0][e.name]=S.getFilteredTypeDef(e.attributes,r)):"object"==typeof t?(r=t[e.name],i[e.name]=S.getFilteredTypeDef(e.attributes,r)):i[e.name]=r||n.DEFAULT_ANY_TYPE}})),i}static getFilteredItemTypeDef(e,t,i=!1){let r;return i&&(r=e),Object.values(t).forEach((t=>{const s=Object.keys(e).find((e=>e===t));s?i?delete r[s]:(r=r||{},r[s]=e[s]):i||(r=r||{},r[s]=n.DEFAULT_ANY_TYPE)})),r}static getFlattenedAttrs(e){const t=[];return e.forEach((e=>{"string"==typeof e?t.push(e):"object"==typeof e&&1===Object.keys(e).length&&e.name&&"string"==typeof e.name&&t.push(e.name)})),t}static isAttributeCriterion(e){return e&&"object"==typeof e&&S.isAttributeOperator(e.op)&&e.attribute&&(!e.criteria||Array.isArray(e.criteria)&&0===e.criteria.length)}static isCompoundCriterion(e){return!(!((!e.op||S.isCompoundOperator(e.op))&&e.criteria&&Array.isArray(e.criteria)&&e.criteria.length>=1)||e.attribute||e.value)}static isAttributeOperator(e){return e===v||e===f||e===m||e===b||e===y||e===E||e===P||e===x||e===T||e===A}static isCompoundOperator(e){return e&&(e===C||e===O)}static combineFilterCriterionFromMultipleSources(e,t){const i=t,r=e,n={};return i&&(S.isAttributeCriterion(i)||S.isCompoundCriterion(i))?(n.op=C,n.criteria=[],n.criteria.push(r),n.criteria.push(i),n):r}}return S})),define("vb/action/builtin/fireDataProviderEventAction",["ojs/ojdataprovider","vb/action/action","vb/private/log","vb/private/types/utils/dataProviderUtils","vb/private/types/dataProviderConstants","vb/private/utils"],((e,t,i,r,n,s)=>{const a=i.getLogger("/vb/private/stateManagement/fireDataProviderEventAction"),o=n.DataProviderEvent.REFRESH,c=[n.DataProviderMutationEvent.ADD,n.DataProviderMutationEvent.UPDATE,n.DataProviderMutationEvent.REMOVE],l=new e.DataProviderRefreshEvent;class h{constructor(e){this.key=e}}class p{constructor(e,t,i,r){this.metadata=e,this.data=t,this.indexes=i,this.keys=r}}class u extends p{constructor(e,t,i,r,n,s){super(e,t,i,r),this.afterKeys=n||[],this.addBeforeKeys=s||[]}}class d{constructor(){return this.add=null,this.remove=null,this.update=null,this}addEvent(e){return this.add=e,this}updateEvent(e){return this.update=e,this}removeEvent(e){return this.remove=e,this}}class g{constructor(e){if(this.dataProvider=e,s.isExtendedType(e)){this.extendedType=!0;const t=e.getValue(),i=e.getIdAttributeProperty&&e.getIdAttributeProperty();this.idAttribute=i?t[i]:t[n.DataProviderIdAttributeProperty.ID_ATTRIBUTE],this.itemsPath=t.itemsPath,this.log=a}}static throwError(e,t){const i=t||`${e} event was raised but a valid payload was not provided!`;throw a.error(i),i}static isEventWithValidPayload(e,t){if(c.indexOf(e)>=0){if(t&&Object.keys(t).length>0&&(t.data||t.keys||t.indexes))return!0}return!1}assembleKeysFromData(e,t,i){let r=i,s=r&&(r instanceof Set?r.size:r.length);if((!r||!s)&&this.canBuildKeys()){if(this.log.warn("No keys were specified in the event payload for the mutation operation",e,". Attempting to build keys from data."),t&&0===t.length)return new Set;r=this._buildKeys(t),s=r&&r.size,!s||0===s&&t.length>0?g.throwError(e,`${e} event has no keys set for the data, or the keys cannot be determined from the data, ${t}`):s>0&&s>t.length&&e!==n.DataProviderMutationEvent.REMOVE&&g.throwError(e,`${e} event has more keys ${i} than the data ${t}`)}return r&&Array.isArray(r)?new Set(r):r}fireEvent(t){let i=null;if(Object.keys(t).indexOf(o)>=0)i=l;else{let r,s,a,o,c,l;const h=new d;Object.keys(t).forEach((e=>{const i=t[e];if(g.isEventWithValidPayload(e,i)||g.throwError(e),this.extendedType)switch(e){case n.DataProviderMutationEvent.ADD:{r=this._getDataItemsArray(i.data),o=this.assembleKeysFromData(e,r,i.keys),({metadata:s}=i),({indexes:a}=i),({afterKeys:c}=i),({addBeforeKeys:l}=i);(c&&(c instanceof Set?c.size:c.length))>0&&this.log.warn("afterKeys parameter is being deprecated on the FireDataProviderEventAction. Use addBeforeKeys instead.");const t=new u(s,r,a,o,c,l);h.addEvent(t);break}case n.DataProviderMutationEvent.UPDATE:case n.DataProviderMutationEvent.REMOVE:{r=this._getDataItemsArray(i.data),o=this.assembleKeysFromData(e,r,i.keys),({indexes:a}=i),({metadata:s}=i);const t=new p(s,r,a,o);e===n.DataProviderMutationEvent.UPDATE?h.updateEvent(t):h.removeEvent(t);break}default:{const t=`The event ${e} is not recognized as a valid DataProvider event`;g.throwError(e,t);break}}else switch(({keys:o}=i),({data:r}=i),({metadata:s}=i),({indexes:a}=i),({afterKeys:c}=i),({addBeforeKeys:l}=i),o=o&&Array.isArray(o)?new Set(o):o,e){case n.DataProviderMutationEvent.ADD:{const e=new u(s,r,a,o,c,l);h.addEvent(e);break}case n.DataProviderMutationEvent.UPDATE:case n.DataProviderMutationEvent.REMOVE:{const t=new p(s,r,a,o);e===n.DataProviderMutationEvent.UPDATE?h.updateEvent(t):h.removeEvent(t);break}default:{const t=`The event ${e} is not recognized as a valid DataProvider event`;g.throwError(e,t);break}}})),i=new e.DataProviderMutationEvent(h)}if(i)try{this.dataProvider.dispatchEvent(i,!0)}catch(e){const i=`failure occurred when processing dispatched event,\n            '${JSON.stringify(t,s.setToJSONReplacer,2)}'.`;g.throwError(i)}}_getDataItemsArray(e){const{itemsPath:t}=this;let i=e;if(t&&t.length>0){const e=t.split(".");for(let t=0;t<e.length;t+=1)i=i&&i[e[t]]}return i&&Array.isArray(i)||(i=i?[i]:[]),i}_getItemsMetadata(e){const t=r.getIdAttributeHelper(this.idAttribute),i=[];return(e&&(t.getKeys(e)||[])).forEach((e=>i.push(new h(e)))),i}_buildKeys(e){let t;if(this.idAttribute){const i=r.getIdAttributeHelper(this.idAttribute);t=e&&i.getKeys(e)}return t}canBuildKeys(){return!this.idAttribute||this.idAttribute!==n.DataProviderIdAttribute.AT_INDEX}}return class extends t{constructor(e,t){super(e,t),this.log=a}perform(e){const i=e.target||e.dataProvider;let r,n;if(c.forEach((t=>{e[t]&&(r=r||{},r[t]=s.cloneObject(e[t]))})),Object.keys(e).indexOf(o)>=0&&(this.log.finer("payload for",o,"is ignored, as no payload is required"),n=n||{},n[o]=null),r&&n)throw new Error(`refresh event cannot be raised along with mutation event. ${e}.`);if(!r&&!n)throw new Error(`either refresh or mutation event needs to be present, not both. ${e}.`);const a=n||r;if(n?this.log.info("FireDataProviderEventAction called with a refresh event"):this.log.info("FireDataProviderEventAction called with a mutation event for operations:",JSON.stringify(Object.keys(a)),"and payloads:",JSON.stringify(Object.values(a)),"respectively."),!i||!function(e){return!(!e.fetchFirst||!e.getCapability)}(i))throw new Error("a valid DataProvider instance is required in order to dispatch the event");try{return new g(i).fireEvent(a),t.createSuccessOutcome()}catch(e){return t.createFailureOutcome(`Dispatching data provider event ${a} failed`,e)}}}})),define("vb/action/builtin/fireNotificationEventAction",["vb/action/eventAction","vb/action/action","vb/private/log","vb/private/utils","vb/private/constants"],((e,t,i,r,n)=>{const s=i.getLogger("/vb/private/stateManagement/fireNotificationEventAction"),a="persist";class o extends e{perform(t){const i=o.createPayload(t);if(s.info("FireNotificationEventAction",i.type,i.displayMode),t&&!e.isValidTarget(t.target))return e.createFailureOutcome(`invalid "target" for event action: ${t.target}`);if(this.eventContainer){return e.fireEvent(this.eventContainer,n.NOTIFICATION_EVENT,i,t)?e.createSuccessOutcome():e.createFailureOutcome(`Unable to find target: ${t.target}`)}return e.createFailureOutcome(`unable to fire ${n.NOTIFICATION_EVENT} event, no page context`)}static createPayload(e){return{summary:e.summary||"",message:e.message||"",displayMode:e.displayMode||a,type:e.type||n.MessageType.ERROR,key:e.key||r.generateUniqueId()}}}return o})),define("vb/private/action/actionHelper",["vb/private/constants"],(e=>class{static createNewContext(t,i,r={}){if(null==t)throw new Error("availableContexts must be provided to create a new context ");if(null==i)throw new Error("action must be provided to create a new context ");const n=t.clone();n[e.ContextName.CURRENT]={},Object.entries(r).forEach((e=>{n[e[0]]=e[1]}));const s=i.alias||i.metadataKey;return s&&n.addAccessor(s,(()=>n[e.ContextName.CURRENT])),n}})),define("vb/action/builtin/forEachAction",["vb/action/action","vb/private/constants","vb/private/action/actionHelper"],((e,t,i)=>{const r={SERIAL:"serial",PARALLEL:"parallel"},n=Object.values(r);return class extends e{perform(s){return Promise.resolve().then((()=>{const{items:a,mode:o,actionId:c}=s;if(!this.actionChain||!this.availableContexts)throw new Error(`ForEachAction (${this.logLabel}): invalid execution context, internal error`);if(!Array.isArray(a))return this.log.error("ForEachAction",this.logLabel,"'items' is not an array"),e.createFailureOutcome();if("string"!=typeof c)return this.log.error("ForEachAction",this.logLabel,"invalid actionId",c),e.createFailureOutcome();if(o&&-1===n.indexOf(o))return this.log.error("ForEachAction",this.logLabel,"invalid mode value",o,"must be one of",JSON.stringify(n)),e.createFailureOutcome();this.alias=s.as;const l=[];let h=Promise.resolve();return a.forEach(((e,n)=>{const s=i.createNewContext(this.availableContexts,this),a=o===r.PARALLEL?Promise.resolve():h;h=a.then((()=>(s[t.ContextName.CURRENT]={data:e,index:n},this.actionChain.runActionStep(c,s)))),l.push(h),h.catch((e=>(this.log.error("ForEachAction",this.logLabel,e),e)))})),Promise.all(l).then((t=>e.createSuccessOutcome(t))).catch((t=>e.createFailureOutcome(t)))}))}setContext(e,t){this.actionChain=e,this.availableContexts=t}}})),define("vb/action/builtin/forkAction",["vb/action/action","vb/private/log"],((e,t)=>{const i=t.getLogger("/vb/action/action/forkAction");return class extends e{constructor(e,t){super(e,t),this.log=i,this.actionChain=null,this.outcomesMap=null}perform(t){return new Promise((i=>{const r={},n=[],s=t&&t.actions||this.outcomesMap;if(!s||"object"!=typeof s||Array.isArray(s)){const t=`forkAction ${this.logLabel} has an invalid action parameter`;return this.log.warn(t),void i(e.createFailureOutcome("Error during ForkAction",new Error(t),r))}Object.keys(s).forEach((e=>{const t=s[e],i=this.actionChain.runActionStep(t);i.then((t=>{r[e]=t})),n.push(i)})),Promise.all(n).then((()=>{i(e.createOutcome("join",r))})).catch((t=>{i(e.createFailureOutcome("Error during ForkAction",t,r))}))}))}setContext(e,t){this.actionChain=e,this.outcomesMap=t}}})),define("vb/action/builtin/geolocationAction",["vb/action/action","vb/private/log"],((e,t)=>{const i=t.getLogger("/vb/action/builtin/geolocationAction");return class extends e{constructor(e,t){super(e,t),this.log=i}perform(t){if(!navigator.geolocation){const t="Geolocation is not supported in the browser";return e.createFailureOutcome(t,new Error(t))}const i={},r=t.maximumAge,n=t.timeout,s=t.enableHighAccuracy;return this.checkParam(r,"number","maximumAge")&&this.checkParam(n,"number","timeout")&&this.checkParam(s,"boolean","enableHighAccuracy")?(r&&(i.maximumPage=r),n&&(i.timeout=n),s&&(i.enableHighAccuracy=s),new Promise((t=>{navigator.geolocation.getCurrentPosition((i=>{t(e.createSuccessOutcome(i))}),(i=>{this.log.error(`(${this.logLabel}): ${i.message}`),t(e.createFailureOutcome(i.message,i,i.code))}),i)}))):e.createFailureOutcome(this.errorMessage,new TypeError(this.errorMessage))}checkParam(e,t,i){return!e||typeof e===t||(this.errorMessage=`Invalid GeolocationAction parameter '${i}' : ${e}`,this.log.error(`(${this.logLabel}): ${this.errorMessage}`),!1)}}})),define("vb/action/builtin/getDirtyDataStatusAction",["vb/action/action","vb/private/log"],((e,t)=>{const i=t.getLogger("/vb/action/builtin/getDirtyDataStatusAction"),r="dirty",n="notDirty";return class extends e{constructor(e,t){super(e,t),this.log=i}setContext(e){this.context=e}perform(t){return this.context.container.isDirtyDataPresent()?e.createSuccessOutcome({status:r}):e.createSuccessOutcome({status:n})}}})),define("vb/action/builtin/ifAction",["vb/action/action"],(e=>class extends e{perform(t){return t.condition?e.createOutcome(e.Outcome.TRUE,!0):e.createOutcome(e.Outcome.FALSE,!1)}})),define("vb/action/builtin/loginAction",["vb/action/action"],(e=>class extends e{perform(t){const i=this.context.application.securityProvider;if(!i)return e.createFailureOutcome("Security Provider missing.");try{return e.createSuccessOutcome(i.handleLogin(t.returnPath))}catch(t){return e.createFailureOutcome("Error during login operation",t)}}setContext(e){this.context=e}})),define("vb/action/builtin/logoutAction",["vb/action/action","vb/private/stateManagement/router"],((e,t)=>class extends e{perform(t){const i=this.context.application.securityProvider;if(!i)return e.createFailureOutcome("Security Provider missing.");try{return i.handleLogout(t.logoutUrl),e.createSuccessOutcome()}catch(t){return e.createFailureOutcome("Error during logout operation",t)}}setContext(e){this.context=e}})),define("vb/action/builtin/navigateAction",["vb/action/action"],(e=>class extends e{perform(t){return this.helpers.navigate(t).then((t=>e.createSuccessOutcome(t))).catch((t=>e.createFailureOutcome("Error during navigateAction",t)))}})),define("vb/action/builtin/navigateBackAction",["vb/action/action"],(e=>class extends e{perform(t){return this.helpers.navigateBack(t),e.createSuccessOutcome()}})),define("vb/helpers/navigate",["vb/private/stateManagement/router"],(e=>class{static toUrl(t){e.navigateToExternal(t)}static getUrlFromPath(t){return e.getUrlFromPath(t)}})),define("vb/action/builtin/navigateToExternalAction",["vb/action/action","vb/helpers/navigate"],((e,t)=>class extends e{perform(i){return t.toUrl(i),e.createSuccessOutcome()}})),define("vb/action/builtin/navigateToPageAction",["vb/action/action"],(e=>class extends e{perform(t){return this.helpers.navigateToPage(t).then((t=>e.createSuccessOutcome(!0===t.navigated))).catch((t=>e.createFailureOutcome("Error during NavigateToPageAction",t)))}})),define("vb/action/builtin/openUrlAction",["vb/action/action","vb/private/stateManagement/router"],((e,t)=>class extends e{perform(i){return t.openUrl(i).then((()=>e.createSuccessOutcome())).catch((t=>e.createFailureOutcome("Failed to open url",t)))}})),define("vb/action/builtin/resetDirtyDataStatusAction",["vb/action/action","vb/private/log"],((e,t)=>{const i=t.getLogger("/vb/action/builtin/resetDirtyDataStatusAction");return class extends e{constructor(e,t){super(e,t),this.log=i}setContext(e){this.context=e}perform(t){return this.context.container.resetAllDirtyData(),e.createSuccessOutcome()}}})),define("vb/action/builtin/resetVariablesAction",["vb/action/action","vb/action/builtin/assignVariablesAction","vb/private/utils","vb/private/log"],((e,t,i,r)=>{const n=r.getLogger("/vb/action/builtin/resetVariablesAction");class s extends t{constructor(e,t){super(e,t),this.log=n}perform(t){let i,r=t.variables||[];if(Array.isArray(r)||(r=[r]),r.some((e=>{try{const t=s.RESET_OPTION.TO_DEFAULT,i=this.analyzeTargetExpr(e,{resetOption:t,availableContexts:this.availableContexts}),r=i.rootValue;return this.log.info(this.constructor.name,this.id,"resetting variable",e,"to",r),i.rootObj[i.rootPropName]=r,!1}catch(e){return i=e,!0}})),i)throw i;return e.createSuccessOutcome()}}return s})),define("vb/private/monitoring/fetchRequestMonitorOptions",["vbc/private/monitorOptions"],(e=>class extends e{constructor(e,t,i){super(e,t),this.addStartFields((()=>({request:i})))}})),define("vb/private/monitoring/fetchResponseMonitorOptions",["vbc/private/monitorOptions"],(e=>class extends e{constructor(e,t,i){super(e,t),this.addEndFields((()=>({response:i})))}})),define("vb/private/services/transformsUtils",[],(()=>{const e="body";return class{static bodyTransformLast(t,i){return t===e?1:i===e?-1:0}static excludeFetchByKeys(e){return"fetchByKeys"!==e}static selectTransformFirst(e){return"select"===e?-1:1}}})),define("vb/private/services/endpointReference",["vb/private/constants","vb/private/utils"],((e,t)=>{class i{static getCallingExtensionId(e){if(e.getCallingContext){const t=e.getCallingContext();return t&&t.sourceExtension&&t.sourceExtension.id||e.extensionId}return e.extensionId}constructor(r,n){if(!r)throw Error("Invalid ID used for endpoint reference.");const{extensionId:s=e.ExtensionNamespaces.BASE}=n||{};if(this._containerNamespace=s,"string"==typeof r){const{prefix:e,main:s="",suffix:a=""}=t.parseQualifiedIdentifier(r);if(this._serviceId=s,this._operationId=a,e&&"@"===e[0]?(this._namespace=e.substring(1),this._programmatic=!0):e||"@"!==s[0]?(this._namespace=e,this._programmatic=!1):(this._serviceId=s.substring(1),this._programmatic=!0),this._serviceName=this._serviceId,this._moduleName="",this._programmatic&&this._serviceId){const{main:e,suffix:i=""}=t.parseQualifiedIdentifier(s,{suffixToken:"#"});i&&(this._serviceName=e,this._moduleName=i)}if(e&&n){const e=i.getCallingExtensionId(n);e&&(this._localNamespace=this._containerNamespace,this._containerNamespace=e)}}else{if(!r.url)throw new Error(`Attempt to create an invalid EndpointReference: ${JSON.stringify(r)}`);{const{url:e,operationRef:t,serviceId:i}=r;this._url=e,this._operationRef=t,this._serviceId=i,this._serviceName=i}}}get isProgrammatic(){return this._programmatic}get containerNamespace(){return this._containerNamespace}get referencingNamespace(){return this._localNamespace||this.containerNamespace}get url(){return this._url}get operationRef(){return this._operationRef}get namespace(){return this._namespace}get operationId(){return this._operationId}get serviceId(){return this._serviceId}get serviceName(){return this._serviceName}get moduleName(){return this._moduleName}getQualifiedServiceId(e=this._containerNamespace){return`${this._programmatic?"@":""}${this.namespace||e}:${this.serviceId}`}getQualifiedEndpointReference(e=this._containerNamespace){return`${this.getQualifiedServiceId(e)}/${this.operationId}`}get derivedNamespace(){return this.namespace||this.containerNamespace}toString(){return this._url?JSON.stringify({url:this._url,operationRef:this.operationRef,serviceId:this._serviceId}):this.getQualifiedEndpointReference("")}toJSON(){return this._url?{url:this._url,operationRef:this.operationRef,serviceId:this._serviceId}:{endpoint:this.getQualifiedEndpointReference("foo"),containerNamespace:this._containerNamespace,referencingNamespace:this._localNamespace,programmatic:this._programmatic}}}return i})),define("vb/private/helpers/abstractRestHelper",["vb/private/constants","vb/private/utils","vb/private/log","vbc/private/logConfig","vb/private/services/uriTemplate","vb/private/services/transformsUtils","vb/private/services/swaggerUtils","vb/private/services/endpointReference","vbc/private/trace/tracer"],((e,t,i,r,n,s,a,o,c)=>{const l=i.getLogger("/vb/private/helpers/abstractRestHelper",[{name:"startRest",severity:e.Severity.INFO,style:r.FancyStyleByFeature.restHelperStart},{name:"endRest",severity:e.Severity.INFO,style:r.FancyStyleByFeature.restHelperEnd}]),h=/application[\w/+.]*json/;class p{constructor(e,i,r){this.log=l,this.container=r&&"string"==typeof r.extensionId&&r.extensionId.length>0?r:void 0,this.container||l.warn("RestHelper created without the container information",e),this._endpointId=e,this.endpointReference="string"==typeof e?new o(e,this.container):e,this.id=`${t.generateUniqueId()}`,this.initConf={},this.params={},this.bdy=null,this.transformRequestFuncMap={},this.transformResponseFuncMap={},this.transformRequestOptionsMap={},this.initRequestMap=null,this.defaultRequestContentType=null,this.handler=null,this.url=null,this.retryCount=0,this._serverUrlInfos=[],this.endpointProvider=i}getName(){return JSON.stringify(this.endpointReference)}stringifyBody(e){return Array.isArray(e)||t.isObject(e)&&t.isPrototypeOfObject(e)?(this.defaultRequestContentType="application/json",JSON.stringify(e)):e}static processFinalHeaders(t){const i=new Headers(t||{});return i.get(e.Headers.CONTENT_TYPE)===e.ContentTypes.MULTIPART&&i.delete(e.Headers.CONTENT_TYPE),i}static getBody(t,i){if(!t)return Promise.resolve(null);const r=t.headers.get(e.Headers.CONTENT_TYPE);let n;switch(i){case"json":n=t.json();break;case"arrayBuffer":n=t.arrayBuffer();break;case"blob":n=t.blob();break;case"text":n=t.text();break;case"base64":n=p._getBase64(t,"readAsDataURL").then((e=>e.split(",")[1]));break;case"base64Url":n=p._getBase64(t,"readAsDataURL");break;case"formData":n=t.formData()}if(n)return n.catch((e=>Promise.reject(new Error(`An error occurred while using '${i}' to convert the response (${r}):\n${e.message||e}`))));if(!r)return t.text();if(r.indexOf("json")>0){const e=t.ok?null:t.clone();return t.json().catch((t=>{const i=e?`The response specifies content type ${r}, but unable to parse response as JSON. Reading response as text`:`Unable to parse response as JSON, content type ${r}`,n=`${i} : ${t}`;return l.error(i,t),e?e.text().then((e=>e||n)):n})).catch((e=>(l.error("error getting response as text",e),`unable to get response as text: ${e}`)))}return"application/octet-stream"===r||r.startsWith("image/")?t.blob():t.text()}static _getBase64(e,t){return e.blob().then((e=>new Promise(((i,r)=>{const n=new FileReader;n.onerror=r,n.onabort=r,n.onload=()=>{i(n.result)},"function"==typeof n[t]?n[t](e):n.readAsArrayBuffer(e)}))))}getFetchConfiguration(){return this.fetchConfiguration}setFetchConfiguration(e){this.fetchConfiguration=e}getRequestTransformsToRun(e){return Object.keys(this.transformRequestFuncMap).filter(s.excludeFetchByKeys).sort(s.bodyTransformLast)}_executeRequestVBPrepareTransform(e,i){if(this.transformRequestFuncMap){if(this.getRequestTransformsToRun({}).includes("vbPrepare")){const r=this.transformRequestFuncMap.vbPrepare;delete this.transformRequestFuncMap.vbPrepare;const n=this._serverUrlInfos.filter((({url:e,template:t})=>e!==t)).map((({template:e,variables:t})=>({template:e,variables:t}))),s={endpointId:this._endpointId,endpointPath:e.path,fetchConfiguration:this.getFetchConfiguration(),serverUrlTemplates:n};this.params||(this.params={});const o={parameters:this.params};let c=a.splitVariables(this.params).serverVariables;if(c&&(c=t.cloneObject(c,{})),r.call(null,s,o,i),t.diff(c,a.splitVariables(this.params).serverVariables))return l.info("The prepare transform has changed the server variables so the endpoint",this._endpointId,"will be resolved again"),this._endpointPromise=void 0,this._getEndpoint()}}return Promise.resolve(e)}_executeRequestTransformations(e){let t=!1,i={url:this.url,readOnlyParameters:this.parameters,endpointDefinition:this.endpointMetadata,initConfig:{},fetchConfiguration:this.getFetchConfiguration()};if(Object.assign(i.initConfig,this.initRequestMap),h.test(this.defaultRequestContentType)){const e=i.initConfig.body;let t;if(e)try{t="string"==typeof e?JSON.parse(e):e}catch(t){this.log.error("AbstractRestHelper",this.id,"error parsing JSON body",e,"with content-type",this.defaultRequestContentType)}i.initConfig.body=t||e}if(this.transformRequestFuncMap){this.getRequestTransformsToRun(i).forEach((r=>{const n=this.transformRequestFuncMap[r],s=this.transformRequestOptionsMap[r];if(n){const a=i.url;if(i=n.call(null,i,s,e),t=t||a!==i.url&&!p.transformDoesQueryEncoding(r,n),!i||!i.url||!i.initConfig)throw new Error("Transformation function did not return a configuration.")}}))}const{body:r}=i.initConfig;return r&&(i.initConfig.body=this.stringifyBody(r)),t&&(l.info(`custom transforms have changed the URL, encoding parameters: ${i.url}`),i.url=n.encode(i.url,!1)),i}_executeResponseTransformations(e,t,i){const r={headers:e.headers,body:t,fetchConfiguration:this.getFetchConfiguration()},n={};if(this.transformResponseFuncMap){const e=Object.keys(this.transformResponseFuncMap);e.sort((e=>"body"===e?1:0)),e.forEach((e=>{const t=this.transformResponseFuncMap[e];t&&(n[e]=t.call(null,r,i))}))}return n}_getEndpointProvider(){return t.getResource(this.endpointProvider)}_addServerUrlInfo(e){this._serverUrlInfos.every((({url:t,template:i})=>t!==e.url&&i!==e.template))&&this._serverUrlInfos.push(e)}_getEndpoint(){return this._endpointPromise||(this._endpointPromise=this._getEndpointProvider().then((e=>{const t=a.splitVariables(this.params).serverVariables||{};return t[Symbol.for("RestHelper.addServerUrlInfo")]=(...e)=>this._addServerUrlInfo(...e),e.getEndpoint(this.endpointReference,this.container,t)}))),this._endpointPromise}_initFetchRequestMapAndUrl(t){let i;return this.initRequestMap?Promise.resolve(this.initRequestMap):this._getEndpoint().then((e=>{if(i=e,!i)throw Error(`unable to find endpoint '${JSON.stringify(this.endpointReference)}'attempted REST call failed`);return this.requestTransformationFunctions(Object.assign({},i.getRequestTransforms(),this.transformRequestFuncMap)),this.responseTransformationFunctions(Object.assign({},i.getResponseTransforms(),this.transformResponseFuncMap)),this._executeRequestVBPrepareTransform(i,t).then((e=>(i=e,i.getConfig(this.params))))})).then((t=>{const r=Object.assign({},t.headers),n={method:t.method,body:this.bdy,credentials:"same-origin",headers:r},s=this._getRequestContentType(t,n.body);return this.initRequestMap=Object.assign({},n,this.initConf),s&&(new Headers(r).get(e.Headers.CONTENT_TYPE)||(r[e.Headers.CONTENT_TYPE]=s)),this.initRequestMap.headers=Object.assign({},r,this.initConf.headers||{}),this.url=t.url,this.endpointMetadata=i.getMetadata(),this.initRequestMap}))}_getRequestContentType(t,i){let r=this.defaultRequestContentType;if(this.bdy&&t.requestContentTypes&&t.requestContentTypes.length>0)if(r){const e=h;e.test(this.defaultRequestContentType)?t.requestContentTypes.some((t=>{const i=e.test(t);return i&&(r=t),i})):r=t.requestContentTypes[0]}else r=i instanceof FormData&&t.requestContentTypes.indexOf(e.ContentTypes.MULTIPART)>=0?e.ContentTypes.MULTIPART:t.requestContentTypes[0];return r}static transformDoesQueryEncoding(e,t){return t&&t.doesQueryEncoding}_fetchRequest(e){return t.getRuntimeEnvironment().then((t=>{const i=e=>(t.annotate(e,"data-request",!0),fetch(e));return c.inject(e).then((e=>i(e))).catch((t=>(this.log.warn("injected fetch failed, blacklisting url and reverting to original request",t),c.blacklist(e),i(e))))}))}}return p})),define("vb/helpers/rest",["vb/private/constants","vb/private/utils","vb/private/log","vbc/private/logConfig","vb/private/services/uriTemplate","vb/private/monitoring/fetchRequestMonitorOptions","vb/private/monitoring/fetchResponseMonitorOptions","vb/private/helpers/abstractRestHelper","urijs/URI"],((e,t,i,r,n,s,a,o,c)=>{const l=i.getLogger("/vb/private/helpers/Rest",[{name:"startRest",severity:e.Severity.INFO,style:r.FancyStyleByFeature.restHelperStart},{name:"endRest",severity:e.Severity.INFO,style:r.FancyStyleByFeature.restHelperEnd}]),h=!t.isSafari();class p extends o{static get(e,t={}){if("string"!=typeof e)throw new TypeError(`Invalid endpointId for Rest.get(): ${e}`);return new p(e,"vb/private/services/servicesManager",t)}hookHandler(e){return this.handler=e,this}initConfiguration(e){return this.initConf=e,this}parameters(e){return this.params=e,this}transformsContext(e){return this.transformsCtx=e,this}requestTransformationFunctions(e){return e&&(this.transformRequestFuncMap=e),this}requestTransformationOptions(e){return e&&(this.transformRequestOptionsMap=e),this}responseTransformationFunctions(e){return e&&(this.transformResponseFuncMap=e),this}body(e){return e&&(this.bdy=this.stringifyBody(e)),this}responseBodyFormat(e){return this.resBodyFormat=e,this}fetch(){let e,i,r,n;return Promise.resolve().then((()=>this.handler&&this.handler.handlePreFetchHook(this)||Promise.resolve())).then((()=>(i=this.transformsCtx||{},this._initFetchRequestMapAndUrl(i)))).then((()=>{r=this._executeRequestTransformations(i);const e=r.initConfig.body;r.initConfig&&null==e&&delete r.initConfig.body;const n=r.url;return r.initConfig.headers=o.processFinalHeaders(r.initConfig.headers),r.initConfig.body&&p.needsSafariWorkaround()?t.getResource("vbsw/private/serviceWorkerManager").then((e=>e.getInstance().getLocalFetchHandler())).then((()=>new Request(n,r.initConfig))):new Request(n,r.initConfig)})).then((e=>this.handler&&this.handler.handleRequestHook(e)||e)).then((i=>{l.startRest("Starting native fetch with parameters:",h?i:r.url),n=`${this.id} ${h?i.url:r.url}`;const o=new s(s.SPAN_NAMES.FETCH,n,h?i:r.url);return this.log.monitor(o,(n=>(e=n,r.initConfig.body&&p.needsSafariWorkaround()?t.getResource("vbsw/private/serviceWorkerManager").then((e=>{const t=[{url:new c(i.url).path(),method:i.method}];return e.getInstance().addRequestsToSkip(t).then((()=>e.getInstance().getLocalFetchHandler())).then((e=>(e.hasOfflineHandler&&i._browserRequest||(i.originalBody=r.initConfig.body),e.handleRequest(i)))).finally((()=>{e.getInstance().removeRequestsToSkip(t)}))})):this._fetchRequest(i)))).then((t=>{l.endRest("Ending native fetch with response",t,e(new a(a.SPAN_NAMES.FETCH,n,t)));const i=t;return this.handler&&this.handler.handleResponseHook(i)||i}))})).then((e=>{const t=e;return(t&&t.ok?o.getBody(t,this.resBodyFormat):o.getBody(t).catch((()=>null))).then((e=>{const r={response:t,body:e};if(t&&t.ok){const n=this._executeResponseTransformations(t,e,i);if(r.transformResults=n,n.body&&(r.body=n.body),this.handler){const e=Object.assign({},r);return e.transformResults=e.transformResults||{},e.transformResults.transformsContext=i,Promise.resolve().then((()=>this.handler.handlePostFetchHook(e))).then((()=>e))}}else if(this.handler){const e=Object.assign({},r);return Promise.resolve().then((()=>this.handler.handlePostFetchErrorHook(r))).then((()=>e))}return r}))}))}toUrl(){return this._getEndpoint().then((e=>e?e.getConfig(this.params,{ignoreMissingParams:!0}):null)).then((e=>e?e.url:"")).catch((e=>(this.log.error("AbstractRestHelper",this.id,"error fetching full URL for endpoint",JSON.stringify(this.endpointReference),e),"")))}toRelativeUrl(){return this._getEndpoint().then((e=>e?e.getConfig(this.params,{ignoreMissingParams:!0}):null)).then((e=>e?e.urlSuffix:"")).catch((e=>(this.log.error("AbstractRestHelper",this.id,"error fetching relative URL for endpoint",JSON.stringify(this.endpointReference),e),"")))}static needsSafariWorkaround(){if(void 0===this.needsSafariWorkaroundFlag){const e=navigator.userAgent.match(/^(?:(?!chrome|android|iphone|ipad).)*\/([0-9\.]*) safari.*$/i);if(e){const t=e[1].split("."),i=t[0]&&parseInt(t[0],10),r=t[1]&&parseInt(t[1],10);this.needsSafariWorkaroundFlag=!(i>14)&&!(14===i&&r>=1)}else{const e=navigator.userAgent.match(/(?:iPad|iPhone).*?os ([0-9\_]*)/i);if(e){const t=e[1].split("_"),i=t[0]&&parseInt(t[0],10),r=t[1]&&parseInt(t[1],10);this.needsSafariWorkaroundFlag=!(i>14)&&!(14===i&&r>=3)}else this.needsSafariWorkaroundFlag=!1}}return this.needsSafariWorkaroundFlag}}return p})),define("vb/action/builtin/restAction",["vb/private/constants","vb/action/action","vb/private/utils","vb/helpers/rest","vb/private/stateManagement/stateUtils","vb/private/action/assignmentHelper","vb/private/log"],((e,t,i,r,n,s,a)=>{const o=a.getLogger("/vb/action/builtin/restAction");class c extends t{constructor(e,t){super(e,t),this.log=o}perform(e){let t;return c.createBody(e.contentType,e.requestType,e.body,e.filePath,e.fileContentType,e.filePartName).then((i=>{const n=e.endpoint,s=e.hookHandler,a=e.responseType,o=c.getResponseFields(e),l=Object.prototype.hasOwnProperty.call(e,"responseType"),h=Object.prototype.hasOwnProperty.call(e,"responseFields");if(!l&&h&&(!o||!o.length))return c.createFailureOutcome(`RestAction: responseFields is assigned an invalid value: ${o}`);t=h?void 0:this.getResolvedType(a);const p=c.getRequestTransformOptions(e.requestTransformOptions,t,o),u=this.context&&this.context.container,d=(s&&"function"==typeof s.getRestHelper?s.getRestHelper(n,u):r.get(n,u)).parameters(e.uriParams).requestTransformationFunctions(e.requestTransformFunctions).requestTransformationOptions(p).responseTransformationFunctions(e.responseTransformFunctions).responseBodyFormat(e.responseBodyFormat);s&&d.hookHandler(s);const g={},v=c.configureHeaders(e.headers,e.contentType);return v&&(g.headers=v),e.signal&&(g.signal=e.signal),d.body(i),d.initConfiguration(g).fetch()})).then((e=>{let i=e.body;if(e.response.ok&&t){const e=i;i=s.coerceType(e,t),this.log.finer("Action",this.logLabel,"response",e,"was coerced to",i)}const r={status:e.response.status,headers:e.response.headers,body:i};return this.options.mirrorBrowserApiBehavior&&(r.ok=e.response.ok,r.statusText=e.response.statusText),e.response.ok||this.options.mirrorBrowserApiBehavior?c.createSuccessOutcome(r):c.createFailureOutcome("Error response during RestAction",e.error||null,r)})).catch((e=>c.createFailureOutcome("Exception during RestAction",e,null)))}static getResponseFields(e){return e.responseFields||[]}getResolvedType(e){return e?n.getType(`${this.id}:response`,{type:e},this.context.container.scopeResolver):void 0}static getRequestTransformOptions(e,t,i){if(e&&e.select&&e.select.type)return e;const r=e||{};return(t||i)&&(r.select=r.select||{},r.select.type=r.select.type||t||{},r.select.attributes=r.select.attributes||i),r}static createBody(t,r,n,s,a,l){return Promise.resolve().then((()=>{let h=!1;const p=l||"file";if(n&&i.isObject(n)){s||t||(Blob.prototype.isPrototypeOf(n)?h=!0:r=r||"json"),s&&n&&(t=t||e.ContentTypes.MULTIPART);if(t===e.ContentTypes.MULTIPART&&!(n instanceof FormData)||!t&&function(e){return!!e&&Object.keys(e).some((t=>Blob.prototype.isPrototypeOf(e[t])))}(n)){const e=new FormData;return Blob.prototype.isPrototypeOf(n)?e.append(p,n,n.name):Array.isArray(n)?o.warn("Rest Action: does not support 'body' as an array for 'multipart/form-data', skipping."):Object.keys(n||{}).forEach((t=>{const i=n[t],r=i.name;Blob.prototype.isPrototypeOf(i)&&r?e.append(t,i,r):e.append(t,i)})),s?i.readBlob(s,a).then((t=>(t?e.append(p,t,c.shortFileName(s)):o.warn(`empty data for file: ${s}`),e))):e}if(h||"json"===r){const e=c.convertFileIfNeeded(n);return Promise.resolve(e)}if("form"===r){const e=new FormData;return Object.keys(n).forEach((t=>{const i=n[t];e.append(t,i)})),Promise.resolve(e)}if("url"===r){const e=new URLSearchParams;return Object.keys(n).forEach((t=>{const i=n[t];e.append(t,i)})),e}}if(s){if(t===e.ContentTypes.MULTIPART){const e=new FormData;return i.readBlob(s,a).then((t=>(e.append(p,t,c.shortFileName(s)),e)))}return n&&o.warn("Rest Action: 'filePath' and 'body' are set, but 'contentType' is not set to","multipart/form-data, ignoring the 'body' parameter"),i.readBlob(s,t).then((e=>c.convertFileIfNeeded(e)))}return n}))}static convertFileIfNeeded(e){return!File.prototype.isPrototypeOf(e)||i.isIos()||i.isAndroid()?e:i.fileToBlob(e)}static configureHeaders(t,i){let r;return t&&(r=t),i&&i.indexOf("/")>0&&(r=r||{},new Headers(r).get(e.Headers.CONTENT_TYPE)||(r[e.Headers.CONTENT_TYPE]=i)),r}static shortFileName(e){return e&&e.substring(e.lastIndexOf("/")+1)}setContext(e){this.context=e}static createSuccessOutcome(e){const i=Object.assign({error:null,message:{summary:""}},e);return t.createSuccessOutcome(i)}static createFailureOutcome(e,i,r){let n=r;const s=i&&i.message||i||e||"";if(n)n.body=n.body||s;else{n={body:s,headers:{},status:-1}}const a=t.createFailureOutcome(e,i,n);return a.result=Object.assign({status:n&&n.status,headers:n&&n.headers,body:n&&n.body},a.result||{}),a}}return c})),define("vb/action/builtin/restartApplicationAction",["vb/action/action","vb/helpers/navigate","vb/private/constants","urijs/URI"],((e,t,i,r)=>class extends e{perform(n){if(this.context.application.isQueryStrategy()){const s=n.restartPath||"/",a=new r(window.location.href).search(t.getUrlFromPath(s));return t.toUrl({url:a,history:i.HistoryMode.REPLACE}),e.createSuccessOutcome(!0)}return e.createOutcome(this.Outcome.FAILURE,!1)}setContext(e){this.context=e}})),define("vb/action/builtin/returnAction",["vb/action/action"],(e=>class extends e{perform(t){return e.createOutcome(t.outcome,t.payload)}})),define("vb/action/builtin/switchAction",["vb/action/action"],(e=>class extends e{perform(t){const i=t.possibleValues,r=t.caseValue;let n=null==r?"default":`${r}`;return i&&i.length&&i.indexOf(n)<0&&(n="default"),e.createOutcome(n)}})),define("vb/private/mobile/fileIo",[],(()=>{class e{static saveFileToLib(t,i,r){return new Promise(((n,s)=>{window.resolveLocalFileSystemURL(cordova.file.dataDirectory,(function(a){a.getDirectory(t,{create:!0},(function(t){t.getFile(i,{create:!0},(function(t){t.createWriter((function(e){const t=e;t.onwriteend=function(e){n()},t.onerror=s;const i=new Blob([r],{type:"text/plain"});t.write(i)}),(function(t){s(e._decodeError(t))}))}),(function(t){s(e._decodeError(t))}))}),(function(t){s(e._decodeError(t))}))}),(function(t){s(e._decodeError(t))}))}))}static readFileFromLib(t,i){return new Promise(((r,n)=>{window.resolveLocalFileSystemURL(`${cordova.file.dataDirectory}${t}`,(function(t){t.getFile(i,{},(function(t){t.file((function(e){const t=new FileReader;t.onloadend=function(e){r(this.result)},t.onerror=n,t.readAsText(e)}),(function(t){n(e._decodeError(t))}))}),(function(t){n(e._decodeError(t))}))}),(function(t){n(e._decodeError(t))}))}))}static renameFile(t,i,r){return new Promise(((n,s)=>{window.resolveLocalFileSystemURL(t,(function(t){t.getFile(i,{create:!1},(function(i){i.moveTo(t,r,(function(){n()}),(function(t){s(e._decodeError(t))}))}),(function(t){s(e._decodeError(t))}))}),(function(t){s(e._decodeError(t))}))}))}static createDir(t,i){return new Promise(((r,n)=>{t.getDirectory(i,{create:!0},(e=>r(e)),(t=>{n(e._decodeError(t))}))}))}static createFileContentOnDevice(t,i,r){return new Promise(((n,s)=>{const a=i.split("/");let o=Promise.resolve(t);if(a.length>1){a.splice(0,a.length-1).forEach((t=>{o=o.then((i=>e.createDir(i,t))).catch((t=>s(e._decodeError(t))))}))}o.then((t=>t.getFile(a[a.length-1],{create:!0,exclusive:!1},(t=>{t.createWriter((e=>{e.onwriteend=()=>n(i),"string"==typeof r||r instanceof Blob?e.write(r):e.write(JSON.stringify(r))}),(t=>{s(e._decodeError(t))}))})))).catch((t=>s(e._decodeError(t))))}))}static _decodeError(e){let t="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="Storage quota exceeded";break;case FileError.NOT_FOUND_ERR:t="File not found";break;case FileError.SECURITY_ERR:t="Security error";break;case FileError.INVALID_MODIFICATION_ERR:t="Invalid modification";break;case FileError.INVALID_STATE_ERR:t="Invalid state";break;default:t="Unknown error"}return t}}return e})),define("vb/action/builtin/takePhotoAction",["knockout","vb/private/utils","vb/action/action","vb/private/log","vb/private/mobile/fileIo","ojs/ojhtmlutils","ojs/ojmenu","ojs/ojoption"],((e,t,i,r,n,s)=>{const a=r.getLogger("/vb/action/builtin/takePhotoAction"),o=["image","video","audio"],c="vbInternalAndroidPhotoOptionsContainer",l="vbInternalAndroidPhotoOptionsMenu",h="androidCamera",p="androidBrowse",u=`<div><div id="${c}">\n      <a id="vbInternalAndroidPhotoOptionsLauncher" style="display:none"/>\n      <oj-menu id="${l}"\n               style="display:none"\n               on-oj-action="[[vbInternalAndroidPhotoOptionsAction]]"\n               open-options.launcher="vbInternalAndroidPhotoOptionsLauncher">\n          <oj-option id="androidCamera" value="androidCamera">\n               <oj-bind-text value="[[ getString('camera') || 'Camera' ]]"></oj-bind-text>\n          </oj-option>\n          <oj-option id="androidBrowse" value="androidBrowse">\n               <oj-bind-text value="[[ getString('browse') || 'Browse' ]]"></oj-bind-text>\n          </oj-option>\n          <oj-option id="divider"></oj-option>\n          <oj-option id="androidCancel" value="androidCancel">\n               <oj-bind-text value="[[ getString('cancel') || 'Cancel' ]]"></oj-bind-text>\n          </oj-option>\n      </oj-menu>\n    </div></div>`;class d extends i{constructor(e,t,{registrar:i}){super(e,t),i.setFinallyCallback("TakePhotoAction cleanup",(()=>(d.cleanupCallback(),Promise.resolve())))}setAvailableContexts(e){t.isAndroid()&&(this.availableContexts=e,this.setupAndroidPhotoOptionsMenu())}setupAndroidPhotoOptionsMenu(){if(!document.getElementById(c)){const t=s.stringToNodeArray(u);document.body.appendChild(t[0]),e.applyBindings({vbInternalAndroidPhotoOptionsAction:e=>{e.target.parentElement.getProperty("resolver")(e.target.value)},getString:e=>{const t=this.availableContexts.$application;return t.translations&&t.translations.app&&t.translations.app.take_photo&&t.translations.app.take_photo[e]}},document.getElementById(c))}}perform(e){return!t.isIos()&&!t.isAndroid()||e.mediaType?d.performHtmlMediaCapture(e):d.performLegacy(e)}static performLegacy(e){const r=navigator.camera,s={};e.quality&&e.quality>=0&&e.quality<=100?s.quality=e.quality:s.quality=50;const a=e.sourceType&&e.sourceType.toUpperCase();return s.sourceType="PHOTOLIBRARY"===a?r.PictureSourceType.PHOTOLIBRARY:"SAVEDPHOTOALBUM"===a?r.PictureSourceType.SAVEDPHOTOALBUM:r.PictureSourceType.CAMERA,e.targetWidth&&e.targetHeight&&e.targetWidth>=0&&e.targetHeight>=0&&(s.targetWidth=e.targetWidth,s.targetHeight=e.targetHeight),s.cameraDirection=e.cameraDirection&&"FRONT"===e.cameraDirection.toUpperCase()?r.Direction.FRONT:r.Direction.BACK,s.encodingType=r.EncodingType.JPEG,s.saveToPhotoAlbum=!1,s.correctOrientation=!0,new Promise((e=>{r.getPicture((r=>{const s=r.lastIndexOf("?");let a=r;s>-1&&(a=r.substring(0,s));const o=a.lastIndexOf("/"),c=a.substring(0,o),l=a.substring(o+1),h=`${t.generateUniqueId()}.jpg`;n.renameFile(c,l,h).then((()=>{e(i.createSuccessOutcome({filePath:`${c}/${h}`}))})).catch((t=>{e(i.createFailureOutcome("Failed to take photo",new Error(t)))}))}),(t=>{e(i.createFailureOutcome("Failed to take photo",new Error(t)))}),s)}))}static androidUseCameraWithCordovaPlugin(e,r){return d.performLegacy(r).then((e=>t.readBlob(e.result.filePath).then((e=>i.createSuccessOutcome({file:e})))))}static androidPerform(e,t){return new Promise((t=>{if("image/*"===e){const e=document.getElementById(l);e.setProperty("resolver",t),e.open()}else t(p)})).then((r=>{switch(r){case h:return d.androidUseCameraWithCordovaPlugin(e,t);case p:return d.webPerform(e);default:return i.createFailureOutcome("Take Photo Action cancelled")}}))}static webPerform(e){return new Promise((r=>{const n=document.createElement("input");n.type="file",n.accept=e;const s=document.body.onfocus;document.body.onfocus=()=>{setTimeout((()=>{document.body.onfocus=s,n.value||r(i.createFailureOutcome("Take Photo Action cancelled"))}),1e3)},n.onchange=()=>{document.body.onfocus=s;const e=t.fileToBlob(n.files[0]);r(i.createSuccessOutcome({file:e}))},n.click()}))}static performHtmlMediaCapture(e){let i=e.mediaType;i||(i="image"),i=i.toLowerCase();const r=`${o.includes(i)?i:"image"}/*`;return t.isAndroid()?d.androidPerform(r,e):d.webPerform(r)}static cleanupCallback(){t.isIos()&&navigator.camera.cleanup((function(){a.log("Camera cleanup succeeded.")}),(function(e){a.error("Failed to perform camera cleanup: ",e)}))}}return d})),define("vb/action/builtin/webShareAction",["vb/action/action","vb/private/log"],((e,t)=>{const i=t.getLogger("/vb/action/builtin/webShareAction");return class extends e{constructor(e,t){super(e,t),this.log=i}perform(t){if(!navigator.share){const t="Web Share API is not supported in the browser";return e.createFailureOutcome(t,new Error(t))}const i=t.title,r=t.text,n=t.url,s=t.files;if(!(this.checkParam(i,"title")&&this.checkParam(r,"text")&&this.checkParam(n,"url")&&this.checkFiles(s)))return e.createFailureOutcome(this.error.message,this.error);if(!(i||r||n||s)){const t="At least one of the webShareAction's parameters must be specified";return e.createFailureOutcome(t,new Error(t))}const a={};return i&&(a.title=i),r&&(a.text=r),n&&(a.url=n),s&&(a.files=s),navigator.share(a).then((()=>e.createSuccessOutcome())).catch((t=>(this.log.warn(`(${this.logLabel}): ${t.message}`),e.createSuccessOutcome())))}checkParam(e,t){return!e||"string"==typeof e||(this.error=new TypeError(`Invalid WebShareAction parameter '${t}' : ${e}`),this.log.error(`(${this.logLabel}): ${this.error.message}`),!1)}checkFiles(e){return!e||("canShare"in navigator?Array.isArray(e)&&e.length>0?!!navigator.canShare({files:e})||(this.error=new Error(`Files cannot bes shared: ${JSON.stringify(e,null,2)}`),this.log.error(`(${this.logLabel}): ${this.error.message}`),!1):(this.error=new TypeError(`Invalid WebShareAction parameter 'files' : ${e}`),this.log.error(`(${this.logLabel}): ${this.error.message}`),!1):(this.error=new Error("Web Share for files is not supported in the browser"),this.log.error(`(${this.logLabel}): ${this.error.message}`),!1))}}})),define("vb/private/stateManagement/redux/basicStoreManager",["vb/private/log","redux","redux-thunk"],((e,t,i)=>{const r=e.getLogger("/vb/stateManagement/redux/basicStoreManager");return class{constructor(){this.store=null,this.reducers=null}get name(){return"redux store manager without Time Travel"}init(e){if(r.info("Initializing",this.name),this.store)throw new Error("StoreManager is already initialized.");return this.reducers=e,this.store=t.createStore(this.combineReducers(),{},t.applyMiddleware(i.default)),this.store}combineReducers(){return this.reducers?t.combineReducers(this.reducers):e=>e||{}}addScopeToStore(e){const i=e.initVariableReducers();if(0===Object.keys(i).length)return;r.fine("Adding scope",e.name);const n=this.reducers,s=t.combineReducers(i);if(n){if(n[e.name])throw new Error(`Scope ${e.name} already exist in the store.`);n[e.name]=s}else this.reducers={[e.name]:s};this.store.replaceReducer(this.combineReducers()),e.syncWithStore(this.getStore())}removeScopeFromStore(e){r.fine("Removing scope",e.name);const t=this.reducers;t&&(delete t[e.name],delete this.getState()[e.name],this.store.replaceReducer(this.combineReducers()))}getState(){return this.store.getState()}getStore(){return this.store}dispose(){this.store=null,this.reducers=null}}})),define("vb/private/stateManagement/redux/storeManager",["vb/private/stateManagement/redux/basicStoreManager"],(e=>new e)),define("vb/private/translations/bundleDefinition",["vb/private/log","vb/private/utils","vb/private/constants","vb/private/pathHandler","vb/private/services/uriTemplate","ojs/ojtranslation"],((e,t,i,r,n,s)=>{const a=e.getLogger("/vb/private/translations/bundleDefinition");class o{constructor(e,t,i,s,o="",c={}){const l=c.replacementValues||{},h=c.isUnrestrictedRelative||!1,p=!1!==c.allowSelfRelative,u=new n(t||"",void 0,!0),d=Object.assign({"locale-name":s},l),g=u.replace(d);this.log=a,this.name=e,this.default=i.default||!1,this.pathHandler=new r(g,o,{allowParent:h,allowSelfRelative:p}),this.map=null}isAllowed(){return this.pathHandler.isAllowed()}load(e){let t=this.pathHandler.getResolvedPath();return o.useWorkaroundNlsMappingForFA(t)&&(t=o.workaroundNlsMapping(t)),e.getLocaleBundle(t).then((e=>(this.map=e,this)))}format(e,...t){return o.format(this.map,e,...t)}static useWorkaroundNlsMappingForFA(e){const t=requirejs.toUrl("app-flow").split(i.PATH_SEPARATOR),r=t.length>1&&"bundles"===t[t.length-2],n=!!window.faConfig||!!window.FAEndPoints,s=-1===e.indexOf("/nls");return s&&a.warn(`translation bundle paths without "\\nls" are deprecated, and must be updated: ${e}`),n&&!r||s}static workaroundNlsMapping(e){let r=e;const n=e.split(i.PATH_SEPARATOR),s=n[0],a="__un1que__",o=requirejs.toUrl(`${s}/__un1que__`);return n.shift(),r=o.replace(a,n.join(i.PATH_SEPARATOR)),o===`${requirejs.toUrl("")}${s}/__un1que__`?e:(t.isAbsolutePath(r)?r.endsWith(".js")||(r=`${r}.js`):r.endsWith(".js")&&(r=r.substring(0,r.length-3)),r=r.replace(/(:\/\/)|(\/)+/g,"$1$2"),r)}static format(e,t,...i){let r=e[t];if(!r){const i=t?t.split("."):[];if(i.length>1){let t=e;for(let e=0;e<i.length&&t;e+=1)t=t[i[e]];r=t||null}}return r||(r=t),s.applyParameters(r,...i)}}return o})),define("vb/private/translations/bundleV2Extension",["vb/private/log"],(e=>{const t=e.getLogger("/vb/private/translations/bundleV2Extension");return class{constructor(e,t,i){Object.defineProperties(this,{base:{value:i,enumerable:!0},extension:{value:e,enumerable:!0},resourceLoc:{value:`${e.baseUrl}${t}`,enumerable:!0},path:{value:t,enumerable:!0}})}load(){const e=this.base.application.runtimeEnvironment,i=this.resourceLoc;return e.getV2Strings(i,this.base.declaration).then((({functions:e})=>(this.stringFunctions=e,this))).catch((e=>{t.error(`error loading v2 bundle extension ${this.resourceLoc}`,e)}))}getStringFunctions(){return this.stringFunctions||{}}}})),define("vb/private/translations/bundleV2Definition",["urijs/URI","vb/private/constants","vb/private/log","vb/private/pathHandler","vb/private/utils","vb/private/translations/bundleV2Extension"],((e,t,i,r,n,s)=>{const a=i.getLogger("/vb/private/translations/bundleV2Definition"),o=/^(translations\/self\/)(.*)$/,c=/\/(undefined|null)\//gi;class l{constructor(e,t,i=""){this.translationsPath=e,this.bundlePath=t,this.baseUrl=i,this.normalizedBundlePath=void 0}isAllowed(){return!r.startsWithDot(this.bundlePath)}getNormalizedBundlePath(){return void 0===this.normalizedBundlePath&&(0===this.bundlePath.indexOf("/")?this.normalizedBundlePath=this.bundlePath.substring(1):this.normalizedBundlePath=`${this.translationsPath}${this.bundlePath}`),this.normalizedBundlePath}getResolvedPath(){if(!this.resolvedPath){let t;if(n.isAbsoluteUrl(this.bundlePath))t=this.bundlePath,this.normalizedBundlePath=null;else{const e=this.getNormalizedBundlePath();t=this.baseUrl?`${this.baseUrl}/${e}`:e}this.resolvedPath=e(t).normalizePath().toString()}return this.resolvedPath}}class h{constructor(e,i,r,n={},s=null){this.application=e,this.name=i,this.path=r,this.extensionId=s?s.id:t.ExtensionFolders.BASE,this.declaration=Object.assign({},n),this.default=n.default||!1,this.extensionId===t.ExtensionFolders.BASE?this.pathHandler=new l("resources/translations/",this.path):this.pathHandler=new l("translations/self/",this.path,s.baseUrl),this.map={}}static get extensionClass(){return s}isAllowed(){return this.pathHandler.isAllowed()}getResolvedPath(){return this.pathHandler.getResolvedPath()}load(e){if(!this.loadPromise){let i=null;const r=this.getResolvedPath();this.loadPromise=e.getV2Strings(r,this.declaration).then((e=>{i=e.functions,Object.defineProperty(this,"map",{get:()=>e.functions||{}});const r=this.pathHandler.getNormalizedBundlePath();if(!r)return null;let n=r.replace(c,"/");return this.extensionId!==t.ExtensionFolders.BASE&&(n=n.replace(o,"$2")),this.application.extensionRegistry.loadTranslationExtensions(n,this)})).then((e=>(i&&e&&e.length&&e.forEach((e=>{const t=e.getStringFunctions();Object.keys(t).forEach((e=>{i[e]=t[e]}))})),this))).catch((e=>i?(a.error(`Failed to load v2 bundle extensions for ${this.path}`,e),this):(a.error(`Failed to load v2 bundle ${this.path}`,e),null)))}return this.loadPromise}static getBundleV2Definition(e,i,r,n,s){const a=i?i.id:t.ExtensionFolders.BASE;let o=h.extensions[a];o||(o={},h.extensions[a]=o);let c=o[r];return c||(c=new h(e,r,n,s,i),o[r]=c),c}static reset(){h.extensions={}}}return h.extensions={},h})),define("vb/private/translations/bundlesModel",["vb/private/constants","vb/private/log","vb/private/translations/bundleDefinition","vb/private/translations/bundleV2Definition","vb/binding/expression","ojs/ojconfig"],((e,t,i,r,n,s)=>{const a=t.getLogger("vb/private/translations/bundlesModel"),o=/-i18n(\.js)?$/;class c{constructor(e,t="",i={},r=null){this.log=a,this.relativePath=t,this.runtimeEnvironment=e,this.options=i,this.extension=r,this.bundleDefinitions={},this.bundleV2Definitions={},this.extensionsBundleV2Definitions={},this.bundleMap={},this.bundleV2Map={},this.extensionsBundleMap={}}evaluateTranslationPath(t){return t&&t.path&&n.getEvaluatedSafe(t.path,{[e.ContextName.INIT_PARAMS]:this.options.initParams||{}})}addBundleV1Definitions(e){const t=s.getLocale();Object.entries(e).forEach((([e,r])=>{const n=this.evaluateTranslationPath(r);n?c.isV2(n)?a.error(`Not a v1 translation bundle ${e}`):this.bundleDefinitions[e]=new i(e,n,r,t,this.relativePath,this.options):a.error(`No path declared for translation bundle ${e}`)}))}addBundleV2Definitions(e,t,i){Object.entries(i).forEach((([i,n])=>{const s=this.evaluateTranslationPath(n);s?c.isV2(s)?"self"===e?this.bundleV2Definitions[i]=r.getBundleV2Definition(c.application,this.extension,i,s,n):(this.extensionsBundleV2Definitions[e]||(this.extensionsBundleV2Definitions[e]={}),this.extensionsBundleV2Definitions[e][i]=r.getBundleV2Definition(c.application,t,i,s,n)):a.error(`Not a v2 translation bundle ${i}`):a.error(`No path declared for translation bundle ${i}`)}))}static isV2(e){return e&&o.test(e)}load(){if(!this.loadPromise){const e=Object.values(this.bundleDefinitions).filter((e=>e.isAllowed())).map((e=>e.load(this.runtimeEnvironment).then((e=>{e&&(this.bundleMap[e.name]=e.map)}))));e.push(...Object.values(this.bundleV2Definitions).filter((e=>e.isAllowed())).map((e=>e.load(this.runtimeEnvironment).then((e=>{e&&(this.bundleV2Map[e.name]=e.map)}))))),Object.entries(this.extensionsBundleV2Definitions).forEach((([t,i])=>{e.push(...Object.values(i).filter((e=>e.isAllowed())).map((e=>e.load(this.runtimeEnvironment).then((e=>{e&&(this.extensionsBundleMap[t]||(this.extensionsBundleMap[t]={}),this.extensionsBundleMap[t][e.name]=e.map)})))))})),this.loadPromise=Promise.all(e).then((()=>this))}return this.loadPromise}getStringMap(){return this.bundleMap}getBundleDefinition(e){return this.bundleDefinitions[e]}getV2StringMap(){return this.bundleV2Map}getExtensionV2StringMap(e){return this.extensionsBundleMap[e]}static loadBundlesModel(t,i={},r="",n={},s=null){const o=new c(t,r,n,s);if(i.translations&&o.addBundleV1Definitions(i.translations),i.imports&&i.imports.translations){const r=s?s.id:e.ExtensionFolders.BASE,n=i.imports.translations,l=Object.keys(n).map((e=>"self"===e?r:e)),h=c.getExtensionsBundleDeclarations(t,l),p=h[r];p&&(delete h[r],h.self=p);const u=[];return Object.entries(n).forEach((([e,t])=>{u.push(h[e].then((i=>{const r={};t.forEach((e=>{r[e]=i.translations[e]})),o.addBundleV2Definitions(e,i.extension,r)})).catch((t=>{"self"===e?a.error(`Failed to load bundle declarations for ${e})`,t):a.error(`Failed to load bundle declarations for ${e} (referenced in ${r})`,t)})))})),Promise.all(u).then((()=>o.load()))}return o.load()}static getExtensionsBundleDeclarations(t,i){const r={};return i.forEach((i=>{let n=c.extensionsBundleDeclarations[i];if(!n){let r,s=null;r=i===e.ExtensionFolders.BASE?t.getTextResource("resources/translations/translations-config.json"):c.getExtensions().then((e=>(s=e[i],s.init().then((()=>t.getExtensionTextResource(`${s.baseUrl}translations/translations-config.json`)))))),n=r.then((e=>({translations:JSON.parse(e).translations,extension:s}))).catch((e=>(a.error(`Failed to load translations-config for ${i}`,e),{translations:[]}))),c.extensionsBundleDeclarations[i]=n}r[i]=n})),r}static getExtensions(){return c.extensions||(c.extensions=c.application.extensionRegistry.getTranslations()),c.extensions}static reset(){c.application=null,c.extensionsBundleDeclarations={},c.extensions=null,r.reset()}}return c.application=null,c.extensionsBundleDeclarations={},c.extensions=null,c})),define("vb/private/helpers/eventHelper",["vb/private/constants","vb/private/utils","vb/private/stateManagement/router","vb/action/eventAction","vb/action/builtin/fireNotificationEventAction","vb/action/builtin/fireCustomEventAction"],((e,t,i,r,n,s)=>class{constructor(t){this.target=null,Object.assign(this,{fireCustomEvent:(e,i)=>Promise.resolve().then((()=>{if(!t||!t.container)throw new Error("unable to fire event; no active container context");if(!s.isValid(e))throw new Error(`attempt to raise invalid event: ${e}`);return r.fireEvent(t.container,e,i,{target:this.target})||Promise.reject(new Error(`Unable to find target: ${this.target}`))})),fireNotificationEvent:t=>{const i=n.createPayload(t);return this.fireCustomEvent(e.NOTIFICATION_EVENT,i)},target:e=>(this.target=e,this)})}})),define("vb/private/model/modelUtils",["vb/private/helpers/eventHelper","vb/private/stateManagement/router","vb/private/log","vb/private/utils"],((e,t,i,r)=>{const n=i.getLogger("/vb/private/models/ModelUtils");return class{static initializeJsModule(e,i){let r=null;if(e&&(r=e,"function"==typeof r)){const s=void 0!==i?i:t.getCurrentPage();s||n.warn("No container context for initializing module helpers");r=new e(this.createModuleContext(s))}return r}static createModuleContext(t){return{getEventHelper:()=>new e({container:t})}}static chooseCorrectFunctionsModel(e,t,i){let s;if(i?s=`$${r.hyphenatedToCamelCase(i)}`:i="appropriate data-description(*).js",function(e){if(e.$functions){if(Object.getOwnPropertyNames(e.$functions).length)return!1;let t=!0;for(const i in e.$functions)t=!1;return t}return!0}(e)){n.warn(`the metadata functions are empty, using layout.js functions instead. You should move your functions to the ${i} source file`);const r=Object.assign({},e);return r.$functions=t&&t.$functions,s&&r[s]&&(r[s].functions=r.$functions),r}return e}}})),define("vb/private/events/eventMonitorOptions",["vbc/private/monitorOptions"],(e=>class extends e{constructor(e,t,i,r){super(e),this.addMessage(t),this.addStartFields((()=>({trigger:i,container:r,eventName:t}))),this.addEndFields((()=>({trigger:i,container:r,eventName:t})))}})),define("vb/private/stateManagement/container",["ojs/ojcontext","ojs/ojrouter","vb/private/action/actionChainUtils","vb/private/action/assignmentHelper","vb/private/stateManagement/redux/storeManager","vb/private/stateManagement/scope","vb/private/stateManagement/router","vb/private/stateManagement/navigationContext","vb/private/log","vbc/private/logConfig","vb/private/stateManagement/stateUtils","vb/private/translations/bundlesModel","vb/private/constants","vb/private/utils","vb/errors/httpError","vb/private/helpers/eventHelper","vb/private/history","vb/private/stateManagement/scopeResolver","vb/private/model/modelUtils","vb/private/events/eventRegistry","vb/private/configLoader","vb/private/debug/applicationDebugStream","vbc/private/performance/performance","vb/private/events/eventMonitorOptions","urijs/URI"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v,f,m,b,y,E,P,x,T,A)=>{const C=c.getLogger("/vb/stateManagement/container",[{name:"beforeHandleEvent",severity:u.Severity.INFO,style:l.FancyStyleByFeature.containerStart},{name:"afterHandleEvent",severity:u.Severity.INFO,style:l.FancyStyleByFeature.containerEnd}]),O=e=>new Error(`Containers must define the ${e} property.`),S=e=>new Error(`Containers must implement ${e}.`);class w{constructor(e,t,i="Container"){"Application"!==i||w[u.APP_INTERNAL_PROPERTY_NAME]||(w[u.APP_INTERNAL_PROPERTY_NAME]=this),this._id=e,this._className=i,this._parent=t,this._extension=w.createEmptyExtension(),this.fullPath=this.getContainerPath(),this.path=null,this.scope=null,this.router=null,this.availableContexts=null,this.expressionContext=null,this.functions=null,this.variablesListeners=[],this.chains={},this.lifecycleState=u.ContainerState.CREATED,this.log=C,this.eventListeners={},this.enums={},this.bundles=void 0,this.loadFunctionsPromise=null,this.loadMetadataPromise=null,this.loadDescriptorPromise=null,this.loadBundlesPromise=null,this.exported=null,this.extensionsArray=[],this.extensions={},this.imports={},this.definition=null,this.layouts=[],this.navPath=null,this.flows={}}static createEmptyExtension(){return{id:u.ExtensionFolders.BASE,baseUrl:E.requirePath||"",files:[],getAbsoluteUrl:()=>requirejs.toUrl(""),fileExists:()=>!0}}get id(){return this._id}get name(){return this._id}get className(){return this._className}get parent(){return this._parent}get application(){return w[u.APP_INTERNAL_PROPERTY_NAME]}get extension(){return this._extension}get extensionId(){return this.extension.id}get baseUrl(){return this.extension.baseUrl}get urlId(){return this._id}get resourceLoc(){return this.path}get absoluteUrl(){return this.extension.getAbsoluteUrl()}get eventPrefix(){return this._className.toLowerCase()}get loadSpanName(){return`${this.className}Load`}get activateSpanName(){return`${this.className}Activate`}get resourceName(){return this.name}get fullName(){throw O("fullName")}get scopeResolver(){const e=new m(Object.assign({[u.THIS_PREFIX]:this},this.getScopeResolverMap()));return Object.defineProperty(this,"scopeResolver",{value:e,configurable:!0}),e}static get descriptorLoaderName(){throw O("descriptorLoaderName")}static get functionsLoaderName(){throw O("functionsLoaderName")}static get templateLoaderName(){throw O("templateLoaderName")}descriptorLoader(e){return this.application.runtimeEnvironment[this.constructor.descriptorLoaderName](e)}functionsLoader(e){return this.application.runtimeEnvironment[this.constructor.functionsLoaderName](e)}templateLoader(e){return this.application.runtimeEnvironment[this.constructor.templateLoaderName](e)}isExtension(){return!1}getResourceFolder(){return`${this.baseUrl}${this.resourceLoc}`}getResourcePath(){return`${this.getResourceFolder()}${this.resourceName}`}getScopeResolverMap(){throw S("getScopeResolverMap")}getServices(){throw S("getServices")}getAllServices(){return d.toFlatUniqueArray(this.getServices(),this.application.getAllServices())}getCallingContext(){return{sourceExtension:this.extension}}enter(){throw S("enter")}exit(){throw S("exit")}createRouter(e){if(!e.router)return this.createRouter(e.parent);const t=e.router.getChildRouter(this.urlId);return t||e.router.createChildRouter(this.urlId,this.urlId)}initRouter(){if(this.router)return;const e=this.createRouter(this.parent);e&&(Object.defineProperty(this,"router",{value:e,enumerable:!0,configurable:!0}),this.router.configure(this.getRouterConfigureCallBack()))}routerStateEnterCallback(e){return Promise.resolve().then((()=>{const t=this.getContainer(e);return t&&t.enter()}))}routerStateCanExitCallback(e){return Promise.resolve().then((()=>{const t=this.getContainer(e);return t&&t.canExit()}))}routerStateExitCallback(e){return Promise.resolve().then((()=>{const t=this.getContainer(e);return t&&t.exit()}))}getRouterConfigureCallBack(){return e=>{let t;return e&&(t={canEnter:()=>this.loadContainer(e).then((e=>!!e)),canExit:()=>this.routerStateCanExitCallback(e),enter:()=>this.routerStateEnterCallback(e),exit:()=>this.routerStateExitCallback(e),value:this}),t}}getParentFlow(){throw S("getParentFlow")}hideFromUrl(){return!1}loadContainer(e,t){throw S("loadContainer")}getContainer(e){throw S("getContainer")}getContainerPath(){if(this.parent){const e=this.parent.getContainerPath();return e?`${e}${u.PATH_SEPARATOR}${this.id}`:this.id}return""}calculateNavPath(){if(this.parent){const e=this.parent.getNavPath();return this.hideFromUrl()?e:e?`${e}/${this.urlId}`:this.urlId}return""}getNavPath(){return null===this.navPath&&(this.navPath=this.calculateNavPath()),this.navPath}getNewScopeName(){return`${this.className}/${this.fullPath}`}loadMetadata(){return this.loadMetadataPromise=this.loadMetadataPromise||this.descriptorLoader(this.getResourcePath()).then((e=>(P.descriptorLoaded(this.getResourcePath(),e,this),this.expressionContext=new this.constructor.ContextType(this),this.initDefault(e),this.definition))),this.loadMetadataPromise}loadDescriptor(){return this.loadDescriptorPromise=this.loadDescriptorPromise||this.loadMetadata().then((()=>this.checkAccess())).then((()=>this.loadContainerDependencies())).then((()=>(this.combineExtensions(),this.definition))),this.loadDescriptorPromise}loadContainerDependencies(){return Promise.all([this.loadExtensions(),this.loadImports(),this.loadTranslationBundles()])}loadTemplate(){return this.loadHtmlPromise=this.loadHtmlPromise||this.templateLoader(this.getResourcePath()),this.loadHtmlPromise}loadFunctionModule(){if(this.loadFunctionsPromise)return this.loadFunctionsPromise;const e=[],t=this.functionsLoader(this.getResourcePath()).then((e=>(this.functions=b.initializeJsModule(e,this),this.functions))).catch((e=>(e.requireType&&"scripterror"===e.requireType||this.log.error("Error loading module",this.getResourcePath(),e),Promise.resolve())));return e.push(t),e.push(...this.traverseExtensions("loadFunctionModule")),this.loadFunctionsPromise=Promise.all(e),this.loadFunctionsPromise}get layoutModelClass(){return"vb/private/stateManagement/layout"}get chainsFolderName(){return"chains"}get chainLoaderName(){return"getTextResource"}get chainModuleLoaderName(){return"getModuleResource"}preloadChains(){return Promise.resolve().then((()=>{const{eventListeners:e}=this.definition,t=[];return Object.keys(e).forEach((i=>{if(i===u.RESOURCE_CHANGED_EVENT||i===u.NOTIFICATION_EVENT){const r=e[i],{chains:n}=r;n&&n.forEach((e=>{const i=e.chain||e.chainId;-1===i.indexOf(":")&&t.push(this.loadChain(i,!!e.chain,!0))}))}})),Promise.allSettled(t)}))}loadChain(e,t,i){const r=()=>Promise.resolve().then((()=>{const i=this.chains[e];if(void 0!==i)return i;const r=t?"":".json",n=t?this.chainModuleLoaderName:this.chainLoaderName,s=`${this.getResourceFolder()}${this.chainsFolderName}/${e}${r}`;return this.application.runtimeEnvironment[n](s).then((i=>(this.chains[e]=t?i:d.parseJsonResource(i),P.descriptorLoaded(this.getResourcePath(),this.definition,this),this.chains[e]))).catch((i=>(t&&this.triggerResourceChangedEvent(s),C.error("Failed to load action chain",e,i),this.chains[e]=null,null)))}));return i?r():this.queueLoadChain(r)}triggerResourceChangedEvent(e){if(d.isHostApplication())return;const t=`${this.absoluteUrl}${e}.js`;fetch(t,{headers:{"Cache-Control":"no-cache, no-store"}}).catch((e=>{}))}queueLoadChain(e){return this.loadChainPromise=this.loadChainPromise||Promise.resolve(),this.loadChainPromise=this.loadChainPromise.then(e),this.loadChainPromise}combineExtensionConstants(e,t){const{constants:i}=this.definition.interface;Object.keys(e).forEach((r=>{const n=i[r];if(n){const i=e[r];if("object"==typeof i){if(void 0===i.defaultValue)return;n.defaultValue=i.defaultValue}else n.defaultValue=i;n.extension=t}else this.log.warn("Constant",r,"is not part of the interface of",this.className,this.name)}))}combineExtensions(){this.extensionsArray.forEach((e=>{const t=e.definition;if(t){const i=t.extensions.constants;i&&this.combineExtensionConstants(i,e)}}))}traverseExtensions(e,...t){const i=[];return this.extensionsArray.forEach((r=>{i.push(r[e](...t))})),i}get export(){if(!this.exported){this.exported={enums:{},constants:{},variables:{}};const{types:e}=this.definition.interface;e&&(Object.keys(e).forEach((e=>{const t=this.enums[e];t&&(this.exported.enums[e]=t)})),Object.freeze(this.exported.enums));const{constants:t}=this.definition.interface;t&&(Object.keys(t).forEach((e=>{this.exported.constants[e]=this.scope.variableNamespaces[u.VariableNamespace.CONSTANTS][e]})),Object.freeze(this.exported.constants));const i=this.definition.interface.variables;if(i){const e=this.scope.variableNamespaces[u.VariableNamespace.VARIABLES];Object.keys(i).forEach((t=>{const r={get:()=>e[t],enumerable:!0};"readWrite"===i[t].mode&&(r.set=i=>{e[t]=i}),Object.defineProperty(this.exported.variables,t,r)})),Object.preventExtensions(this.exported.variables)}}return this.exported}loadExtensions(){return Promise.resolve().then((()=>this.application.extensionRegistry.loadContainerExtensions(this.path,this))).then((e=>this.storeExtensions(e)))}storeExtensions(e){this.extensionsArray=this.extensionsArray.concat(e),e.forEach((e=>{this.extensions[e.extensionId]=e}))}initDefault(e){const t=e;t.types=t.types||{},t.variables=t.variables||{},t.metadata=t.metadata||{},t.constants=t.constants||{},t.events=t.events||{},t.eventListeners=t.eventListeners||{},t.interface=t.interface||{},t.interface.events=t.interface.events||{},t.interface.constants=t.interface.constants||{},t.interface.variables=t.interface.variables||{},t.interface.types=t.interface.types||{},t.security=t.security||{};const{security:i}=t;i.access||(i.access={}),d.removeDecorators(t.constants),d.removeDecorators(t.interface.constants),d.removeDecorators(t.variables),d.removeDecorators(t.interface.variables),d.removeDecorators(t.eventListeners),d.removeDecorators(t.types),d.removeDecorators(t.interface.types),d.removeDecorators(t.chains),Object.defineProperty(this,"definition",{value:t,configurable:!0,enumerable:!0})}saveNavigateParamsInDt(e){e&&this.application.runtimeEnvironment.saveInputParameters({get plainParams(){return d.cloneObject(e)}})}validateNavigationInDt(e){const t=this.application.runtimeEnvironment,i=this.application.getCurrentPagePath();if(e.operation===u.NavigateOperation.PAGE||e.operation===u.NavigateOperation.PAGE_OLD){let r=e.page||"";if("/"!==r[0]&&this.parent){const e=this.parent.getContainerPath();e&&(r=`${e}/${r}`)}return this.saveNavigateParamsInDt(e.params),t.canNavigateToPage(i,r)}return this.saveNavigateParamsInDt(e.params),t.canNavigate(i,e)}validateNavigation(e){e.operation===u.NavigateOperation.APP_UI&&""!==e.application&&e.application!==(this.package&&this.package.id)&&this.application.appUiInfos.validateNavigation(e)}navigateOperation(e,t){return Promise.resolve().then((()=>{let i,r,n,s="";switch(e.operation){case u.NavigateOperation.PAGE:r=e.page,s="page",i=this.getLeafPageInstance(r,t);break;case u.NavigateOperation.FLOW:r=e.flow,s="flow",n="parent"===e.target?this.parent.parent:this,i=n.getLeafPageInstanceFromFlowId(r,t);break;case u.NavigateOperation.APP_UI:{const n=e.application||this.package.id;r=this.application.appUiInfos.getUrlIdFromAppId(n),s="App UI",i=this.application.prepareHostRootPage(e.application).then((()=>this.application.getLeafPageInstanceFromAppUiId(r,t)))}break;case u.NavigateOperation.PAGE_OLD:r=e.page,s="path",i=this.getLeafPageInstance(r,t)}this.log.info("Starting navigation to",s,r);const a=d.cloneObject(f.getInputParameters()),o=e.params||{},c=d.diff(o,a);return c&&f.setInputParameters(o),i.then((i=>i?(t.container.package!==i.package&&i.checkNavigable(),t.container.switcher&&i.checkEmbeddable(),this.navigate(i,e,c,a)):(t.clean(),{navigated:!1})))}))}getLeafPageInstance(e,t){if("/"===e[0])return this.application.getLeafPageInstance(e.substr(1),t);if(""===e)return this.parent.loadDefaultContainers(t);const i=e.split("/");return this.loadFirstPathSegment(i.shift(),t).then((e=>e?e.loadPathSegments(i,t):Promise.resolve())).then((e=>e?e.loadDefaultContainers(t):Promise.resolve())).catch((t=>{if(!g.isFileNotFound(t))throw t;this.fireNotificationEvent(`${d.formatLoadError(t)} while loading path "${e}".`)}))}fireNotificationEvent(e){return new v({container:this}).fireNotificationEvent({message:e})}getLeafPageInstanceFromFlowId(e,t){let i=t.options.page;return i&&"/"===i[0]&&(i=i.substring(1),t.options.page=i),e||i?this.loadContainer(e,t).then((e=>{if(e)return i?e.getLeafPageInstance(i,t):e.loadDefaultContainers(t)})).catch((t=>{if(!g.isFileNotFound(t))throw t;this.log.error(t),this.fireNotificationEvent(`${d.formatLoadError(t)} while loading "${e}".`)})):this.loadDefaultContainers(t)}loadFlowFromId(e,t){return Promise.resolve().then((()=>{let i=this.flows[e];return i||(i=this.createFlow(e,this),i.load().then((()=>i.processDefaultPage())).then((()=>(t||a.sync(),this.flows[e]=i,i))))}))}loadDefaultContainers(e){const t=this.router.defaultStateId;return t?this.loadContainer(t,e).then((t=>t?t.loadDefaultContainers(e):void 0)):Promise.resolve(this)}loadFirstPathSegment(e,t){return this.loadContainer(e,t)}loadPathSegments(e,t){return e.length>0?this.loadContainer(e.shift(),t).then((i=>i?i.loadPathSegments(e,t):void 0)):Promise.resolve(this)}navigate(e,t,i,r){f.setSkipMode(t.history===u.HistoryMode.SKIP);const n=e.getNavPath();return this.application.getCurrentPagePath()===n?(()=>{let s={navigated:!0},o="cancelled",c="because it is the current page and input parameters";return i?t.params?(e.refreshInputParameters(),f.pushState(),a.updateState(e.fullPath),f.sync(),this.application.previousPagePath=n,this.application.currentPageParams=d.cloneObject(f.getInputParameters()),e.invokeAfterNavigateEvent({previousPageParams:r}),o="done",c="",a.clearBusyState()):(f.setInputParameters(r),c+=" are undefined",s={navigated:!1}):(c+=" are the same",s={navigated:!1}),this.log.info("Navigation to",n,"is",o,c),s})():(()=>{let i;t.history!==u.HistoryMode.REPLACE&&t.history!==u.HistoryMode.SKIP||(i={historyUpdate:t.history});const s=f.getSearch();return f.resetUrlParameters(),a.go(n,i).then((t=>{!1===t.hasChanged?(a.clearBusyState(),f.setSearch(s),f.setInputParameters(r),f.setSkipMode(!1)):(f.resetUri(),window.scroll(0,0),f.setHash(),e.parent.refreshInputParameters(!0))})).catch((t=>{throw e.parent.deletePage(e.id),f.setSearch(s),f.setInputParameters(r),f.setSkipMode(!1),t})),{navigated:!0}})()}createListenerChainFunctions(e){const t=[];return(e.chains||[]).forEach((e=>{const{chainId:i,chain:r,parameters:n}=e;t.push({chainId:i,fnc:e=>{const t=!!r;return this.callActionChain(r||i,n||{},t,e).then((e=>t?{result:e}:e))}})})),t}callListenerChainFunctionsInParallel(e,t){const i=e.map((e=>e.fnc(t)));return Promise.all(i).catch((e=>{if(this.log.error(e),this.application.alwaysRethrowException)throw e;return Promise.resolve()}))}callVariableEventListeners(e,t){const i=this.createListenerChainFunctions(e);return this.callListenerChainFunctionsInParallel(i,t)}callActionChain(e,t={},r,n=this.getAvailableContexts()){const s={application:this.application,parent:this.parent,container:this,chains:this.chains};if(n&&n[u.ContextName.EVENT]){const i=n[u.ContextName.EVENT];C.finer("action chain",e,"called with params",t,"for event",i)}return i.startChain(e,t,s,n,r)}getAvailableContexts(){return this.availableContexts||(this.availableContexts=this.constructor.ContextType.getAvailableContexts(this),this.traverseExtensions("getAvailableContexts")),this.availableContexts}static get ContextType(){throw O("ContextType")}initializeEvents(){this.initializeEventDefinitions(),this.initializeComponentListeners(),this.traverseExtensions("initializeEvents")}initializeEventDefinitions(){const e=this.definition.interface.events||{};Object.keys(e).forEach((t=>{const i=e[t];i.mode||(i.mode=u.EventMode.LISTENABLE)}));const t=Object.assign({},this.definition.events,e);Object.keys(t).forEach((i=>{const r=t[i],n=!!e[i];y.register(this,i,r,n)}))}initializeComponentListeners(){const e=this.definition.eventListeners||{};Object.keys(e).forEach((t=>{this.eventListeners[t]=this.createComponentEventFunction(t,e[t])}))}createComponentEventFunction(e,t){return(i,r,n)=>{if(this.lifecycleState===u.ContainerState.EXITED)return;const s=d.cloneObject(i,{});this.invokeComponentEvent(e,s,r,n);const a=this.getAvailableContexts().clone();a[u.ContextName.EVENT]=s;this.evaluateSynchronousHandlerProperty(t.stopPropagation,a)&&("function"==typeof i.stopPropagation?(this.log.info("stopping event propagation in",e,"event listener"),i.stopPropagation()):this.log.warn(e,"event listener has a true 'stopPropagation' expression,"," but listener argument does not have 'stopPropagation' method"));this.evaluateSynchronousHandlerProperty(t.preventDefault,a)&&("function"==typeof i.preventDefault?(this.log.info("preventing default behavior for event in",e,"event listener"),i.preventDefault()):this.log.warn(e,"event listener has a true 'preventDefault' expression,","but listener argument does not have 'preventDefault' method"))}}invokeComponentEvent(t,i,r,n){const s=this.definition.eventListeners[t];if(s){const a=this.getAvailableContexts().clone();a[u.ContextName.EVENT]=i,a[u.ContextName.CURRENT]=r,a[u.ContextName.BINDING_CONTEXT]=n,C.beforeHandleEvent(this.className,this.id,"handling component event",t,"with payload:",i,"and current:",r);const o=new T(T.SPAN_NAMES.EVENT_COMPONENT,t,i,this);return this.log.monitor(o,(i=>{const r=e.getPageContext().getBusyContext().addBusyState({description:t}),n=this.createListenerChainFunctions(s);return this.callListenerChainFunctionsInParallel(n,a).then((()=>{C.afterHandleEvent(this.className,this.id,"handled component event",t,"successfully",i())})).catch((e=>{C.afterHandleEvent("Failed to handle component event",t,i(e)),this.log.error(e)})).finally((()=>{r()}))}))}return Promise.resolve(null)}evaluateSynchronousHandlerProperty(e,t,i=!1){if(e){const i=h.getValueOrExpression(e,t);return d.resolveIfObservable(i)}return i}canExit(){return Promise.resolve(!0)}invokeEvent(e,t,i,r){e.startsWith(u.VB_EVENT_MARKER)&&x.timestamp(this.id,e);const n=new T(T.SPAN_NAMES.EVENT_RUNTIME,e,t,this);return this.log.monitor(n,(n=>Promise.resolve().then((()=>{const n=[],s=this.findEventListener(e);if(s){const a=this.getAvailableContexts().clone();a[u.ContextName.EVENT]=t,e===u.BEFORE_ENTER_EVENT&&(a[u.ContextName.PARAMETERS]=this.isExtension()&&this.base?this.base.buildAllParameters():this.buildAllParameters());const o=this.createListenerChainFunctions(s);let c;if(i){if(c=i.callChainFunctions(this,o,a,r),e!==u.AFTER_NAVIGATE_EVENT)return c}else c=this.callListenerChainFunctionsInParallel(o,a);n.push(c)}if(e===u.ENTER_EVENT||e===u.EXIT_EVENT||e===u.AFTER_NAVIGATE_EVENT||e===u.BEFORE_ENTER_EVENT||e===u.BEFORE_EXIT_EVENT){const s=this.traverseExtensions("invokeEvent",e,t,i,r);n.push(...s)}return Promise.all(n).then((t=>{const i=t.filter((e=>e!==u.NO_EVENT_LISTENER_RESPONSE));if(0===i.length)return u.NO_EVENT_LISTENER_RESPONSE;if(e===u.BEFORE_ENTER_EVENT||e===u.BEFORE_EXIT_EVENT){const e=[];for(let t=0;t<i.length;t+=1)e.push(...i[t]);return e}return i[0]}))})).then((t=>(e===u.ENTER_EVENT||e===u.EXIT_EVENT?this.log.info(this.className,this.id,"completed",e,n()):n(),t))).catch((t=>{throw e===u.ENTER_EVENT||e===u.EXIT_EVENT?this.log.info(this.className,this.id,"failed to complete",e,n(t)):n(t),t}))))}findEventListener(e){return y.findListener(this,e)}getAllVariablesDefinition(){return Object.assign({},this.definition.variables,this.definition.interface.variables)}invokeEventWithBubbling(e,t){return Promise.resolve().then((()=>{const i=y.get(this,this,e);if(!i)throw new Error(`Event registry returned null for event ${e}`);if(!i.behavior)throw new Error(`No behavior found for event ${e}`);if(!i.behavior.triggerableBy(this))throw new Error(`Event '${e}' is not triggerable from container '${this.id}'`);return i.behavior.start(this,e,t)}))}initializeActionChains(){this.chains=this.definition.chains||{},this.traverseExtensions("initializeActionChains")}initializeVariableByNamespace(e,t,i){const r=[];if(!e)return Promise.resolve();const n=h.buildVariablesDependenciesGraph(e,this.scopeResolver);return Object.keys(e).forEach((s=>{const a=e[s],o=i||{};o.dependencies=n&&n[s],t===u.VariableNamespace.METADATA&&(delete a.input,delete a.persisted,delete a.rateLimit),r.push(this.createVariable(s,a,t,o))})),Promise.all(r)}initVariableScope(){this.scope=s.createScope(this.getNewScopeName(),this),this.getAvailableContexts(),this.traverseExtensions("initVariableScope")}initAllVariableNamespace(){return this.scope&&(this.log.error("Scope already created"),this.disposeScope()),this.initializeEnums(),this.initVariableScope(),this.initializeConstants(),this.initializeBuiltins(),this.initializeVariables().then((()=>this.initializeMetadata())).then((()=>{this.addScopeToStore(),this.subscribeVariablesToStore()})).then((()=>this.activateVariables())).then((()=>this.activateDirtyDataTracking()))}activateDirtyDataTracking(){this.scope.initVarsMarkedForDirtyDataTracking(),this.traverseExtensions("activateDirtyDataTracking")}isDirtyDataPresent(){let e=this.checkForDirtyData();if(e)return!0;let t=this.getLeafContainer();for(;t&&t!==this;){if(e=t.checkForDirtyData(),e)return!0;t=t.parent}return!1}checkForDirtyData(){if(this.scope.checkForDirtyData())return!0;if(this.layouts.find((e=>e.checkForDirtyData())))return!0;return this.traverseExtensions("checkForDirtyData").includes(!0)}resetAllDirtyData(){this.resetDirtyData();let e=this.getLeafContainer();for(;e&&e!==this;)e.resetDirtyData(),e=e.parent}resetDirtyData(){this.scope.resetDirtyData(),this.layouts.forEach((e=>{e.resetDirtyData()})),this.traverseExtensions("resetDirtyData")}initializeEnums(){const e=Object.assign({},this.definition.types,this.definition.interface.types);Object.entries(e).forEach((e=>{const t=e[0],i=e[1];if(i&&i.enumType)if(d.isPrimitiveType(i.enumType))if(Array.isArray(i.values))if("number"===i.enumType){let e=0;this.enums[t]=Object.assign(...i.values.map((t=>{const i={[t]:e};return e+=1,i})))}else"string"===i.enumType?this.enums[t]=Object.assign(...i.values.map((e=>({[e]:e})))):this.log.error(`Enum ${t} is missing initializers.`,"Only enumerations of type number or string can be defined with no initializers.");else this.enums[t]=i.values;else this.log.error(`Enum ${t} is of unsupported enumeration type ${i.enumType}.`,"Only primitive types are supported.")})),this.traverseExtensions("initializeEnums")}addScopeToStore(){n.addScopeToStore(this.scope),this.traverseExtensions("addScopeToStore")}subscribeVariablesToStore(){this.scope.subscribeVariablesToStore()}activateVariables(){const e=this.getAvailableContexts();return Promise.resolve().then((()=>this.scope.activateVariables(e).then((()=>this.traverseExtensions("activateVariables")))))}initializeBuiltins(){let e=this.defineInfoBuiltinVariable();e&&this.createConstant(u.INFO_CONTEXT,{type:"object",defaultValue:e},u.VariableNamespace.BUILTIN),e=this.defineCurrentPageBuiltinVariable(),e&&this.scope.createVariable(u.CURRENT_PAGE_VARIABLE,u.VariableNamespace.BUILTIN,e.type,e.defaultValue,void 0,{writable:!1})}defineInfoBuiltinVariable(){return null}defineCurrentPageBuiltinVariable(){return null}initializeConstants(){const e=Object.assign({},this.definition.constants,this.definition.interface.constants);Object.keys(e).forEach((t=>{this.createConstant(t,e[t])})),this.traverseExtensions("initializeConstants")}createConstant(e,t,i=u.VariableNamespace.CONSTANTS){if(d.isInstanceType(t.type))throw new Error(`Type cannot be a built-in type for constant ${e} in${this.className} ${this.fullPath||this.definition.id}.`);const r=t.extension||this,n=h.createNonInstanceTypeDefaultValue(e,t,this.scopeResolver,r.getAvailableContexts()),s=this.manageInputParameter(e,t,n);void 0!==s&&this.log.info("Loaded",t.input,"constant",d.getWebStorageItemName(this.application.id,this.scope.name,u.VariableNamespace.CONSTANTS,e),"value:",s);const a=this.scope.createConstant(e,i,t.type,n,s,t.persisted);this.addValueChangedListeners(a,t,this.getAvailableContexts())}initializeVariables(){const e=this.getAllVariablesDefinition(),t=[];return t.push(this.initializeVariableByNamespace(e,u.VariableNamespace.VARIABLES)),t.push(...this.traverseExtensions("initializeVariables")),Promise.all(t)}initializeMetadata(){const e=[];return e.push(this.initializeVariableByNamespace(this.definition.metadata,u.VariableNamespace.METADATA,{writable:!1})),e.push(...this.traverseExtensions("initializeMetadata")),Promise.all(e)}createVariable(e,t,i=u.VariableNamespace.VARIABLES,r){const n=this.getAvailableContexts(),s=this.getInputParameterFromCallerValue(e,t);return h.createVariableDefaultValue(e,t,this.scopeResolver,this.scope,n,i,s).then((s=>{const a=this.manageInputParameter(e,t,s);void 0!==a&&this.log.info("Loaded",t.input,"variable",d.getWebStorageItemName(this.application.id,this.scope.name,i,e),"value:",a);const o=h.getType(e,t,this.scopeResolver),c=this.getVariableDescriptor(t,r),l=this.scope.createVariable(e,i,o,s,a,c,t);return this.addValueChangedListeners(l,t,n),l}))}getVariableDescriptor(e,t){return Object.assign({},{persisted:e.persisted,input:e.input,rateLimit:e.rateLimit,dirtyDataBehavior:e.dirtyDataBehavior},t)}addValueChangedListeners(e,t,i){const r=t.onValueChanged;r&&this.handleValueChangedListener(e,r,i);const{name:n}=e;!(!this.definition.interface.variables[n]&&!this.definition.interface.constants[n])&&this.traverseExtensions("addExtensionValueChangedListeners",e)}allowsDynamicComponentEventBehavior(e){return e!==u.EventBehaviors.DYNAMIC_COMP}canFireEvent(e){return!0}allowsEventPropagation(e,t){return!1}handleValueChangedListener(e,t,i){if(e.onValueChanged){const r={eventSource:e.onValueChanged,eventListener:e=>{const r=i.clone();r[u.ContextName.EVENT]=e;const n=e.type;C.beforeHandleEvent(this.className,this.id,"handling variable event",n,"with payload:",e);const s=new T(T.SPAN_NAMES.EVENT_VARIABLE,n,e,this);return this.log.monitor(s,(e=>{this.callVariableEventListeners(t,r).then((()=>{C.afterHandleEvent(this.className,this.id,"handled variable event",n,"successfully",e())})).catch((t=>{C.afterHandleEvent("Failed to handle variable event",n,e(t)),this.log.error(t)}))}))}};e.onValueChanged.add(r.eventListener,this),this.variablesListeners.push(r)}else this.log.warn(e.name,"does not have a live expression so its onValueChanged listener is ignored")}addExtensionValueChangedListeners(e){const{name:t}=e,i=this.definition.extensions.variables||{},r=this.definition.extensions.constants||{};if(i||r){const n=i[t]||r[t];n&&n.onValueChanged&&this.handleValueChangedListener(e,n.onValueChanged,this.getAvailableContexts())}}loadImports(){return Promise.resolve().then((()=>{const e=this.definition.imports;if(e){const t=[];if(e.components){const i=this.importModule(e.components,!1);i&&t.push(i)}if(e.modules){const i=this.importModule(e.modules,!0);i&&t.push(i)}return e.css&&t.push(this.importCss(e.css)),Promise.all(t)}}))}loadTranslationBundles(){return this.loadBundlesPromise||(this.loadBundlesPromise=p.loadBundlesModel(this.application.runtimeEnvironment,this.definition,this.getResourceFolder(),{initParams:this.application.initParams},this.extension).then((e=>(this.bundles=e,this.bundles)))),this.loadBundlesPromise}getInputParameterFromCallerValue(e,t){const i=this.application.runtimeEnvironment.loadInputParameters();return i&&i[e]}getInputParameterValue(e,t){let i,r,n=this.getInputParameterFromCallerValue(e,t);if(void 0===n&&(r=f.getInputParameters(),n=r&&r[e]),"fromCaller"===t.input)i=n;else if("fromUrl"===t.input)if(void 0!==n)i=n;else{const t=f.getUrlParameter(e);void 0!==t&&(i=t)}return i}manageInputParameter(e,t,i){let n=this.getInputParameterValue(e,t);if("fromUrl"===t.input){n=r.coerceType(n,t.type);n!==d.resolveIfObservable(i)&&f.setUrlParameter(e,n)}return n}refreshInputParameters(e){this.parent&&this.parent.refreshInputParameters(e),this.scope&&this.scope.variablesDef.forEach((t=>{if(t.namespace===u.VariableNamespace.VARIABLES){const i=t.descriptor&&t.descriptor.input;if("fromCaller"===i||"fromUrl"===i){const i=this.getAllVariablesDefinition()[t.name];let r=this.manageInputParameter(t.name,i,t.defaultValue);e?void 0!==r&&t.setValue(r):(void 0===r&&(r=t.defaultValue),t.setValue(r))}}}))}buildTitle(e){return""}hasType(e){return this.definition.interface.types[e]||this.definition.types[e]}hasEvent(e){return this.definition.interface.events[e]||this.definition.events[e]}isInterfaceType(e){return this.definition.interface.types[e]}getType(e){const t=this.hasType(e);if(!t)throw new TypeError(`Type "${e}" does not exist in ${this.className} ${this.fullPath||this.definition.id}`);return"object"!==t.type&&"array"!==t.type||"*"!==t.definition&&!d.isObject(t.definition)?{type:t}:t}getTypeReferencesByPrefix(e="",t){const i=[];return function e(t,i){t&&"function"==typeof i&&Object.keys(t).forEach((r=>{"string"==typeof t[r]?i(r,t[r]):"object"==typeof t[r]&&e(t[r],i)}))}(t,(function(t,r){"type"!==t&&"definition"!==t||!r.startsWith(e)||i.push(r.substring(e.length))})),i}callSecurityProvider(e){const t=this.application.securityProvider;if(t&&t.handleLoadError&&t.handleLoadError(e,this.fullPath))throw e}isAuthenticationRequired(){const{requiresAuthentication:e}=this.definition.security.access;return void 0!==e?e:!this.parent||this.parent.isAuthenticationRequired()}checkAccess(){return Promise.resolve().then((()=>{if((window.vbInitConfig||{}).TEST_MODE===u.TestMode.ACTION_CHAIN)return;const e=this.definition.security.access;if(e.roles=e.roles||[],e.permissions=e.permissions||[],e.requiresAuthentication=this.isAuthenticationRequired(),!1===e.requiresAuthentication){if(e.roles.length>0||e.permissions.length>0)throw new Error(`Incorrect security configuration for ${this.className} ${this.fullPath}`);return}const t=this.application.securityProvider;if(!t)throw new Error(`A Security Provider is required to enforce access restriction for ${this.className} ${this.fullPath||this.definition.id}.`);if(!t.isAccessAllowed(this.className,this.fullPath,e))throw new g(403,null,`${this.fullPath} HTTP status: 403 Forbidden`)}))}checkNavigable(){}registerLayout(e){this.layouts.push(e)}disposeScope(){this.scope&&(this.scope.dispose(),n.removeScopeFromStore(this.scope),this.scope=null),this.variablesListeners.forEach((e=>{e.eventSource.remove(e.eventListener)})),this.variablesListeners=[]}dispose(){this.loadMetadataPromise=null,this.loadDescriptorPromise=null,this.layouts.forEach((e=>e.dispose())),this.layouts=[],this.traverseExtensions("dispose"),this.disposeScope()}importCss(e){return Promise.resolve().then((()=>{if(!Array.isArray(e)||0===e.length)return;const t=this.resolveCssPaths(e),i=[];return t.urlPaths.length>0&&i.push(d.getResources(t.urlPaths)),t.cssPaths.length>0&&i.push(w.injectCss(t.cssPaths,t.cssUrls)),Promise.all(i)})).catch((e=>{C.error("Unable to load css:",e)}))}resolveCssPaths(e=[]){const t={cssPaths:[],cssUrls:[],urlPaths:[]};return e.forEach((e=>{let i=e.trim();if(A.parse(i).protocol)t.urlPaths.push(`css!${i}`);else{i="/"===i[0]?i.substring(1):`${this.getResourceFolder()}${i}`;const e=requirejs.toUrl(i);t.cssUrls.push(e.substring(0,e.lastIndexOf("/")+1)),t.cssPaths.push(`text!${i}`)}})),t}static injectCss(e,t=[]){return d.getResources(e).then((e=>{let i="";e.forEach(((e,r)=>{e&&(i+=d.replacePathInCSS(e,(e=>{let i=e;return A.parse(e).protocol||(i=A(`${t[r]}${e}`).normalizePath().toString()),i})))})),d.injectStyleTag(i)}))}getLeafContainer(){return a.getCurrentPage()}static isJetComponent(e){return e.startsWith("ojs/")}adjustImportPath(e){return e}importModule(e,t){const i=[],r=[];let n;return Object.keys(e).forEach((t=>{const n=e[t];let s;d.isObject(n)&&(s=n.path,s="string"==typeof s&&s.trim()),s?(i.push(this.adjustImportPath(s)),r.push(t.trim())):this.log.error("Unable to load component",t,"in",this.className,this.fullPath,"because the path is missing.")})),i.length>0&&(n=d.getResources(i).then((e=>{if(t)for(let t=0;t<e.length;t+=1)this.imports[r[t]]=e[t]})).catch((e=>{C.error("Unable to load component:",e.message,this.id)}))),n}}return w})),define("vb/private/stateManagement/stateMonitor",[],(()=>new class{constructor(){this.RuntimeState={PAGE_ACTIVATED:"vbPageActivated",PAGE_DEACTIVATED:"vbPageDeactivated",FRAGMENT_ACTIVATED:"vbFragmentActivated",FRAGMENT_DEACTIVATED:"vbFragmentDeactivated",CONTAINER_ACTIVATED:"vbContainerActivated",CONTAINER_DEACTIVATED:"vbContainerDeactivated"},this.stateChangeListeners=[]}recordStateChange(e,t){this.stateChangeListeners.forEach((i=>{i(e,t)}))}addStateChangeListener(e){this.stateChangeListeners.push(e)}removeStateChangeListener(e){const t=this.stateChangeListeners.indexOf(e);t>=0&&this.stateChangeListeners.splice(t,1)}})),define("vb/private/translations/translationContext",["ojs/ojtranslation","vb/private/constants"],((e,t)=>class{constructor(){throw new Error("TranslationContext is a set of static methods, do not call constructor")}static createV1Context(t){if(!t)return{format:(t,i,...r)=>e.applyParameters(i,...r)};const i={format:(e,i,...r)=>{if(void 0===e)return t.getStringMap().format;return t.getBundleDefinition(e).format(i,...r)}};return Object.assign({},t.getStringMap(),i)}static createContext(t){if(!t)return{format:(t,i,...r)=>e.applyParameters(i,...r)};const i=t.getStringMap(),r=t.getV2StringMap();if(Object.keys(i).length||!Object.keys(r).length){const e={format:(e,r,...n)=>{if(void 0===e)return i.format;return t.getBundleDefinition(e).format(r,...n)}};return Object.assign({},i,r,e)}return r}static addExtensionsContexts(e,i){const r=Object.entries(e.extensionsBundleMap);r.length&&r.forEach((([e,r])=>{i[e]?Object.defineProperty(i[e],t.TRANSLATIONS_CONTEXT,{enumerable:!0,configurable:!0,value:r}):Object.defineProperty(i,e,{enumerable:!0,configurable:!0,value:{[t.TRANSLATIONS_CONTEXT]:r}})}))}})),define("vb/private/stateManagement/context/containerContext",["vb/private/constants","vb/private/translations/translationContext"],((e,t)=>{const i=Symbol("container-accessor");class r{constructor(e){const t=this;Object.defineProperty(this,i,{value:{get listeners(){return e.eventListeners||{}},get functions(){return e.functions},get chains(){return e.chains||{}},get scope(){return e.scope},get enums(){return e.enums},get bundles(){return e.bundles},bundleContext:null,get baseContext(){const i=new t.constructor.BaseContextType(e);return Object.defineProperty(this,"baseContext",{value:i,enumerable:!0}),i},get application(){let t;const i=e.package;if(i){t=i.application.extensions[i.extensionId].expressionContext.base}else t=e.application.expressionContext;return Object.defineProperty(this,"application",{value:t,enumerable:!0}),t}}})}get baseContext(){return this[i].baseContext}get[e.VariableNamespace.VARIABLES](){const{scope:t}=this[i];return t&&t.variableNamespaces[e.VariableNamespace.VARIABLES]}get[e.VariableNamespace.METADATA](){const{scope:t}=this[i];return t&&t.variableNamespaces[e.VariableNamespace.METADATA]}get[e.VariableNamespace.CONSTANTS](){const{scope:t}=this[i];return t&&t.variableNamespaces[e.VariableNamespace.CONSTANTS]}get enums(){return this[i].enums}get listeners(){return this[i].listeners}get functions(){return this[i].functions}get chains(){return this[i].chains}get[e.TRANSLATIONS_CONTEXT](){return this[i].bundleContext||(this[i].bundleContext=t.createV1Context(this[i].bundles)),this[i].bundleContext}set[e.TRANSLATIONS_CONTEXT](t){(window.vbInitConfig||{}).TEST_MODE===e.TestMode.ACTION_CHAIN&&(this[i].bundleContext=t)}get application(){return this[i].application}getVariable(...e){return this[i].scope.getVariable(...e)}static getAvailableContexts(i){const n={};if(Object.defineProperty(n,"clone",{enumerable:!1,value:r.cloneContext.bind(n)}),Object.defineProperty(n,"addAccessor",{enumerable:!1,value:r.addAccessor.bind(n)}),Object.defineProperties(n,{$global:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.application},$application:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.application},$variables:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.variables},$enums:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.enums},$metadata:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.metadata},$constants:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.constants},$chains:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.chains},$functions:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.functions},$listeners:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.listeners},$imports:{enumerable:!0,configurable:!0,get:()=>i.imports},[`$${e.TRANSLATIONS_CONTEXT}`]:{enumerable:!0,configurable:!0,get:()=>{const r=t.createContext(i.bundles);return Object.defineProperty(n,`$${e.TRANSLATIONS_CONTEXT}`,{value:r,enumerable:!0}),r}}}),i.package&&(Object.defineProperties(n,{$application:{enumerable:!0,configurable:!0,get:()=>i.package.expressionContext},$base:{enumerable:!0,configurable:!0,get:()=>i.expressionContext.baseContext},$extension:{enumerable:!0,configurable:!0,value:{get base(){return i.expressionContext.baseContext},[e.PATH_VARIABLE]:i.absoluteUrl}}}),i.bundles)){t.addExtensionsContexts(i.bundles,n.$extension);const r=i.bundles.getExtensionV2StringMap(e.ExtensionFolders.BASE);r&&Object.defineProperty(n.$base,e.TRANSLATIONS_CONTEXT,{enumerable:!0,configurable:!0,value:r})}return n}static cloneContext(){const e={};return Object.keys(this).forEach((t=>{const i=Object.getOwnPropertyDescriptor(this,t);Array.isArray(i.value)&&(i.value=i.value.slice()),Object.defineProperty(e,t,i)})),Object.defineProperty(e,"clone",{enumerable:!1,value:r.cloneContext.bind(e)}),Object.defineProperty(e,"addAccessor",{enumerable:!1,value:r.addAccessor.bind(e)}),e}static addAccessor(e,t){e&&"function"==typeof t&&Object.defineProperty(this,e,{enumerable:!0,configurable:!0,get:t})}}return r})),define("vb/private/stateManagement/context/baseContext",["vb/private/constants"],(e=>{const t=Symbol("base-accessor");class i{constructor(e){Object.defineProperty(this,t,{value:{get export(){return e.export},get applicationBaseContext(){return(e.package||e.application).expressionContext.baseContext},get globalBaseContext(){return e.application.expressionContext.baseContext},get scope(){return e.scope}}})}get application(){return this[t].applicationBaseContext}get global(){return this[t].globalBaseContext}get[e.VariableNamespace.VARIABLES](){return this[t].export[e.VariableNamespace.VARIABLES]}get[e.VariableNamespace.CONSTANTS](){return this[t].export[e.VariableNamespace.CONSTANTS]}get enums(){return this[t].export.enums}getVariable(e,i){let r;if(this[i]){Object.keys(this[i]).indexOf(e)>=0&&(r=this[t].scope.getVariable(e,i))}return r}}return i})),define("vb/private/stateManagement/context/pageBaseContext",["vb/private/stateManagement/context/baseContext"],(e=>{const t=Symbol("page-base-accessor");return class extends e{constructor(e){super(e),Object.defineProperty(this,t,{value:{get flowBaseContext(){return e.parent.expressionContext.baseContext}}})}get flow(){return this[t].flowBaseContext}get page(){return this}}})),define("vb/helpers/componentFinder",["vb/private/log"],(e=>{const t=e.getLogger("/vb/helpers/componentFinder");return class{static byId(e){const i=document.getElementById(e);return i||t.info("unable to find element by id:",e),i}static bySelector(e){const i=document.querySelector(e);return i||t.info("unable to find element by selector:",e),i}}})),define("vb/private/stateManagement/context/pageContext",["vb/private/constants","vb/private/stateManagement/context/containerContext","vb/private/stateManagement/context/pageBaseContext","vb/helpers/componentFinder"],((e,t,i,r)=>{const n=Symbol("page-accessor");class s extends t{constructor(t){super(t);const i={[e.COMPONENTS_CONTEXT]:()=>r};Object.keys(i).forEach((e=>{Object.defineProperty(this,e,{enumerable:!0,configurable:!0,get:i[e]})})),Object.defineProperty(this,n,{value:{get builtins(){return t.scope.variableNamespaces[e.VariableNamespace.BUILTIN]}}})}static get BaseContextType(){return i}get[e.CURRENT_FLOW_VARIABLE](){return this[n].builtins[e.CURRENT_FLOW_VARIABLE]}get[e.INFO_CONTEXT](){return this[n].builtins[e.INFO_CONTEXT]}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return Object.defineProperties(t,{$flow:{enumerable:!0,configurable:!0,get:()=>e.parent.expressionContext},$page:{enumerable:!0,configurable:!0,get:()=>e.expressionContext}}),t}}return s})),define("vb/private/monitoring/loadMonitorOptions",["vbc/private/monitorOptions"],(e=>class extends e{constructor(e,t,i){super(e,t),this.addStartFields((()=>({container:i}))),this.addEndFields((()=>({container:i})))}})),define("vb/helpers/mixin",[],(()=>{const e=class{};class t{constructor(t=e){this.superclass=t}with(...e){return e.reduce(((e,t)=>t(e)),this.superclass)}}return e=>new t(e)})),define("vb/private/stateManagement/packageAndExtensionContainerMixin",["vb/private/constants","urijs/URI"],((e,t)=>i=>class extends i{resolveCssPaths(i=[]){const r={cssPaths:[],cssUrls:[],urlPaths:[]};return i.forEach((i=>{let n,s,a=i.trim();if(a.startsWith("self:")){a=a.substring(5),"/"===a[0]&&(a=a.substring(1));const t=`${e.DefaultPaths.UI}${e.ExtensionFolders.SELF}/`;n=`${this.baseUrl}${t}`,s=`${this.extension.baseUrlDef}/${t}`}else{t.parse(a).protocol?(r.urlPaths.push(`css!${a}`),a=null):"/"===a[0]?(a=a.substring(1),n=this.package.getResourceFolder(),s=`${this.extension.baseUrlDef}/${this.resourceLoc}`):(this.log.error("Cannot load css",a,"start the path with self:/"),a=null)}if(a){r.cssPaths.push(`text!${n}${a}`);const e=`${s}${a}`;r.cssUrls.push(e.substring(0,e.lastIndexOf("/")+1))}})),r}})),define("vb/private/stateManagement/containerExtension",["vb/private/stateManagement/container","vb/private/log","vb/private/constants","vb/private/monitoring/loadMonitorOptions","vb/helpers/mixin","vb/private/stateManagement/packageAndExtensionContainerMixin"],((e,t,i,r,n,s)=>{const a=t.getLogger("/vb/stateManagement/containerExtension",[{name:"greenInfo",severity:"info",style:"green"}]);class o extends(n(e).with(s)){constructor(e,t,i,r,n="ContainerExtension"){super(r.name,t,n),this._extension=e,this._resourceLoc=i,Object.defineProperties(this,{base:{value:r,enumerable:!0},path:{value:r.path,enumerable:!0}}),this.fullPath=this.base.fullPath,this.view={},this.log=a}get resourceLoc(){return this._resourceLoc}get layoutRoot(){return this.base?`${i.DefaultPaths.LAYOUTS}${i.ExtensionFolders.SELF}/`:i.DefaultPaths.LAYOUTS}get chainLoaderName(){return"getExtensionTextResource"}isExtension(){return!0}getContainerPath(){return this.base&&this.base.fullPath}getNewScopeName(){return`${this.className}/${this.extensionId}/${this.fullPath}`}initDefault(e){const t=e;t.extensions=t.extensions||{},super.initDefault(e)}load(){const e=new r(this.loadSpanName,`${this.className} load ${this.fullPath}`,this);return this.log.monitor(e,(e=>this.loadDescriptor().then((()=>{this.log.greenInfo(this.getResourcePath(),"loaded.",e())})).catch((t=>{throw e(t),t}))))}checkAccess(){return Promise.resolve()}adjustImportPath(t){const i=this.baseUrl;if(!e.isJetComponent(t)&&i){const e=`${i}${t}`;if(requirejs.toUrl(e)!==`${requirejs.toUrl(i)}${t}`)return e}return t}isDirtyDataPresent(){const e=this.base;return!!e&&e.isDirtyDataPresent()}resetAllDirtyData(){const e=this.base;e&&e.resetAllDirtyData()}}return o})),define("vb/private/stateManagement/context/extensionContext",["vb/private/stateManagement/context/containerContext","vb/private/constants","vb/private/translations/translationContext"],((e,t,i)=>{const r=Symbol("extension-accessor"),n=[t.APPLICATION_USER_VARIABLE,"builtinUtils",t.RESPONSIVE_CONTEXT,t.PROFILE_CONSTANT,t.DEPLOYMENT_CONSTANT,t.INIT_PARAM_CONTEXT,t.PATH_VARIABLE,t.CURRENT_PAGE_VARIABLE,t.INFO_CONTEXT];return class extends e{constructor(e){let t,i;super(e),Object.defineProperty(this,r,{value:{base:e.base,absoluteUrl:e.absoluteUrl,get application(){if(!t){const i=e.base.application.extensions[e.extensionId];if(i){const e=i.expressionContext,r=e.base;t={},["variables","constants","enums","events"].forEach((i=>{let n;Object.defineProperty(t,i,{get(){if(!n){n={};let t=e[i]||[];Object.keys(t).forEach((e=>{const i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,i)})),t=r[i]||[],Object.keys(t).forEach((e=>{const i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,i)}))}return n}})})),t.getVariable=function(...t){return e.getVariable(...t)||r.getVariable(...t)},Object.defineProperty(t,"functions",{get:()=>e.functions}),n.forEach((e=>{Object.defineProperty(t,e,{get:()=>r[e]})}))}else t={}}return t},get appUi(){if(void 0===i)if(e.base.package){i={};const t=e.base.package.extensions[e.extensionId];if(t){const e=t.expressionContext;["variables","constants","enums","events","functions"].forEach((t=>{Object.defineProperty(i,t,{get:()=>e[t]})})),i.getVariable=(...t)=>e.getVariable(...t);const r=this.application;n.forEach((e=>{Object.defineProperty(i,e,{get:()=>r[e]})}))}}else i=null;return i},get bundles(){return e.bundles}}})}static get BaseContextType(){throw new Error("Base context constructor undefined")}get base(){return this[r].base.expressionContext.baseContext}get extension(){const e={base:this.base,[t.PATH_VARIABLE]:this[r].absoluteUrl};return this[r].bundles&&i.addExtensionsContexts(this[r].bundles,e),e}get application(){return this[r].application}get appUi(){return this[r].appUi}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return Object.defineProperties(t,{$application:{enumerable:!0,configurable:!0,get:()=>e.expressionContext.appUi||e.expressionContext.application},$extension:{enumerable:!0,configurable:!0,get:()=>e.expressionContext.extension},$base:{enumerable:!0,configurable:!0,get:()=>e.expressionContext.base}}),t}}})),define("vb/private/stateManagement/context/pageExtensionContext",["vb/private/constants","vb/private/stateManagement/context/extensionContext","vb/private/stateManagement/context/pageBaseContext"],((e,t,i)=>class extends t{static get BaseContextType(){return i}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return Object.defineProperties(t,{$page:{enumerable:!0,configurable:!0,get:()=>e.expressionContext},$flow:{enumerable:!0,configurable:!0,get:()=>{const t=e.base.parent.extensions[e.extensionId];return t&&t.expressionContext}}}),t}})),define("text!vb/components/oj-vb-fragment/component.json",[],(function(){return'{\n  "name": "oj-vb-fragment",\n  "displayName": "Visual Builder Fragment Content",\n  "description": "A component to nest content from a fragment into a Visual Builder page or another fragment",\n  "version": "22.01.0",\n  "jetVersion": ">=11.0.0",\n  "properties": {\n    "bridge": {\n      "type": "Object",\n      "description": "A factory to create a bridge between CCA and VB"\n    },\n    "name": {\n      "type": "string",\n      "description": "Name of the fragment to load."\n    },\n    "config": {\n      "type": "object",\n      "description": "A configuration object as defined for the oj-module component",\n      "properties": {\n        "cleanupMode": {\n          "type": "string",\n          "enumValues": ["onDisconnect", "none"],\n          "value": "onDisconnect"\n        }\n      }\n    },\n    "animation": {\n      "type": "object"\n    },\n    "dataContext": {\n      "binding": {\n        "consume": {\n          "name": "layoutContext"\n        }\n      }\n    }\n  },\n  "methods": {\n    "updateParam": {\n      "params": {\n        "type": "object"\n      },\n      "description": "An object with the param that changed and its new value"\n    }\n  },\n  "slots": {\n    "": {\n      "description": "The default slot used to contain fragment parameters",\n      "preferredContent": [\n        "oj-vb-fragment-param"\n      ]\n    }\n  },\n  "dynamicSlots": {}\n}\n'})),define("text!vb/components/oj-vb-fragment-param/component.json",[],(function(){return'{\n  "name": "oj-vb-fragment-param",\n  "displayName": "Page Fragment Param",\n  "description": "A component used to configure an input param for a oj-vb-fragment component ",\n  "version": "1.0.0",\n  "jetVersion": ">=11.0.0",\n  "properties": {\n    "name": {\n      "type": "string",\n      "description": "Name of the param."\n    },\n    "value": {\n      "type": "any",\n      "description": "Value of the param.",\n      "writeback": true\n    }\n  },\n  "methods": {\n    "valueChangedProxy": {\n      "description" : "A function to update the value property",\n      "params" : [\n        {\n          "description":"name of the property",\n          "name" : "name",\n          "type": "string"\n        },\n        {\n          "description":"value to set for the property",\n          "name" : "value",\n          "type": "any"\n        }\n      ],\n      "return" : "boolean"\n    }\n  }\n}\n'})),define("vb/components/oj-vb-fragment-param/fragmentParamViewModel",["vb/private/log"],(e=>{const t=e.getLogger("/vb/components/oj-vb-fragment-param");return class{constructor(e){this.composite=e.element,this.properties=e.properties,this.parentFragmentId=e.element.parentElement.getAttribute("id"),this.name=e.properties.name,this.log=t}propertyChanged(e){const{previousValue:t,value:i,updatedFrom:r}=e;if("value"===e.property&&"external"===r){const e=document.getElementById(this.getParentFragmentId());e&&e.updateParam(this.name,{value:i})}else"name"===e.property&&t!==i&&this.log.error("changing the name of the param from",t,"to newValue",i,"is not supported!")}valueChangedProxy(e,t){e&&this.properties.setProperty(e,t)}getParentFragmentId(){return this.parentFragmentId||(this.parentFragmentId=(e=>{let t,i=e.parentNode;for(;i;)"OJ-VB-FRAGMENT"===i.nodeName?(t=i.getAttribute("id"),i=null):i=i.parentNode;return t})(this.composite),this.parentFragmentId||this.log.warn("An id was not available on parent fragment component for the fragment param",this.name)),this.parentFragmentId}}})),define("vb/components/oj-vb-fragment-param/loader",["ojs/ojcomposite","text!./component.json","./fragmentParamViewModel"],((e,t,i)=>{e.register("oj-vb-fragment-param",{view:"",viewModel:i,metadata:JSON.parse(t)})})),define("text!vb/components/oj-vb-fragment-slot/component.json",[],(function(){return'{\n  "name": "oj-vb-fragment-slot",\n  "displayName": "Visual Builder Fragment Slot Content",\n  "description": "A component to inject slot content specified on oj-vb-fragment",\n  "version": "23.04.0",\n  "jetVersion": ">=13.0.0",\n  "properties": {\n    "bridge": {\n      "type": "Object",\n      "description": "A factory to create a bridge between CCA and VB"\n    },\n    "context": {\n      "type": "any",\n      "description": "user can set extra context, if the immediate parent is a component that sets up data context."\n    },\n    "name": {\n      "type": "string",\n      "description": "Name of the (cca) slot whose content is being loaded."\n    }\n  }\n}\n'})),define("vb/components/oj-vb-fragment-slot/fragmentSlotViewModel",["knockout","vb/private/log","vb/private/utils","vb/private/constants","ojs/ojhtmlutils"],((e,t,i,r,n)=>{const s=t.getLogger("/vb/components/oj-vb-fragment-slot");return class{constructor(e){this.log=s;const t=e.properties;if(this.composite=e.element,this.name=t.name,!t.name){throw new Error("The fragment-slot 'name' was not provided. This is required in order to identify the slot content. Check the configuration of the oj-vb-fragment-slot component!")}if(!t.bridge){const e=`the 'bridge' property was not configured on the oj-vb-fragment-slot component with${this.name}. For best results it is recommended that the 'bridge' property be set to "[[ vbBridge ]]".`;throw new Error(e)}this.bridge=((e,t)=>e.create(r.ComponentBridgeType.FRAGMENT_SLOT,t))(t.bridge,t),this.context=t.context||{},this.defaultTemplates=this.composite.querySelectorAll("template")}connected(e){this.log.info("oj-vb-fragment-slot component",this.name,"viewModel connected to DOM"),this.bridge.connected(e,this.name)}disconnected(e){this.log.info("oj-vb-fragment-slot",this.name,"disconnected from DOM");const t=e?e.children:void 0;this.bridge.disconnected(t,this.name)}getSlotConfig(){return this.bridge.getSlotConfig(this.name,this.defaultTemplates).then((e=>{const t=e&&e.view||Promise.resolve(),i=e&&e.data||Promise.resolve(),r=e&&e.alias||Promise.resolve();return Promise.all([t,i,r]).then((([t="",i,r=""])=>{const s=n.stringToNodeArray(t);let a;return this.context&&(r&&!this.context[r]&&(this.context[r]=this.context.$current||{}),a=Object.assign({},i,this.context)),Object.assign(e,{view:s,data:a})}))}))}propertyChanged(e){if("name"===e.property){const{previousValue:t,value:i}=e;i!==this.name&&this.log.error("The oj-vb-fragment-slot 'locator' property was changed from",t,"to",i,". The locator cannot be changed dynamically.")}}}})),define("vb/components/oj-vb-fragment-slot/loader",["ojs/ojcomposite","text!./component.json","./fragmentSlotViewModel","ojs/ojbinddom"],((e,t,i)=>{const r=JSON.parse(t);e.register("oj-vb-fragment-slot",{view:'<oj-bind-dom config="[[ getSlotConfig() ]]"></oj-bind-dom>',viewModel:i,metadata:r})})),define("vb/components/oj-vb-fragment/fragmentViewModel",["knockout","vb/private/log","vb/private/utils","vb/private/constants","ojs/ojhtmlutils","../oj-vb-fragment-param/loader","../oj-vb-fragment-slot/loader"],((e,t,i,r,n)=>{const s=t.getLogger("/vb/components/oj-vb-fragment"),a=(e,t)=>e.create(r.ComponentBridgeType.FRAGMENT,t);return class{constructor(t){this.log=s;const n=t.properties;if(this.composite=t.element,this.id=n.id||this.composite.getAttribute("id"),!n.name){throw new Error("A fragment name was not provided. This is required in order to load and render a fragment. Check the configuration of the oj-vb-fragment CCA!")}if(this.name=n.name,this.name=n.name,this.id||(this.id=`frag-${i.generateUniqueId()}`,this.composite.setAttribute("id",this.id),this.log.info("fragment component",this.name,"does not have the 'id' property to be set! A system","generated id will be used instead",this.id)),n.bridge)this.bridge=a(n.bridge,n);else{const t=this.id?`id:'${this.id}';name:'${this.name}'`:`name:'${this.name}'`;this.log.warn("the 'bridge' property was not configured on the oj-vb-fragment component with",t,". For best results it is recommended that the 'bridge' property be set to \"[[ vbBridge ]]\"."),this.dataContext=n.dataContext?n.dataContext:e.contextFor(this.composite).$data,this.bridge=a(this.dataContext[r.componentBridge],n)}this.bridge.addVariableValueChangedListener(this.paramChangedCallback()),this.params={},this.buildParams(),this.gatherSlots()}buildParams(){const e={},t=t=>{const r=t.getProperty("name"),n=t.getProperty("value"),s=t.getAttribute("value"),a=i.cloneObject(n);e[r]={value:a,valueExpr:s},t.setAttribute("data-vb-uid",`${this.id}:${r}`)},r=this.composite.getElementsByTagName("oj-vb-fragment-param")||[];for(let e=0;e<r.length;e+=1)t(r[e]);this.params=e}connected(e){this.log.info("vb-fragment component",this.name,"viewModel connected to DOM"),this.bridge.connected(e,this.id)}disconnected(e){this.log.info("fragment",this.name,"disconnected from DOM");const t=e?e.children:void 0;this.bridge.disconnected(t,this.id)}gatherSlots(){this.templates=this.composite.querySelectorAll("template[slot]")}getModuleConfig(){return this.bridge.getModuleConfig(this.id,this.name,this.params,this.templates).then((t=>{const i=e.utils.unwrapObservable(t),r=i&&i.view||Promise.resolve(),s=i&&i.viewModel||Promise.resolve();return Promise.all([r,s]).then((e=>{const t=n.stringToNodeArray(e[0]);return Object.assign(i,{view:t,viewModel:e[1]})}))}))}propertyChanged(e){if("name"===e.property){const{previousValue:t,value:i}=e;i!==this.name&&this.log.error("The fragment",this.name,"name property was changed from",t,"to",i,". The fragment name on the CCA property cannot be changed dynamically.")}}updateParam(e,t){this.params[e]=i.cloneObject(t),this.bridge.updateParam(this.id,e,this.params[e])}paramChangedCallback(){return(e={},t=this.id)=>{if(e.diff){const{_vb_fragmentId:i,name:r,value:n}=e;if(t===i){const e=`${t}:${r}`,i=document.querySelector(`oj-vb-fragment-param[data-vb-uid="${e}"]`);(i?i.getAttribute("name")===r:null)?i.valueChangedProxy("value",n):this.log.info("Unable to locate fragment param",r,"to set the new value",n,"for fragment",t,". This is likely, because no param was configured!")}}}}}})),define("css!vb/components/oj-vb-fragment/styles",[],(function(){})),define("vb/components/oj-vb-fragment/loader",["ojs/ojcomposite","text!./component.json","./fragmentViewModel","ojs/ojmodule-element","css!./styles.css"],((e,t,i)=>{const r=JSON.parse(t);e.register("oj-vb-fragment",{view:'<oj-module config="[[ getModuleConfig() ]]" animation="[[ $props.animation]]"></oj-module>',viewModel:i,metadata:r})})),define("vb/private/stateManagement/fragmentHolderBaseMixin",["vb/private/constants","vb/components/oj-vb-fragment/loader"],(e=>t=>class extends t{constructor(...t){super(...t),this.fragments={},this.fragmentBridge=null;const i=this.getParentOrBaseOfExtension(),r=!i||"function"!=typeof i.getCapability||i.getCapability(e.FragmentCapability.ALLOWS_SLOTS);this.capabilities={allowSlots:void 0===r||r}}getParentOrBaseOfExtension(){return this.parent}getCapability(t){return t===e.FragmentCapability.ALLOWS_SLOTS?this.capabilities.allowSlots:null}createFragment(e,t,i,r){let n=this.fragments[e];return!n&&t?this.getFragmentClass().then((s=>(n=new s(e,this,void 0,t,i,r),this.fragments[e]=n,n))):Promise.resolve(n)}getFragment(e){return this.fragments[e]}getFragmentClass(){return Promise.resolve(this.constructor.FragmentClass)}disposeFragments(){Object.keys(this.fragments).forEach((e=>{this.fragments[e].dispose()}))}deleteFragment(e){delete this.fragments[e]}checkForDirtyData(){return!!Object.values(this.fragments).find((e=>e.checkForDirtyData()))||super.checkForDirtyData()}resetDirtyData(){Object.values(this.fragments).forEach((e=>{e.resetDirtyData()})),super.resetDirtyData()}})),define("vb/private/stateManagement/fragmentHolderExtensionMixin",["vb/helpers/mixin","vb/private/stateManagement/fragmentHolderBaseMixin","vb/private/constants","vb/private/utils"],((e,t,i,r)=>i=>class extends(e(i).with(t)){getFragmentClass(){return this.loadFragmentModulePromise||(this.loadFragmentModulePromise=r.getResource("vb/private/stateManagement/packageFragmentReferenceable")),this.loadFragmentModulePromise}getParentOrBaseOfExtension(){return this.base}})),define("vb/private/stateManagement/pageExtension",["vb/private/stateManagement/containerExtension","vb/private/stateManagement/context/pageExtensionContext","vb/private/constants","vb/private/utils","vb/helpers/mixin","vb/private/stateManagement/fragmentHolderExtensionMixin"],((e,t,i,r,n,s)=>{class a extends(n(e).with(s)){constructor(e,t,i,r="PageExtension"){super(e,i.getParentFlow().extensions[e.id],t,i,r)}static get extensionClass(){return a}static get resourceSuffix(){return"-page-x.json"}get eventPrefix(){return"page"}disconnected(){this.dispose()}dispose(){this.disposeFragments(),delete this.definition,this.initializePromise=null,this.enterPromise=null,super.dispose()}get fullName(){return`${this.id}-page`}static get descriptorLoaderName(){return"getPageExtensionDescriptor"}static get functionsLoaderName(){return"getPageExtensionFunctions"}get chainsFolderName(){return`${this.id}-page-x-chains`}static get ContextType(){return t}getViewModel(){return Promise.resolve().then((()=>r.getResource("vb/private/stateManagement/pageModuleViewModel"))).then((e=>new e(this)))}getScopeResolverMap(){const e={[i.PAGE_PREFIX]:this};return this.parent?Object.assign(e,this.parent.getScopeResolverMap()):e}}return a})),define("vb/private/monitoring/activateMonitorOptions",["vbc/private/monitorOptions"],(e=>class extends e{constructor(e,t,i){super(e,t),this.addStartFields((()=>({container:i}))),this.addEndFields((()=>({container:i})))}})),define("vb/private/stateManagement/eventBehaviorMixin",["vb/private/constants"],(e=>t=>class extends t{allowsEventPropagation(t,i){switch(t){case e.EventPropagationBehaviors.CONTAINER:return i.propagationBehavior===e.EventPropagationBehaviors.CONTAINER&&i.isDeclared;case e.EventPropagationBehaviors.SELF:default:return!1}}})),define("vb/private/stateManagement/context/fragmentBaseContext",["vb/private/constants","vb/private/stateManagement/context/baseContext"],((e,t)=>{const i=Symbol("fragment-base-accessor");class r extends t{constructor(e){super(e),Object.defineProperty(this,i,{value:{get fragmentContext(){return e.expressionContext}}})}get[e.INFO_CONTEXT](){return this[i].fragmentContext[e.INFO_CONTEXT]}get fragment(){return this}}return r})),define("vb/private/stateManagement/context/fragmentContext",["vb/private/constants","vb/private/stateManagement/context/containerContext","vb/private/stateManagement/context/fragmentBaseContext","vb/helpers/componentFinder"],((e,t,i,r)=>{const n=Symbol("fragment-accessor");class s extends t{constructor(t){super(t);const i={[e.COMPONENTS_CONTEXT]:()=>r};Object.keys(i).forEach((e=>{Object.defineProperty(this,e,{enumerable:!0,configurable:!0,get:i[e]})})),Object.defineProperty(this,n,{value:{get builtins(){return t.scope.variableNamespaces[e.VariableNamespace.BUILTIN]},get fragment(){return t}}})}static get BaseContextType(){return i}get[e.INFO_CONTEXT](){return this[n].builtins[e.INFO_CONTEXT]}static getAvailableContexts(t){const i=super.getAvailableContexts(t);return Object.defineProperties(i,{$fragment:{enumerable:!0,configurable:!0,get:()=>t.expressionContext}}),t.extension&&(t.extension.id!==e.ExtensionFolders.BASE&&delete i.$application,Object.defineProperties(i,{$extension:{enumerable:!0,configurable:!0,value:{get[e.PATH_VARIABLE](){return t.absoluteUrl}}}})),i[e.ContextNameInternal.DISPATCH_EVENT]=e=>{r.byId(t.id).dispatchEvent(e)},i}}return s})),define("vb/private/stateManagement/context/fragmentExtensionContext",["vb/private/stateManagement/context/extensionContext","vb/private/stateManagement/context/fragmentBaseContext","vb/private/constants"],((e,t,i)=>class extends e{static get BaseContextType(){return t}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return delete t.$application,delete t.$metadata,Object.defineProperties(t,{$extension:{enumerable:!0,configurable:!0,value:{get[i.PATH_VARIABLE](){const t=e.absoluteUrl;return t.endsWith(`${i.ExtensionFolders.SELF}/`)?t:`${t}${i.DefaultPaths.UI}${i.ExtensionFolders.SELF}/`}}},$fragment:{enumerable:!0,configurable:!0,get:()=>e.expressionContext}}),t}})),define("vb/private/stateManagement/switcherPageMixin",["ojs/ojrouter","vb/private/stateManagement/page","vb/private/stateManagement/router","vb/private/history","vb/private/constants"],((e,t,i,r,n)=>e=>class extends e{constructor(e,t,i,r){super(e,t,i,r),this.switcher=t.switcher,this.switcherElementId=t.switcherElementId,this._viewCache=null}checkEmbeddable(){if(!this.switcher.getElementData(this.switcherElementId).started){const{navigation:e}=this.definition;if(!e||"enabled"!==e.embeddable)throw new Error(`Page ${this.getNavPath()} is not allowed to be embedded.`)}}navigateOperation(e,t){return Promise.resolve().then((()=>{switch(e.operation){case n.NavigateOperation.FLOW:if("parent"===e.target)return this.log.error("Navigate the parent flow not supported inside a switcher."),{navigated:!1};break;case n.NavigateOperation.APP_UI:return this.log.error("Navigate to application not supported inside a switcher."),{navigated:!1}}return e.history=n.HistoryMode.SKIP,super.navigateOperation(e,t).then((e=>{if(e&&!0===e.navigated){r.pushState();const e=this.switcher.getCurrentElementData();r.setVariable("internal","flowElt",e),r.sync()}return e}))}))}canExit(){return this.switcher.getElementData(this.switcherElementId).toDelete?super.canExit():Promise.resolve(!0)}exit(){return this.switcher.getElementData(this.switcherElementId).toDelete?super.exit():Promise.resolve()}enter(){if(this.scope){const e=this.getParentFlow().getParentModuleConfig();return e&&e().pagePath!==this.fullPath&&e(this.createModuleConfig()),Promise.resolve()}return super.enter()}invokeEventWithBubbling(e,t){return e===n.AFTER_NAVIGATE_EVENT&&this.switcher.updateCurrentPagePath(t.currentPage),super.invokeEventWithBubbling(e,t)}createModuleConfig(){return{viewModel:this.getViewModel(),view:this._viewCache||this.getView(),cleanupMode:"none",pagePath:this.fullPath}}disconnected(e){this.switcher.getElementData(this.switcherElementId).toDelete?(this._viewCache=null,super.disconnected(),this.switcher.delete(this.switcherElementId)):this._viewCache=e}})),define("vb/private/stateManagement/switcherFlowMixin",["knockout","vb/helpers/mixin","vb/private/stateManagement/switcherPageMixin"],((e,t,i)=>e=>class extends e{constructor(e,t,i,r,n){const s=e.split(":"),a=s[1];super(e,i,i.parent.calculateRequirePath(a),n),this._name=a,this._switcherElementId=s[0],this._switcher=t}get switcher(){return this._switcher}get switcherElementId(){return this._switcherElementId}get name(){return this._name}createPage(e,r){return new(t(this.constructor.PageClass).with(i))(e.id,this,r)}getParentModuleConfig(){return this.switcher.moduleConfig}enter(){return this.scope?Promise.resolve():super.enter()}exit(){return this.switcher.getElementData(this.switcherElementId).toDelete?super.exit():Promise.resolve()}})),define("vb/private/stateManagement/componentBridge",[],(()=>class{connected(e,t){}disconnected(e,t){}get moduleConfig(){return null}})),define("vb/private/stateManagement/switcherBridge",["knockout","vb/helpers/mixin","vb/private/stateManagement/switcherFlowMixin","vb/private/stateManagement/componentBridge","vb/private/stateManagement/router","vb/private/stateManagement/navigationContext","vb/private/history","vb/private/utils","vb/private/constants"],((e,t,i,r,n,s,a,o,c)=>class extends r{constructor(t,i){if(super(),t.switcher)throw new Error("Cannot have more than one oj-vb-switcher in a page.");if(this.parent=t,this.parent.switcher=this,this.parent.createFlow=this.createFlow.bind(this),this._allFlows={},this._moduleConfig=e.observable(c.blankModuleConfig),this.props=i,window.addEventListener("popstate",this.handlePopStateEvent.bind(this),!1),this.arrayAdd(i.data.data),this.currentItem){const e=this._allFlows[this.currentItem];e&&this._initialize(e,!0)}}currentItemChanged(e,t,i){return this.itemChanged={id:e,previousId:t},Promise.resolve().then((()=>{let t;if(e&&(t=this._allFlows[e]),t)return this._initialize(t,i)}))}arrayAdd(e){Array.isArray(e)&&e.length>0&&e.forEach((e=>{if(!(o.isObject(e)&&e.id&&e.flow))throw new Error("Switcher element require id and flow properties to be defined.");this._allFlows[e.id]=e}))}arrayRemove(e){if(Array.isArray(e)&&e.length>0){const t=e[0];if(null===this.itemChanged.id&&this.itemChanged.previousId===t.id){const e=this._allFlows[t.id];e.toDelete=!0;const i=Object.keys(this._allFlows),r=i.indexOf(e.id),n=r>0?r-1:r+1;n<i.length&&(this.currentItem=i[n])}}}delete(e){e&&delete this._allFlows[e]}handlePopStateEvent(){const e=a.getVariable("internal","flowElt");this.currentItem!==e.id?this.currentItem=e.id:this._initialize(e,!0)}get currentItem(){return this.props.currentItem}set currentItem(e){this.props.currentItem=e}_initialize(e,t){const i={operation:c.NavigateOperation.FLOW,flow:`${e.id}:${e.flow}`,page:e.page,params:e.params,history:c.HistoryMode.SKIP};return this.parent.navigateOperation(i,new s(this.parent,i)).then((i=>{i&&!0===i.navigated&&(e.started=!0,t||a.pushState(),a.setVariable("internal","flowElt",e),a.sync(),n.clearBusyState())}))}_isActiveFlow(e){return this.currentItem&&e&&e===this.currentItem}createFlow(e,r){return new(t(r.parent.constructor.FlowClass).with(i))(e,this,r)}getElementData(e){return this._allFlows[e]}getCurrentElementData(){return this.getElementData(this.currentItem)}updateCurrentPagePath(e){const t=this.getCurrentElementData(),i=e.substring(e.indexOf(t.flow)+t.flow.length+1);t.page=i}get moduleConfig(){return this._moduleConfig}})),define("vb/private/stateManagement/fragmentBridge",["vb/private/log","signals"],((e,t)=>{const i=e.getLogger("/vb/stateManagement/fragmentBridge"),r=Symbol("fragment-bridge-container");class n{constructor(e){const i=e;Object.defineProperty(this,r,{value:{get container(){return e}}}),i.fragmentBridge=this,this.variableValueChanged=new t.Signal,this.id=`${i.id}-bridge`}static getOrCreateBridge(e,t={}){const i=e.fragmentBridge;return t.type,i||new n(e)}addVariableValueChangedListener(e){return this.variableValueChanged.add(e)}removeVariableValueChangedListener(e){return e?this.variableValueChanged.remove(e):this.variableValueChanged.removeAll}getFragmentSync(e){const t=this[r].container;return"function"==typeof t.getFragment&&t.getFragment(e)}connected(e,t){const r=this.getFragmentSync(t);r?r.componentConnected(e,t):i.finer("fragment",t,"has not been created yet")}disconnected(e,t){this.removeVariableValueChangedListener();const r=this.getFragmentSync(t);r?r.componentDisconnected(e):i.finer("fragment",t,"has already been disconnected from parent container")}getModuleConfig(e,t,i,n){const s=this[r].container;return"function"==typeof s.createFragment?s.createFragment(e,t,i,n).then((e=>e.getModuleConfig())):Promise.reject(new Error(`unable to create fragment ${t}`))}getSlotConfig(e,t){const i=this[r].container;return i?i.getSlotConfig(e,t):Promise.reject(new Error(`unable to load contents of fragment-slot ${e}`))}updateParam(e,t,r){const n=this.getFragmentSync(e);n?n.updateParam(t,r):i.finer("fragment",e,"not found! The parameter",t,"could be not be updated!")}valueChanged(e){this.variableValueChanged.dispatch(e)}}return n})),define("vb/private/stateManagement/bridgeFactory",["vb/private/stateManagement/switcherBridge","vb/private/stateManagement/fragmentBridge"],((e,t)=>class{constructor(i){this.create=(r,n)=>{switch(r){case"switcher":return new e(i,n);case"fragment":return t.getOrCreateBridge(i,n);case"fragment-slot":return t.getOrCreateBridge(i,Object.assign({type:"fragment-slot"},n));default:throw new Error("Missing or invalid bridge type")}}}})),define("vb/private/stateManagement/baseModuleViewModel",["vb/private/constants","vb/private/stateManagement/bridgeFactory"],((e,t)=>class{constructor(i){const r=i;let n=null;const s=this.getPropertyDescriptors(r);s[e.componentBridge]={get:()=>(n||(n=new t(r)),n),enumerable:!0},Object.defineProperties(this,s)}getPropertyDescriptors(e){const t=Object.getOwnPropertyDescriptors(e.getAvailableContexts());return Object.keys(t).forEach((e=>{t[e].enumerable||delete t[e]})),t}})),define("vb/private/stateManagement/fragmentModuleViewModel",["vb/private/constants","vb/private/utils","vb/private/stateManagement/baseModuleViewModel"],((e,t,i)=>{const r=["$container","$fields","$metadataProvider","$value"];return class extends i{constructor(i){super(i);const r=i;this.connected=i=>{if(i&&i.length>0){const e=i[0].parentNode;if(e&&"oj-module"===e.localName){const i=t.vbModuleObserver.getIntersectionObserver();i&&i.observe(e)}}(r.lifecycleState!==e.ContainerState.DISPOSED||r.definition)&&(r.run(),r.fragmentLifecycleState=e.FragmentState.MODULE_CONNECTED)},this.disconnected=()=>{const t=r.parent;t.lifecycleState===e.ContainerState.REFRESHING&&(r.lifecycleState=t.lifecycleState,r.deactivated=!0,r.dispose()),r.fragmentLifecycleState=e.FragmentState.MODULE_DISCONNECTED}}getPropertyDescriptors(e){const t=e,i=super.getPropertyDescriptors(e);return r.forEach((e=>{const r=t.inputParams&&(t.inputParams.dynamicLayoutContext||t.inputParams.$dynamicLayoutContext),n=r&&r.value||{};!i[e]&&n[e]&&(i[e]={enumerable:!0,configurable:!0,get:()=>n[e]})})),i}}})),define("vb/private/stateManagement/fragmentExtension",["vb/private/stateManagement/containerExtension","vb/private/stateManagement/context/fragmentExtensionContext","vb/private/constants","vb/private/utils","vb/helpers/mixin","vb/private/stateManagement/fragmentHolderExtensionMixin","vb/private/stateManagement/eventBehaviorMixin","vb/private/stateManagement/fragmentModuleViewModel","vb/private/events/eventMonitorOptions","vb/private/log","vbc/private/logConfig"],((e,t,i,r,n,s,a,o,c,l,h)=>{const p=l.getLogger("/vb/stateManagement/fragmentExtension",[{name:"coralInfo",severity:"info",style:"coral"},{name:"beforeHandleEvent",severity:i.Severity.INFO,style:h.FancyStyleByFeature.containerStart},{name:"afterHandleEvent",severity:i.Severity.INFO,style:h.FancyStyleByFeature.containerEnd}]);class u extends(n(e).with(s,a)){constructor(e,t,i,r="FragmentExtension"){super(e,null,t,i,r),this.inputParams=i.inputParams}static get extensionClass(){return u}static get resourceSuffix(){return"-fragment-x.json"}get eventPrefix(){return"fragment"}static get descriptorLoaderName(){return"getFragmentExtensionDescriptor"}static get functionsLoaderName(){return"getFragmentExtensionFunctions"}get fullName(){return`${this.id}-fragment`}static get ContextType(){return t}get resourceName(){return this.base.resourceName}addValueChangedListeners(e,t,r){const n=e.descriptor;n&&n[i.VariableProperties.WRITEBACK]&&n[i.VariableProperties.INPUT]===i.VariablePropertyInput.FROM_CALLER&&this.handleValueChangedListenerForWritable(e,t,r),super.addValueChangedListeners(e,t,r)}handleValueChangedListenerForWritable(e,t,r){e.onValueChanged||this.log.warn(e.name,"does not have a live expression so its onValueChanged listener is ignored");const n={eventSource:e.onValueChanged,eventListener:e=>{const t=e||{};r.clone()[i.ContextName.EVENT]=e;const n=e.type;p.beforeHandleEvent(this.className,this.id,"handling variable event",n,"with payload:",e);const s=new c(c.SPAN_NAMES.EVENT_VARIABLE,n,e,this);return this.log.monitor(s,(e=>{const i=this.parent.fragmentBridge;try{i.valueChanged(Object.assign({},t,{_vb_fragmentId:this.id})),p.afterHandleEvent(this.className,this.id,"handled variable event",n,"successfully",e())}catch(t){p.afterHandleEvent("Failed to handle variable event",n,e(t)),this.log.error(t)}}))}};e.onValueChanged.add(n.eventListener,this),this.variablesListeners.push(n)}getViewModel(){return Promise.resolve().then((()=>new o(this)))}getScopeResolverMap(){return{[i.FRAGMENT_PREFIX]:this}}getLeafContainer(){return this.base}validateNavigation(e){return this.base.validateNavigation(e)}dispose(){Object.keys(this.fragments).forEach((e=>{this.fragments[e].dispose()})),delete this.definition,super.dispose()}}return u})),define("vb/private/stateManagement/fragment",["knockout","vb/private/stateManagement/container","vb/helpers/mixin","vb/private/stateManagement/fragmentHolderBaseMixin","vb/private/stateManagement/eventBehaviorMixin","vb/private/stateManagement/context/fragmentContext","vb/private/stateManagement/fragmentExtension","vb/private/stateManagement/fragmentModuleViewModel","vb/private/log","vbc/private/logConfig","vb/private/monitoring/loadMonitorOptions","vb/private/monitoring/activateMonitorOptions","vb/private/utils","vb/private/constants","vb/private/stateManagement/stateMonitor","vb/private/events/eventMonitorOptions"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v)=>{const f=c.getLogger("/vb/stateManagement/fragment",[{name:"coralInfo",severity:"info",style:"coral"},{name:"beforeHandleEvent",severity:d.Severity.INFO,style:l.FancyStyleByFeature.containerStart},{name:"afterHandleEvent",severity:d.Severity.INFO,style:l.FancyStyleByFeature.containerEnd}]);class m extends(i(t).with(r,n)){constructor(t,i,r="Fragment",n,a,o){super(t,i,r),this.log=f,this.fragmentName=n,this.inputParams=a,this.templates=o,this.viewTemplateByLocator={},this.viewTemplateDataAliasByLocator={};Object.defineProperties(this,{path:{get(){return`fragments/${this.resourceName}/`},enumerable:!0}}),this.moduleConfig=e.observable(d.blankModuleConfig),this.expressionContext=new s(this),this.inBeforeEvent=!1,this.fragmentLifecycleState=void 0,this.loadAndStartPromise=null,this.loadFragmentPromise=null,this.initializePromise=null,this.viewModelPromise=null}defineInfoBuiltinVariable(){return{id:this.id,title:this.definition.title,description:this.definition.description}}static get ContextType(){return s}static get extensionClass(){return a}static get FragmentClass(){return m}get fullName(){return`${this.resourceName}-fragment`}get resourceName(){return this.fragmentName}canFireEvent(e){return!(e&&!e.isDeclared)&&super.canFireEvent(e)}buildAllParameters(){const e={};return this.buildParameters("variables",e),this.buildParameters("constants",e),e}buildParameters(e,t){const i=t,r=this.definition[e];Object.keys(r).forEach((t=>{i[t]&&this.log.warn(`Input parameter ${t} is already defined. Using the definition in ${e}.`);const n=r[t],s=this.getInputParameterValue(t,n);i[t]=s,this.log.info(`Input parameter ${t}[input='${n.input}'] value:`,s)}))}createModuleConfig(){return{viewModel:this.getViewModel(),params:this.fullPath,view:this.getView()}}checkFragmentAccess(e){return!0}componentConnected(){this.fragmentLifecycleState=d.FragmentState.COMPONENT_CONNECTED}componentDisconnected(e){if(e&&e.length>0){const t=e[0];if(t&&"oj-module"===t.localName){const e=u.vbModuleObserver.getIntersectionObserver();e&&e.unobserve(t)}}this.fragmentLifecycleState=d.FragmentState.COMPONENT_DISCONNECTED}invokeEvent(e,t,i,r){const n=[];return e===d.EXIT_EVENT?(Object.keys(this.fragments).forEach((t=>{const i=this.fragments[t];n.push(i.invokeEvent(e))})),Promise.all(n).then((()=>super.invokeEvent(e)))):super.invokeEvent(e,t,i,r)}deleteFragment(e){delete this.fragments[e]}static get descriptorLoaderName(){return"getFragmentDescriptor"}dispose(){Object.keys(this.fragments).forEach((e=>{this.fragments[e].dispose()})),this.parent.deleteFragment(this.id),delete this.definition,this.lifecycleState=d.ContainerState.DISPOSED,this.initializePromise=null,this.enterPromise=null,this.viewModelPromise=null,super.dispose()}enter(){this.getInitializePromise();const e=this.createModuleConfig();return this.moduleConfig(e),this.moduleConfig}static get functionsLoaderName(){return"getFragmentFunctions"}getEventDispatcher(){return this.availableContexts[d.ContextNameInternal.DISPATCH_EVENT]}getInitializePromise(){return this.initializePromise=this.initializePromise||this.loadAndStart().then((e=>{if(e)return this.initializeScopeAndContextVariables().then((()=>this));this.log.info("vbBeforeEnter event listener has canceled entering the fragment",this.resourceName,"with id",this.id)})),this.initializePromise}getInputParameterFromCallerValue(e,t){let i=super.getInputParameterFromCallerValue(e);if(void 0===i){const r=this.inputParams;i=r&&r[e]&&r[e].value,t.required&&void 0===i&&(u.isInstanceType(t.type)?this.log.error("A required value was not provided for fragment variable",e,"! A value must"," be provided for variables that require a reference."):this.log.error("A required value was not provided for fragment variable",e,". A value will be","attempted to be initialized from other sources such as History, persistence store, configuration."))}return i}getLeafContainer(){return this}getSlotConfig(e,t){return Promise.resolve().then((()=>{const i=this.getSlotViewLocator(e,t),r=i===`--vb-reserved-slot-default--:${e}`;return{view:this.viewTemplateByLocator[i],data:this.getSlotViewModel(r),alias:this.viewTemplateDataAliasByLocator[i]}}))}getSlotViewLocator(e,t){if(this.getCapability(d.FragmentCapability.ALLOWS_SLOTS)&&!this.viewTemplateByLocator[e]&&this.templates&&this.templates.length>0){const t=[...this.templates].find((t=>t.getAttribute("slot")===e));if(t){const i=t&&t.innerHTML||"";i||this.log.info("Unable to locate the fragment slot content for the slot:",e,". Please check your fragment configuration!"),this.viewTemplateByLocator[e]=i,this.viewTemplateDataAliasByLocator[e]=t.getAttribute("data-oj-as")||""}}return this.viewTemplateByLocator[e]?e:this.getDefaultSlotViewLocator(e,t)||""}getDefaultSlotViewLocator(e,t){const i=`--vb-reserved-slot-default--:${e}`;if(!this.viewTemplateByLocator[i]){const r=t&&t[0];let n=r&&r.innerHTML;n||(n="",this.log.warn("Unable to locate a default slot content for the slot:",e,". It is recommended to have a default view content. Please check your fragment configuration!")),this.viewTemplateByLocator[i]=n,this.viewTemplateDataAliasByLocator[i]=r&&r.getAttribute("data-oj-as")}return i}getSlotViewModel(e=!1){let t;if(e)return this.getViewModel();if(!this.parent)throw t=`unable to locate the parent containerfor the current fragment ${this.name} to create a view model for the fragment slot`,new Error(t);if(!0===this.getCapability(d.FragmentCapability.ALLOWS_SLOTS))return this.parent.getViewModel();throw t=`use of slots in the container for the current fragment' ${this.name} is not supported. Please check your configuration.`,new Error(t)}getModuleConfig(){return this.enter()}getScopeResolverMap(){return{[d.FRAGMENT_PREFIX]:this,[d.GLOBAL_PREFIX]:this.application,[d.APPLICATION_PREFIX]:this.application}}getView(){return this.loadFragment().then((e=>e[1]))}getViewModel(){return this.viewModelPromise||(this.viewModelPromise=this.getInitializePromise().then((()=>new o(this)))),this.viewModelPromise}addValueChangedListeners(e,t,i){const r=e.descriptor;r&&r[d.VariableProperties.WRITEBACK]&&r[d.VariableProperties.INPUT]===d.VariablePropertyInput.FROM_CALLER&&this.handleValueChangedListenerForWritable(e,t,i),super.addValueChangedListeners(e,t,i)}getVariableDescriptor(e,t){const i=super.getVariableDescriptor(e,t);return Object.assign({writeback:e[d.VariableProperties.WRITEBACK]},i,t)}handleValueChangedListenerForWritable(e,t,i){e.onValueChanged||this.log.warn(e.name,"does not have a live expression so its onValueChanged listener is ignored");const r={eventSource:e.onValueChanged,eventListener:e=>{const t=e||{};i.clone()[d.ContextName.EVENT]=e;const r=e.type;f.beforeHandleEvent(this.className,this.id,"handling variable event",r,"with payload:",e);const n=new v(v.SPAN_NAMES.EVENT_VARIABLE,r,e,this);return this.log.monitor(n,(e=>{const i=this.parent.fragmentBridge;try{i.valueChanged(Object.assign({},t,{_vb_fragmentId:this.id})),f.afterHandleEvent(this.className,this.id,"handled variable event",r,"successfully",e())}catch(t){f.afterHandleEvent("Failed to handle variable event",r,e(t)),this.log.error(t)}}))}};e.onValueChanged.add(r.eventListener,this),this.variablesListeners.push(r)}initializeScopeAndContextVariables(){const e=`[${this.id}: ${this.resourceName}]`;return this.loadFragment().then((()=>{const t=new p(this.activateSpanName,`fragment activate ${e}`,this);return this.log.monitor(t,(t=>this.initAllVariableNamespace().then((()=>{this.log.coralInfo("Fragment",e,"of parent",this.parent.id,"ACTIVATED.",t())})).catch((i=>{const r=i&&i.message||"Unknown error";throw this.log.coralInfo("Fragment",e,"of parent",this.parent.id,"failed to activate because of error: ",r,t(i)),this.dispose(),i}))))}))}invokeBeforeEvent(e){return this.invokeEvent(e).then((t=>{if(Array.isArray(t))for(let i=0;i<t.length;i+=1){const{result:r}=t[i];if(r&&!0===r.cancelled)return this.log.info("Loading of fragment",this.fullPath,"was cancelled by",e),!1}return!0}))}loadAndStart(){const e=`[${this.id}: ${this.resourceName}]`;return!0===this.inBeforeEvent?(this.log.warn("Attempt to load a new fragment",this.resourceName,"when a fragment is already being loaded."),Promise.resolve(this)):(this.loadAndStartPromise=this.loadAndStartPromise||Promise.resolve().then((()=>{const t=new h(this.loadSpanName,`fragment load ${e}`,this);return this.log.monitor(t,(t=>this.loadFragment().then((i=>{if(!this.checkFragmentAccess(i[0]))throw new Error(`Fragment ${this.resourceName} does not allow other extensions to reference it. The\n                fragment configuration must explicitly allow access for use by another extension.`);return this.inBeforeEvent=!0,this.invokeBeforeEvent(d.BEFORE_ENTER_EVENT).then((i=>{let r="LOADED.",n=this;return!1===i&&(r="CANCELED.",n=void 0),this.log.coralInfo("Fragment",e,"of parent",this.parent.id,r,t()),n})).finally((()=>{this.inBeforeEvent=!1}))})).catch((i=>{const r=i&&i.message||"Unknown error";throw this.log.coralInfo("Fragment",e,"of parent",this.parent.id,"failed to load because of error: ",r,t(i)),this.dispose(),i})).then((e=>(e||this.dispose(),e)))))})),this.loadAndStartPromise)}loadFragment(){return this.loadFragmentPromise=this.loadFragmentPromise||Promise.all([this.loadDescriptor().catch((e=>e)),this.loadTemplate()]).then((e=>{if(e[0]instanceof Error){const e=`[${this.id}: ${this.resourceName}]`;throw new Error(`unable to load the descriptor for fragment ${e}`)}return this.getAvailableContexts(),this.initializeEvents(),this.initializeActionChains(),e})).then((e=>this.loadFunctionModule().then((()=>e)))),this.loadFragmentPromise}run(){return this.getInitializePromise().then((()=>this.lifecycleState!==d.ContainerState.ENTERED&&this.fragmentLifecycleState===d.FragmentState.MODULE_CONNECTED?(this.lifecycleState=d.ContainerState.ENTERED,this.invokeEvent(d.ENTER_EVENT)):Promise.resolve())).then((()=>{g.recordStateChange(g.RuntimeState.FRAGMENT_ACTIVATED,this)}))}static get templateLoaderName(){return"getFragmentTemplate"}updateParam(e,t){if(this.inputParams[e]=t,this.scope){const i=this.scope.getVariable(e);i&&(this.log.info("input param updating fragment variable",i.name,"with value",t.value),this.scope.variables[e]=t.value)}else this.log.finer("unable to update fragment variable with value",t.value,"as the fragment scope","has not been created yet")}validateNavigation(e){if(e.operation!==d.NavigateOperation.APP_UI)throw new Error("The 'application' property is required but not set!");this.application.appUiInfos.validateNavigation(e)}}return m})),define("vb/private/stateManagement/page",["knockout","vb/private/stateManagement/container","vb/private/stateManagement/router","vb/private/stateManagement/stateUtils","vb/private/utils","vb/private/log","vb/private/constants","vb/private/stateManagement/stateMonitor","vb/private/stateManagement/context/pageContext","vb/private/stateManagement/pageExtension","vb/private/history","vb/errors/httpError","vbc/private/performance/performance","vb/private/monitoring/loadMonitorOptions","vb/private/monitoring/activateMonitorOptions","vb/helpers/mixin","vb/private/stateManagement/fragmentHolderBaseMixin","vb/private/stateManagement/fragment"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v,f,m)=>{const b=s.getLogger("/vb/stateManagement/page",[{name:"greenInfo",severity:"info",style:"green"}]);class y extends(v(t).with(f)){constructor(t,i,r=i.path,n="Page"){super(t,i,n),Object.defineProperties(this,{path:{value:`${r}pages/`,enumerable:!0}}),this.moduleConfig=e.observable(a.blankModuleConfig),this.loadPagePromise=null,this.loadAndStartPromise=null,this.initializePromise=null,this.enterPromise=null,this.viewModelPromise=null,this.inBeforeEvent=!1,this.deactivated=!1,this._switcher=null,this.log=b}static get extensionClass(){return l}static get FragmentClass(){return m}static get layoutRoot(){return a.DefaultPaths.LAYOUTS}get fullName(){return`${this.id}-page`}static get descriptorLoaderName(){return"getPageDescriptor"}static get functionsLoaderName(){return"getPageFunctions"}static get templateLoaderName(){return"getPageTemplate"}get chainsFolderName(){return`${this.fullName}-chains`}getParentFlow(){return this.parent}isDefault(){return this.parent.defaultPage.id===this.id}getServices(){return this.parent.getServices()}createFlow(e,t){return this.parent.createFlow(e,t)}loadContainer(e,t){return t&&t.isCancelled()?Promise.resolve():this.loadFlowFromId(e,t)}getContainer(e){return this.flows[e]}loadFirstPathSegment(e,t){const{operation:i}=t.options;return i===a.NavigateOperation.PAGE_OLD?this.loadContainer(e,t).catch((i=>{if(p.isFileNotFound(i))return this.parent.loadContainer(e,t).then((t=>(this.log.warn(`Invalid navigation to page "${e}".`,"Using navigateToPage action is deprecated.","Use the navigate action with the 'page' parameter."),t)));throw i})):this.parent.loadContainer(e,t)}invokeBeforeEvent(e){return this.invokeEvent(e).then((t=>{if(Array.isArray(t))for(let i=0;i<t.length;i+=1){const{result:r}=t[i];if(r&&!0===r.cancelled)return this.log.info("Navigation to page",this.fullPath,"was cancelled by",e),h.restoreStateBeforeHistoryPop().then((()=>!1))}return!0}))}buildParameters(e,t){const i=t,r=this.definition[e];Object.keys(r).forEach((t=>{i[t]&&this.log.warn(`Input parameter ${t} is already defined. Using the definition in ${e}.`);const n=r[t],s=this.getInputParameterValue(t,n);i[t]=s,this.log.info(`Input parameter ${t}[input='${n.input}'] value:`,s)}))}buildAllParameters(){const e={};return this.buildParameters("variables",e),this.buildParameters("constants",e),e}buildErrorPage(e){const t=document.createElement("div"),i=document.createElement("h1");i.textContent=n.formatLoadError(e),t.appendChild(i);const r=document.createElement("p");return r.textContent=`while loading page "${this.fullPath}".`,t.appendChild(r),t.outerHTML}loadPage(e){return this.loadPagePromise=this.loadPagePromise||Promise.all([this.loadTemplate(),this.loadDescriptor()]).catch((t=>{if(this.callSecurityProvider(t),!this.application.started||e&&e.options&&e.options.operation===a.NavigateOperation.PAGE_OLD)return this.expressionContext=new this.constructor.ContextType(this),this.initDefault(a.errorPageDescriptor),[this.buildErrorPage(t),this.definition];throw t})),this.loadPagePromise}hideFromUrl(){return this.parent.isPageHiddenFromUrl(this.id)}load(e){return this.loadPage(e).then((()=>{const t=this.definition;return this.hideFromUrl()||(this.initRouter(),this.router.defaultStateId=t.routerFlow,e||i.sync()),this.getAvailableContexts(),this.initializeEvents(),this.initializeActionChains(),t})).then((e=>Promise.all([this.loadFunctionModule(),this.preloadChains()]).then((()=>e))))}preloadChains(){return Promise.resolve().then((()=>{if("shell"===this.id)return super.preloadChains()}))}loadAndStart(e){return!0===this.inBeforeEvent?(this.log.warn("Recursive navigation to page",this.id,"detected."),Promise.resolve(this)):(this.loadAndStartPromise=this.loadAndStartPromise||Promise.resolve().then((()=>{const t=new d(d.SPAN_NAMES.LOAD_PAGE,`page load ${this.id}`,this);return this.log.monitor(t,(t=>this.load(e).then((()=>{if(!e||!e.isCancelled())return this.inBeforeEvent=!0,this.invokeBeforeEvent(a.BEFORE_ENTER_EVENT).then((i=>{let r="loaded.",n=this;return(!1===i||e&&e.isCancelled())&&(r="CANCELLED.",n=void 0),this.log.greenInfo(this.getResourcePath(),r,t()),n})).finally((()=>{this.inBeforeEvent=!1}))})).catch((e=>{throw t(e),this.dispose(),e})).then((e=>(e||this.dispose(),e)))))})),this.loadAndStartPromise)}static get ContextType(){return c}initializePageScopeAndContextVariables(){return this.loadPage().then((()=>{const e=new g(g.SPAN_NAMES.ACTIVATE_PAGE,`page activate ${this.id}`,this);return this.log.monitor(e,(e=>this.initAllVariableNamespace().then((()=>{this.log.greenInfo("Page",this.id,"of flow",this.parent.id,"ACTIVATED.",e())})).catch((t=>{const i=t&&t.message||"Unknown error";throw this.log.greenInfo("Page",this.id,"of flow",this.parent.id,"failed to activate because of error: ",i,e(t)),this.dispose(),t}))))}))}initializeBuiltins(){super.initializeBuiltins(),this.scope.createVariable(a.CURRENT_FLOW_VARIABLE,a.VariableNamespace.BUILTIN,"string",null,void 0,{writable:!1})}defineInfoBuiltinVariable(){return{id:this.id,title:this.definition.title,description:this.definition.description}}getInitializePromise(){return this.initializePromise=this.initializePromise||this.loadFunctionModule().then((()=>this.initializePageScopeAndContextVariables())),this.initializePromise}enter(){this.application.started=!0,this.getInitializePromise();const e=this.getParentFlow().getParentModuleConfig();e&&e().pagePath!==this.fullPath&&e(this.createModuleConfig()),this.lifecycleState=a.ContainerState.ENTERED}canExit(){return this.invokeBeforeEvent(a.BEFORE_EXIT_EVENT).then((e=>(e||i.clearBusyState(),e))).catch((e=>{throw i.clearBusyState(),e}))}exit(){return this.invokeEvent(a.EXIT_EVENT).then((()=>{this.lifecycleState=a.ContainerState.EXITED,this.application.previousPagePath=this.getNavPath()}))}invokeEvent(e,t,i,r){const n=[];return e===a.EXIT_EVENT?(Object.keys(this.fragments).forEach((t=>{const i=this.fragments[t];n.push(i.invokeEvent(e))})),Promise.all(n).then((()=>super.invokeEvent(e)))):super.invokeEvent(e,t,i,r)}run(e){return this.getInitializePromise().then((()=>{const t=this.isLeafPage();let r;return t&&i.updateState(this.fullPath),this.parent.updateCurrentPageVariable(this.id),r=t?h.sync():Promise.resolve(),this.application.currentPageParams=n.cloneObject(h.getInputParameters()),this.enterPromise=r.then((()=>this.invokeEvent(a.ENTER_EVENT))).then((()=>this.invokePwaEvents())).then((()=>{n.isMobile()&&this.invokePauseResumeEvent(this.application.pauseResumeEvent)})).then((()=>{o.recordStateChange(o.RuntimeState.CONTAINER_ACTIVATED,this)})).then((()=>{if(t){i.clearBusyState();const e=window.vb.perf;e&&(e.logVB(),u.clear())}})),e?this.enterPromise:r}))}isLeafPage(){const e=i.getCurrentPage();return e&&e.fullPath===this.fullPath}invokeAfterNavigateEvent(e){const t=Object.assign({previousPage:this.application.previousPagePath,previousPageParams:this.application.currentPageParams,currentPage:this.getNavPath(),currentPageParams:n.cloneObject(h.getInputParameters())},e);return this.invokeEventWithBubbling(a.AFTER_NAVIGATE_EVENT,t)}invokeAppInstallPromptEvent(e){return e?Promise.resolve().then((()=>{const t={getInstallPromptEvent:()=>e};return this.invokeEventWithBubbling(a.INSTALL_PROMPT_EVENT,t)})).then((()=>(delete this.application.beforeInstallPromptEvent,null))):Promise.resolve()}invokeNewContentAvailable(e){return e?(delete this.application.newContentAvailableEvent,this.invokeEventWithBubbling(a.NEW_CONTENT_AVAILABLE,e)):Promise.resolve()}invokePwaEvents(){return this.invokeAppInstallPromptEvent(this.application.beforeInstallPromptEvent).then((()=>this.invokeNewContentAvailable(n.cloneObject(this.application.newContentAvailableEvent))))}invokePauseResumeEvent(e){if(e){let t;switch(e.type){case"resume":t=a.RESUME_EVENT;break;case"pause":t=a.PAUSE_EVENT;break;default:return Promise.resolve()}return this.invokeEventWithBubbling(t,e).then((()=>{delete this.application.pauseResumeEvent}))}return Promise.resolve()}buildTitle(e){let t=this.expressionContext[a.INFO_CONTEXT].title;return t?e&&(t=`${e} - ${t}`):t=e,this.parent.buildTitle(t)}getScopeResolverMap(){return Object.assign({[a.PAGE_PREFIX]:this},this.parent.getScopeResolverMap())}createModuleConfig(){return{viewModel:this.getViewModel(),view:this.getView(),pagePath:this.fullPath}}resetParentModuleConfig(){const e=this.getParentFlow().getParentModuleConfig();e&&e().pagePath===this.fullPath&&(e().pagePath=null)}getViewModel(){return this.viewModelPromise||(this.viewModelPromise=this.run(!1).then((()=>n.getResource("vb/private/stateManagement/pageModuleViewModel"))).then((e=>new e(this)))),this.viewModelPromise}getView(){return this.loadPage().then((e=>e[0]))}disconnected(){o.recordStateChange(o.RuntimeState.PAGE_DEACTIVATED),o.recordStateChange(o.RuntimeState.CONTAINER_DEACTIVATED,this),this.deactivated=!0,this.dispose()}get switcher(){return this._switcher}set switcher(e){this._switcher=e}dispose(){this.lifecycleState!==a.ContainerState.REFRESHING?(this.deactivated||o.recordStateChange(o.RuntimeState.PAGE_DEACTIVATED),this.resetParentModuleConfig(),Object.keys(this.fragments).forEach((e=>{this.fragments[e].dispose()})),Object.keys(this.flows).forEach((e=>{this.flows[e].dispose()})),this.moduleConfig(a.blankModuleConfig),this.router&&this.router.dispose(),this.parent.deletePage(this.id),delete this.definition,this.initializePromise=null,this.enterPromise=null,this.viewModelPromise=null,super.dispose()):this.lifecycleState=a.ContainerState.ENTERED}}return y})),define("vb/private/stateManagement/pageInExtension",["vb/private/stateManagement/page","vb/private/constants"],((e,t)=>class extends e{constructor(e,t,i,r="PageInExtension"){super(e.id,t,i,r),this._extension=e.extension}get resourceLoc(){return`${t.DefaultPaths.UI}${t.ExtensionFolders.SELF}/${this.path}`}get eventPrefix(){return"page"}checkResourceExist(e){this.extension.fileExists(`${this.resourceLoc}${this.fullName}.${e}`)}descriptorLoader(e){return this.extension.init().then((()=>(this.checkResourceExist("json"),super.descriptorLoader(e))))}functionsLoader(e){return this.extension.init().then((()=>(this.checkResourceExist("js"),super.functionsLoader(e))))}templateLoader(e){return this.extension.init().then((()=>(this.checkResourceExist("html"),super.templateLoader(e))))}})),define("vb/private/stateManagement/context/flowBaseContext",["vb/private/stateManagement/context/baseContext"],(e=>class extends e{get flow(){return this}})),define("vb/private/stateManagement/context/flowContext",["vb/private/constants","vb/private/stateManagement/context/containerContext","vb/private/stateManagement/context/flowBaseContext"],((e,t,i)=>{const r=Symbol("flow-accessor");class n extends t{constructor(t){super(t),Object.defineProperty(this,r,{value:{get builtins(){return t.scope.variableNamespaces[e.VariableNamespace.BUILTIN]}}})}static get BaseContextType(){return i}get[e.PATH_VARIABLE](){return this[r].builtins[e.PATH_VARIABLE]}get[e.CURRENT_PAGE_VARIABLE](){return this[r].builtins[e.CURRENT_PAGE_VARIABLE]}get[e.INFO_CONTEXT](){return this[r].builtins[e.INFO_CONTEXT]}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return Object.defineProperties(t,{$flow:{enumerable:!0,configurable:!0,get:()=>e.expressionContext}}),t}}return n})),define("vb/private/stateManagement/context/flowExtensionContext",["vb/private/stateManagement/context/extensionContext","vb/private/stateManagement/context/flowBaseContext"],((e,t)=>class extends e{static get BaseContextType(){return t}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return Object.defineProperties(t,{$flow:{enumerable:!0,configurable:!0,get:()=>e.expressionContext}}),t}})),define("vb/private/stateManagement/flowExtension",["vb/private/stateManagement/containerExtension","vb/private/stateManagement/context/flowExtensionContext","vb/private/constants"],((e,t,i)=>{class r extends e{constructor(e,t,i,r="FlowExtension"){super(e,null,t,i,r),this.services=null}static get extensionClass(){return r}static get resourceSuffix(){return"-flow-x.json"}get eventPrefix(){return"flow"}static get descriptorLoaderName(){return"getFlowExtensionDescriptor"}static get functionsLoaderName(){return"getFlowExtensionFunctions"}static get ContextType(){return t}getScopeResolverMap(){const e={[i.FLOW_PREFIX]:this,[i.GLOBAL_PREFIX]:this.base.getParentFlow().extensions[this.extensionId]};return this.package?e[i.APP_UI_PREFIX]=this.package:e[i.APPLICATION_PREFIX]=e[i.GLOBAL_PREFIX],e}}return r})),define("vb/private/services/serviceProvider",[],(()=>class{constructor(e,t,i){this.serviceName=e,this.servicePath=t,this.definition=i}getServiceName(){return this.serviceName}getServiceFilePath(){return this.servicePath}getDefinition(){return this.definition}})),define("vb/private/services/trapData",["urijs/URI","vb/private/configuration","vb/private/utils"],((e,t,i)=>{const r=["VB_SERVER","CONTEXT_ROOT","APP_URL_PREFIX","APP_ID","APP_VERSION"],n="{service_name}",s="{extension_id}",a="{extension_ver}",o="rwdinfraapp",c=(e,t,r=window.vbInitConfig||{})=>{const n=i.getTemplateParameterNames(e),s={};s.oraSaasTrapServiceName=o,n.forEach((e=>{const t=r[e];t&&(s[e]=t)}));return i.servicesGlobalVariableSupplier().forEach((e=>{const[t,i]=e;s[t]=i})),((e,t,i,r)=>t.reduce(((e,t)=>{let n=i[t];return"APP_VERSION"===t&&n&&r&&(n=`${n};profile=${encodeURIComponent(r)}`),e.replace(`{${t}}`,n||"")}),e))(e,n,s,t)},l=Symbol("trapInfo");class h{static getFallbackBaseUrlForProxy(e={},r=null){let n=t.applicationUrl||"";const s=["APP_ID","APP_VERSION"].reduce(((t,i)=>`${t}${e[i]}${e[i]?"/":""}`),""),a=n.indexOf(s);if(a>=0&&(n=n.substring(0,a+s.length)),r&&e.APP_VERSION){const t=e.APP_VERSION.length,i=n.lastIndexOf(e.APP_VERSION);i>=0&&(n=`${n.substring(0,i)}${e.APP_VERSION};profile=${encodeURIComponent(r)}${n.substring(i+t)}`)}return n=i.cleanUpExtraSlashes(n),n}static getBaseUrlForProxyImpl(e={},t=null){let n=r.reduce(((r,n)=>{let s=e[n];return"APP_VERSION"===n&&t&&(s=`${s};profile=${encodeURIComponent(t)}`),`${r}${i.addTrailingSlash(s)}`}),"");return n&&"/////"!==n?(n.startsWith("/")&&(n=n.substring(1)),i.cleanUpExtraSlashes(n)):h.getFallbackBaseUrlForProxy(e,t)}static _shouldUseTrapServiceImpl(e){return(e.TRAP_SERVICE||{}).ENABLED}static _getTrapServiceScopeImpl(e){const t=e.TRAP_SERVICE||{};return t.TRAP_SERVICE_SCOPE?c(t.TRAP_SERVICE_SCOPE):c("urn:opc:resource:fusion:{oraPodName}:{rwdinfraapp}/")}static _getTrapServiceUrlPatternImpl(r,n,s){const a=s.TRAP_SERVICE||{},o=n?a.TOKEN_RELAY_URL:a.PROXY_URL;if(o){const e=c(o,r,s);return i.cleanUpExtraSlashes(e)}let l,p,u=!1;if(i.isHostApplication(s)){const t=c("{oraSaasApp}/api/{oraSaasTrapServiceName}",r,s),i=e.parse(t);"http"!==i.protocol&&"https"!==i.protocol||(l=t,u=!0)}return l||(l=c("{VB_SERVER}/{CONTEXT_ROOT}/{APP_URL_PREFIX}/{APP_ID}/{APP_VERSION}",r,s)),l&&"////"!==l?(l.startsWith("/")&&(l=l.substring(1)),l=i.cleanUpExtraSlashes(l)):(l=h.getFallbackBaseUrlForProxy(s,r),l=l||t.applicationUrl,l=i.cleanUpExtraSlashes(l)),p=u?n?"trap/2/module/{extension_id}/{extension_ver}/service/{service_name}/token":"trap/2/module/{extension_id}/{extension_ver}/service/{service_name}/proxy/":n?"services/trap/2/service/{service_name}/token":"services/trap/2/service/{service_name}/proxy/",`${l}/${p}`}constructor(e={}){this._vbInitConfig=e}shouldUseTrapService(){return void 0===this._shouldUseTrapService&&(this._shouldUseTrapService=h._shouldUseTrapServiceImpl(this._vbInitConfig)),this._shouldUseTrapService}getTrapServiceScope(){return void 0===this._trapServiceScope&&(this._trapServiceScope=h._getTrapServiceScopeImpl(this._vbInitConfig)),this._trapServiceScope}_getTrapServiceUrlPattern(e,t=!1){const i=this._trapData||(this._trapData={}),r=t?"tokenRelayUrl":"proxyUrl",n=i[r]||(i[r]={});return n[e||""]||(n[e||""]=h._getTrapServiceUrlPatternImpl(e,t,this._vbInitConfig)),n[e||""]}_getTrapUrlPattern({activeProfile:e},t=!1){if(this.shouldUseTrapService())return this._getTrapServiceUrlPattern(e,t);const i=h.getBaseUrlForProxyImpl(this._vbInitConfig,e);return t?`${i}/services/auth/1.1/tokenrelay/{service_name}`:`${i}/services/auth/1.1/proxy/{service_name}/uri/`}_getTrapUrl(e,t=!1){const{serviceName:i,extensionId:r="base",extensionVersion:o="1.0"}=e;return this._getTrapUrlPattern(e,t).replace(n,i).replace(s,r).replace(a,o)}getTokenRelayUrl(e){return this._getTrapUrl(e,!0)}getProxyUrl(e){return this._getTrapUrl(e,!1)}}return h.getTrapData=(e=window.vbInitConfig||{})=>{const t=e.TRAP_SERVICE||(e.TRAP_SERVICE={});return t[l]||(t[l]=new h(e)),t[l]},h})),define("vb/private/services/serviceUtils",["urijs/URI","vb/private/configLoader","vb/private/constants","vb/private/log","vb/private/utils","vb/private/services/serviceConstants","vb/private/services/swaggerUtils","vb/private/services/trapData"],((e,t,i,r,n,s,a,o)=>{const c=/^[A-Za-z][A-Za-z0-9+.-]*:.+/,l=e=>o.getTrapData(e),h=r.getLogger("/vb/private/services/serviceUtils"),p=Symbol("initConfigEndpointResolverDefs"),u=e=>{const t=e.SERVICE_ENDPOINT_RESOLVERS||(e.SERVICE_ENDPOINT_RESOLVERS={});if(!t[p]){const e={};Object.keys(t).forEach((i=>{let r;const n=t[i];"string"==typeof n?r={path:n}:n&&n.path&&(r=n),r?e[i]=r:h.warn("Endpoint Resolver Plugin for ",i,' is not configured correctly: "',n,'".')})),t[p]=e}return t[p]};class d{static shouldUseTrapService(e=window.vbInitConfig||{}){return l(e).shouldUseTrapService()}static getTrapServiceScope(e=window.vbInitConfig||{}){return l(e).getTrapServiceScope()}static getProxyUrl(e){return l(e.vbInitConfig).getProxyUrl(e)}static getTokenRelayUrl(e){return l(e.vbInitConfig).getTokenRelayUrl(e)}static augmentExtension(e,i,r){if(r){const s=i&&i[0]||{},a="services"===s.type&&s.name||e,o=n.cloneObject(r);o.serviceName=a;const c={serviceName:a,extensionId:s.namespace,extensionVersion:s.version,activeProfile:t.activeProfile};return o.resolvedProxyUrl=d.getProxyUrl(c),o.resolvedTokenRelayUrl=d.getTokenRelayUrl(c),o.trapEnabled=d.shouldUseTrapService(),o.trapEnabled&&(o.trapScope=d.getTrapServiceScope()),o}return r}static getHeadersAndUrlForPreprocessing(t,r,n){const s=t;let o,c=!1;if(d.isProtocolOverrideRequired(r)){const t=new e(r);t.protocol("https"),s[i.Headers.PROTOCOL_OVERRIDE_HEADER]="http",o=t.toString(),c=!0}n&&(s[i.Headers.ALLOW_ANONYMOUS_ACCESS_HEADER]=!0,c=!0);const l=c&&t[i.Headers.VB_INFO_EXTENSION];if(l){const e=a.parseServiceText(l);e.headers=Object.assign({},s),t[i.Headers.VB_INFO_EXTENSION]=JSON.stringify(e)}return o}static isProtocolOverrideRequired(e){return 0===window.location.protocol.indexOf("https")&&0===e.indexOf("http:")}static mergeExtensions(e,t){const i=e||{},r=t||{},n=Object.assign({},i.headers||{},r.headers||{}),a=Object.assign({},r.authentication||i.authentication||{}),o=Object.assign({},i,r,{headers:n});return Object.keys(a).length&&(o[s.AUTH_DECL_NAME]=a),o}static getExtensionsFromMetadata(t,r,n){const s=new e(t).segment(r.path||"");r.query&&(s.query()?s.addQuery(e.parseQuery(r.query)):s.query(r.query));const o=s.normalize().toString(),c=r.method.toUpperCase(),l=r.extensions||{},h=n.headers||{},p=a.parseServiceText(h[i.Headers.VB_INFO_EXTENSION]||"{}"),u=Object.assign({},n.headers||{},l.headers||{});delete u[i.Headers.VB_INFO_EXTENSION];const d=Object.assign({url:o,method:c},p,l,{headers:u});d.headers=u;const g=Object.assign({},d);return delete g.url,delete g.method,u[i.Headers.VB_INFO_EXTENSION]=JSON.stringify(g),d}static transformResolvedCatalogObject(e,t,r,n){const s=e&&e.extensions||{};let a=d.mergeExtensions(s.backends||{},s.services||{});const o=a.headers||{},c=d.getNameForProxy(t,r,e.chain);a=d.augmentExtension(c,e.chain,a),o[i.Headers.VB_INFO_EXTENSION]=JSON.stringify(a);const l=Object.assign({},o||{},n||{}),h=e.metadata||{};return{url:e.url,namespace:e.namespace,services:{extensions:{headers:l},metadata:h.services},backends:{extensions:s.backends||{}},metadata:e.metadata,chain:e.chain||[],mergedExtensions:a}}static getAndRegisterAllCatalogNames(e){const t=["_serviceDefFactories","catalogServices","getAndRegisterCatalogNames"];return Promise.resolve().then((()=>e.searchDelegates((e=>Promise.resolve().then((()=>n.safelyCall(e,...t))).then((()=>!1)))))).then((()=>n.safelyCall(e,...t)))}static hasScheme(e){return c.test(e)}static toAbsoluteServerUrl(t,i){return d.hasScheme(t)&&!d.hasScheme(i)?new e(i,t).href():i}static getNameForProxy(e,t,i){const r=i&&i[0];let s=r&&"services"===r.type&&r.name;if(!(s||i&&i.length||n.isAbsolutePath(t))){const e=t.split("/"),i=e.indexOf("services");i>=0&&i===e.length-3&&(s=e[i+1])}return s||e}static addEndpointResolverModule(e,t,i=window.vbInitConfig||{}){const r=u(i);r[e]?h.warn("endpoint resolver already registered for",e,'. Ignoring "',t,'" plugin.'):r[e]={path:t}}static getServiceTypeEndpointResolverDef(e,t=window.vbInitConfig||{}){return u(t)[e]}static createNamespaceMap(e=i.ExtensionNamespaces.BASE){return n.createNamespaceMap(e)}}return d})),define("vb/private/services/servicesLoader",["vb/private/utils","vb/private/log","vb/private/constants","urijs/URI","vb/private/services/serviceUtils","vb/private/services/swaggerUtils","signals"],((e,t,i,r,n,s,a)=>{const o=t.getLogger("/vb/private/services/servicesLoader"),c=`${i.EXTENSION_PATH_NAME}/`;class l{static loadWithFetchOrXHR(t,i={}){return e.getResource("vb/private/stateManagement/router").then((r=>{const n=e.isAbsolutePath(t),s=n?t:r.baseUrl+t;if(i.resolvedUrl=s,e.isMobile()&&!n)return new Promise((e=>{const t=new XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&e(new Response(t.responseText,{status:t.status}))},t.onerror=()=>{console.error("Failed to fetch request: ",s)};const r=i.method||"GET";t.open(r,s,!0),t.send(null)}));const a=Object.assign({},i,{credentials:"same-origin"}),o=new Request(s,a);return fetch(o)})).then((e=>{if(e.ok)return e.json();throw Error(`service fetch failed: ${t} : ${e.status} ${e.statusText}`)}))}static loadWithTimeout(t,n,s=i.Services.definitionTimeout){const a=n.headers&&n.headers[i.Headers.VB_INFO_EXTENSION],c=n.headers&&Object.keys(n.headers).length>(a?1:0),h=Object.keys(n).length>(n.headers?1:0);function p(){const i=new Error(`Service definition loading timed out: ${s}`);return e.promiseRaceWithTimeout(l.loadWithFetchOrXHR(t,n),s,i)}if(!c&&!h){if(!r.parse(t).protocol)return l.loadWithRequireJs(t,n).catch((e=>{if(e&&"timeout"===e.requireType)return o.warn("Fetching service with requireJS timed out, trying fetch:",t,e),p();throw e}))}return p()}static loadWithRequireJs(t,i={}){let r;return i.resolvedUrl=t,r=t.startsWith(c)?e.getRuntimeEnvironment().then((e=>e.getExtensionTextResource(t))):t.startsWith("text!")?e.getResource(t):e.getTextResource(t),r.then((e=>s.parseServiceText(e)))}static getCatalogExtensions(e,t,i,r,s,a){return e.getResolvedInfoOrDefault(t,r,s).then((e=>n.transformResolvedCatalogObject(e,i,t,a||{})))}static notify(e,t){const i=e.name,r=e.nameForProxy||i,n=e.getServers(),s=e.extensions,a=e.catalogInfo,o=a&&a.services&&a.services.metadata||{},c=n.map((e=>Object.assign({url:e.getUrl(t),id:i,nameForProxy:r,metadata:o},s)));return l.opened.dispatch(i,c,e.namespace)}}return l.opened=new a.Signal,l})),define("vb/private/services/definition/definitionObject",["vb/private/log","vb/private/constants","vb/private/utils","vb/private/services/serviceConstants","urijs/URI"],((e,t,i,r,n)=>{const s=e.getLogger("/vb/private/services/services"),a={request:["vbPrepare","sort","filter","query","paginate"],response:["paginate"],metadata:["capabilities"]};class o{constructor(e,t,i,r,n,s,a){this._name=e;const c=s&&s.backends&&s.backends.extensions||{};this._extensions=o._mergeExtensions(t,c),this._loadExtensionsPromise=null,this._relativePath=n||"",this._catalogInfo=s||{chain:[]},this._isUnrestrictedRelative=a,this._parent=i,this._namespace=r}get name(){return this._name}get namespace(){return this._namespace}get extensions(){return this._extensions}set extensions(e){this._extensions=e||{}}get relativePath(){return this._relativePath}get isUnrestrictedRelative(){return this._isUnrestrictedRelative}get catalogInfo(){return this._catalogInfo}set catalogInfo(e){this._catalogInfo=e}_initTransforms(){const e=this.extensions.transforms||{};this._transformsFile=e.path;const t=function(e={}){const t={request:{},response:{},metadata:{}};return Object.keys(a).forEach((i=>{e[i]&&Object.keys(e[i]).forEach((r=>{if(e[i][r]){const n=e[i][r];try{t[i][r]=n?new Function("configuration","options",n):null}catch(e){s.error(e)}}}))})),t}(e);this._transforms={request:{},response:{},metadata:{}},this._setRequestTransforms(t.request),this._setResponseTransforms(t.response),this._setMetadataTransforms(t.metadata),this._disabledTransforms=e.disabled||{}}get transforms(){return this._transforms||this._initTransforms(),this._transforms}getRequestTransforms(){return this.transforms.request}getResponseTransforms(){return this.transforms.response}getMetadataTransforms(){return this.transforms.metadata}get disabledTransforms(){return this._disabledTransforms||this._initTransforms(),this._disabledTransforms}get transformsFile(){return this._transformsFile||this._initTransforms(),this._transformsFile}getRelativePath(e){return e&&e.startsWith("vb/")?e:e?this.relativePath+e:""}load(){return Promise.resolve(this._parent&&this._parent.load()).then((()=>(this._loadExtensionsPromise=this._loadExtensionsPromise||this._loadTransformsAndMerge(this.transformsFile).then((()=>this)),this._loadExtensionsPromise)))}_setRequestTransforms(...e){Object.assign(this._transforms.request,...e)}_setResponseTransforms(...e){Object.assign(this._transforms.response,...e)}_setMetadataTransforms(...e){Object.assign(this._transforms.metadata,...e)}_loadTransformModule(e){return Promise.resolve().then((()=>o.getModuleUri(e))).then((e=>e?i.getRuntimeEnvironment().then((t=>t.getTransformsSource(e.toString()))):{}))}_loadTransformsAndMerge(e){let i=e;const r={request:{},response:{},metadata:{}};return Promise.resolve().then((()=>{if(i&&i.indexOf(t.PARENT_FOLDER)>=0&&!this.isUnrestrictedRelative)return s.error("found",t.PARENT_FOLDER,"in Flow transform path, which is not allowed. skipping:",i),r;if(i)if(i.startsWith(t.RELATIVE_FOLDER_PREFIX)){const e=this._parent&&this._parent.catalogInfo&&this._parent.catalogInfo.url||this.catalogInfo&&this.catalogInfo.url;if(e){const r=e.lastIndexOf(t.PATH_SEPARATOR),n=r<=0?"":e.substring(0,r+1);i=`${n}${i}`}}else this.isUnrestrictedRelative&&(i=this.getRelativePath(i));return this._loadTransformModule(i)})).then((e=>{Object.keys(e).forEach((t=>{const i="function"==typeof e[t]?new e[t]:e[t],n=[];n.push(...Object.getOwnPropertyNames(i));let s=Object.getPrototypeOf(i);const o=Object.getPrototypeOf({});for(;s&&s!==o;)n.push(...Object.getOwnPropertyNames(Object.getPrototypeOf(i))),s=Object.getPrototypeOf(s);a[t].forEach((e=>{-1===n.indexOf(e)&&n.push(e)})),n.filter((e=>"constructor"!==e&&"_"!==e[0])).forEach((e=>{i[e]&&"function"==typeof i[e]&&(r[t][e]=i[e].bind(i),i[e].doesQueryEncoding&&(r[t][e].doesQueryEncoding=!0))}))}));const t=this._parent&&this._parent.transforms||{},i=Object.assign({},this.transforms.request);this._setRequestTransforms(t.request,r.request,i);const n=Object.assign({},this.transforms.response);this._setResponseTransforms(t.response,r.response,n);const s=Object.assign({},this.transforms.metadata);return this._setMetadataTransforms(t.metadata,r.metadata,s),r}))}static _mergeExtensions(e={},t={}){const i=Object.assign({},e.headers||{},t.headers||{}),n=Object.assign({},e.authentication||t.authentication||{}),s=Object.assign({},t,e,{headers:i});return Object.keys(n).length&&(s[r.AUTH_DECL_NAME]=n),s}}return o.getModuleUri=e=>Promise.resolve().then((()=>{let t=e;if(e){const r=i.isAbsolutePath(e),n=e.endsWith(".js");r&&!n?t=`${e}.js`:!r&&n&&(t=e.substring(0,e.length-3))}if(t){const e=new n(t);return e.normalizePath(),e}return null})),o})),define("vb/private/services/definition/openApiDefinitionObject",["vb/private/services/definition/definitionObject"],(e=>class extends e{constructor(e,t,i,r,n,s,a){super(e,t?t.getExtensions():{},i,r,n,s,a)}})),define("vb/private/services/endpointMetadata",["vb/private/utils"],(e=>class{constructor(t,i){this.url=t.url;const r=i.getRequestContentTypes(),n=i.getResponseContentTypes();this.name=t.name,this.serviceId=t.service.name,this.method=t.method,this.description=t.description,this.proxyUrl=t.proxyUrl,this.parameters=t.parameters?e.cloneObject(t.parameters):null,this.headers=t.headers?e.cloneObject(t.headers):null,this.staticQueryParameters=t.staticQueryParams?e.cloneObject(t.staticQueryParams):null,this.requestContentTypes=r?r.slice():null,this.responseContentTypes=n?n.slice():null,this.componentParameters=i.openApi&&i.openApi.definition&&i.openApi.definition.components&&i.openApi.definition.components.parameters;const s=t.service.server;this.server=s?{getUrl:(...e)=>s.getUrl(...e)}:{getUrl:()=>""},Object.defineProperties(this,{responses:{enumerable:!0,configurable:!1,get:()=>i.getExpandedResponses()}})}setUrl(e){this.url=e}get(){if(!this.url)throw new Error(`getMetadata called for endpoint ${this.name} before loading`);return this}})),define("vb/private/services/endpoint",["vb/private/log","vb/private/services/uriTemplate","vb/private/services/swaggerUtils","vb/private/utils","vb/private/services/definition/openApiDefinitionObject","vb/private/services/servicesLoader","vb/private/services/endpointMetadata","vb/private/stateManagement/router","vbc/private/constants","vb/private/services/serviceUtils"],((e,t,i,r,n,s,a,o,c,l)=>{const h=e.getLogger("/vb/private/services/endpoint");return class extends n{constructor({name:e,service:t,protocolRegistry:r,pathKey:n,pathObject:s,operationKey:o,operationObject:c,isUnrestrictedRelative:l}){super(e,c,t,t.namespace,t.relativePath,null,l),this._service=t,this._pathKey=n||"",this._protocolRegistry=r,this.method=o&&o.toUpperCase()||"GET",this.description=c.description||"",this.parameterDefs=c.parameters.slice(),this.parameters=i.separateParameters(this.parameterDefs),this._metadata=new a(this,c);const h=c.getStaticHeaderValues(),p=c.getStaticQueryParameterValues(),u=c.getCombinedExtensions(),d=this._parent&&this._parent.extensions||{},g=this.extensions||{};this.staticQueryParams=Object.assign({},p,d.queryParameters||{},g.queryParameters||{}),this.headers=Object.assign({},h,d.headers||{},g.headers||{}),this.combinedExtensions=Object.assign({},u,d,g,{headers:this.headers})}get path(){return this._pathKey}get service(){return this._service}load(){return this._loadPromise||(this._loadPromise=r.getRuntimeEnvironment().then((e=>e.getServiceExtensionOverride())).then((e=>(e&&(this.combinedExtensions=Object.assign(this.combinedExtensions,e)),super.load().catch((e=>(h.warn("Error while loading parts of the endpoint: ",this.name," - ",this.path,e),this))))))),this._loadPromise}_handleServerVariables(e){const{serverVariables:t,variables:r}=i.splitVariables(e);let n;const s=this.service.server;if(s){let e=s.getUrl(t)||"";"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),n=e+this.path}else n=this.path;return{unresolvedUrl:n,variables:r,serverVariables:t}}_computeUrl(e){const i=this._handleServerVariables(e);return this.load().then((()=>s.getCatalogExtensions(this._protocolRegistry,i.unresolvedUrl,this.service.nameForProxy,this.namespace,i.serverVariables))).then((e=>{this.catalogInfo=e,this.url=e.url||i.unresolvedUrl;const r=e.backends&&e.backends.extensions||{},n=r&&r.headers||{},s=Object.assign({},n,this.combinedExtensions.headers||{});return this.combinedExtensions=Object.assign({},r,this.combinedExtensions,{headers:s}),this.headers=this.combinedExtensions.headers,this.uriTemplate=new t(this.url,this.parameters),this._metadata.setUrl(this.url),i.variables}))}getConfig(e={},i={}){return this._computeUrl(e).then((e=>{if(!this.url||!this.uriTemplate)throw new Error(`getConfig called for endpoint ${this.name} before loading`);if(!i.ignoreMissingParams){let t=this.uriTemplate.getMissingRequiredParameters(e,this.parameters);if(t=t.filter((e=>"query"!==e.type)),t.length){const e=t.map((e=>e.name)).join('", "');throw new Error(`getConfig() for "${this.name}" is missing required parameters: "${e}"`)}}const r=Object.assign({},this.staticQueryParams,e||{});let n=this.uriTemplate.replace(r,i.ignoreMissingParams);const s=this.path?new t(this.path,this.parameters).replace(r,i.ignoreMissingParams):"",a=this.getAllHeaders(r),c=o.getCurrentPage();return n=l.getHeadersAndUrlForPreprocessing(a,n,c&&!c.isAuthenticationRequired())||n,{url:n,urlSuffix:s,method:this.method,headers:a,requestContentTypes:this._metadata.requestContentTypes,responseContentTypes:this._metadata.responseContentTypes}}))}getAllHeaders(e){const t=Object.assign({},this.headers),r=this.parameters.header||{};Object.keys(r).forEach((n=>{const s=r[n],a=i.getParameterDefault(s);(a||Object.prototype.hasOwnProperty.call(e,n))&&(t[n]=e[n]||a||"")}));const n=this.catalogInfo.chain.slice().concat(this.service.catalogInfo.chain).filter((e=>e&&"services"===e.type));return this.combinedExtensions=l.augmentExtension(this.service.nameForProxy,n,this.combinedExtensions),t[c.Headers.VB_INFO_EXTENSION]=JSON.stringify(this.combinedExtensions),t}getRequestTransforms(){return this._getFilteredTransforms("request")}getResponseTransforms(){return this._getFilteredTransforms("response")}getMetadataTransforms(){return this._getFilteredTransforms("metadata")}getMetadata(){return this._metadata.get()}_getFilteredTransforms(e){const t=this.disabledTransforms[e]||[],i=this._parent&&this._parent.disabledTransforms&&this._parent.disabledTransforms[e]||[],r=Object.assign({},this.transforms[e]),n=t.slice();return n.push(...i),n.forEach((e=>{delete r[e]})),r}static createEmptyService(e){return{name:e,nameForProxy:e,catalogInfo:{chain:[]},load:()=>Promise.resolve()}}}})),define("vb/private/services/readers/openApiObjectCommon",["vb/private/log","vb/private/services/serviceConstants","vb/private/services/swaggerUtils"],((e,t,i)=>{const r=e.getLogger("/vb/private/services/readers/openApiObjectCommon");class n{constructor(e,t,i,n){this.name=e,this.method=e,this.openApi=n,this.expanded={},this.responses,Object.assign(this,i),this.parameters=function(...e){const t=[];e.forEach((e=>{const i={};e&&(Array.isArray(e)?e.forEach((e=>{const t=`${e.name}-${e.in}`;i[t]=e})):r.error(`invalid parameter definition: ${JSON.stringify(e)}`)),t.push(i)}));const i=Object.assign({},...t);return Object.values(i)}(t.parameters,this.parameters),this.staticHeaders=Object.assign({},this.openApi.getExtensions().headers||{},this.getExtensions().headers||{})}getExtensions(){return this[t.VB_EXTENSIONS]||{}}getCombinedExtensions(){return Object.assign({},this.getExtensions(),this.openApi.getExtensions())}getStaticHeaderValues(){return this.staticHeaders}getProxy(){return this.getExtensions()[t.VB_PROXY]||this.openApi.getExtensions()[t.VB_PROXY]}getTokenRelayUrls(){return this.getExtensions()[t.AuthUrlNames.TOKEN_RELAY]||this.openApi.getExtensions()[t.AuthUrlNames.TOKEN_RELAY]}getStaticQueryParameterValues(){return this.getExtensions().queryParameters}getResponseContentTypes(){throw new Error("getResponseContentTypes must be implemented!")}getRequestContentTypes(){throw new Error("getRequestContentTypes must be implemented!")}getExpandedResponses(){return this.expanded.responses||(this.expanded.responses=i.resolveReferences(this.openApi.definition,null,this.responses)),this.expanded.responses}}class s{constructor(e,t,i){Object.assign(this,t),this.name=e,this.path=e,this.operationObjects=[],Object.keys(t||{}).forEach((e=>{this.operationObjects.push(i.createOperationObjectObject(e,t,e))}))}getOperationObjects(){return this.operationObjects}}class a{constructor(e){const t=a.resolveSomeReferences(e);this.definition=t||{},this.pathObjects=[];const i=this.definition.paths||{};Object.keys(i).forEach((e=>{this.pathObjects.push(this.createPathObjectObject(e,i[e]))}))}createPathObjectObject(e,t){return new s(e,t,this)}createOperationObjectObject(e,t,i){const r=t[i];return new n(e,t,r,this)}getInfo(){return this.definition.info||{}}getExtensions(){return this.getInfo()[t.VB_EXTENSIONS]||{}}getServers(){throw Error("must be implemented by subclass")}getServerForProfile(){const e=this.getServers();return e[e.length-1]}getPathObjects(){return this.pathObjects}static resolveSomeReferences(e){const t=Object.assign({},e);return t.paths=i.resolveReferences(e,((e,t)=>3===t.names.length?"parameters"===t.names[2]:4!==t.names.length||!("parameters"===t.names[2]&&"schema"===t.names[3])),e.paths||{}),t}}return a.PathObject=s,a.OperationObject=n,a.Protocol={HTTP:"http",HTTPS:"https"},a})),define("vb/private/services/readers/openApiUtils",["vb/private/services/serviceConstants"],(e=>{function t(t){return t&&t[e.VB_EXTENSIONS]&&Array.isArray(t[e.VB_EXTENSIONS].profiles)&&t[e.VB_EXTENSIONS].profiles||[]}return class{static findServerForProfile(e=[],i){let r;return i&&(r=e.find((e=>t(e)&&-1!==t(e).indexOf(i)))),r=r||e[0],r}}})),define("vb/private/services/readers/openApi3Object",["vb/private/log","./openApiObjectCommon","./openApiUtils","vb/private/services/serviceUtils","vb/private/services/swaggerUtils","vb/private/services/uriTemplate"],((e,t,i,r,n,s)=>{const a=e.getLogger("/vb/private/services/readers/openApi3Object");class o extends t.OperationObject{getResponseContentTypes(){const e=this.responses||{};let t=e.default||e[200]||function(e){const t=Object.entries(e);return t.length?{name:t[0][0],value:t[0][1]}:{name:null,value:{}}}(e).value;return t=n.resolveReferences(this.openApi.definition,null,t),Object.keys(t.content||{})}getRequestContentTypes(){let e=this.requestBody||this.openApi.requestBody||{};return e=n.resolveReferences(this.openApi.definition,null,e),Object.keys(e.content||{})}}class c extends t{constructor(e,t={}){super(e),this.initParams=t.initParams||{},this.definitionUrl=t.definitionUrl}getServers(){if(!this._servers){const e=this.definition.servers||[];this._servers=e.map((e=>{const t=Object.assign({},e);if(delete t.url,e.url&&e.url.includes("{"))t.getUrl=t=>{const i=this._replaceServerVariables(e,t);return t&&t[Symbol.for("RestHelper.addServerUrlInfo")]&&t[Symbol.for("RestHelper.addServerUrlInfo")](i),i.url};else{const i=this.definitionUrl?r.toAbsoluteServerUrl(this.definitionUrl,e.url):e.url;t.getUrl=()=>i}return t}))}return this._servers}getServerForProfile(e){const t=this.getServers();return t&&t.length?i.findServerForProfile(t,e):this.createDefaultServer()}createDefaultServer(){const e=this.definitionUrl?r.toAbsoluteServerUrl(this.definitionUrl,"/"):"/";return{getUrl:()=>e}}createOperationObjectObject(e,t,i){const r=t[i];return new o(e,t,r,this)}_replaceServerVariables(e,t){const i={},o=e.variables;o&&Object.keys(o).forEach((e=>{i[e]=o[e].default}));const c=this.initParams;if(c&&Object.keys(c).forEach((e=>{const t=c[e];null!=t&&(i[e]=t)})),t){let r="";Object.keys(t).forEach((s=>{const a=t[s];n.isValidServerVariableValue(a,e,s)&&(r+=`\n  '${s}': '${a}'`,i[s]=a)})),r&&a.info("The server url of the service located at",this.definitionUrl||"<unknown>","has been modified by the following request-specific variables:",r)}const l=e.url||"";let h=new s(l,{},!0).replace(i);return this.definitionUrl&&(h=r.toAbsoluteServerUrl(this.definitionUrl,h)),{url:h,template:l,variables:i}}}return c.OpenApi3OperationObject=o,c})),define("vb/private/services/definition/pluginServiceDefinition",["vb/private/services/endpoint","vb/private/services/serviceUtils","vb/private/services/definition/definitionObject","vb/private/services/readers/openApi3Object"],((e,t,i,r)=>class extends i{constructor(e,i,r,n,s,a,o){const c=e.serviceId;super(c,{},null,a.namespace,"",a,!0),this._endpointReference=e,this._plugin=i,this._serviceType=r,this._requestInit=n,this._catalog=s,this._protocolRegistry=o,this._server={getUrl:()=>this.catalogInfo.url},this._nameForProxy=t.getNameForProxy(c,"",a.chain),this.extensions=t.augmentExtension(this.nameForProxy,a.chain,this.extensions),this._endpoints={}}get server(){return this._server}get requestInit(){return this._requestInit}get nameForProxy(){return this._nameForProxy}isExtensionAccessible(){const e=this._catalogInfo.chain[0];return!0===(e&&e.extensionAccess)}findEndpoint(t,i){const n=this.getEndpointReferenceHash(t);return void 0===this._endpoints[n]&&(this._endpoints[n]=Promise.resolve().then((()=>this._getEndpointFromPlugin(t,i))).then((({operation:i,path:n,method:s,extensions:a,parameters:o}={})=>{if(i){const c={getExtensions:()=>a||{}},l={parameters:o||[]},h=new r.OpenApi3OperationObject(s,l,i,c),p={name:t.operationId,service:this,protocolRegistry:this._protocolRegistry,pathKey:n,operationKey:s,operationObject:h,isUnrestrictedRelative:this.isUnrestrictedRelative};return new e(p)}return null}))),this._endpoints[n]}getEndpointReferenceHash(e){return`${e.operationId}$${e.containerNamespace}`}_getEndpointFromPlugin(e,t={}){const i=this.catalogInfo.chain[0],r=i&&i.variables||{},n=Object.assign({},r,t),s={url:this.server.getUrl(),extensions:this.extensions},a={contextNamespace:e.containerNamespace,namespace:this.namespace,serviceId:this._endpointReference.serviceId,moduleName:this._endpointReference.moduleName,endpoint:this._endpointReference.operationId,serverVariables:n,url:this.catalogInfo.url,server:s};return this._plugin.getEndpointDefinition(e.operationId,a)}})),define("vb/private/services/definition/serviceDefFactory",["vb/private/services/endpointReference"],(e=>{const t=e=>new Error(`Subclass must implement ${e}`);return class{constructor(e){this._services=e}get services(){return this._services}supports(e){return!1}getDeclaration(e){return this.updateServiceDeclarations().then((()=>this.findDeclaration(e)))}loadAllDefinitions(){return this.updateServiceDeclarations().then((()=>{const t=this.getAllServiceIds();return Promise.all(t.map((t=>{const i=new e(t),r=this.findDeclaration(i);return this.loadDefinition(i,r)})))}))}loadDefinition(e,i,r){return Promise.reject(t("loadDefinition(endpointReference, serviceDeclaration, serverVariables)"))}findDeclaration(e){return Promise.reject(t("findDefinition(endpointReference)"))}getAllServiceIds(){throw t("getAllServiceIds()")}updateServiceDeclarations(){return Promise.resolve()}}})),define("vb/private/services/definition/programmaticPluginFactory",["vb/private/log","vb/private/utils","vb/private/services/servicesLoader","vb/private/services/serviceUtils","vb/private/services/definition/definitionObject","vb/private/services/definition/pluginServiceDefinition","vb/private/services/definition/serviceDefFactory","vbc/private/constants"],((e,t,i,r,n,s,a,o)=>{const c=e.getLogger("/vb/private/services/definition/ProgrammaticPluginFactory"),l="programmaticPlugin";class h extends a{constructor(e,t){super(e);const{relativePath:i,isUnrestrictedRelative:r,protocolRegistry:n}=t;this._protocolRegistry=n,this._isUnrestrictedRelative=!!r,this._relativePath=i||"",this._plugins={}}supports(e){return e.isProgrammatic}findDeclaration(e){return{endpointReference:e,type:l}}getAllServiceIds(){return[]}loadDefinition(e,t,r){return Promise.resolve().then((()=>{const t=this.services.namespace,n=this.getBackendName(e),s=`${o.VbProtocols.CATALOG}://backends/${t}:${n}/`;return i.getCatalogExtensions(this._protocolRegistry,s,n,t,r,void 0)})).then((t=>{if(t){const i=(e=>{if(e&&e.chain)return e.chain.find((e=>e.serviceType));return null})(t);if(i){const e=this._protocolRegistry.catalogRegistry;return Promise.all([i.serviceType,t,e.get(i.namespace)])}c.error(`${e} does not have serviceType`)}return[]})).then((([e,t,i])=>i?Promise.all([e,t,i,this.getServiceTypePlugin(e,i)]):[])).then((([t,i,r,n])=>n&&this.createServiceDefinition(n,t,r,i,e))).catch((e=>(c.error("service load error: ",e),null)))}getServiceTypePlugin(e,t){return this._plugins[e]||(this._plugins[e]=Promise.resolve().then((()=>{const i=r.getServiceTypeEndpointResolverDef(e);if(i)return this.createPlugin(i,!0);const n=t.serviceTypes&&t.serviceTypes[e];if(!n||!n.path)throw new Error(`serviceType "${e}" does not have a plugin to resolve its endpoints`);return this.createPlugin(n)}))),this._plugins[e]}createPlugin(e,i){return Promise.resolve().then((()=>{const r=i?e.path:this.services.getDefinitionPath(e.path);return s=r,Promise.resolve().then((()=>n.getModuleUri(s))).then((e=>{if(e)return t.getRuntimeEnvironment().then((t=>t.getEndpointPlugin(e.toString())));throw new Error(`Can not resolve URI for the endpoint plugin path: "${s}".`)}));var s})).then((e=>"function"==typeof e?new e:e))}createServiceDefinition(e,t,i,r,n){const a=r.services&&r.services.extensions;return new s(n,e,t,a,i,r,this._protocolRegistry)}getBackendName(e){return e.serviceName}updateServiceDeclarations(){return r.getAndRegisterAllCatalogNames(this.services)}}return h.TYPE=l,h})),define("vbsw/private/constants",[],(()=>{const e={AuthenticationType:{ORACLE_CLOUD:"oraclecloud",BASIC:"basic",OAUTH:"oauth",IMPLICIT:"implicit",TOKEN_RELAY:"tokenRelay",DIRECT:"direct",NONE:"none",HTTP_SIGNATURE_OCI:"http_signature_oci"},AUTHENTICATION_TYPE_HEADER:"vb-authentication-type",TRAP_2_ENABLED_HEADER:"vb-trap-v2",TOKEN_RELAY_URL_HEADER:"vb-token-relay-url",TOKEN_RELAY_AUTH_HEADER:"vb-token-relay-authentication",PROXY_HEADERNAME_HEADER:"vb-proxy11-headers",HEADER_PROXY_PREFIX:"vb-proxy-"};return e.HEADER_PROXY_HEADER_PREFIX=`${e.HEADER_PROXY_PREFIX}header-`,e.HEADER_PASSTHROUGH="vb-auth-settings",e.ORASASS_SCOPE="scope",e.ALT_AUTHORIZATION_HEADER_NAME="vb-alt-authorization-header-name",e.USE_CACHED_RESPONSE_WHEN_OFFLINE="vb-use-cached-response-when-offline",e.PATH_SEPARATOR="/",e.LOOKUP_INDEX_MODE="lookupIndex",e.DEFAULT_CLOCK_SKEW_TOLERANCE=180,e})),define("vb/private/services/definition/serviceDefinition",["vb/private/services/swaggerUtils","vb/private/configLoader","vb/private/services/definition/openApiDefinitionObject","vb/private/services/endpoint","vb/private/services/serviceConstants","vbsw/private/constants","vb/private/services/serviceUtils"],((e,t,i,r,n,s,a)=>class extends i{constructor(i,o,c,l,h,p,u,d,g){if(super(i,h,null,d,p,l,g),this._openApi=h,this._requestInit=u,this._protocolRegistry=c,this._server=h.getServerForProfile(t.activeProfile),this._nameForProxy=a.getNameForProxy(i,o,l.chain),this.server[n.VB_EXTENSIONS]){const e=a.mergeExtensions(this.extensions,this.server[n.VB_EXTENSIONS]);this.extensions=a.augmentExtension(this.nameForProxy,l.chain,e)}else this.extensions=a.augmentExtension(this.nameForProxy,l.chain,this.extensions);("businessObjects"===i||o.endsWith("businessObjects/service.json"))&&(this.extensions.authenticationType=s.AuthenticationType.ORACLE_CLOUD),this._endpoints={},h.getPathObjects().forEach((t=>{const i=t.path;t.getOperationObjects().forEach((n=>{const s=n.name,a=e.getEndpointId(i,t,n.name,n);this._endpoints[a]=new r({name:a,service:this,protocolRegistry:c,pathKey:i,pathObject:t,operationKey:s,operationObject:n,isUnrestrictedRelative:this.isUnrestrictedRelative})}))}))}get server(){return this._server}get requestInit(){return this._requestInit}get nameForProxy(){return this._nameForProxy}getDefinition(){return this._openApi.definition}getServers(){return this._openApi.getServers()}isDefined(){return!!this.url}isExtensionAccessible(){const e=this._openApi&&this._openApi.getExtensions();if(!0===(e&&e.extensionAccess))return!0;const t=this.catalogInfo&&this.catalogInfo.mergedExtensions;return!0===(t&&t.extensionAccess)}getEndpointReferenceHash(e){return e.operationId}findEndpoint(e){return this._endpoints[this.getEndpointReferenceHash(e)]}})),define("vb/private/services/readers/openApi2Object",["./openApiObjectCommon","vb/private/constants","vb/private/services/serviceUtils"],((e,t,i)=>{class r extends e.OperationObject{getResponseContentTypes(){return this.produces||this.openApi.definition.produces||[]}getRequestContentTypes(){return this.consumes||this.openApi.definition.consumes||[]}}return class extends e{constructor(e,t={}){super(e),this.definitionUrl=t.definitionUrl}createOperationObjectObject(e,t,i){const n=t[i];return new r(e,t,n,this)}getServers(){if(!this._servers){const r=this.getExtensions().servers;if(r&&r.length>0)this._servers=r.map((e=>{const t=Object.assign({},e);return delete t.url,t.getUrl=()=>e.url,t}));else{let r=this.definition.host||"";if(r){let t;if(Array.isArray(this.definition.schemes)){const i=this.definition.schemes.map((e=>e.toLowerCase()));t=i.indexOf(e.Protocol.HTTPS)>=0?e.Protocol.HTTPS:i.indexOf(e.Protocol.HTTP)>=0?e.Protocol.HTTP:i[0]}t=t||e.Protocol.HTTP,r=`${t}://${r}`}let n=`${r}${this.definition.basePath===t.PATH_SEPARATOR?"":this.definition.basePath||""}`;this.definitionUrl&&(n=i.toAbsoluteServerUrl(this.definitionUrl,n)),this._servers=[{getUrl:()=>n}]}}return this._servers}}})),define("vb/private/services/readers/openApiObjectFactory",["./openApi2Object","./openApi3Object"],((e,t)=>class{static get(i,r){return i.openapi?new t(i,r):new e(i,r)}})),define("vb/private/services/definition/openApiServiceDefFactory",["urijs/URI","vb/private/configLoader","vb/private/log","vb/private/utils","vb/private/services/servicesLoader","vb/private/services/serviceUtils","vb/private/services/definition/serviceDefinition","vb/private/services/definition/serviceDefFactory","vb/private/services/readers/openApiObjectFactory"],((e,t,i,r,n,s,a,o,c)=>{const l=i.getLogger("/vb/private/services/definition/OpenApiServiceDefFactory");class h extends o{constructor(e,t){super(e);const{relativePath:i,isUnrestrictedRelative:r,protocolRegistry:n}=t;this._protocolRegistry=n,this._isUnrestrictedRelative=!!r,this._relativePath=i||""}supports(e){return!e.isProgrammatic}loadDefinition(e,t,i){return Promise.resolve().then((()=>{"string"==typeof t&&(t={path:t});const r=e.serviceName,n=this.services.evaluatePathDeclaration(t.path);return this.services.isPathAllowed(n)?this.loadServiceFromPath(r,n,t.headers,i):null}))}loadServiceFromPath(e,t,i,r){let s,a,o;return Promise.resolve().then((()=>(o=this.services.getDefinitionPath(t),n.getCatalogExtensions(this._protocolRegistry,o,e,this.services.namespace,r,i)))).then((t=>{s=t,a=s.services&&s.services.extensions;const i=s.services&&s.services.metadata;return i?h.getOpenApiObjectUsingMetadata(e,s.url,i,a):h.getOpenApiObject(e,s.url,a)})).then((t=>this.createServiceDefinition(e,o,s,t,a,r))).catch((e=>(l.error("service load error: ",e),null)))}createServiceDefinition(e,t,i,r,s,o){const c=new a(e,t,this._protocolRegistry,i,r,this._relativePath,s,this.services.namespace,this._isUnrestrictedRelative);try{n.notify(c,o)}catch(e){l.error(e)}return c}static getOpenApiObjectUsingMetadata(e,t,i,r){return Promise.resolve().then((()=>{const n=s.getExtensionsFromMetadata(t,i,r),{url:a}=n;return delete n.url,h.getOpenApiObject(e,a,n)}))}static getOpenApiObject(t,i,n){return r.getRuntimeEnvironment().then((t=>{const r=i.startsWith("text!")?i:e(i).normalizePath().toString(),s=Object.assign({},n);return t.getServiceDefinition(r,s).then((e=>{const t=s.resolvedUrl&&{definitionUrl:s.resolvedUrl};return h.getOpenApi(e,t)}))}))}static getOpenApi(e,i){return Promise.resolve().then((()=>{const r=i?Object.assign({},i,{initParams:t.initParams}):{initParams:t.initParams};return c.get(e,r)})).catch((e=>{throw l.error("unable to resolve service references:",e),e}))}}return h})),define("vb/private/services/definition/serviceMapFactory",["vb/binding/expression","vb/private/log","vb/private/utils","vb/private/services/definition/openApiServiceDefFactory"],((e,t,i,r)=>{const n=t.getLogger("/vb/private/services/definition/ServiceMapFactory");class s extends r{constructor(e,t){super(e,t);const{serviceFileMap:r={}}=t;i.removeDecorators(r),this._serviceFileMap={},Object.keys(r).forEach((e=>{let t=r[e];"string"==typeof t&&(t={path:t}),t.type=s.TYPE,this._serviceFileMap[e]=t})),s.checkForDeprecatedPathExpressions(this._serviceDeclarationMap)}findDeclaration(e){return this._serviceFileMap[e.serviceName]}getAllServiceIds(){return Object.keys(this._serviceFileMap).map((e=>`${this.services.namespace}:${e}`))}static checkForDeprecatedPathExpressions(t={}){const i=[];Object.keys(t).forEach((r=>{const n=t[r],s="string"==typeof n?n:n.path;if(s&&e.isExpression(s)){/\$(application|flow|page|variables|metadata)/g.exec(s)&&i.push(s)}})),i.length&&n.warn('DEPRECATED: Application "services" contains expressions with references other than "$initParams". These should be changed: ',i)}}return s.TYPE="serviceMap",s})),define("vb/private/services/definition/serviceProviderFactory",["vb/private/log","vb/private/services/serviceProvider","vb/private/services/definition/openApiServiceDefFactory"],((e,t,i)=>{const r=e.getLogger("/vb/private/services/definition/ServiceProviderFactory"),n="serviceProvider";class s extends i{constructor(e,t){super(e,t),this._serviceProviderMap={}}findDeclaration(e){return this._serviceProviderMap[e.serviceName]}getAllServiceIds(){return Object.keys(this._serviceProviderMap).map((e=>`${this.services.namespace}:${e}`))}loadDefinition(e,t){return Promise.resolve().then((()=>{const e=t.serviceProvider;return this.services.isPathAllowed(e.getServiceFilePath())?i.getOpenApi(e.getDefinition()).then((t=>t&&this.createServiceDefinition(e.getServiceName(),e.getServiceFilePath(),{chain:[]},t,null))):null}))}addServiceProvider(e){if(e instanceof t){const t=e.getServiceName();if(this._serviceProviderMap[t]){const e=new Error(`The serviceProvider with name ${t} is already registered.`);throw r.error(e),e}this._serviceProviderMap[t]={serviceProvider:e,type:n}}else r.error("Given serviceProvider is not an instance of ServiceProvider")}}return s.TYPE=n,s})),define("vb/private/services/services",["vb/private/configLoader","vb/private/constants","vb/private/log","vb/binding/expression","vb/private/utils","vb/private/services/serviceProvider","vb/private/services/serviceUtils","vb/private/services/endpointReference","vb/private/services/definition/programmaticPluginFactory","vb/private/services/definition/serviceMapFactory","vb/private/services/definition/serviceProviderFactory"],((e,t,i,r,n,s,a,o,c,l,h)=>{const p=i.getLogger("/vb/private/services/services");return class{constructor(e){const{relativePath:i,serviceFileMap:r={},expressionContext:s,protocolRegistry:o,isUnrestrictedRelative:c,namespace:l}=e;this._namespace=l||t.ExtensionNamespaces.BASE,this._relativePath=i||"",n.removeDecorators(r),this._expressionContext=s,this._options=e,this._initServiceDefFactories(e),this._protocolRegistry=o,this._isUnrestrictedRelative=!!c,this._loadedServicePromises=a.createNamespaceMap(this.namespace),this._delegates=[]}_initServiceDefFactories(e=this._options||{}){this._serviceDefFactories={},this._serviceDefTypes=this.getServiceDefTypes(e.serviceDefTypes),this._serviceDefTypes.forEach((t=>{const i=this.createServiceDefFactory(t,e);i&&(this._serviceDefFactories[t]=i)}))}get namespace(){return this._namespace}addDelegate(e){return e===this||this._delegates.includes(e)||this._delegates.push(e),this}searchDelegates(e){return this._delegates.reduce(((t,i)=>t.then((t=>t||e(i)))),Promise.resolve())}getServiceDefTypes(){return[c.TYPE,l.TYPE,h.TYPE]}createServiceDefFactory(e,t={}){switch(e){case c.TYPE:return new c(this,t);case l.TYPE:return new l(this,t);case h.TYPE:return new h(this,t);default:return null}}searchServiceDefFactories(e){return this._serviceDefTypes.reduce(((t,i)=>t.then((t=>t||this._serviceDefFactories[i]&&e(this._serviceDefFactories[i])))),Promise.resolve())}containsDeclaration(e){return this.isNamespaceMatch(e.namespace)?this.FindServiceDeclaration(e).then((e=>!!e)):Promise.resolve(!1)}FindServiceDeclaration(e,i){const r=e.serviceId,n=e.getQualifiedServiceId(this.namespace),s=t=>t.supports(e)?t.getDeclaration(e):Promise.resolve(null);return Promise.resolve().then((()=>this.searchServiceDefFactories(s))).then((s=>{if(s)return Promise.resolve(s);if(this.namespace===t.ExtensionNamespaces.BASE){return this.searchDelegates((t=>t.LoadService(n,!1,e,i).then((n=>n&&n.name===r?t.FindServiceDeclaration(e,i):null)))).catch((e=>(p.error(`Delegate services failed to load service ${n}`,e),null)))}return Promise.resolve(null)}))}addServiceProvider(e){if(e instanceof s){const t=e.getServiceName();if(!t){const e=new Error("The serviceProvider does not provide a service name.");throw p.error(e),e}if(!e.getServiceFilePath()){const e=new Error("The serviceProvider does not provide a service file path.");throw p.error(e),e}if(!e.getDefinition()){const e=new Error("The serviceProvider does not provide a service definition.");throw p.error(e),e}if(this._loadedServicePromises.has(t,this.namespace)){const e=new Error(`A service with name ${t} is already registered.`);throw p.error(e),e}const i=this._serviceDefFactories.serviceProvider;if(!i){const e=new Error(`ServiceProviders are not supported in the ${this._relativePath} services.`);throw p.error(e),e}i.addServiceProvider(e)}else p.error("Given serviceProvider is not an instance of ServiceProvider")}loadAll(){const e=e=>(e.forEach((e=>{e&&this._loadedServicePromises.set(e.name,void 0,Promise.resolve(e))})),!1);return this.searchServiceDefFactories((t=>t.loadAllDefinitions().then(e)))}load(e,t,i,r){return e?Promise.all(e.map((e=>this.LoadService(e,t,i,r)))):this.loadAll()}LoadService(e,t,i=new o(`${e}/any`,{extensionId:this.namespace}),r){const n=r&&Object.keys(r),s=n&&n.length>0?n.map((e=>`${e}:${r[e]}`)).join():void 0,a=i.serviceName;return Promise.resolve().then((()=>t||!this._loadedServicePromises.hasWithVariables(a,void 0,s)?Promise.all([!1,this.FindServiceDeclaration(i,r)]):[!0,null])).then((([n,o])=>{if(!n)if(o){const e=o.type,n=this._serviceDefFactories[e];!t&&this._loadedServicePromises.hasWithVariables(a,void 0,s)||this._loadedServicePromises.setWithVariables(a,void 0,s,n.loadDefinition(i,o,r))}else p.info("service:",e,"not found in container",this._relativePath,"continuing");return this._loadedServicePromises.getWithVariables(a,void 0,s)}))}_getServiceEndpoint(e,t,i){return Promise.resolve().then((()=>{if(!i){const i=t&&Object.keys(t),r=i&&i.length>0?i.map((e=>`${e}:${t[e]}`)).join():void 0;return this._loadedServicePromises.getWithVariables(e.serviceName,void 0,r)}return i})).then((i=>i&&i.findEndpoint(e,t)))}getEndpoint(e,t){return"string"==typeof e&&(e=new o(e)),Promise.resolve().then((()=>{if(!this.isNamespaceMatch(e.namespace))return!1;const i=e.getQualifiedServiceId(this.namespace);return this.LoadService(i,!1,e,t)})).then((i=>i&&this._getServiceEndpoint(e,t,i))).then((i=>i&&this.isEndpointAccessible(i,e)?i.load():this.searchDelegates((i=>i.getEndpoint(e,t))))).catch((t=>(p.error("Error loading endpoint",e,t),null))).then((e=>e||null))}isNamespaceMatch(e){return this.namespace===e||!e}isEndpointAccessible(e,t){return this.namespace===t.containerNamespace||this.namespace===t.referencingNamespace||!e.service||e.service.isExtensionAccessible()}getDefinitionPath(i){if(n.isAbsolutePath(i))return i;if(i[0]!==t.RELATIVE_FOLDER_PREFIX){const t=requirejs.toUrl(".");if(!requirejs.toUrl(i).startsWith(t)||e.isResourceBundled(`text!${i}`))return i;this._isUnrestrictedRelative||p.warn("deprecated: service definition path without current folder prefix is ambiguous:",i)}return`${"/"!==this._relativePath&&this._relativePath||""}${i}`}isPathAllowed(e){const i=this._isUnrestrictedRelative||-1===e.indexOf(t.PARENT_FOLDER);return i||p.error("Found invalid service definition path (use of",t.PARENT_FOLDER,"):",e),i}disposeService(e){this._loadedServicePromises.set(e,void 0,null)}evaluatePathDeclaration(e){return r.getEvaluated(e,this._expressionContext)}}})),define("vb/private/stateManagement/flow",["vb/private/stateManagement/container","vb/private/stateManagement/page","vb/private/stateManagement/pageInExtension","vb/private/stateManagement/redux/storeManager","vb/private/stateManagement/router","vb/private/utils","vb/private/constants","vb/private/stateManagement/context/flowContext","vb/private/stateManagement/flowExtension","vb/private/services/services","vb/private/stateManagement/stateMonitor","vb/errors/httpError","urijs/URI","vb/private/log","vb/private/monitoring/loadMonitorOptions"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g)=>{const v=d.getLogger("/vb/stateManagement/flow",[{name:"greenInfo",severity:"info",style:"green"}]);class f extends e{constructor(e,t,i,r="Flow"){let n;if(super(e,t,r),i)n=i;else if(t){n=this.getParentFlow().calculateRequirePath(e);const t=n.substr(0,n.length-1),i=t.lastIndexOf(a.PATH_SEPARATOR);this._name=i<0?t:t.substr(i+1)}else n="";Object.defineProperties(this,{path:{value:n,enumerable:!0}}),this.loadedPromise=null,this.pages={},this.defaultPage=null,this.services=null}static get PageClass(){return t}static get FlowClass(){return f}static get extensionClass(){return c}get name(){return this._name||super.name}get fullName(){return`${this.name}-flow`}get owningApp(){return this.application}calculateRequirePath(e){let t=this.definition.flows[e]||`flows/${e}`;t=s.addTrailingSlash(t);return u.parse(t).protocol||(t="/"===t[0]?`${this.owningApp.path}${t.substr(1)}`:`${this.path}${t}`),t}createFlow(e,t){return new this.constructor.FlowClass(e,t)}static get descriptorLoaderName(){return"getFlowDescriptor"}static get functionsLoaderName(){return"getFlowFunctions"}routerStateEnterCallback(e){return Promise.resolve().then((()=>{let t;if(this.defaultPage&&!0===this.defaultPage.excludeFromUrl){const i=this.pages[this.defaultPage.id];i.enter(),t=i.getContainer(e)}else t=this.getContainer(e);return t&&t.enter()}))}getParentFlow(){const{parent:e}=this;return e instanceof f?e:e&&e.getParentFlow()}isDefault(){return this.parent.definition.routerFlow===this.id}processFlowDefaultPage(e,t){if(!e)return Promise.reject(new Error(`Invalid application defaultPage "${this.defaultPage.id}"`));this.deletePage(e);const i=this.calculateRequirePath(e),r=`${this.getResourceFolder()}${i}${e}`;return f.prototype.descriptorLoader(r).then((r=>{const n="object"==typeof r.defaultPage?r.defaultPage.id:r.defaultPage;if(!n)throw new Error(`The default page for flow ${e} is not defined.`);const s=this.createPage({id:n},i);return this.pages[n]=s,s.loadDescriptor().then((e=>(this.defaultPage.excludeFromUrl=!0,this.defaultPage.id=n,this.router.defaultStateId=t||e.routerFlow,s.loadAndStart())))}))}processDefaultPage(){const e=this.defaultPage&&this.defaultPage.id;if(!e)return Promise.resolve();const t=e.split("/"),i=t[0];return t.length>1?this.processFlowDefaultPage(i,t[1]):this.getOrCreatePageFromInfo(this.defaultPage).loadDescriptor().then((e=>{let t;return!0===this.defaultPage.excludeFromUrl?(this.router.defaultStateId=e.routerFlow,t=this.pages[i].loadAndStart()):this.router.defaultStateId=i,t})).catch((e=>{let r;if(p.isFileNotFound(e))if(this.defaultPage.extension){delete this.appUiInfos.getInfo(this.defaultPage.appUiId).hostRootPage,this.pages[i].dispose(),this.log.error("Cannot find host root page",i,"in extension",this.defaultPage.extension.id),r=this.processDefaultPage()}else r=this.processFlowDefaultPage(i,t[1]);else this.router.defaultStateId=i;return r}))}loadFlow(){return this.loadedPromise=this.loadedPromise||this.loadDescriptor().then((()=>{this.defaultPage=this.definition.defaultPage})).catch((e=>{throw this.callSecurityProvider(e),e})),this.loadedPromise}load(){const e=new g(this.loadSpanName,this.getResourcePath(),this);return v.monitor(e,(e=>this.loadFlow().then((()=>this.loadFunctionModule())).then((()=>(this.initializeActionChains(),this.initializeEvents(),this.initRouter(),h.recordStateChange(h.RuntimeState.CONTAINER_ACTIVATED,this),this.createServices()))).then((()=>{v.greenInfo(this.getResourcePath(),"loaded.",e())})).catch((t=>{throw e(t),this.dispose(),t}))))}getViewModel(){return Promise.all([this.load(),this.loadFunctionModule()]).then((()=>{const e={},t=this.getAvailableContexts();return Object.getOwnPropertyNames(t).forEach((i=>{const r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r)})),e}))}createServices(){return Promise.resolve().then((()=>{const e=this.definition.services||{},t={relativePath:this.getResourceFolder(),serviceFileMap:e,expressionContext:this.getAvailableContexts(),protocolRegistry:this.application.protocolRegistry};this.services=new l(t)}))}isPageHiddenFromUrl(e){return this.defaultPage.id===e&&!0===this.defaultPage.excludeFromUrl}initDefault(e){const t=e;if(t.flows=t.flows||{},"string"==typeof t.defaultPage||!t.defaultPage){const e=t.defaultPage;t.defaultPage={id:e,excludeFromUrl:!1}}super.initDefault(t)}static get ContextType(){return o}enter(){return this.initAllVariableNamespace().then((()=>this.invokeEvent(a.ENTER_EVENT)))}initializeBuiltins(){super.initializeBuiltins(),this.createConstant(a.PATH_VARIABLE,{type:"string",defaultValue:`${this.absoluteUrl}${this.path}`},a.VariableNamespace.BUILTIN)}defineCurrentPageBuiltinVariable(){return{type:"string",defaultValue:null}}defineInfoBuiltinVariable(){return{id:this.definition.id,description:this.definition.description}}initializeVariables(){const e=this.parent;if(e&&e instanceof t){const t=e;t.initializePromise.then((()=>{if(t.scope){t.scope.getVariable(a.CURRENT_FLOW_VARIABLE,a.VariableNamespace.BUILTIN).setValueInternal(this.id)}}))}return super.initializeVariables()}getParentModuleConfig(){const e=this.parent;let t;return e&&(t=e.moduleConfig||e.getParentModuleConfig()),t}exit(){return this.invokeEvent(a.EXIT_EVENT).then((()=>{const e=this.parent;if(e&&e.router&&!e.router.defaultStateId&&(e.moduleConfig(a.blankModuleConfig),e.scope)){e.scope.getVariable(a.CURRENT_FLOW_VARIABLE,a.VariableNamespace.BUILTIN).setValueInternal(null),n.clearBusyState()}this.dispose()}))}createPage(e,t){return e.extension?new i(e,this,t):new this.constructor.PageClass(e.id,this,t)}loadContainer(e,t){return t&&t.isCancelled()?Promise.resolve():Promise.resolve().then((()=>!0===this.defaultPage.excludeFromUrl&&this.defaultPage.id!==e?this.loadPageFromInfo(this.defaultPage,t).then((i=>i.loadContainer(e,t))):this.loadPageFromInfo({id:e},t)))}getContainer(e){return!0===this.defaultPage.excludeFromUrl?this.pages[this.defaultPage.id].getContainer(e):this.pages[e]}loadPageFromId(e,t){return this.loadPageFromInfo({id:e},t)}loadPageFromInfo(e,t){return this.getOrCreatePageFromInfo(e,t).loadAndStart(t)}deletePage(e){delete this.pages[e]}getOrCreatePageFromId(e,t){return this.getOrCreatePageFromInfo({id:e},t)}getOrCreatePageFromInfo(e,t){let i=this.pages[e.id];return i||(i=this.createPage(e),this.pages[e.id]=i,t&&t.pages.push(i)),i}buildTitle(e){return this.parent.buildTitle(e)}updateCurrentPageVariable(e){this.scope.getVariable(a.CURRENT_PAGE_VARIABLE,a.VariableNamespace.BUILTIN).setValueInternal(e)}getScopeResolverMap(){const e={[a.FLOW_PREFIX]:this,[a.GLOBAL_PREFIX]:this.application};return e[a.APPLICATION_PREFIX]=this.owningApp,e}getServices(){return this.services}isAuthenticationRequired(){const{requiresAuthentication:e}=this.definition.security.access;return void 0!==e?e:this.parent?this.getParentFlow().isAuthenticationRequired():super.isAuthenticationRequired()}dispose(){Object.keys(this.pages).forEach((e=>{this.pages[e].dispose()})),this.loadedPromise=null,super.dispose()}}return f})),define("vb/private/stateManagement/redux/reduxRouter",["ojs/ojrouter","signals"],((e,t)=>{const i="@@oj/TRANSITIONED",r="router";return class{constructor(e){this.router=e,this.reducer=(t,r)=>{if(t=t||{},r.type===i){const i={};return i.routerId=e.stateId(),Object.assign({},t,i)}return t}}syncRouterWithStore(r){this.store=r,this.navigated=new t.Signal,this.signal=e.transitionedToState.add((e=>{e.hasChanged&&this.store.dispatch({type:i}),this.navigated.dispatch(e.hasChanged)}))}getState(){if(this.store)return this.store.getState().router}getRouterId(){let e=this.getState();if(e)return e.routerId}static get KEY(){return r}dispose(){this.signal&&this.signal.detach(),this.stateSubscription&&this.stateSubscription(),this.navigated&&this.navigated.removeAll()}}})),define("vb/private/stateManagement/context/applicationBaseContext",["vb/private/stateManagement/context/flowBaseContext","vb/private/constants"],((e,t)=>{const i=Symbol("application-base-accessor");class r extends e{constructor(e){super(e),Object.defineProperty(this,i,{value:{get applicationContext(){return e.expressionContext}}})}get[t.APPLICATION_USER_VARIABLE](){return this[i].applicationContext[t.APPLICATION_USER_VARIABLE]}get[t.GLOBAL_CURRENT_APPUI_VARIABLE](){return this[i].applicationContext[t.GLOBAL_CURRENT_APPUI_VARIABLE]}get builtinUtils(){return this[i].applicationContext.builtinUtils}get[t.RESPONSIVE_CONTEXT](){return this[i].applicationContext[t.RESPONSIVE_CONTEXT]}get[t.PROFILE_CONSTANT](){return this[i].applicationContext[t.PROFILE_CONSTANT]}get[t.DEPLOYMENT_CONSTANT](){return this[i].applicationContext[t.DEPLOYMENT_CONSTANT]}get[t.INIT_PARAM_CONTEXT](){return this[i].applicationContext.initParams}get[t.PATH_VARIABLE](){return this[i].applicationContext[t.PATH_VARIABLE]}get[t.CURRENT_PAGE_VARIABLE](){return this[i].applicationContext[t.CURRENT_PAGE_VARIABLE]}get[t.INFO_CONTEXT](){return this[i].applicationContext[t.INFO_CONTEXT]}}return r})),define("vb/private/ui/responsiveUtils",["vb/private/log","ojs/ojresponsiveutils","ojs/ojresponsiveknockoututils"],((e,t,i)=>{const r=e.getLogger("/vb/private/responsiveUtils");return class{static getResponsiveObservablesInterface(){const e={};Object.keys(t.FRAMEWORK_QUERY_KEY).forEach((n=>{const s=t.FRAMEWORK_QUERY_KEY[n],a=t.getFrameworkQuery(s);if(a){const t=i.createMediaQueryObservable(a);e[n]=t}else r.fine("unable to create media query observable for","ojResponsiveUtils.FRAMEWORK_QUERY_KEY",n)}));try{e.screenRange=i.createScreenRangeObservable()}catch(e){r.warn("error calling ojResponsiveKnockoutUtils.createScreenRangeObservable:",e)}const n={SM_UP:"smUp",MD_UP:"mdUp",LG_UP:"lgUp",XL_UP:"xlUp",SM_ONLY:"smOnly",MD_ONLY:"mdOnly",LG_ONLY:"lgOnly"};return Object.keys(n).forEach((t=>{e[t]&&Object.defineProperty(e,n[t],{get:()=>e[t](),enumerable:!0,configurable:!0})})),Object.seal(e),e}}})),define("vb/private/stateManagement/context/applicationContext",["vb/private/constants","vb/private/stateManagement/context/flowContext","vb/private/stateManagement/context/applicationBaseContext","vb/private/ui/responsiveUtils"],((e,t,i,r)=>{const n=Symbol("application-accessor");let s=null;class a extends t{constructor(t){super(t),Object.defineProperty(this,n,{value:{get initParams(){return t.initParams},get builtinUtils(){return t.builtinUtils},get builtins(){return t.scope.variableNamespaces[e.VariableNamespace.BUILTIN]}}})}static get BaseContextType(){return i}get[e.APPLICATION_USER_VARIABLE](){return this[n].builtins[e.APPLICATION_USER_VARIABLE]}get[e.GLOBAL_CURRENT_APPUI_VARIABLE](){return this[n].builtins[e.GLOBAL_CURRENT_APPUI_VARIABLE]}get builtinUtils(){return this[n].builtinUtils}get[e.RESPONSIVE_CONTEXT](){return s||(s=r.getResponsiveObservablesInterface()),s}get[e.PROFILE_CONSTANT](){return this[n].builtins[e.PROFILE_CONSTANT]}get[e.DEPLOYMENT_CONSTANT](){return this[n].builtins[e.DEPLOYMENT_CONSTANT]}get[e.INIT_PARAM_CONTEXT](){return this[n].initParams}static getAvailableContexts(t){const i=super.getAvailableContexts(t);return delete i.$flow,Object.defineProperties(i,{$builtinUtils:{enumerable:!0,configurable:!0,get:()=>t.expressionContext.builtinUtils},[e.ContextName.INIT_PARAMS]:{enumerable:!0,configurable:!0,get:()=>t.expressionContext.initParams}}),i}}return a})),define("vb/private/stateManagement/containerRjsInitMixin",["vb/private/configLoader"],(e=>t=>class extends t{constructor(...e){super(...e),this.containerRjsConfig={}}get implicitResourceFolder(){return!1}loadContainerDependencies(){return this.initializeRequirejsMappings(),super.loadContainerDependencies()}initializeRequirejsMappings(){(this.definition&&this.definition.requirejs||this.implicitResourceFolder)&&(this.containerRjsConfig=e.addRequirejsConfigFromContainer(this,this.implicitResourceFolder))}})),define("vb/private/stateManagement/applicationExtension",["vb/helpers/mixin","vb/private/constants","vb/private/stateManagement/containerRjsInitMixin","vb/private/stateManagement/flowExtension"],((e,t,i,r)=>{class n extends(e(r).with(i)){constructor(e,t,i,r="ApplicationExtension"){super(e,t,i,r)}static get extensionClass(){return n}get eventPrefix(){return"application"}getAllServices(){return[this.services]}createServices(){return Promise.resolve().then((()=>{const e=this.getResourceFolder(),t=this.definition.services||{},i={namespace:this.extensionId,relativePath:e,expressionContext:this.getAvailableContexts(),protocolRegistry:this.application.protocolRegistry,serviceFileMap:t};return this.application.extensionRegistry.loadServicesModel(this.extensionId,i)})).then((e=>{this.services=e}))}getScopeResolverMap(){return{[t.GLOBAL_PREFIX]:this,[t.APPLICATION_PREFIX]:this}}}return n})),define("vb/private/stateManagement/shellPageInfo",[],(()=>class{constructor(e,t){if(this.id=e.definition.defaultPage.id,t){this.appUiId=t;const i=e.appUiInfos.getInfo(t);if(i){const r=i.hostRootPage;r&&(this.id=r,this.extension=e.appUiInfos.getExtension(t))}}this.excludeFromUrl=!0}})),define("vb/private/stateManagement/appPackageExtension",["vb/helpers/mixin","vb/private/constants","vb/private/stateManagement/flowExtension","vb/private/stateManagement/containerRjsInitMixin"],((e,t,i,r)=>{class n extends(e(i).with(r)){constructor(e,t,i,r="AppPackageExtension"){super(e,t,i,r)}static get extensionClass(){return n}static get resourceSuffix(){return"-x.json"}get eventPrefix(){return"application"}static get descriptorLoaderName(){return"getAppUiExtensionDescriptor"}static get functionsLoaderName(){return"getAppUiExtensionFunctions"}get implicitResourceFolder(){return!0}getScopeResolverMap(){return{[t.APP_UI_PREFIX]:this,[t.GLOBAL_PREFIX]:this.application}}}return n})),define("vb/private/stateManagement/packageContainerMixin",["vb/private/utils","vb/private/stateManagement/container","vb/private/constants"],((e,t,i)=>r=>class extends r{get package(){return this.parent.package}isNavigable(){const{navigation:e}=this.definition;return e&&e.fromExternal===i.FROM_EXTERNAL_NAVIGATION_ENABLED?(this.parent.isNavigable()||this.log.error("Navigation to parent",this.parent.getNavPath(),"is not enabled."),!0):!(!this.isDefault()||!this.parent.isNavigable())}checkNavigable(){if(!this.isNavigable())throw new Error(`Navigation to ${this.getNavPath()} is not enabled.`)}adjustImportPath(i){const r=this.baseUrl,n=this.package&&this.package.path;if(!t.isJetComponent(i)&&r&&n){const t=requirejs.toUrl(r);if(this.package){let n=this.package.localRjs;if(!n){const i=this.package.containerRjsConfig||{},{containerContextPath:r,map:s={}}=i;if(r){let a;const o=r.split("/");if(o.length){let t=o[0];for(let r=1;r<o.length;r++)if(t=`${t}/${o[r]}`,s[t]){a||(a=e.cloneObject(i));const r=a.map||{},n=r["*"]||(r["*"]={}),o=s[t];Object.keys(o).forEach((e=>{n[e]=o[e]}))}}a&&(a.context=`${t}${r}`,n=requirejs.config(a),this.package.localRjs=n)}}if(n){const e=n.toUrl(i);if(e.startsWith(t)){return`${r}${e.substring(t.length)}`}}}}return i}})),define("vb/private/stateManagement/packageFragment",["vb/private/stateManagement/fragment","vb/private/constants","vb/private/utils","vb/helpers/mixin","vb/private/stateManagement/packageContainerMixin","vb/private/stateManagement/packageAndExtensionContainerMixin"],((e,t,i,r,n,s)=>{const a="extension";class o extends(r(e).with(n,s)){constructor(e,t,r="PackageFragment",n,s,a){if(super(e,t,r,n,s,a),this.fragmentExtensionId=void 0,this.fragmentName){const e=i.parseQualifiedIdentifier(this.fragmentName,{prefixToken:":",suffixToken:""}),t=e.main,r=e.prefix;r&&(this.fragmentExtensionId=r,this.fragmentName=t)}this.callingContext=void 0;let o;o=t.getCallingContext?t.getCallingContext().sourceExtension:t.extension,this.callingContext={sourceExtension:o,parentExtension:t.extension,owningExtension:(e=>{let t=e;if(!t&&this.parent&&this.parent.callingContext){t=this.parent.callingContext.owningExtension.id}const i=this.scopeResolver&&this.scopeResolver.global||this.application,r=i.extensionRegistry&&i.extensionRegistry.extensions;if(r)return r[t]})(this.fragmentExtensionId)||t.extension},Object.defineProperties(this,{package:{value:this.getPackage(t),enumerable:!0}})}get resourceLoc(){return`${t.DefaultPaths.UI}${t.ExtensionFolders.SELF}/${this.path}`}get extension(){return this.callingContext.owningExtension}get eventPrefix(){return"fragment"}getPackage(e){return e&&e.package}getCallingContext(){return this.callingContext}allowsEventPropagation(e,i){const r=this.callingContext,n=this.fragmentExtensionId&&r&&r.parentExtension!==r.owningExtension,s=super.allowsEventPropagation(e,i);return e===t.EventPropagationBehaviors.CONTAINER&&s&&n&&!i.isInterface?(this.log.warn("Fragment Event",i.name,"is not an interface event and so cannot be dispatched to","the outer container as a result. Check your configuration"),!1):s}static get FragmentClass(){return o}checkFragmentAccess(e){const{referenceable:t}=e,i=this.callingContext;return(!(this.fragmentExtensionId&&i&&i.parentExtension!==i.owningExtension)||t===a)&&super.checkFragmentAccess(e)}descriptorLoader(e){return Promise.resolve().then((()=>{const t=this.resourceLoc;return this.extension.fileExists(`${t}${this.fullName}.json`,this.extension.id),super.descriptorLoader(e)}))}functionsLoader(e){const t=this.resourceLoc;return Promise.resolve().then((()=>(this.extension.fileExists(`${t}${this.fullName}.js`,this.extension.id),super.functionsLoader(e))))}templateLoader(e){const t=this.resourceLoc;return Promise.resolve().then((()=>(this.extension.fileExists(`${t}${this.fullName}.html`,this.extension.id),super.templateLoader(e))))}get fullName(){return`${this.resourceName}-fragment`}getScopeResolverMap(){const e={},i=this.parent&&this.parent.getScopeResolverMap()||{};return i[t.GLOBAL_PREFIX]&&(e[t.GLOBAL_PREFIX]=i[t.GLOBAL_PREFIX]),Object.assign({[t.FRAGMENT_PREFIX]:this},e)}}return o})),define("vb/private/stateManagement/packagePage",["vb/helpers/mixin","vb/private/stateManagement/packageContainerMixin","vb/private/stateManagement/packageAndExtensionContainerMixin","vb/private/stateManagement/pageInExtension","vb/private/stateManagement/packageFragment","vb/private/constants"],((e,t,i,r,n)=>{class s extends(e(r).with(t,i)){constructor(e,t,i,r="PackagePage"){super({id:e,extension:t.package.extension},t,i,r)}static get FragmentClass(){return n}}return s})),define("vb/private/stateManagement/packageFlow",["vb/helpers/mixin","vb/private/stateManagement/flow","vb/private/stateManagement/packageContainerMixin","vb/private/stateManagement/packageAndExtensionContainerMixin","vb/private/stateManagement/packagePage","vb/private/constants"],((e,t,i,r,n,s)=>{class a extends(e(t).with(i,r)){constructor(e,t,i,r="PackageFlow"){super(e,t,i,r),t.package&&(this._extension=t.package.extension)}static get PageClass(){return n}static get FlowClass(){return a}get resourceLoc(){return`${s.DefaultPaths.UI}${s.ExtensionFolders.SELF}/${this.path}`}get eventPrefix(){return"flow"}get owningApp(){return this.package}checkResourceExist(e){this.extension.fileExists(`${this.resourceLoc}${this.fullName}.${e}`)}descriptorLoader(e){return Promise.resolve().then((()=>(this.checkResourceExist("json"),super.descriptorLoader(e))))}functionsLoader(e){return Promise.resolve().then((()=>(this.checkResourceExist("js"),super.functionsLoader(e))))}isDefault(){const e=this.parent.definition;return e.routerFlow===this.id||e.defaultFlow===this.id}}return a})),define("vb/private/stateManagement/context/appPackageContext",["vb/private/constants","vb/private/stateManagement/context/flowContext"],((e,t)=>{const i=Symbol("app-ui-accessor");class r extends t{constructor(t){super(t),Object.defineProperty(this,i,{value:{get global(){const e=t.application.extensions[t.extensionId];return e&&e.expressionContext.application},get builtins(){return t.scope.variableNamespaces[e.VariableNamespace.BUILTIN]}}})}get[e.RESPONSIVE_CONTEXT](){return this[i].global[e.RESPONSIVE_CONTEXT]}get[e.APPLICATION_USER_VARIABLE](){return this[i].global[e.APPLICATION_USER_VARIABLE]}get[e.INIT_PARAM_CONTEXT](){return this[i].global[e.INIT_PARAM_CONTEXT]}get[e.CURRENT_PAGE_VARIABLE](){return this[i].global[e.CURRENT_PAGE_VARIABLE]}get[e.DEPLOYMENT_CONSTANT](){return this[i].global[e.DEPLOYMENT_CONSTANT]}get global(){return this[i].global}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return delete t.$flow,Object.defineProperties(t,{$global:{enumerable:!0,configurable:!0,get:()=>e.expressionContext.global}}),t}}return r})),define("vbc/private/pwa/pwaUtils",["vbc/private/constants","vbc/private/utils"],((e,t)=>{const i={method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"}};class r{static isOnline(){return t.isOnline()}static isPwaConfig(e){return r.isMobilePwaConfig(e)||r.isWebPwaConfig(e)}static isMobilePwaConfig(e){return!(!e||e.IS_DT_MODE||!e.SERVICE_WORKER_CONFIG||e.SERVICE_WORKER_CONFIG.disabled||!r.isPwaShellPath(e.SERVICE_WORKER_CONFIG.shellPath))}static isWebPwaConfig(e){return!(!e||!e.PWA_CONFIG||e.PWA_CONFIG.disabled)}static shouldAddBeforeInstallPromptListener(e){return r.isMobilePwaConfig(e)||!(!r.isWebPwaConfig(e)||e.PWA_CONFIG.skipBeforeInstallPrompt)}static isPwaShellPath(e){return"string"==typeof e&&e.trim().length>0}static getServiceWorkerScope(){return Promise.resolve().then((()=>navigator.serviceWorker.getRegistration())).then((e=>e.scope)).catch((()=>{}))}static loadAppShellFile(e,t,r){return Promise.resolve().then((()=>{if(!e)throw new Error("loadAppShellFile(): empty application shell path specified");const n=new Request(e,i);return t.call(r,n)})).then((t=>{if(t&&t.ok)return t.text();throw new Error(`loadAppShellFile(${e}): invalid response: ${t?t.status:t}`)})).then((t=>{if(t)return JSON.parse(t);throw new Error(`loadAppShellFile(${e}): result.text is empty`)}))}static postSlash(t){return t?t.trim().endsWith(e.PATH_SEPARATOR)?t:`${t.trim()}${e.PATH_SEPARATOR}`:""}}return r})),define("vbsw/private/utils",["vbc/private/utils","vbc/private/pwa/pwaUtils"],((e,t)=>{class i extends e{static getResources(e){return new Promise(((t,i)=>{require(e,((...e)=>{t(e)}),i)}))}static resolveClient(e){return"string"==typeof e?self.clients.get(e):Promise.resolve(e)}static invokeMethod(e,t,r){const n=t.method,s=e&&e.config&&e.config.nonce||"";if(!e||!e[n]||"function"!=typeof e[n]){const t=`unable to invoke method "${n}" on target ${e}`;return console.error(t),void i.postResponse(r,Promise.reject(new Error(t)),`Service Worker (${s}): ${n}`)}const a=t.args||[];(t.options||{}).addClientToArgs&&a.push(r),i.postResponse(r,e[n](...a),`Service Worker (${s}): ${n}`)}static postMessage(e,t){return new Promise(((r,n)=>{const s=new MessageChannel;s.port1.onmessage=e=>{console.log("Message received from client",e.data);const t=e.data;t.method?i.postResponse(e.ports[0],i.postMessage(null,t),`${t.method}`):t.success?r(t.result):n(JSON.parse(t.error))},s.port1.onmessageerror=()=>{n("Failed to send message to client.")},i.resolveClient(e).then((e=>{e?e.postMessage(t,[s.port2]):window.postMessage(t,"*",[s.port2])})).catch(n)}))}static postResponse(e,t,r){Promise.resolve(t).then((t=>{console.log(r,"invoked with result:",t),e.postMessage({success:!0,result:t})})).catch((t=>{console.log(r,"invoked with error:",t),e.postMessage({success:!1,error:JSON.stringify(t,i.replaceErrors)})}))}static replaceErrors(e,t){if(t instanceof Error){const e={};return Object.getOwnPropertyNames(t).forEach((function(i){e[i]=t[i]})),e}return t}static extractJwtPayload(e){try{let t=e.split(".")[1];t=t.replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(t))}catch(e){return null}}static getEpochTime(e=!1){const t=(new Date).getTime();return e?t:Math.round(t/1e3)}static extractJwtExpiration(e){const t=i.extractJwtPayload(e);if(t&&t.exp&&t.iat){const e=i.getEpochTime()-t.iat;return{time:t.exp,skew:e}}return null}static checkJwtExpiration(e,t){if(e){const r=i.getEpochTime();if(r-e.skew>=e.time)return!0;if(r-e.time>=t)return!0}return!1}static generateUID(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:3&i|8).toString(16)}))}static getCookie(e,t){const r={method:"vbGetCookie",args:[t]};return i.postMessage(e,r)}static deleteCookie(e,t){const r={method:"vbDeleteCookie",args:[t]};return i.postMessage(e,r)}static setCookie(e,t,r){const n={method:"vbSetCookie",args:[t,r]};return i.postMessage(e,n)}static getRegexForAppScope(e,i){const r=e||"/";if(r.indexOf("ic/builder")>=0){const e=r.split("/");let n=2;t.isWebPwaConfig(i)&&(n=4);let s=1;const a=e.pop();for(;!a&&s<n&&s<e.length;)e.pop(),s+=1;return`${e.join("/")}/[^/]+/`}return r}static getTokenRelayUrl(e,t){return`${e}/services/auth/1.1/tokenrelay/${t}`}static getProxyUrl(e,t){return`${e}/services/auth/1.1/proxy/${t}/uri/`}}return i})),define("vbsw/private/stateCache",[],(()=>{class e{constructor(e,t){this.swCache=e,this.namespace=t?`${t}_namespace`:null,this.memoryCache={}}createNamespacedCache(t){return new e(this.swCache,t)}get(e){const t=this.namespace||e;return this.getInternal(t).then((t=>t&&this.namespace?t[e]:t))}getInternal(e){return this.swCache?this.swCache.match(e).then((e=>{if(e)return e.json()})):Promise.resolve(this.memoryCache[e])}put(e,t){return this.namespace?this.getInternal(this.namespace).then((i=>{const r=i||{};return r[e]=t,this.putInternal(this.namespace,r)})):this.putInternal(e,t)}putOpaque(e,t){return this.swCache?this.swCache.put(e,t).catch((t=>{console.log("putOpaque",e,"failed with",t)})):Promise.resolve()}putInternal(e,t){if(this.swCache){const i=new Response(JSON.stringify(t));return this.swCache.put(e,i).catch((t=>{console.log("putInternal",e,"failed with",t)}))}return this.memoryCache[e]=t,Promise.resolve()}getResponse(e,t){return this.swCache?this.swCache.match(e,t):Promise.resolve()}add(t){return this.swCache?this.swCache.add(t).catch((i=>{console.log("add",t,"failed with",i),e.checkQuota()})):Promise.resolve()}delete(e){return this.namespace?this.getInternal(this.namespace).then((t=>{const i=t||{};return delete i[e],this.putInternal(this.namespace,i)})):this.deleteInternal(e)}deleteInternal(e){return this.swCache?this.swCache.delete(e):(delete this.memoryCache[e],Promise.resolve())}clear(){return this.namespace?this.deleteInternal(this.namespace):Promise.reject("StateCache.clear is not supported for a cache without a namespace.")}isEmpty(){return Promise.resolve(this.swCache.keys()).then((e=>!(Array.isArray(e)&&e.length>0)))}static checkQuota(){"storage"in navigator&&"estimate"in navigator.storage&&navigator.storage.estimate().then((({usage:e,quota:t})=>{console.log("checkQuota: Using",e,"out of",t,"bytes.")}))}}return e})),define("vbsw/private/cacheStrategy",[],(()=>class{constructor(e){this.config=e}shouldCheckCache(e){return Promise.resolve(!1)}checkCache(e,t){return Promise.resolve()}cacheOnInstall(){return Promise.resolve()}cacheOnRequest(){return Promise.resolve()}fetchAndCache(e){return Promise.resolve()}})),define("vbsw/private/pwa/pwaUtils",["vbsw/private/constants","vbc/private/pwa/pwaUtils"],((e,t)=>{class i extends t{static computeAppPath(t){if(!t)return;let i="";return t.IS_DT_MODE&&(i+="preview/"),t.APP_PATH&&(i+=t.APP_PATH.endsWith(e.PATH_SEPARATOR)?t.APP_PATH:`${t.APP_PATH}${e.PATH_SEPARATOR}`),i.length>0?i:void 0}static getLocale(){return"en-US"}static parseLocale(e){const t=[];if("string"==typeof e){const i=e.split("-");let r,n;t.push(...i.map((e=>(n=r?`${r}-${e}`:e,r=n,n))))}return t}static isJetRequest(e,t){return!(!t||!t.jetPath)&&e.startsWith(t.jetPath)}static constructScopeRelativeResourcePath(e,t){return`.${i.constructRelativeResourcePath(e,t)}`}static constructRelativeResourcePath(t,r){const n=`${i.postSlash(t)}${i.postSlash(r)}`;return n?n.startsWith(e.PATH_SEPARATOR)?`${n}`:`${e.PATH_SEPARATOR}${n}`:e.PATH_SEPARATOR}}return i})),define("vbsw/private/pwa/appShell",["vbsw/private/pwa/pwaUtils","vbc/private/log","vbc/private/performance/performance"],((e,t,i)=>{const r=t.getLogger("/vbsw/private/pwa/appShell"),n="skipCacheLookupPattern",s=["lib/third-party-libs.js","resources/vb-icon-font.css","resources/vb-icon-font.woff"];class a{constructor(e){this.fetchHandler=e}loadAppShellFile(t){return e.loadAppShellFile(t,this.fetchHandler.handleRequest,this.fetchHandler)}static getVBCacheList(t="",i){return Promise.resolve().then((()=>{let r=[];return r.push(...s),r.push(`visual-runtime${i?"-debug":""}.js`),r.push(`visual-runtime${i?"-debug":""}.js.map`),r=r.map((i=>`${e.postSlash(t)}${i}`)),r}))}cacheVB(e="",t){const r=["appShell.cacheVB"];return Promise.resolve().then((()=>i.markStart(r))).then((()=>a.getVBCacheList(e,t))).then((e=>this.cache(e))).then((e=>(i.markEnd(r),e)))}static getAppFilesCacheList(t=[],i,r){return Promise.resolve().then((()=>{const n=[];if(t){const s=e.constructScopeRelativeResourcePath(i,r);n.push(...t.map((e=>`${s}${e}`)))}return n}))}cacheAppFiles(e=[],t,r){const n=["appShell.cacheAppShell"];return Promise.resolve().then((()=>i.markStart(n))).then((()=>a.getAppFilesCacheList(e,t,r))).then((e=>this.cacheApplicationAssets(e))).then((e=>(i.markEnd(n),e)))}static getUnversionedAssetsList(t){return Promise.resolve().then((()=>{const i=[],n=e.constructScopeRelativeResourcePath(t);return r.info("PWA: getUnversionedAssetsList (",n,")"),i.push(n),i.push(`${n}manifest.json`),i}))}cacheUnversionedAssets(e){return a.getUnversionedAssetsList(e).then((e=>this.cacheApplicationAssets(e)))}cacheFiles(e=[]){return Promise.resolve().then((()=>(r.info("PWA: cacheFiles()"),e.map((e=>fetch(e).then((t=>this.fetchHandler.stateCache.putOpaque(e,t)))))))).then((e=>Promise.all(e)))}cache(e=[]){return Promise.resolve().then((()=>{const t=e.map((e=>this.fetchHandler.cacheFile(e).catch((t=>{r.error("PWA: cache",e,t)}))));return Promise.all(t)}))}cacheApplicationAssets(e){return Promise.resolve().then((()=>{if(e&&e.length>0&&void 0!==this.fetchHandler.appCache){const t=e.map((e=>this.fetchHandler.appCache.add(e).catch((t=>{r.error("PWA: cacheApplicationAssets",e,t)}))));return Promise.all(t)}return r.info("PWA: cacheApplicationAssets(): no files cached"),Promise.resolve([])}))}cacheSkipCacheLookupPattern(e){return Promise.resolve().then((()=>{if(e.skipCacheLookupPattern)return this.fetchHandler.stateCache.put(n,e.skipCacheLookupPattern)}))}getSkipCacheLookupPattern(){return this.fetchHandler.stateCache.get(n)}cacheAppShell({shellPath:e,appPath:t,baseUrlToken:i,modulePath:n,debug:s=!1}){return Promise.resolve().then((()=>(r.info("PWA: cacheAppShell()"),this.cacheVB(n,s)))).then((()=>this.cacheUnversionedAssets(t))).then((()=>this.loadAppShellFile(e))).then((e=>{if(e){const r=this.cacheSkipCacheLookupPattern(e),n=this.cacheAppFiles(e.appFiles,t,i),s=this.cacheFiles(e.files);return Promise.all([n,s,r])}throw new Error("cacheAppShell(): No app shell")})).catch((t=>{r.error("PWA: cacheAppShell(",e,")",t)}))}}return a})),define("vbsw/private/pwa/pwaCacheStrategy",["vbsw/private/pwa/appShell","vbsw/private/cacheStrategy","vbsw/private/pwa/pwaUtils","vbc/private/log","vbsw/private/constants"],((e,t,i,r,n)=>{const s=r.getLogger("/vbsw/private/pwa/pwaCacheStrategy"),a={mode:"cors"};return class extends t{constructor(t){super(t.config),this.handler=t,this.appShell=new e(t),this.ignoreSearchOptions=t.config&&t.config.skipIgnoreSearch?void 0:{ignoreSearch:!0}}getIgnoreSearchOptions(e){return e.indexOf("?")>0?this.ignoreSearchOptions:void 0}getSkipCacheLookupRegEx(){return Promise.resolve().then((()=>(this.skipCacheLookupRegExPromise||(this.skipCacheLookupRegExPromise=this.appShell.getSkipCacheLookupPattern().then((e=>{if(e)try{s.info(`PWA: skip cache lookup pattern found: '${e}'`);const t=new RegExp(e);return s.info(`PWA: skip cache lookup RegEx constructed: ${t}`),t}catch(t){s.error(`Could not create skip cache lookup regular expression from '${e}'`,t)}}))),this.skipCacheLookupRegExPromise)))}shouldCheckCache(e){return this.getSkipCacheLookupRegEx().then((t=>t&&t.test(e)?(s.info(`PWA: skipping cache lookup for ${e}`),Promise.resolve(!1)):Promise.resolve(!0)))}checkCache(e,t){const i=this.getIgnoreSearchOptions(e);return Promise.resolve().then((()=>{if(this.handler&&this.handler.stateCache)return this.handler.stateCache.getResponse(e,i)})).then((r=>r||this.getStartUrl().then((r=>{if(!r||!e.endsWith(r)||t===n.LOOKUP_INDEX_MODE)return this.handler.appCache?(s.finer("PWA: checkCache(): cache lookup for",e),this.handler.appCache.getResponse(e,i)):void 0;s.finer("PWA: checkCache(): skipped cache lookup for",r)})))).catch((t=>{s.warn("PWA: checkCache(): failed to checkCache for",e,t)}))}getStartUrl(){return Promise.resolve().then((()=>{if(i.isOnline())return i.constructRelativeResourcePath(this.config.appPath)}))}cacheOnInstall(){return s.info("PWA: cacheOnInstall:",this.config),this.appShell.cacheAppShell(this.config).then((()=>{this.skipCacheLookupRegExPromise=null}))}cacheOnRequest(){return this.detectEmptyCaches().then((e=>{if(e)return s.warn("PWA: cacheOnRequest:",this.config,": empty caches detected."),this.handler.openCaches().then((()=>this.appShell.cacheAppShell(this.config)))})).catch((e=>{s.error("PWA: Failed to cacheOnRequest:",e)}))}detectEmptyCaches(){return Promise.all([this.handler.appCache.isEmpty(),this.handler.stateCache.isEmpty()]).then((e=>e.some((e=>e)))).catch((()=>!0))}fetchAndCache(e){return Promise.resolve().then((()=>{if(i.isJetRequest(e.url,this.config)){let t=e;return"no-cors"===e.mode&&(t=new Request(e.url,a)),this._fetchAndCache(t)}})).catch((t=>{console.log("PWA: Failed to fetchAndCache",e.url,t)}))}_fetchAndCache(e){return fetch(e).then((t=>t?(s.finer("PWA: fetchAndCache() request url:",e.url),this.handler.stateCache.putOpaque(e,t.clone())):t))}}})),define("vbsw/private/cacheStrategyFactory",["vbsw/private/cacheStrategy","vbsw/private/pwa/pwaCacheStrategy"],((e,t)=>class{static createCacheStrategy(i){const r=i.config;return r&&!r.disabled&&r.isPwa?new t(i):new e(r)}})),define("vbsw/api/fetchHandlerPlugin",[],(()=>class{constructor(e,t={}){e&&(this.fetchHandler=e.fetchHandler,this.stateCache=e.stateCache),this.params=t}initCache(){return this.stateCache?this.stateCache.clear():Promise.resolve()}handleRequestHook(e,t){return Promise.resolve()}handleResponseHook(e,t,i,r){return Promise.resolve(!1)}handleErrorHook(e,t,i,r){return Promise.resolve(!1)}static getRequestConfig(e,t){let i;return Promise.resolve().then((()=>{const r={};for(const t of e.headers.entries())t&&t.length>=2&&(r[t[0]]=t[1]);if(i={url:e.url,method:e.method,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,headers:r},e.signal&&(i.signal=e.signal),"PUT"===e.method||"POST"===e.method||"PATCH"===e.method||"DELETE"===e.method)if(e._bodyFormData&&t.isFetchPolyfill())i.bodyFormData=e._bodyFormData,i.bodyInit=e._bodyInit;else{if(!e.originalBody)return e.clone().arrayBuffer().then((e=>(e.byteLength>0&&(i.body=e),i)));i.body=e.originalBody,i.attachOrignalBody=!0,i.body instanceof FormData&&delete i.headers["content-type"]}return i})).catch((e=>{throw console.warn(`attempt to clone request failed, using original: ${e}`),e}))}})),define("vbsw/private/pwa/applicationCache",["vbsw/private/stateCache"],(e=>class extends e{get(e){return this.swCache?this.swCache.match(e).then((e=>e?e.json():Promise.resolve())):Promise.resolve()}put(e,t){return this.swCache?this.swCache.put(e,t).catch((t=>{console.log("put",e,"failed with",t)})):Promise.resolve()}getResponse(e,t){return this.swCache?this.swCache.match(e,t):Promise.resolve()}})),define("vbsw/private/optCacheStrategies",["vbsw/private/utils","vbc/private/log"],((e,t)=>{const i=t.getLogger("/vbsw/private/mobileCacheStrategies");function r(e,t){const i=e.get("Cache-Control");if(i){const e=i.split(",");let r,n,s;for(r=0;r<e.length;r+=1)if(n=e[r].trim(),0===n.indexOf(t))return s=n.split("="),!(s.length>1)||s[1].trim()}return null}function n(e,t,r,n,s){return Promise.resolve().then((()=>n.isCachedResponse(t)?s.isOnline()?s.browserFetch(e).then((r=>304===r.status?t:s.getCache().delete(e).then((()=>(i.info("Removing old entry based on HTTP revalidation"),r))))):r?n.responseToJSON(t).then((e=>(e.status=504,e.statusText="cache-control: must-revalidate failed due to application being offline",i.info("Returning Response status 504 based HTTP revalidation"),n.responseFromJSON(e)))):t:t))}return{getHttpCacheHeaderStrategy:function(){return(t,s)=>e.getResources(["persist/persistenceManager","persist/persistenceUtils"]).then((e=>{const[a,o]=e;return function(e,t,r){return Promise.resolve().then((()=>{const e=t.headers.get("Expires"),n=t.headers.get("x-oracle-jscpt-cache-expiration-date");return!e||!r.isCachedResponse(t)||n&&0!==n.length||(t.headers.set("x-oracle-jscpt-cache-expiration-date",e),i.info("Set x-oracle-jscpt-cache-expiration-date header based on HTTP Expires header")),t}))}(0,s,o).then((e=>function(e,t,n){return Promise.resolve().then((()=>{const s=r(t.headers,"max-age");if(null!=s&&n.isCachedResponse(t)){let r=e.headers.get("Date");r||(r=(new Date).toUTCString());const n=new Date(r).getTime(),a=new Date(n+1e3*s);t.headers.set("x-oracle-jscpt-cache-expiration-date",a.toUTCString()),i.info("Set x-oracle-jscpt-cache-expiration-date header based on HTTP max-age header")}return t}))}(t,e,o))).then((e=>function(e,t,r,s){return Promise.resolve().then((()=>{const a=e.headers.get("If-Match"),o=e.headers.get("If-None-Match");if(a||o){if(s.isOnline())return n(e,t,!1,r,s);{const e=t.headers.get("ETag");if(a&&e.indexOf(a)<0)return r.responseToJSON(t).then((e=>(e.status=412,e.statusText="If-Match failed due to no matching ETag while offline",i.info("Returning Response status 412 based on ETag and HTTP If-Match header"),r.responseFromJSON(e))));if(o&&e.indexOf(o)>=0)return r.responseToJSON(t).then((e=>(e.status=412,e.statusText="If-None-Match failed due to matching ETag while offline",i.info("Returning Response status 412 based on ETag and HTTP If-None-Match header"),r.responseFromJSON(e))))}}return t}))}(t,e,o,a))).then((e=>function(e,t,s,a){return Promise.resolve().then((()=>{if(r(t.headers,"must-revalidate")){const r=t.headers.get("x-oracle-jscpt-cache-expiration-date");if(r){const o=new Date(r).getTime();if((new Date).getTime()>o)return i.info("Handling revalidation HTTP must-revalidate header"),n(e,t,!0,s,a)}}return t}))}(t,e,o,a))).then((e=>function(e,t,r,n){return Promise.resolve().then((()=>{if(null!=t&&!r.isCachedResponse(t)&&("GET"===e.method||"HEAD"===e.method)){const r=t.clone();return n.getCache().put(e,t).then((()=>(i.info("Cached Request/Response"),r)))}return t}))}(t,e,o,a)))}))}}})),define("vbsw/private/optCacheStrategiesFactory",["vbc/private/utils","vbsw/private/optCacheStrategies"],((e,t)=>class{static getCacheStrategy(i,r){return e.isMobile()||i.isWebPwa&&i.registryUrl&&r.url.startsWith(i.registryUrl)?{cacheStrategy:t.getHttpCacheHeaderStrategy()}:{cacheStrategy:null}}})),define("vbsw/private/urlMapperClient",["vbc/private/log","vbsw/private/utils","urijs/URI"],((e,t,i)=>{const r=e.getLogger("/vbsw/private/plugins/utils/urlMapperClient");class n{constructor(e){let i=[];if(e){if(!1!==e.includeDefaultPrefixes){if(e.applicationUrl){!!e.baseUrlToken&&"/"===e.baseUrlToken[0]||i.push(new Request(e.applicationUrl).url)}e.baseUrl&&e.baseUrl!==e.applicationUrl&&i.push(new Request(e.baseUrl).url),e.baseProxyUrl&&e.baseProxyUrl!==e.applicationUrl&&i.push(new Request(e.baseProxyUrl).url),e.baseTokenRelayUrl&&e.baseTokenRelayUrl!==e.applicationUrl&&i.push(new Request(e.baseTokenRelayUrl).url),e.modulePath&&i.push(new Request(e.modulePath).url),e.jetPath&&i.push(new Request(e.jetPath).url);const r=t.getTokenRelayUrl(".*","");i.push(r.replace(/\/$/,"(\\/|$)"));const n=t.getProxyUrl(".*",".*");i.push(n);const s=e.userConfig&&e.userConfig.configuration&&e.userConfig.configuration.url;s&&(i.push(new Request(s).url),i.push(`.*${s}`))}e.prefixesToIgnore&&Array.isArray(e.prefixesToIgnore)&&(i=i.concat(e.prefixesToIgnore))}i.length?this.ignoreForMapping=new RegExp(`^(${i.join("|")})`,"i"):this.ignoreForMapping=e&&e.ignoreRegex?new RegExp(e.ignoreRegex):/\/catalog.json$/g}getMapping(e,t){return Promise.resolve().then((()=>{if(this.ignoreForMapping.test(e.url))return null;let i;r.fine(`getMapping called with: ${e.url}`);const n=new Promise(((t,r)=>{i=setTimeout((()=>{r(new Error(`urlMapper postMessage timeout: ${e.url}`))}),a.MAPPER_POSTMESSAGE_TIMEOUT)})),s=this.requestMapping(e.url,t);return s.then((()=>{i&&clearTimeout(i)})),Promise.race([s,n])})).catch((t=>(r.warn("UrlMapperClient is unable to request mapping, continuing",e.url,t),null)))}requestMapping(e,r){let n;return Promise.resolve().then((()=>{if(this.disabled)return null;const s=i.parse(e);n=s.query,s.query=null;const a={method:"vbGetUrlMapping",args:[i.build(s)]};return t.postMessage(r,a)})).then((e=>{if(n&&e&&e.urlToFetch){const t=i.parse(e.urlToFetch);t.query=n,e.urlToFetch=i.build(t)}return e}))}}class s{constructor(){r.warn("URL Mapping is disabled by configuration")}getMapping(){return Promise.resolve(null)}}class a{constructor(e){this.config=e?Object.assign({},e.urlMapping||{},{applicationUrl:e.applicationUrl,baseUrl:e.baseUrl,baseUrlToken:e.baseUrlToken,modulePath:e.modulePath,jetPath:e.jetPath,userConfig:e.userConfig}):{},this.activated=!1}init(){return this.initPromise||(this.initPromise=Promise.resolve().then((()=>{this.config.disabled?this.delegate=new s:this.delegate=new n(this.config)})).catch((e=>{r.warn("error initializing URL Mapping, disabled"),r.error(e),this.delegate=new s}))),this.initPromise}getMapping(e,t){return this.activated?this.init().then((()=>this.delegate.getMapping(e,t))):Promise.resolve(null)}activate(){return r.info("URL Mapping is activated"),this.activated=!0,this.activated}}return a.MAPPER_POSTMESSAGE_TIMEOUT=1e3,a})),define("vbsw/private/fetchHandler",["vbsw/private/utils","vbsw/private/stateCache","vbsw/private/cacheStrategy","vbsw/private/cacheStrategyFactory","vbsw/api/fetchHandlerPlugin","vbsw/private/pwa/applicationCache","vbsw/private/optCacheStrategiesFactory","vbsw/private/constants","vbc/private/log","vbc/private/performance/performance","vbc/private/trace/tracer","vbsw/private/urlMapperClient","jsondiff"],((e,t,i,r,n,s,a,o,c,l,h,p,u)=>{const d="vbServiceWorkerConfig",g="vbServiceWorkerPluginInfos",v="vbForceOfflineFlag";let f;const m=u.create({arrays:{detectMove:!1},cloneDiffValues:!1});class b{constructor(i,n,s){n&&(n.logConfig&&n.logConfig.level&&c.setMinimumLevel(n.logConfig.level),c.setConfig(n.log)),f=c.getLogger("/vbsw/private/fetchHandler"),f.info("FetchHandler scope:",i,"config:",n),this.scope=i,this.config=n,this.persistenceManager=s,this.setupBrowserFetch(s),this.plugins=[],this.stateCache=new t,this.cacheStrategy=r.createCacheStrategy(this),this.requestClientMap={},e.isWorkerThread()&&l.init(self.vb,n&&n.performanceConfig),this.urlMapperClient=new p(this.config)}setupBrowserFetch(e){const t=e;t?(this.browserFetch=t.browserFetch.bind(t),t.browserFetch=e=>{const t=this.getRequestClient(e);return this.handleRequest(e,t,!0)}):this.browserFetch=e=>fetch(e)}install(){const e=["fetchHandler.install"];return Promise.resolve().then((()=>l.markStart(e))).then((()=>this.deleteStaleCaches())).then((()=>this.restore(!0))).then((()=>this.initApplicationCache())).then((()=>l.markEnd(e)))}openStateCache(){const e=this.getStateCacheName();return f.info("Opening state cache:",e),caches.open(e).then((e=>(this.stateCache=new t(e),this.stateCache)))}openCaches(e){return this.openStateCache().then((t=>e?t.put(d,this.config):t.get(d).then((e=>{e?(this.config=e||{},f.info("Service Worker Cached Configuration:",this.config)):(f.info("Service Worker: Failed to load cached configuration"),this.config={})})))).then((()=>{if(this.config.isPwa)return this.getApplicationCache().then((e=>{if(!e)throw new Error("PWA: missing application cache.");this.setApplicationCache(e)})).catch((e=>{e&&e.message&&e.message.startsWith("PWA")&&f.error("PWA: Failed to initApplicationCache:",e)}))}))}initTracer(){return e.isWorkerThread()?h.init(this.config.traceOptions):Promise.resolve()}restore(e,t=!1){return this.initTracer().then((()=>this.openCaches(e))).then((()=>{this.cacheStrategy=r.createCacheStrategy(this),this.setRequireConfig();const i=[];return t||i.push(this.installPlugins(e?this.config.plugins:void 0)),i.push(this.installOfflineHandler(this.config)),Promise.all(i)}))}getApplicationCacheName(){return this.getCacheName("application")}getStateCacheName(){return this.getCacheName("state")}getCacheName(e){let t="";return this.scope&&(t+=`${this.scope}-`),this.config.version&&(t+=`${this.config.version}-`),t+=e,t}getApplicationCache(){if(this.config.isPwa){const e=this.getApplicationCacheName();return f.info("PWA: opening application cache:",e),caches.open(e).catch((e=>{f.error("PWA: Failed to getApplicationCache:",e)}))}return Promise.resolve()}deleteStaleCaches(){return f.info("Attempting to delete stale caches for version:",this.config.version,"scope:",this.scope),caches.keys().then((e=>Promise.all(e.map((e=>(f.info("Checking cache:",e),this.isStaleStateCache(e)||this.isStaleApplicationCache(e)?(f.info("Deleting cache:",e),caches.delete(e)):Promise.resolve()))))))}isStaleStateCache(e){return e.startsWith(this.scope)&&e.endsWith("state")}isStaleApplicationCache(e){return e.startsWith(this.scope)&&e.endsWith("application")}initApplicationCache(){return Promise.resolve().then((()=>{if(this.config.isPwa)return this.cacheOnInstall()})).catch((e=>{e&&e.message&&e.message.startsWith("PWA")&&f.error("PWA: Failed to initApplicationCache:",e)}))}setApplicationCache(e){e&&(f.info("PWA: setApplicationCache()"),this.appCache=new s(e))}getConfig(){return this.config}setRequireConfig(){this.config.requireConfig&&require.config(this.config.requireConfig)}getCachedPluginInfos(){return this.stateCache.get(g)}cachePluginInfos(e){return this.stateCache.put(g,e)}installPlugin(t,i,r){let n,s;return"object"==typeof t?(n=t.url,s=t.params):n=t,e.getResource(n).then((e=>{f.info("Plugin loaded from",n);const t=new e({fetchHandler:this,stateCache:this.stateCache.createNamespacedCache(n)},s);return this.plugins[i]=t,r?t.initCache():void 0})).catch((e=>{f.error("Failed to load plugin from",n,e)}))}installPlugins(e,t=!1){return this.getCachedPluginInfos().then((i=>{const r=i||e,n=e||r||[],s=this.plugins,a=[];this.plugins=new Array(n.length);for(let e=0;e<n.length;e+=1){const i=n[e],o=r.findIndex((e=>!m.diff(e,i)));t||-1===o||(this.plugins[e]=s[o]),this.plugins[e]||a.push(this.installPlugin(i,e,t))}return Promise.all(a).then((()=>this.cachePluginInfos(n)))}))}uninstallPlugins(){return this.plugins=[],Promise.resolve()}activateUrlMapping(){return this.urlMapperClient.activate()}installOfflineHandler(t){return Promise.resolve().then((()=>{if(!this.offlineHandler){const i=t.offlineHandler;if(i)return this.persistenceManager||requirejs.config({map:{"*":{opt:"persist"}}}),e.getResource(i).then((e=>{let t;if(t=e?"function"==typeof e?new e:e:{},"function"==typeof t.createOfflineHandler)return this.initializePersistenceManagerWithStore(t).then((()=>t.createOfflineHandler().then((e=>{this.offlineHandler=e}))))})).catch((e=>{f.info(`Failed to load offline handler from ${i}: ${e}`),this.offlineHandler=null})).finally((()=>{if(!this.offlineHandler&&this.useCacheResponseWhenOfflineHeaderEnabled)return this.initializePersistenceManagerWithStore()}))}}))}uninstallOfflineHandler(){return this.offlineHandler=null,Promise.resolve()}isOnline(){return this.initializePersistenceManager().then((e=>e.isOnline()))}getCachedForceOfflineFlag(){return this.stateCache.get(v)}cacheForceOfflineFlag(e){return this.stateCache.put(v,e)}forceOffline(e){return this.initializePersistenceManager().then((t=>t.forceOffline(e))).then((()=>this.cacheForceOfflineFlag(e)))}getPersistenceSyncManager(){return this.persistSyncMgrPromise||(this.persistSyncMgrPromise=e.getResource("persist/impl/PersistenceSyncManager").then((e=>new e))),this.persistSyncMgrPromise}getPersistenceUtils(){return this.persistUtilsPromise||(this.persistUtilsPromise=e.getResource("persist/persistenceUtils")),this.persistUtilsPromise}deserializeRequest(t){return Promise.resolve().then((()=>e.isWorkerThread()?this.getPersistenceUtils().then((e=>e.requestFromJSON(t))):t))}serializeSyncOperationResult(t){return Promise.resolve().then((()=>t&&e.isWorkerThread()?this.getPersistenceUtils().then((i=>{if(Array.isArray(t)){const e=[],i=t.map((t=>this.serializeSyncOperationResult(t).then((t=>{e.push(t)}))));return Promise.all(i).then((()=>e))}if(t instanceof Request)return i.requestToJSON(t);if(t instanceof Response)return i.responseToJSON(t);if(e.isObject(t)){const e={},i=Object.keys(t).map((i=>this.serializeSyncOperationResult(t[i]).then((t=>{e[i]=t}))));return Promise.all(i).then((()=>e))}return"function"==typeof t?null:t})):t))}syncOfflineData(t,i){return this.persistenceManagerPromise?this.persistenceManagerPromise.then((r=>e.getResource("persist/impl/PersistenceSyncManager").then((e=>{const n=new e(r.isOnline.bind(r),(e=>this.handleRequest(e,i,!1)),r.getCache.bind(r));return this.offlineHandler&&("function"==typeof this.offlineHandler.beforeSyncRequestListener&&n.addEventListener("beforeSyncRequest",this.offlineHandler.beforeSyncRequestListener.bind(this.offlineHandler)),"function"==typeof this.offlineHandler.afterSyncRequestListener&&n.addEventListener("syncRequest",this.offlineHandler.afterSyncRequestListener.bind(this.offlineHandler))),n.sync(t).catch((e=>this.serializeSyncOperationResult(e).then((e=>{throw e}))))})))):Promise.reject(new Error("Cannot invoke sync before the PersistenceManager is initialized."))}getOfflineSyncLog(){return this.getPersistenceSyncManager().then((e=>e.getSyncLog())).then((e=>this.serializeSyncOperationResult(e)))}insertOfflineSyncRequest(e,t){return this.deserializeRequest(e).then((e=>this.getPersistenceSyncManager().then((i=>i.insertRequest(e,t))).then((e=>this.serializeSyncOperationResult(e)))))}removeOfflineSyncRequest(e){return this.getPersistenceSyncManager().then((t=>t.removeRequest(e))).then((e=>this.serializeSyncOperationResult(e)))}updateOfflineSyncRequest(e,t){return this.deserializeRequest(t).then((t=>this.getPersistenceSyncManager().then((i=>i.updateRequest(e,t))).then((e=>this.serializeSyncOperationResult(e)))))}setOfflineHandlerOptions(e){return Promise.resolve().then((()=>{if(this.offlineHandler&&"function"==typeof this.offlineHandler.setOptions)return this.offlineHandler.setOptions(e)}))}initializePersistenceManagerWithStore(e){return this.initializePersistenceManager().then((t=>b.registerDefaultPersistenceStoreFactory(e).then((()=>t))))}initializePersistenceManager(){return this.persistenceManagerPromise||(this.persistenceManager?this.persistenceManagerPromise=Promise.resolve(this.persistenceManager):this.persistenceManagerPromise=e.getResources(["persist/persistenceManager","persist/impl/PersistenceSyncManager","persist/defaultResponseProxy"]).then((e=>{const[t,i]=e;return this.setupBrowserFetch(t),t.init().then((()=>this.getCachedForceOfflineFlag().then((e=>{void 0!==e&&t.forceOffline(e)})))).then((()=>t))}))),this.persistenceManagerPromise}static registerDefaultPersistenceStoreFactory(t){return Promise.resolve().then((()=>t&&"function"==typeof t.getDefaultPersistenceStoreFactory?t.getDefaultPersistenceStoreFactory():null)).catch((e=>(f.error(e),null))).then((t=>t||e.getResource("persist/pouchDBPersistenceStoreFactory"))).then((t=>e.getResource("persist/persistenceStoreManager").then((e=>{e.registerDefaultStoreFactory(t)}))))}cacheFile(e){return e?this.stateCache.add(e):Promise.resolve()}createRequest(e,t){const i=new Request(e,t);return t.bodyFormData&&(i._bodyFormData=t.bodyFormData,i._bodyInit=t.bodyInit),t.attachOrignalBody&&(i.originalBody=t.body),i}cloneRequest(e){return n.getRequestConfig(e,this).then((e=>this.createRequest(e.url,e))).catch((e=>(f.error(e),null)))}isFetchPolyfill(){return this.persistenceManager&&this.persistenceManager._browserFetchFunc&&this.persistenceManager._browserFetchFunc.polyfill}fetch(e){return"only-if-cached"===e.cache&&"same-origin"!==e.mode?(f.info("Skip request url:",e.url,"cache:",e.cache,"mode:",e.mode),Promise.resolve(new Response(null,{status:200,statusText:"OK"}))):Promise.resolve().then((()=>this.fetchAndCache(e))).then((t=>t||this.browserFetch(e)))}handleRequestHook(e,t){return this.plugins.reduce(((e,i)=>e.then((e=>i?i.handleRequestHook(e,t).then((t=>t||e)).catch((t=>(f.error(t),e))):e))),Promise.resolve(e))}handleResponseHook(e,t,i,r){return this.plugins.reduce(((n,s)=>n.then((n=>s?s.handleResponseHook(e,t,i,r).catch((e=>(f.error(e),!1))).then((e=>e||n)):n))),Promise.resolve(!1))}handleErrorHook(e,t,i,r){return this.plugins.reduce(((n,s)=>n.then((n=>s?s.handleErrorHook(e,t,i,r).catch((e=>(f.error(e),!1))).then((e=>e||n)):n))),Promise.resolve(!1))}saveRequestClient(e,t){this.requestClientMap[e]=t}getRequestClient(e){return this.requestClientMap[e]}deleteRequestClient(e){delete this.requestClientMap[e]}get hasOfflineHandler(){return this.offlineHandler&&"function"==typeof this.offlineHandler.handleRequest}get useCacheResponseWhenOfflineHeaderEnabled(){return this.config&&this.config.useCacheResponseWhenOfflineHeaderEnabled}handleRequest(t,i,r,n=0){return this.checkCache(t.url).then((s=>{if(s)return s;if("navigate"===t.mode||"OPTIONS"===t.method)return this.fetch(t).catch((e=>this.checkCache(t.url,o.LOOKUP_INDEX_MODE).then((t=>{if(void 0!==t)return t;throw e}))));if(!r&&(this.useCacheResponseWhenOfflineHeaderEnabled||this.hasOfflineHandler)){if(t.headers.get(o.USE_CACHED_RESPONSE_WHEN_OFFLINE))return e.getResource("persist/defaultResponseProxy").then((e=>{const i=a.getCacheStrategy(this.config,t);return e.getResponseProxy(i).processRequest(t)}))}if(!r&&this.hasOfflineHandler)return this.saveRequestClient(t,i),this.offlineHandler.handleRequest(t,this.scope,i).finally((()=>{this.deleteRequestClient(t)}));let c,l,h;return this.cloneRequest(t).then((e=>e?this.handleRequestHook(e,i).then((e=>(h=e,this.fetch(e)))).then((e=>(c=e,this.handleResponseHook(e,t,h,i)))).catch((e=>(f.error(e),l=e,this.handleErrorHook(e,t,h,i)))).then((e=>{if(e){if(n<2)return f.info("Retrying request",n),this.handleRequest(t,i,r,n+1);f.info("Max retry count reached.")}if(c)return c;throw l})):this.fetch(t)))}))}fetchAndCache(e){return Promise.resolve().then((()=>{if(this.cacheStrategy)return this.cacheStrategy.fetchAndCache(e)})).catch((e=>{f.error("fetchAndCache() failed",e)}))}checkCache(e,t){return Promise.resolve().then((()=>{if(this.cacheStrategy)return this.cacheStrategy.shouldCheckCache(e).then((i=>{if(i)return this.cacheStrategy.checkCache(e,t)}))})).catch((e=>{f.error("checkCache() failed",e)}))}cacheOnInstall(){return Promise.resolve().then((()=>{if(this.cacheStrategy)return this.cacheStrategy.cacheOnInstall()})).catch((e=>{f.error("cacheOnInstall() failed",e)}))}cacheOnRequest(){return Promise.resolve().then((()=>this.cacheStrategy.cacheOnRequest())).catch((e=>{f.error("cacheOnRequest() failed",e)}))}}return b})),define("vbsw/private/serviceWorkerWrapper",["vbsw/private/utils"],(e=>class{constructor(e){this.scope=e,this.messageHandlers=[]}unregister(){return Promise.resolve().then((()=>{if(this.registration)return this.registration.unregister()}))}uninstall(){return this.uninstallPlugins().then((()=>this.uninstallOfflineHandler())).then((()=>{this.messageEventListener&&(this.removeMessageEventListener(this.messageEventListener),this.messageEventListener=null,this.messageHandlers=[])})).then((()=>this.unregister()))}installPlugins(e,t=!0){return Promise.resolve()}uninstallPlugins(){return Promise.resolve()}installMessageHandler(t){this.messageEventListener||(this.messageEventListener=t=>{const i=t.data;if("object"==typeof i&&i.method){const r=i.method,n=i.args||[],s=t.ports[0];this.messageHandlers.reverse().some((t=>"function"==typeof t[r]&&(e.postResponse(s,t[r](...n),`${r}`),!0)))||e.postResponse(s,Promise.reject("No message handler found."),`${r}`)}},this.addMessageEventListener(this.messageEventListener)),this.messageHandlers.push(t)}uninstallMessageHandler(e){const t=this.messageHandlers.indexOf(e);t>-1&&this.messageHandlers.splice(t,1),0===this.messageHandlers.length&&(this.removeMessageEventListener(this.messageEventListener),this.messageEventListener=null)}addMessageEventListener(e){window.addEventListener("message",e,!1)}removeMessageEventListener(e){window.removeEventListener("message",e)}installOfflineHandler(e){return Promise.resolve()}uninstallOfflineHandler(){return Promise.resolve()}syncOfflineData(e){return Promise.resolve()}setOfflineHandlerOptions(e){return Promise.resolve()}addRequestsToSkip(e){return Promise.resolve()}removeRequestsToSkip(e){return Promise.resolve()}})),define("vbsw/private/emulatedServiceWorkerWrapper",["vbsw/private/serviceWorkerWrapper","vbsw/private/fetchHandler"],((e,t)=>class extends e{constructor(e,i,r,n){super(e),this.isEmulated=!0,this.registration=i,this.fetchHandler=new t(e,r,n),this.activateUrlMapping()}installPlugins(e,t=!0){return this.fetchHandler.installPlugins(e,t)}uninstallPlugins(){return this.fetchHandler.uninstallPlugins()}installOfflineHandler(e){return this.fetchHandler.installOfflineHandler({offlineHandler:e})}uninstallOfflineHandler(){return this.fetchHandler.uninstallOfflineHandler()}syncOfflineData(e){return this.fetchHandler.syncOfflineData(e)}getOfflineSyncLog(){return this.fetchHandler.getOfflineSyncLog()}insertOfflineSyncRequest(e,t){return this.fetchHandler.insertOfflineSyncRequest(e,t)}removeOfflineSyncRequest(e){return this.fetchHandler.removeOfflineSyncRequest(e)}updateOfflineSyncRequest(e,t){return this.fetchHandler.updateOfflineSyncRequest(e,t)}forceOffline(e){return this.fetchHandler.forceOffline(e)}setOfflineHandlerOptions(e){return this.fetchHandler.setOfflineHandlerOptions(e)}isOnline(){return this.fetchHandler.isOnline()}activateUrlMapping(){return Promise.resolve(this.fetchHandler.activateUrlMapping())}handleRequest(e){return this.fetchHandler.handleRequest(e)}})),define("vbsw/private/browserServiceWorkerWrapper",["vbsw/private/utils","vbsw/private/serviceWorkerWrapper"],((e,t)=>class extends t{constructor(e,t,i,r){super(e),this.serviceWorker=t,this.registration=r,i.isPwa&&this.cacheOnRequest(i)}cacheOnRequest(){return this.postMessage({method:"cacheOnRequest",args:[]}).catch((()=>{}))}installPlugins(e,t=!0){const i={method:"installPlugins",args:[e,t]};return this.postMessage(i).catch((()=>{}))}uninstallPlugins(){return this.postMessage({method:"uninstallPlugins",args:[]}).catch((()=>{}))}activateUrlMapping(){return this.postMessage({method:"activateUrlMapping",args:[]})}addMessageEventListener(e){navigator.serviceWorker.addEventListener("message",e),super.addMessageEventListener(e)}removeMessageEventListener(e){navigator.serviceWorker.removeEventListener("message",e),super.removeMessageEventListener(e)}uninstallOfflineHandler(){return this.postMessage({method:"uninstallOfflineHandler",args:[]})}getPersistenceUtils(){return this.persistenceUtilsPromise||(this.persistenceUtilsPromise=e.getResource("persist/persistenceUtils")),this.persistenceUtilsPromise}serializeRequest(e){return this.getPersistenceUtils().then((t=>t.requestToJSON(e)))}deserializeRequest(e){return this.getPersistenceUtils().then((t=>t.requestFromJSON(e)))}deserializeResponse(e){return this.getPersistenceUtils().then((t=>t.responseFromJSON(e)))}deserializeSyncOperationResult(t){return Promise.resolve().then((()=>{if(t){if(Array.isArray(t)){const e=[],i=t.map((t=>this.deserializeSyncOperationResult(t).then((t=>{e.push(t)}))));return Promise.all(i).then((()=>e))}if(e.isObject(t)){const e=Object.assign({},t),i=[];return t.request&&i.push(this.deserializeRequest(t.request).then((t=>{e.request=t}))),t.response&&i.push(this.deserializeResponse(t.response).then((t=>{e.response=t}))),Promise.all(i).then((()=>e))}}return t}))}syncOfflineData(e){const t={method:"syncOfflineData",args:[e],options:{addClientToArgs:!0}};return this.postMessage(t).catch((e=>this.deserializeSyncOperationResult(e).then((e=>{throw e}))))}getOfflineSyncLog(){return this.postMessage({method:"getOfflineSyncLog"}).then((e=>this.deserializeSyncOperationResult(e)))}insertOfflineSyncRequest(e,t){return this.serializeRequest(e).then((e=>{const i={method:"insertOfflineSyncRequest",args:[e,t]};return this.postMessage(i).then((e=>this.deserializeRequest(e)))}))}removeOfflineSyncRequest(e){const t={method:"removeOfflineSyncRequest",args:[e]};return this.postMessage(t).then((e=>this.deserializeRequest(e)))}updateOfflineSyncRequest(e,t){return this.serializeRequest(t).then((t=>{const i={method:"updateOfflineSyncRequest",args:[e,t]};return this.postMessage(i).then((e=>this.deserializeRequest(e)))}))}setOfflineHandlerOptions(e){const t={method:"setOfflineHandlerOptions",args:[e]};return this.postMessage(t)}forceOffline(e){const t={method:"forceOffline",args:[e]};return this.postMessage(t)}isOnline(){return this.postMessage({method:"isOnline",args:[]})}getConfig(){return this.postMessage({method:"getConfig",args:[]})}addRequestsToSkip(e){const t={method:"addRequestsToSkip",args:[e]};return this.postMessage(t)}removeRequestsToSkip(e){const t={method:"removeRequestsToSkip",args:[e]};return this.postMessage(t)}postMessage(t){const i=this.serviceWorker||navigator.serviceWorker.controller;return e.postMessage(i,t)}})),define("vbsw/private/serviceWorkerManagerClass",["vbsw/private/utils","vbsw/private/fetchHandler","vbsw/private/pwa/pwaUtils","vbsw/private/emulatedServiceWorkerWrapper","vbsw/private/browserServiceWorkerWrapper"],((e,t,i,r,n)=>class{constructor(){this.serviceWorkerWrappers={}}installServiceWorkers(e,t,i){return this.getServiceWorkerConfig(e,t,i).then((e=>{const t=[];return e.scopes.forEach((i=>{t.push(this.installServiceWorker(i,e))})),Promise.all(t).then((e=>this.activateUrlMapping().then((()=>e))))}))}activateUrlMapping(){return this.serviceWorkerWrapper?this.serviceWorkerWrapper.activateUrlMapping():Promise.resolve()}getServiceWorkerScopes(){return Object.keys(this.serviceWorkerWrappers)}installServiceWorkerPlugins(e,t=!0){return this.config&&(this.config.plugins=e),this.serviceWorkerWrapper?this.serviceWorkerWrapper.installPlugins(e,t):Promise.resolve()}installMessageHandler(e){this.serviceWorkerWrapper?this.serviceWorkerWrapper.installMessageHandler(e):(this.messageHandlerQueue=this.messageHandlerQueue||[],this.messageHandlerQueue.push(e))}uninstallMessageHandler(e){this.serviceWorkerWrapper&&this.serviceWorkerWrapper.uninstallMessageHandler(e)}getLocalFetchHandler(){return this.localFetchHandlerPromise||(this.localFetchHandlerPromise=Promise.resolve().then((()=>{if(!this.config.isEmulated){const e=new t("/");return this.config.requireConfig&&requirejs.config(this.config.requireConfig),e.installPlugins(this.config.plugins,!0).then((()=>{if(this.config.hasOfflineHandler){const t=this.getDefaultOfflineHandlerUrl(),i=fetch;return e.installOfflineHandler({offlineHandler:t}).then((()=>{fetch=i}))}})).then((()=>e))}return{handleRequest:e=>fetch(e),hasOfflineHandler:this.config.hasOfflineHandler}}))),this.localFetchHandlerPromise}getDefaultOfflineHandlerUrl(){const e=window.vbInitConfig||{};return e.CONTEXT_OFFLINE_HANDLER_PATH?e.CONTEXT_OFFLINE_HANDLER_PATH:"app-flow"}hasOfflineHandler(){const t=this.getDefaultOfflineHandlerUrl();return e.getResource(t).then((e=>{let t;return t=e?"function"==typeof e?new e:e:{},"function"==typeof t.createOfflineHandler&&t.createOfflineHandler()})).catch((()=>!1))}installOfflineHandler(e=this.getDefaultOfflineHandlerUrl()){return this.serviceWorkerWrapper.installOfflineHandler(e)}uninstallOfflineHandler(){return this.serviceWorkerWrapper?this.serviceWorkerWrapper.uninstallOfflineHandler():Promise.resolve()}syncOfflineData(e){return this.serviceWorkerWrapper.syncOfflineData(e)}getOfflineSyncLog(){return this.serviceWorkerWrapper.getOfflineSyncLog()}insertOfflineSyncRequest(e,t){return this.serviceWorkerWrapper.insertOfflineSyncRequest(e,t)}removeOfflineSyncRequest(e){return this.serviceWorkerWrapper.removeOfflineSyncRequest(e)}updateOfflineSyncRequest(e,t){return this.serviceWorkerWrapper.updateOfflineSyncRequest(e,t)}forceOffline(e){return this.serviceWorkerWrapper.forceOffline(e)}setOfflineHandlerOptions(e){return this.serviceWorkerWrapper.setOfflineHandlerOptions(e)}isOnline(){return this.serviceWorkerWrapper.isOnline()}addRequestsToSkip(e){return this.serviceWorkerWrapper.addRequestsToSkip(e)}removeRequestsToSkip(e){return this.serviceWorkerWrapper.removeRequestsToSkip(e)}getServiceWorkerConfig(t,r,n){return Promise.resolve().then((()=>{const s=window.vbInitConfig||{},a=s.SERVICE_WORKER_CONFIG||{};if(a.applicationUrl=n.applicationUrl,a.baseUrl=n.getBaseUrlFromConfig(window.location,s,a.applicationUrl),!a.scriptUrl||!a.scopes){const e=s.APP_ID,t=s.APP_VERSION,i=s.APP_URL_PREFIX;let r,n=s.CONTEXT_ROOT||"/";n.startsWith("/")||(n=`/${n}`),n.endsWith("/")||(n=`${n}/`),r=e&&t?`${n}${i}/${e}/${t}/`:n,a.scriptUrl=`${r}vbServiceWorker.js`,a.scopes=[r]}if(a.dtMode=s.IS_DT_MODE,a.log=s.LOG,s.JET_CDN_PATH&&(a.jetPath=`${s.JET_CDN_PATH}${s.JET_CDN_VERSION}/`),a.baseUrlToken=s.BASE_URL_TOKEN,s.CONTEXT_OFFLINE_HANDLER_PATH)a.offlineHandler=s.CONTEXT_OFFLINE_HANDLER_PATH;else{let e=window.location.pathname;const t="index.html",i=e.indexOf(t);e=i>=0?e.substring(0,i):e,e=e.endsWith("/")?e:`${e}/`,a.offlineHandler=`${e}${a.baseUrlToken?`${a.baseUrlToken}/`:""}app-flow.js`}return a.debug=s.DEBUG,s.IS_DT_MODE&&(a.nonce=e.generateUniqueId()),i.isMobilePwaConfig(s)?(a.isPwa=!0,a.appPath=i.computeAppPath(s),a.locale=i.getLocale(),a.useCacheResponseWhenOfflineHeaderEnabled=!0):i.isWebPwaConfig(s)&&(a.isWebPwa=!0,a.registryUrl=s.REGISTRY_URL),(s.IS_MOBILE||a.isWebPwa)&&(a.useCacheResponseWhenOfflineHeaderEnabled=!0),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(a.disabled=!0),a.modulePath=t,a.performanceConfig=s.PERFORMANCE_CONFIG,r&&(a.requireConfig=r.requireConfig,a.plugins=r.plugins,a.logConfig=r.logConfig,a.userConfig=r.userConfig),a.traceOptions=e.getTraceOptions(s),void 0===a.disabled?this.hasOfflineHandler().then((e=>(a.hasOfflineHandler=e,a.disabled=!a.isPwa&&!a.hasOfflineHandler,!a.isPwa&&a.hasOfflineHandler&&(a.disableOnFetch=!0),a))):a}))}configureServiceWorker(t,i){return console.log("ServiceWorkerManager calling configureServiceWorker"),i&&(this.config=i),e.postMessage(t,{method:"configureServiceWorker",args:[this.config]})}installServiceWorker(e,t){return this.config=t,"serviceWorker"in navigator&&!t.disabled?new Promise(((i,r)=>{const n=t.nonce?`&nonce=${t.nonce}`:"",s=t.baseUrlToken?`&baseUrlToken=${t.baseUrlToken}`:"";let a;if(t.disableOnFetch)a=`${t.scriptUrl}?disableOnFetch=true${s}${n}`;else{const e=t.jetPath?`jetPath=${t.jetPath.trim()}`:"",i=t.modulePath?`&modulePath=${t.modulePath.trim()}`:"",r=t.debug?"&debug=true":"",o=t.skipIgnoreSearch?`&skipIgnoreSearch=${t.skipIgnoreSearch}`:"";a=`${t.scriptUrl}?${e}${i}${s}${n}${r}${o}`}a=encodeURI(a),navigator.serviceWorker.register(a,{scope:e}).then((n=>{if(t.disableOnFetch)n.unregister().then((()=>{this.emulateServiceWorker(e).then(i).catch(r)}));else{let s;if(console.log("Service worker registration succeeded. Scope is",n.scope,t.nonce),n.installing?(s=n.installing,t.disableOnFetch||this.configureServiceWorker(s)):n.active?s=n.active:n.waiting&&(s=n.waiting),s)if("installing"!==s.state&&(n.onupdatefound=()=>{console.log("Service worker update found."),n.installing&&this.configureServiceWorker(n.installing)}),console.log("Service worker state:",s.state),"activated"===s.state){const r=this.addServiceWorkerWrapper(e,s,!1,t,n);i(r)}else s.onstatechange=r=>{const s=r.target.state;let a;console.log("Service worker state changed:",s),"activated"===s?(console.log("Service worker is active."),a=this.addServiceWorkerWrapper(e,r.target,!1,t,n),i(a)):"redundant"===s&&(a=this.addServiceWorkerWrapper(e,navigator.serviceWorker.controller,!1,t,n),i(a))};else console.log("No service worker found in registration."),this.emulateServiceWorker(e).then(i).catch(r)}})).catch((t=>{console.log("Service worker registration failed with",t),this.emulateServiceWorker(e).then(i).catch(r)}))})):this.emulateServiceWorker(e)}emulateServiceWorker(e){return console.log("Emulating service worker using PersistenceManager."),this.config.isEmulated=!0,this.initializePersistenceManager().then((t=>t.register({scope:"/"}).then((t=>{const i=this.addServiceWorkerWrapper(e,t,!0,this.config);return t.addEventListener("fetch",(e=>{e.respondWith(i.handleRequest(e.request))})),i}))))}initializePersistenceManager(){return this.persistenceManagerPromise||(this.persistenceManagerPromise=e.getResource("persist/persistenceManager").then((e=>(this.persistenceManager=e,e.init().then((()=>e)))))),this.persistenceManagerPromise}getServiceWorkerWrapper(e){return this.serviceWorkerWrappers[e]}addServiceWorkerWrapper(e,t,i,s,a){let o;return o=i?new r(e,t,s,this.persistenceManager):new n(e,t,s,a),this.serviceWorkerWrappers[e]=o,this.serviceWorkerWrapper=o,this.messageHandlerQueue&&(this.messageHandlerQueue.forEach((e=>this.installMessageHandler(e))),this.messageHandlerQueue=null),o}addToCache(e){return Promise.resolve()}})),define("vbsw/private/serviceWorkerManager",["vbsw/private/serviceWorkerManagerClass"],(e=>new class{setInstance(e){this.instance=e}getInstance(){return this.instance=this.instance||new e,this.instance}})),define("vb/private/stateManagement/appPackage",["vb/errors/httpError","vb/helpers/mixin","vb/private/constants","vb/private/stateManagement/appPackageExtension","vb/private/stateManagement/containerRjsInitMixin","vb/private/stateManagement/packageFlow","vb/private/stateManagement/context/appPackageContext","vb/private/utils","vbsw/private/serviceWorkerManager"],((e,t,i,r,n,s,a,o,c)=>{class l extends(t(s).with(n)){constructor(e,t,r,n="AppPackage"){const s=t.id;super(s,r,`${i.DefaultPaths.APPLICATIONS}${s}/`,n),this._extension=e,this._appUiInfo=t}get name(){return"app"}get package(){return this}get appUiInfo(){return this._appUiInfo}get eventPrefix(){return"application"}static get descriptorLoaderName(){return"getAppUiDescriptor"}static get functionsLoaderName(){return"getAppUiFunctions"}static get extensionClass(){return r}static get ContextType(){return a}get implicitResourceFolder(){return!0}createServices(){return Promise.resolve().then((()=>{this.services=this.application.extensions[this.extensionId].services}))}get fullName(){return this.name}get urlId(){return this.appUiInfo.urlId||super.urlId}isNavigable(){return!0}enter(){return this.application.scope.getVariable(i.GLOBAL_CURRENT_APPUI_VARIABLE,i.VariableNamespace.BUILTIN).setValueInternal(this.appUiInfo),super.enter()}getNewScopeName(){return`${this.className}/${this.id}`}initDefault(e){const t=e;return super.initDefault(t)}defineCurrentPageBuiltinVariable(){return null}updateCurrentPageVariable(){}load(){return super.load().then((()=>{const e=c.getInstance();return e.uninstallOfflineHandler().then((()=>this.getOfflineHandlerUrl())).then((t=>{if(t)return e.installOfflineHandler(t)}))}))}getOfflineHandlerUrl(){return Promise.resolve().then((()=>this.functions&&"function"==typeof this.functions.createOfflineHandler?this.getResourcePath():o.getRuntimeEnvironment().then((e=>e.getOfflineHandlerUrl()))))}processDefaultPage(){return Promise.resolve().then((()=>{const e=this.definition.defaultFlow;if(!e)return super.processDefaultPage();this.router.defaultStateId=e}))}getContainer(e){return this.flows[e]||super.getContainer(e)}loadContainer(e,t){if(t&&t.isCancelled())return Promise.resolve();return this.definition.defaultFlow?this.loadFlowFromId(e,t):super.loadContainer(e,t)}loadFlow(){return this.extension.init().then((()=>super.loadFlow()))}getScopeResolverMap(){return{[i.APP_UI_PREFIX]:this,[i.GLOBAL_PREFIX]:this.application}}}return l})),define("vb/private/pwa/jetCache",["ojs/ojcontext","ojs/ojthemeutils","vb/private/utils","vbc/private/pwa/pwaUtils","vbc/private/log","vbc/private/monitorOptions"],((e,t,i,r,n,s)=>{const a=n.getLogger("/vb/private/pwa/jetCache"),o=["alta-web","alta-ios","alta-android","alta-windows","redwood-all"],c="metadata/components/jetResources.json",l="default/js/bundles-config",h=["default/js/min/oj3rdpartybundle.js","default/js/min/ojcorebundle.js","3rdparty/require/require.js"],p=/js\/min/i,u=s.SPAN_NAMES.CACHE_JET_MONITOR;class d{static cacheJetWhenPageLoads(){let t;return e.getPageContext().getBusyContext().whenReady().then((()=>{const e=new s(u,"Jet caching");return a.monitor(e,(e=>{t=e;const i=window.vbInitConfig;if(i){const e=i.SERVICE_WORKER_CONFIG&&i.SERVICE_WORKER_CONFIG.shellPath,r=`${i.JET_CDN_PATH}${i.JET_CDN_VERSION}/`;return d.cacheJet(e,r,i.DEBUG).then((e=>(a.info("PWA: cacheJetWhenPageLoads() succeeded",t()),e)))}a.info("PWA: cacheJetWhenPageLoads() no config found",t())}))})).catch((e=>{a.error(e),a.info("PWA: cacheJetWhenPageLoads() failed",t(e))}))}static fetchJetResources(e=[],t="",i){return Promise.resolve().then((()=>{const n=[],s=r.postSlash(t);let o=e;i&&(o=e.map((e=>e.replace(p,"js/debug")))),n.push(...o.map((e=>`${s}${e}`)));const c=n.map((e=>fetch(e).then((e=>(e.ok||"opaque"===e.type||a.error(`Fetch error for ${e.url}`),e)))));return Promise.all(c)}))}static getTheme(){const e=t.getThemeName(),i=t.getThemeTargetPlatform(),r=`${e}-${i}`;if(o.includes(r))return"all"===i||"web"===i?e:r}static getThemeBasedResources(e){return fetch(`${e}${c}`).then((e=>e.json())).then((e=>e.jetResources[d.getTheme()])).catch((()=>(a.warn(`PWA: getThemeBasedResources() fetch failed for JET meta-data - ${e}${c}`),[])))}static getOptResources(e,t=!1){const i=[];return Promise.resolve().then((()=>{const t=new Request(`${e}${l}.json`);return fetch(t)})).then((i=>{if(i&&i.ok)return i.text();throw new Error(`getOptResources(${e}, ${t}): invalid response: ${i?i.status:i}`)})).then((i=>{if(i)return JSON.parse(i);throw new Error(`getOptResources(${e}, ${t}}): result.text is empty`)})).then((e=>{for(let r=0;r<e.bundles.length;r++){const n=e.bundles[r];"3rdparty/persist/debug"===n.path.debug&&i.push(`${t?n.path.debug:n.path.min}/${n.name}.js`)}return i}))}static cacheJet(e,t,n=!1){return r.isOnline()&&r.isPwaShellPath(e)?(a.info("PWA: cacheJet()"),Promise.resolve().then((()=>r.getServiceWorkerScope())).then((t=>{if(t||""===t){const i=`${t}${e}`;return a.info(`PWA: cacheJet() loading shell cache from ${i}`),r.loadAppShellFile(i,fetch)}a.warn("PWA: cacheJet() no service worker")})).then((e=>{if(e){const r=[d.getThemeBasedResources(t),d.getOptResources(t,n)];return Promise.all(r).then((([r,s])=>{const a=[];a.push(i.getResources(e.jetModules));const o=[];return o.push(...h),o.push(...s),o.push(`${l}${n?"-debug":""}.js`),Array.isArray(r)&&o.push(...r),a.push(d.fetchJetResources(o,t,n)),Promise.all(a)}))}}))):Promise.resolve()}}return d})),define("vb/private/services/fallbackServices",["vb/private/services/services","vb/private/constants","vb/private/utils"],((e,t,i)=>{class r extends e{constructor(e){super(e),this._notFoundServiceSet=new Set}loadServiceFromPath(e,t,i,r){return super.loadServiceFromPath(e,t,i,r).then((t=>(t||this._notFoundServiceSet.add(`${this.namespace}:${e}`),t)))}_isNotFoundService(e){return this._notFoundServiceSet.has(e)}FindServiceDeclaration(e){return Promise.resolve().then((()=>{const n=e&&e.namespace,s=e.getQualifiedServiceId(this.namespace),a=e.serviceName;if(this._isNotFoundService(s))return null;if(n&&n!==t.ExtensionNamespaces.BASE){let e,s;return this.namespace===n?(e=this._relativePath,s=a):(e=n,s=`${t.ExtensionFolders.SELF}/${a}`),e=i.addTrailingSlash(e),{type:"serviceMap",path:`${e}${r.getPathSuffix(s)}`}}return{type:"serviceMap",path:`./${r.getPathSuffix(a)}`}}))}getDefinitionPath(e){return this.namespace!==t.ExtensionNamespaces.BASE?`${t.EXTENSION_PATH}${e}`:super.getDefinitionPath(e)}static getPathSuffix(e){return`services/${e}/openapi3.json`}}return r})),define("text!vb/components/oj-vb-content/component.json",[],(function(){return'{\n  "name": "oj-vb-content",\n  "displayName": "Visual Builder Content",\n  "description": "A component to nest content into a Visual Builder page",\n  "version": "0.9.0",\n  "jetVersion": ">=4.2.0",\n  "properties": {\n    "config": {\n      "type": "object",\n      "description": "A configuration object as defined for the oj-module component",\n      "properties": {\n        "viewModel": {\n          "type": "object"\n        },\n        "view": {\n          "type": "array<object>"\n        },\n        "cleanupMode": {\n          "type": "string",\n          "enumValues": ["onDisconnect", "none"],\n          "value": "onDisconnect"\n        }\n      }\n    },\n    "animation": {\n      "type": "object"\n    }\n  }\n}'})),define("css!vb/components/oj-vb-content/styles",[],(function(){})),define("vb/components/oj-vb-content/loader",["ojs/ojcomposite","text!./component.json","ojs/ojmodule-element","css!./styles.css"],((e,t)=>{const i=JSON.parse(t);e.register("oj-vb-content",{view:'<oj-module config="[[$props.config]]" animation="[[$props.animation]]"></oj-module>',metadata:i})})),define("vb/private/stateManagement/applicationClass",["knockout","ojs/ojcore-base","ojs/ojcontext","ojs/ojrouter","vb/versions","vb/private/stateManagement/container","vb/private/stateManagement/flow","vb/private/constants","vb/private/stateManagement/redux/storeManager","vb/private/stateManagement/redux/reduxRouter","vb/private/stateManagement/router","vb/private/utils","vb/private/log","vb/private/stateManagement/context/applicationContext","vb/private/stateManagement/applicationExtension","vb/private/stateManagement/shellPageInfo","vb/private/stateManagement/appPackage","vb/private/services/services","vb/private/translations/bundlesModel","vb/private/configLoader","vb/private/configuration","vb/private/history","vb/private/services/protocolRegistry","vb/private/pwa/jetCache","vbc/private/pwa/pwaUtils","vbc/private/performance/performance","vbsw/private/serviceWorkerManager","vb/private/services/fallbackServices","ojs/ojmodule-element","vb/components/oj-vb-content/loader"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v,f,m,b,y,E,P,x,T,A,C,O,S)=>{const w=u.getLogger("/vb/stateManagement/application",[{name:"custom",severity:"info",style:"calm"}]);return class extends a{constructor(){super("app",null,null,"Application"),this.log=w,this.previousPagePath=null,this.currentPageParams=null,this.started=!1,this.builtinUtils=null,C.init(window.vb,window.vbInitConfig&&window.vbInitConfig.PERFORMANCE_CONFIG),A.shouldAddBeforeInstallPromptListener(window.vbInitConfig)&&window.addEventListener("beforeinstallprompt",this.onBeforeInstallPrompt.bind(this),!1),A.isMobilePwaConfig(window.vbInitConfig)&&T.cacheJetWhenPageLoads(),p.isMobile()&&(window.document.addEventListener("resume",(e=>this.onPauseResumeEvent(e)),!1),window.document.addEventListener("pause",(e=>this.onPauseResumeEvent(e)),!1)),this.moduleConfig=e.observable(o.blankModuleConfig),this.runtimeEnvironment=null,this.reduxRouter=null,this.securityProvider=null,this.appUiInfos=null,this.isHostApplication=null,this.swMessageHandler=null,this.beforeInstallPromptEvent=null,this.newContentAvailableEvent=null,this.pauseResumeEvent=null,this.loadAppFunctionsPromise=null,this._loadApplicationPromise=null,this._messageHandlerPromise=null}static get extensionClass(){return g}static get AppUiClass(){return f}onBeforeInstallPrompt(e){this.log.info("PWA: BeforeInstallPromptEvent delivered at",e.timeStamp),C.timestamp(this.id,e.type),e.preventDefault();const t=h.getCurrentPage();t&&"Page"===t.className?t.invokeAppInstallPromptEvent(e):this.beforeInstallPromptEvent=e}onNewContentAvailable(e){this.log.info(`PWA: new content available: ${e.message}`),C.timestamp(this.id,`newContentAvailable: ${e.message}`);const t=h.getCurrentPage();t&&"Page"===t.className?t.invokeNewContentAvailable(e):this.newContentAvailableEvent=e}onPauseResumeEvent(e){const t=h.getCurrentPage();t&&"Page"===t.className?t.invokePauseResumeEvent(e):this.pauseResumeEvent=e}static get descriptorLoaderName(){return"getApplicationDescriptor"}static get functionsLoaderName(){return"getApplicationFunctions"}initDefault(e){const t=e;t.routerStrategy=t.routerStrategy||o.RouterStrategy.QUERY,t.settings=t.settings||{},super.initDefault(t)}isQueryStrategy(){return this.definition.routerStrategy===o.RouterStrategy.QUERY}doesAppUiExist(e){return this.appUiInfos.exist(e)}createRouter(){let e;return this.isQueryStrategy()||E.appName?e=r.rootInstance:(r.rootInstance.configure({[E.urlMarker]:{isDefault:!0}}),e=r.rootInstance.createChildRouter(E.urlMarker,E.urlMarker)),h.init(e,this.definition.routerStrategy),e}loadRuntimeEnvironment(){return this.runtimeEnvironment?Promise.resolve(this.runtimeEnvironment):p.getRuntimeEnvironment().then((e=>(this.runtimeEnvironment=e,this.runtimeEnvironment)))}initReduxRouter(){this.reduxRouter=new l(h);const e=c.init({[l.KEY]:this.reduxRouter.reducer});this.reduxRouter.syncRouterWithStore(e)}getHostRootPageId(e){let t;if(e){const i=this.appUiInfos.getInfo(e);t=i&&i.hostRootPage}return t||this.definition.defaultPage.id}processDefaultPage(){if(this.isHostApplication){let e;const t=h.getUrlSegmentAfterAppName();t&&(e=this.appUiInfos.getAppUiIdFromUrlId(t)),this.defaultPage=new v(this,e)}return super.processDefaultPage()}prepareHostRootPage(e){return Promise.resolve().then((()=>{if(this.isHostApplication)return this.defaultPage=new v(this,e),super.processDefaultPage()}))}routerStateEnterCallback(e){return Promise.resolve().then((()=>{if(this.isHostApplication){const t=this.appUiInfos.getAppUiIdFromUrlId(e);t&&(e=t)}return super.routerStateEnterCallback(e)}))}routerStateCanExitCallback(e){return Promise.resolve().then((()=>{if(this.isHostApplication){const t=this.appUiInfos.getAppUiIdFromUrlId(e),i=new v(this,t);t&&(e=t);const r=this.pages[i.id];return r.getContainer(e).canExit().then((e=>e?r.canExit():e))}return super.routerStateCanExitCallback(e)}))}routerStateExitCallback(e){return Promise.resolve().then((()=>{let t;if(this.isHostApplication){const i=this.appUiInfos.getAppUiIdFromUrlId(e),r=new v(this,i);return i&&(e=i),t=this.pages[r.id].getContainer(e),t.exit()}return super.routerStateExitCallback(e)}))}loadContainer(e,t){return t&&t.isCancelled()?Promise.resolve():Promise.resolve().then((()=>{if(this.isHostApplication){const t=this.appUiInfos.getAppUiIdFromUrlId(e);if(t)e=t;else if(this.router.defaultStateId!==e){this.log.error("App UI",e,"does not exist in host application",E.appName);let t=window.location.href;return t=`${t.substring(0,t.indexOf(E.appName)+E.appName.length)}/`,p.changeBrowserState(null,t,"replaceState").then((()=>{P.resetUri(),h.sync()})),null}this.defaultPage=new v(this,t)}return super.loadContainer(e,t)}))}getContainer(e){let t=e;return this.isHostApplication&&(t=this.appUiInfos.getAppUiIdFromUrlId(e)),super.getContainer(t)}createFlow(e,t){if(this.doesAppUiExist(e)){const i=this.appUiInfos.getExtension(e);return new this.constructor.AppUiClass(i,i.getAppUiInfo(e),t)}return super.createFlow(e,t)}load(){return this._messageHandlerPromise||(this._messageHandlerPromise=this.installFetchPluginMessageHandler()),this._loadApplicationPromise||(this.logVersion(),Object.defineProperty(h,"application",{value:this,enumerable:!0,configurable:!0}),Object.defineProperty(b,"application",{value:this,enumerable:!0,configurable:!0}),this.initReduxRouter(),this.onNavigate(this.navigated,this),this._loadApplicationPromise=this.loadRuntimeEnvironment().then((()=>this.preloadModules())).then((()=>this.initAppUis())).then((()=>super.load())).then((()=>this.enter())).then((()=>this.processDefaultPage())).then((()=>{this.defaultPage.excludeFromUrl&&this.isQueryStrategy()&&this.defaultPage.id&&(r.defaults.rootInstanceName=this.defaultPage.id),this.moduleConfig({view:[],viewModel:{connected:()=>{i.getPageContext().getBusyContext().applicationBootstrapComplete(),h.sync()}}})})).then((()=>(p.isMobile()&&p.getResource("vb/private/mobile/customUrlScheme").then((e=>{e.performNavigationIfNeeded()})),this.preloadChains())))),Promise.all([this._loadApplicationPromise,this._messageHandlerPromise]).catch((e=>{throw i.getPageContext().getBusyContext().applicationBootstrapComplete(),e}))}getLeafPageInstance(e,t){return""===e?this.loadDefaultContainers(t):super.getLeafPageInstance(e,t)}getLeafPageInstanceFromAppUiId(e,t){return this.loadContainer(e,t).then((e=>{const i=e.router.defaultStateId;if(i){const r=t.options.page||"";if(e.definition.defaultFlow){const n=t.options.flow||i;return e.loadContainer(n,t).then((e=>e&&e.getLeafPageInstance(r||e.router.defaultStateId,t)))}const n=t.options.flow;return n?e.loadContainer(i,t).then((e=>e&&e.getLeafPageInstanceFromFlowId(n,t))):r?e.getLeafPageInstance(r,t):e.loadDefaultContainers(t)}this.log.error(`Cannot navigate to App UI ${this.id} because the default page or flow is not defined.`)}))}loadExtensions(){return super.loadExtensions().then((()=>this.extensionRegistry.getExtensions())).then((e=>{const t=this.extensionRegistry.getBasePath("",this.application),i=[];e.forEach((e=>{const r=e.id;if(!this.extensions[r]){const r=new(0,this.constructor.extensionClass)(e,t,this.application);r.initDefault({}),r.loadFunctionsPromise=Promise.resolve(),r.expressionContext=new r.constructor.ContextType(r),i.push(r)}})),this.storeExtensions(i)}))}fileExistsInExtension(e,t){return this.extensions[e].extension.fileExists(t)}preloadModules(){return this.runtimeEnvironment.getModulesToPreload().then((e=>{let t;return Array.isArray(e)&&e.length>0&&(t=p.getResources(e)),t}))}loadImports(){const{stopValidationPreLoading:e}=this.definition.settings;if(!0!==e){const e=["ojs/ojvalidation-datetime","ojs/ojvalidation-base","ojs/ojvalidation-number"];return Promise.all([super.loadImports(),p.getResources(e)])}return super.loadImports()}isDefault(){return!0}checkAccess(){return this.initApplicationUser().then((()=>super.checkAccess())).catch((e=>{throw this.log.error("Error while loading user information",e),e}))}initApplicationUser(){return Promise.resolve().then((()=>{const e=y.userConfig;if(e&&!this.securityProvider){const t=e.configuration;if(!t)throw new Error("Missing configuration in userConfig");return y.loadSecurityProvider().then((e=>(this.securityProvider=e,t.authentication=t.authentication||{},t.passthroughs=y.initParams[o.InitParams.PLUGIN_PASSTHROUGHS],this.securityProvider.initialize(t).then((()=>{const{userInfo:e}=this.securityProvider;e.isAuthenticated?this.log.info("User",e.username,"is authenticated."):this.log.info("User is anonymous.")})))))}}))}initAppUis(){return this.extensionRegistry.getAppUiInfos().then((e=>(this.appUiInfos=e,this.runtimeEnvironment.disableAppUis().then((e=>{this.isHostApplication=p.isHostApplication()&&!e})))))}initializeBuiltins(){super.initializeBuiltins(),this.securityProvider&&this.scope.createVariable(o.APPLICATION_USER_VARIABLE,o.VariableNamespace.BUILTIN,this.securityProvider.constructor.getUserInfoType(),this.securityProvider.userInfo,void 0,{writable:!1}),this.createConstant(o.PROFILE_CONSTANT,{type:"string",defaultValue:y.activeProfile},o.VariableNamespace.BUILTIN);const e=A.isPwaConfig(window.vbInitConfig),t=p.isMobile()?"mobile":"web",i=e?"enabled":"disabled";this.createConstant(o.DEPLOYMENT_CONSTANT,{type:"object",defaultValue:{appType:t,pwa:i}},o.VariableNamespace.BUILTIN),p.isHostApplication()&&this.scope.createVariable(o.GLOBAL_CURRENT_APPUI_VARIABLE,o.VariableNamespace.BUILTIN,this.appUiInfos.constructor.getAppUiInfoType(),{},void 0,{writable:!1})}defineCurrentPageBuiltinVariable(){return{type:"any",defaultValue:{id:"",path:"",title:""}}}loadFunctionModule(){if(this.loadAppFunctionsPromise)return this.loadAppFunctionsPromise;const e=super.loadFunctionModule(),t=[];t.push(e);const i=p.getResource("vb/private/stateManagement/applicationUtils").then((e=>(this.builtinUtils=e,e)));return t.push(i),this.loadAppFunctionsPromise=Promise.all(t),this.loadAppFunctionsPromise}defineInfoBuiltinVariable(){const e=super.defineInfoBuiltinVariable();return p.isHostApplication()?Object.assign(e,{appUis:this.appUiInfos.getAppUiIds(),appUiInfos:this.appUiInfos.info}):e}static get ContextType(){return d}onNavigate(e,t){this.reduxRouter.navigated.add(e,t)}navigated(e){if(e){const e=h.getCurrentPage();if(!e)return;const t=e.buildTitle();t&&t!==window.document.title&&(window.document.title=t);this.scope.getVariable(o.CURRENT_PAGE_VARIABLE,o.VariableNamespace.BUILTIN).setValueInternal({id:e.id,path:e.getNavPath(),title:t}),e.invokeAfterNavigateEvent()}}getParentFlow(){return null}getCurrentPagePath(){return this.scope&&this.expressionContext[o.CURRENT_PAGE_VARIABLE].path}updateCurrentPageVariable(){}buildTitle(e){return e}getScopeResolverMap(){return{[o.GLOBAL_PREFIX]:this,[o.APPLICATION_PREFIX]:this}}getAllServices(){return p.toFlatUniqueArray(super.getServices(),this.extensionsArray.map((e=>e.getAllServices())))}createServices(){return p.servicesGlobalVariableSupplier=()=>y.servicesGlobalVariables,this.protocolRegistry.getNames().then((e=>{let t=this.definition.services||{};const i=e.find((e=>e.protocol===o.VbProtocols.CATALOG));if(i&&i.namespaces.length){const e=i.namespaces[0];e&&e.services&&Array.isArray(e.services)&&e.services.length&&(t=Object.assign({},t),e.services.forEach((e=>{t[e]||(t[e]={path:`${i.protocol}://services/${e}`})})))}const r={relativePath:this.getResourceFolder(),serviceFileMap:t,expressionContext:this.getAvailableContexts(),isUnrestrictedRelative:!0,protocolRegistry:this.protocolRegistry};return this.services=new m(r),this.services.addDelegate(new S(r)),Promise.all(this.traverseExtensions("createServices")).then((e=>(this.catalogRegistry.extensionRegistry=this.extensionRegistry,this.extensionsArray.forEach((e=>{const t=e.services;e.extension.getRequiredExtensions().forEach((e=>{const i=this.extensions[e.id].services;t.addDelegate(i)})),t.addDelegate(this.services)})),e)))}))}loadTranslationBundles(){return this.loadBundlesPromise=b.loadBundlesModel(this.application.runtimeEnvironment,this.definition,this.getResourceFolder(),{isUnrestrictedRelative:!0,initParams:this.initParams},this.extension).then((e=>(this.bundles=e,this.bundles))),this.loadBundlesPromise}get initParams(){return y.initParams}get protocolRegistry(){return y.protocolRegistry}get catalogRegistry(){return y.catalogRegistry}set protocolRegistry(e){y.protocolRegistry=e}get extensionRegistry(){return y.extensionRegistry}installFetchPluginMessageHandler(){return Promise.resolve().then((()=>{let e=!0,t=[];this.swMessageHandler={vbResourceChanged:(e,i,r)=>{if(this.swMessageHandler.isEnabled()){if(!t.find((e=>e.headerValue===r))){const n=this.handleResourceChangeResponse(e,i,r);t.push({headerValue:r,promise:n}),n.then((e=>{t=t.filter((e=>e.headerValues!==r)),e&&this.swMessageHandler.disable()}))}}},vbGetUrlMapping:e=>y.urlMapper&&y.urlMapper.getUrlMapping(e),isEnabled:()=>e,enable:()=>{e=!0},disable:()=>{e=!1}},O.getInstance().installMessageHandler(this.swMessageHandler)}))}handleResourceChangeResponse(e,t,i){return Promise.resolve().then((()=>{let r=t;try{r=JSON.parse(r)}catch(e){}const n={url:e,error:r,headerValue:i};return(h.getCurrentPage()||this).invokeEventWithBubbling(o.RESOURCE_CHANGED_EVENT,n)})).then((e=>{if(e){if(e.filter((e=>e!==o.NO_EVENT_LISTENER_RESPONSE)).length)return w.info("handler disabled",o.RESOURCE_CHANGED_EVENT),!0;w.info("unhandled event",o.RESOURCE_CHANGED_EVENT)}return!1})).catch((e=>(w.error(e),!1)))}getParentModuleConfig(){return this.moduleConfig}dispose(){super.dispose(),this.moduleConfig(o.blankModuleConfig),r.rootInstance.dispose(),this.reduxRouter&&this.reduxRouter.dispose(),c.dispose(),this._loadApplicationPromise=null,this._messageHandlerPromise=null,C.clear(!0)}logVersion(){this.log.custom(`Starting Visual Builder Runtime v${n.visualDevelopmentPlatform.version}`,`(${n.visualDevelopmentPlatform.sprint}) commit: ${n.visualDevelopmentPlatform.commit}`);const e=n.jet.version,i=t.version;e!==i&&this.log.warn(`JET version mismatch: Visual Builder was built with ${e}, but is running with ${i}`)}}})),define("vb/private/stateManagement/application",["vb/private/stateManagement/applicationClass"],(e=>new e)),define("vb/private/logCustomWriter",["ojs/ojlogger","vb/private/constants","vb/private/log"],((e,t,i)=>{const r=/%s|%o|%O|%d|%i|%f/;class n{constructor(){this.logger=i.getLogger("/oj")}info(...e){this.logger.info(this.format(e))}warn(...e){this.logger.warn(this.format(e))}error(...e){this.logger.error(this.format(e))}log(...e){this.logger.info(this.format(e))}format(e){return e.reduce(((e,t)=>e.replace(r,t)),"%s")}}return e.option("writer",new n),n})),define("vb/bootstrap",["knockout","ojs/ojbootstrap","vb/private/stateManagement/application","vb/private/configuration","vb/private/constants","vb/private/utils","vb/private/history","vb/private/log","vb/private/logCustomWriter","vbIconFontCss","ojdnd","text","ojs/ojcomponentcore","ojs/ojcomposite","ojs/ojknockout"],((e,t,i,r,n,s,a,o)=>()=>{const c=o.getLogger("/vb/bootstrap");function l(e){s.replaceUrlPathname(e),a.resetUri()}let{pathname:h}=window.location;const p=h.indexOf(`/${r.urlMarker}`);if(p<0){const e="index.html",t=h.indexOf(e);t>=0&&(h=h.substring(0,t),l(h))}else r.appName&&(h=h.substring(0,p+1)+h.substring(p+4),l(h));i.load().then(t.whenDocumentReady).then((()=>{try{const t={[n.appModuleConfig]:i.moduleConfig};e.applyBindings(t,document.body)}catch(e){c.error("Error while applying bindings to the application.",e)}}))})),define("text!vb/components/list-item/component.json",[],(function(){return'{\n  "name": "oj-vb-list-item",\n  "description": "Composite component to display boilerplate UI for empty content.",\n  "version": "1.0.0",\n  "jetVersion": ">=4.2.0",\n  "properties": {\n    "title1": {\n      "description": "The value to be displayed in the primary title field. Not shown if the title1 slot is customized.",\n      "type": "any"\n    },\n    "title2": {\n      "description": "The value to be displayed in the secondary title field. Not shown if the title2 slot is customized.",\n      "type": "any"\n    },\n    "value1": {\n      "description": "The value to be displayed in the primary value field. Not shown if the value1 slot is customized.",\n      "type": "any"\n    },\n    "value2": {\n      "description": "The value to be displayed in the secondary value field. Not shown if the value2 slot is customized.",\n      "type": "any"\n    },\n    "imageSrc": {\n      "description": "The src of the image to be displayed. Not shown if the image slot is customized.",\n      "type": "string"\n    },\n    "displayOptions": {\n      "description": "Display options for the list item",\n      "type": "object",\n      "properties": {\n        "drill": "Whether to enable drill down icon at the end of the listItem. Use \'on\' to enable and \'off\' to disable drill down icon.",\n        "type": "string"\n      }\n    }\n  },\n  "slots" : {\n    "title1": {\n      "description": "The primary title content for the list item. If not specified, defaults to text displaying the value of the title1 property."\n    },\n    "title2": {\n      "description": "The secondary title content for the list item. If not specified, defaults to text displaying the value of the title2 property."\n    },\n    "value1": {\n      "description": "The primary value content for the list item. If not specified, defaults to text displaying the value of the value1 property."\n    },\n    "value2": {\n      "description": "The secondary value content for the list item. If not specified, defaults to text displaying the value of the value2 property."\n    },\n    "image": {\n      "description": "The content for the list item image. If not specified, defaults to an image displaying the imageSrc property."\n    }\n  }\n}'})),define("text!vb/components/list-item/listItem.html",[],(function(){return'<div role="gridcell" class="vbcs-list-item oj-flex-item oj-flex-bar oj-sm-align-items-center">\n    <div class="oj-flex-bar-start">\n        <oj-bind-slot name="image">\n            <oj-bind-if test="[[$props.imageSrc]]">\n                <img width="32" height="32" class="vbcs-list-item__image" :src="[[$props.imageSrc]]">\n            </oj-bind-if>\n        </oj-bind-slot>\n    </div>\n\n    <div class="oj-flex-bar-middle oj-sm-flex-direction-column oj-sm-padding-2x-start">\n        <oj-bind-slot name="title1">\n            <div class="vbcs-list-item__title1">\n                <oj-bind-text value="[[$properties.title1]]"></oj-bind-text>\n            </div>\n        </oj-bind-slot>\n        <oj-bind-slot name="title2">\n            <div class="vbcs-list-item__title2">\n                <oj-bind-text value="[[$properties.title2]]"></oj-bind-text>\n            </div>\n        </oj-bind-slot>\n    </div>\n\n    <div class="oj-flex-bar-end oj-sm-align-items-center oj-sm-padding-2x-start">\n        <div class="oj-flex oj-flex-item oj-sm-flex-direction-column">\n            <oj-bind-slot name="value1">\n                <div class="vbcs-list-item__value1">\n                    <oj-bind-text value="[[$properties.value1]]"></oj-bind-text>\n                </div>\n            </oj-bind-slot>\n            <oj-bind-slot name="value2">\n                <div class="vbcs-list-item__value2">\n                    <oj-bind-text value="[[$properties.value2]]"></oj-bind-text>\n                </div>\n            </oj-bind-slot>\n        </div>\n        <oj-bind-if test="[[$properties.displayOptions && $properties.displayOptions.drill === \'on\']]">\n            <div role="presentation" class="oj-flex-item oj-fwk-icon oj-listview-drill-icon"></div>\n        </oj-bind-if>\n    </div>\n</div>'})),define("css!vb/components/list-item/listItem",[],(function(){})),define("vb/components/list-item/loader",["ojs/ojcomposite","text!./component.json","text!./listItem.html","css!./listItem.css"],((e,t,i)=>{e.register("oj-vb-list-item",{view:i,metadata:JSON.parse(t)})})),define("text!vb/components/messagebar/view.html",[],(function(){return""})),define("text!vb/components/messagebar/messageBar.html",[],(function(){return'<div class="messagebar-confirmation-error-note">\n    <div class="messagebar-confirmation-error-note-wrap">\n        <div class="oj-flex">\n            <div class="messagebar-confirmation-error-note-image"></div>\n            <div class="messagebar-confirmation-error-note-text messagebar-pull-left"></div>\n            <div class="messagebar-confirmation-error-note-close messagebar-pull-right messagebar-hidden">\n                \x3c!-- ko if: action --\x3e\n                \x3c!-- ko foreach: action --\x3e\n                <oj-button class="messagebar-confirmation-error-note-action" chroming="half"\n                           on-click="[[action]]">\n                    <oj-bind-text value="[[label]]"></oj-bind-text>\n                </oj-button>\n                \x3c!-- /ko --\x3e\n                \x3c!-- /ko --\x3e\n                <oj-button display=\'icons\' chroming="half"\n                           on-click="[[close]]">\n                    <span slot=\'startIcon\' class="oj-fwk-icon oj-fwk-icon-cross"></span>\n                </oj-button>\n            </div>\n        </div>\n    </div>\n</div>'})),define("vb/components/messagebar/viewModel",["knockout","text!./messageBar.html"],(function(e,t){const i={error:console.error};var r=3e3,n="vb-messages",s=".messagebar-confirmation-error-note",a=".messagebar-confirmation-error-note-text",o=".messagebar-confirmation-error-note-close",c="messagebar-confirmation-error-note-counter",l="confirmation-note",h="error-note",p="warning-note",u="info-note",d="messagebar-slide-up",g="messagebar-slide-down",v="data-note-checksum",f={"error-note":"oj-fwk-icon-status-error","warning-note":"oj-fwk-icon-status-warning","confirmation-note":"oj-fwk-icon-status-confirmation","info-note":"oj-fwk-icon-status-info"},m={promises:[],currentPromise:null,queueTask:function(e){m.promises.push(e()),m.currentPromise||m.run()},run:function(){m.currentPromise=m.promises.shift(),m.currentPromise&&m.currentPromise.catch((function(e){i.error(e)})).then((function(){m.run()}))}};return function(b){var y=this,E=b.element;y.id=E.id||y.randomString(),y.duration=r,y.autocloseDefaults={error:!1,warn:!1,info:!1,confirmation:!0};var P=E.className||"";P.indexOf(n)<=0&&(E.className=P+" "+n),b.props.then((function(e){e.duration&&(y.duration=e.duration),e.autoclose&&Object.keys(e.autoclose).forEach((function(t){void 0!==e.autoclose[t]&&null!==e.autoclose[t]&&(y.autocloseDefaults[t]=e.autoclose[t])}))})),y.closeAll=function(e){e=e||g;var t=document.querySelectorAll("."+e);t&&t.forEach((function(e){y.closeNote(e)}))},y.show=function(e,t,r,n){switch(e){case"error":return y.showErrorNote(t,r,n);case"warn":case"warning":return y.showWarningNote(t,r,n);case"info":return y.showInfoNote(t,r,n);case"success":case"confirmation":return y.showConfirmationNote(t,r,n);default:i.error("invalid type passed to oj-vb-message-bar:",e)}},y.showErrorNote=function(e,t,i){return null==t&&(t=y.autocloseDefaults.error),y.showClosableNote(e,h,t,i)},y.showWarningNote=function(e,t,i){return null==t&&(t=y.autocloseDefaults.warn),y.showClosableNote(e,p,t,i)},y.showConfirmationNote=function(e,t,i){return null==t&&(t=y.autocloseDefaults.confirmation),y.showClosableNote(e,l,t,i)},y.showInfoNote=function(e,t,i){return null==t&&(t=y.autocloseDefaults.info),y.showClosableNote(e,u,t,i)},"complete"!==document.readyState&&m.queueTask((function(){return new Promise((function(e){window.addEventListener("onload",(function(){e()}),!1)}))})),y.getWrapperElement=function(){return E},y.getCloseableObject=function(e,t){var i=Array.isArray(t)?t:t?[t]:null;return i&&i.forEach((function(t,r){i[r].close=function(){var t=document.querySelector("#"+e);t&&y.closeNote(t)}})),{close:function(){var t=document.querySelector("#"+e);t&&y.closeNote(t)},action:i}},y.showClosableNote=function(e,t,i,r){var n="message-"+y.randomString(5),s=y.getCloseableObject(n,r),a=0;if(e){var o=[e,t,r,i];a=y.checksum(JSON.stringify(o))}return y.checkForSameNote(a)||m.queueTask((function(){return new Promise((function(r){var o=y.addMessageToDom(n,s,e,a,t);window.setTimeout((function(){y.slideDown(o)}),1),i&&window.setTimeout((function(){y.closeNote(o)}),y.duration),r()}))})),s},y.closeNote=function(e){e.firstChild.setAttribute(v,null),y.slideUp(e),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),1e3)},y.addMessageToDom=function(r,n,c,l,h){var p=y.getWrapperElement(),u=document.createElement("div");u.innerHTML=t,u.id=r,u.className=d+" "+u.className;var g=p.firstChild;u=p.insertBefore(u,g);var m=document.getElementById(r);m||i.error("did not find msgElem: "+r),e.applyBindings(n,m),u.querySelector(o).style.display="block",u.querySelector(a).textContent=c,u.querySelector(".messagebar-confirmation-error-note").setAttribute(v,l);var b=u.querySelector(".messagebar-confirmation-error-note-image");b.className=b.className+" "+f[h];var E=u.querySelector(s),P=E.className;return E.setAttribute("class",P+" messagebar-"+h),u},y.checksum=function(e){var t=0;e=y.id+e;for(var i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return t},y.checkForSameNote=function(e){var t=s+"["+v+'="'+e+'"]',i=document.querySelector(t);return!!i&&(y.increaseNoteCounter(i),!0)},y.increaseNoteCounter=function(e){var t=e.querySelector("."+c),i=e.querySelector(a);if(t)t.textContent=parseInt(t.textContent,10)+1;else{var r=document.createElement("div");r.innerHTML='<div class="'+c+'">2</div>',i.parentNode.insertBefore(r,i)}},y.slideUp=function(e){y.slide(e,d,g)},y.slideDown=function(e){y.slide(e,g,d)},y.slide=function(e,t,i){var r=(" "+e.className+" ").replace(/[\n\t\r]/g," ");return e.className=(r.replace(" "+i+" ","")+" "+t+" ").trim(),!1},y.randomString=function(){var e=46656*Math.random()|0,t=46656*Math.random()|0;return(e=("000"+e.toString(36)).slice(-3))+(t=("000"+t.toString(36)).slice(-3))}}})),define("text!vb/components/messagebar/component.json",[],(function(){return'{\n  "name": "oj-vb-message-bar",\n  "description": "Visual Builder Notification bars",\n  "version": "1.0.0",\n  "jetVersion": ">=4.0.0",\n  "properties": {\n    "duration": {\n      "description": "Milliseconds to show a message before auto-closing",\n      "type": "number"\n    },\n    "autoclose": {\n      "description": "the default values for the \'autoclose\' parameter for the different message types",\n      "properties": {\n        "error": {\n          "description": "Error message auto-close default",\n          "type": "boolean",\n          "default": false\n        },\n        "warn": {\n          "description": "Warning message auto-close default",\n          "type": "boolean",\n          "default": false\n        },\n        "info": {\n          "description": "Information message auto-close default",\n          "type": "boolean",\n          "default": false\n        },\n        "confirmation": {\n          "description": "Confirmation message auto-close default",\n          "type": "boolean",\n          "default": true\n        }\n      }\n    }\n  },\n  "methods": {\n    "show": {\n      "description": "",\n      "params": [{\n        "name": "type",\n        "description": "The type of message bar to display",\n        "type": "string",\n        "enumValues": ["error", "warn", "info", "confirmation"]\n      }, {\n        "name": "message",\n        "description": "The text to display",\n        "type": "string"\n      }, {\n        "name": "autoclose",\n        "description": "Whether the bar should close automatically after a pause",\n        "type": "boolean"\n      }, {\n        "name": "action",\n        "description": "Optional action push button to add to the message",\n        "type": "object",\n        "properties": {\n          "action": {\n            "description": "a parameterless function for the button on-click",\n            "type": "() => null"\n          },\n          "label": {\n            "description": "the button text",\n            "type": "string"\n          }\n        }\n      }]\n    },\n    "closeAll": {\n      "description": "Close all message bars"\n    }\n  }\n}'})),define("css!vb/components/messagebar/styles",[],(function(){})),define("vb/components/messagebar/loader",["ojs/ojcomposite","text!./view.html","./viewModel","text!./component.json","css!./styles"],((e,t,i,r)=>{const n=JSON.parse(r);e.register("oj-vb-message-bar",{view:t,viewModel:i,metadata:n})})),define("text!vb/components/mobile-navigation-bar-bottom/view.html",[],(function(){return'\x3c!--\n  Copyright (c) 2015, 2018, Oracle and/or its affiliates.\n  The Universal Permissive License (UPL), Version 1.0\n--\x3e\n\x3c!-- Page --\x3e\n<div id="page" class="oj-hybrid-applayout-page oj-ext-mobile-navbar-bottom-page">\n\n  \x3c!-- Content --\x3e\n  <div class="oj-ext-mobile-navigation-bar-page-content">\n    <oj-bind-slot name="content">\n      <div data-bind="ojModule: selection"></div>\n    </oj-bind-slot>\n  </div>\n\n  <div class="oj-applayout-fixed-bottom">\n    \x3c!-- Navigation Bar --\x3e\n    <div id="navbar" role="navigation" class="oj-hybrid-applayout-navbar-app">\n      <oj-navigation-list class="oj-navigationlist-stack-icon-label"\n                          data="[[navDataSource]]"\n                          edge="top"\n                          as=\'item\'\n                          on-selection-changed="[[navBarChangeHandler.bind($data)]]"\n                          on-oj-before-select="[[beforeSelectHandler.bind($data)]]"\n                          selection="[[$properties.selection]]">\n        \x3c!-- Navigation bar item template --\x3e\n        <template slot=\'itemTemplate\'>\n          <li><a href="#">\n            <span data-bind="css: \'oj-navigationlist-item-icon \' +  item.data[\'iconClass\']"></span>\n            <oj-bind-text value=\'[[item.data.name]]\'></oj-bind-text>\n          </a></li>\n        </template>\n      </oj-navigation-list>\n    </div>\n  </div>\n</div>'})),define("vb/components/mobile-navigation-bar-bottom/viewModel",["ojs/ojarraydataprovider","ojs/ojbutton","ojs/ojnavigationlist"],(e=>class{constructor(e){this.composite=e.element,this.configure()}configure(){document.querySelector('link[href*="alta-android"]')?this.composite.classList.add("oj-ext-android-theme"):document.querySelector('link[href*="alta-ios"]')?this.composite.classList.add("oj-ext-ios-theme"):document.querySelector('link[href*="oj-redwood"]')&&this.composite.classList.add("oj-ext-redwood-theme");const t=e=>{const t={};return t.name=e.getAttribute("name"),t.view=e.getAttribute("view"),t.action=e.getAttribute("action"),t.takeFocus=!("false"===e.getAttribute("takeFocus")),t.iconClass=e.getAttribute("iconclass"),t},i=[],r=this.composite.getElementsByTagName("oj-ext-mobile-navigation-item");for(let e=0;e<r.length;e+=1)i.push(t(r[e]));this.navData=i,this.navDataSource=new e(i,{idAttribute:"action"})}_raiseNavigationAction(e,t){const i={detail:{value:t.action}};this.composite.dispatchEvent(new CustomEvent("navigationAction",i))}navBarChangeHandler(e){if("external"!==e.detail.updatedFrom){const t=this._findNavItem(e.detail.value);t.action&&this._raiseNavigationAction(e,t)}}beforeSelectHandler(e){this._findNavItem(e.detail.key).takeFocus||e.preventDefault()}_findNavItem(e){return this.navData.find((t=>t.action===e))}})),define("text!vb/components/mobile-navigation-bar-bottom/component.json",[],(function(){return'{\r\n  "name": "oj-ext-mobile-navigation-bar-bottom",\r\n  "displayName": "Mobile Navigation Bar - Bottom Tabs",\r\n  "description": "A component to assist in creating a simple but compelling navigation framework. All configured navigation items are displayed in a bar across the bottom of the view.  The user can elect to either associate ojModule pages to the navigation items, in which case those pages will be displayed above the bar, or they can associate an action value and react to events raised when a navigation item is selected.",\r\n  "version": "1.0.0-beta.20180307",\r\n  "jetVersion": ">=4.2.0",\r\n  "properties": {\r\n    "selection": {\r\n      "type": "string",\r\n      "description": "Stores the currently selected item in the Nav Shell."\r\n    }\r\n  },\r\n  "methods": {\r\n  },\r\n  "events": {\r\n    "navigationAction": {\r\n      "description": "Triggered when a navigation item is selected and has an action property defined.",\r\n      "bubbles": false,\r\n      "detail": {\r\n        "value": {\r\n          "description": "The action value of the navigation item selected.",\r\n          "type": "string"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  "slots": {\r\n    "content": {\r\n      "description": "The page content that will be controlled by the navigation items. Defaults to an ojModule that is automatically updated."\r\n    }\r\n  },\r\n  "license": "https://opensource.org/licenses/UPL",\r\n  "extension": {\r\n    "catalog": {\r\n      "readme": "README.md",\r\n      "category": "Navigation",\r\n      "tags": [\r\n        "mobile",\r\n        "shell",\r\n        "navigation bar",\r\n        "tabs"\r\n      ],\r\n      "coverImage": "extension/catalog/images/oj-ext-mobile-navigation-bar-bottom-cover.JPG",\r\n      "screenshots": [\r\n        "extension/catalog/images/oj-ext-mobile-navigation-bar-bottom-shot1.JPG"\r\n      ]\r\n    }\r\n  }\r\n}'})),define("text!vb/components/mobile-navigation-bar-bottom/styles.css",[],(function(){return"/**\r\n  Copyright (c) 2015, 2018, Oracle and/or its affiliates.\r\n  The Universal Permissive License (UPL), Version 1.0\r\n*/\r\n\r\n/**\r\n * Important! This CSS is loaded through requirejs/text plugin vs require css plugin in VB packaging.  Hence relative\r\n * resource urls will not work in the css selectors as expected. It is fine since this component does not need any css resource urls\r\n */\r\noj-ext-mobile-navigation-bar-bottom:not(.oj-complete) {\r\n    visibility: hidden;\r\n}\r\n\r\noj-ext-mobile-navigation-bar-bottom .oj-navigationlist.oj-navigationlist-horizontal .oj-navigationlist-item {\r\n    /* Set default margin to the right of the tab to 0. JET 9.0 sets a margin which is not needed and causes spacing issues */\r\n    margin-right: 0;\r\n    /* Remove the border at the bottom */\r\n    border-bottom-width: 0;\r\n}\r\n\r\n/* Change the default size of the icon 16px. JET 9.0 is defaulting to 24px. 16px is compatible with previous versions */\r\noj-ext-mobile-navigation-bar-bottom .oj-navigationlist-item-icon {\r\n    font-size: 16px;\r\n}\r\n\r\n/* Change the default font size of the label to 12px. JET 9.0 is defaulting to 16px. 12px is compatible with previous versions */\r\noj-ext-mobile-navigation-bar-bottom .oj-navigationlist-horizontal .oj-navigationlist-item-label {\r\n    font-size: 12px;\r\n}\r\n\r\n/* For redwood themes use branding color to show the selection */\r\noj-ext-mobile-navigation-bar-bottom.oj-ext-redwood-theme .oj-navigationlist-item.oj-selected .oj-navigationlist-item-icon {\r\n    color: #759c6c !important;\r\n}\r\n\r\noj-ext-mobile-navigation-bar-bottom.oj-ext-redwood-theme .oj-navigationlist-item.oj-selected .oj-navigationlist-item-label {\r\n    color: #759c6c !important;\r\n}\r\n\r\n/**\r\n * Workaround JET issue. If we use slot='itemTemplate' recommended way to load items, the min-height is set to 56px,\r\n * which is 40 for the loading icon and 16 for paddings. So change the loading icons to a smaller value so that the\r\n * tabbar is of the correct size (min-height: 48px)\r\n */\r\noj-ext-mobile-navigation-bar-bottom .oj-listview-loading-icon {\r\n    width: 32px;\r\n    height: 32px;\r\n}\r\n/**\r\n * The iOS spec is 49pt (device independent pixel) and 56dp on Android for bottom tabbar . Hence the hardcoded numbers.\r\n * Note: We cannot use rem since they depend on the font size, which varies per device and desktop browser\r\n */\r\noj-ext-mobile-navigation-bar-bottom .oj-ext-mobile-navigation-bar-page-content {\r\n    position: absolute;\r\n    top: 0px;\r\n    left: 0px;\r\n    width: 100%;\r\n    bottom: 0px;\r\n    bottom: 0px;\r\n}\r\n\r\noj-ext-mobile-navigation-bar-bottom.oj-ext-ios-theme .oj-ext-mobile-navigation-bar-page-content {\r\n    margin-bottom: 49px;\r\n    margin-bottom: calc(49px + env(safe-area-inset-bottom));\r\n}\r\n\r\n/* By default (for android or any redwood) use has a larger bottom size */\r\noj-ext-mobile-navigation-bar-bottom .oj-ext-mobile-navigation-bar-page-content {\r\n    margin-bottom: 56px;\r\n    margin-bottom: calc(56px + env(safe-area-inset-bottom));\r\n}\r\n\r\n/* In landscape mode show the text to the right of the icon */\r\n@media (min-width: 760px) {\r\n    oj-ext-mobile-navigation-bar-bottom .oj-navigationlist.oj-navigationlist-horizontal .oj-navigationlist-listview .oj-navigationlist-item-content {\r\n        flex-direction: row;\r\n    }\r\n\r\n    /*\r\n       On iOS and Anndroid when the text is next to the icon because of the touch the margins are correct.\r\n       This is for browser mode only.\r\n     */\r\n     oj-ext-mobile-navigation-bar-bottom:not(.oj-ext-ios-theme):not(.oj-ext-android-theme) .oj-navigationlist-item-icon {\r\n        margin: 5px 4px 4px;\r\n    }\r\n}\r\n\r\noj-ext-mobile-navigation-bar-bottom .oj-hybrid-applayout-navbar-app .oj-navigationlist-listview-container {\r\n    margin-bottom: 0px;\r\n    margin-bottom: calc(0px + env(safe-area-inset-bottom));\r\n}\r\n\r\n/*\r\n * Styles specific to DT preview for supporting device safe areas (notch on iphoneX)\r\n */\r\n.vbdt-preview-iphonex oj-ext-mobile-navigation-bar-bottom .oj-ext-mobile-navigation-bar-page-content {\r\n    margin-bottom: 83px;\r\n}\r\n\r\n.vbdt-preview-iphonex oj-ext-mobile-navigation-bar-bottom .oj-hybrid-applayout-navbar-app .oj-navigationlist-listview-container {\r\n    margin-bottom: 24px;\r\n}"})),define("text!vb/components/mobile-navigation-item/component.json",[],(function(){return'{\r\n  "name": "oj-ext-mobile-navigation-item",\r\n  "displayName": "Mobile Navigation Item",\r\n  "description": "A component used as a navigation item for navigation bottom bar and navigation drawer components.",\r\n  "version": "1.0.0",\r\n  "jetVersion": ">=6.0.0",\r\n  "properties": {\r\n    "name": {\r\n      "type": "string",\r\n      "description": "Name of the navigation item."\r\n    },\r\n    "action": {\r\n      "type": "string",\r\n      "description": "Action triggered by the navigation item.",\r\n      "value": false\r\n    },\r\n    "iconclass": {\r\n      "type": "string",\r\n      "description": "Style class name used for the icon.",\r\n      "value": false\r\n    }\r\n  }\r\n}'})),define("vb/components/mobile-navigation-item/loader",["ojs/ojcomposite","text!./component.json"],((e,t)=>{e.register("oj-ext-mobile-navigation-item",{view:"",metadata:JSON.parse(t)})})),define("vb/components/mobile-navigation-bar-bottom/loader",["ojs/ojcomposite","text!./view.html","./viewModel","text!./component.json","text!./styles.css","../mobile-navigation-item/loader"],((e,t,i,r,n)=>{const s=document.createElement("style");document.querySelector("head").appendChild(s),s.appendChild(document.createTextNode(n)),e.register("oj-ext-mobile-navigation-bar-bottom",{view:t,viewModel:i,metadata:JSON.parse(r)})})),define("text!vb/components/mobile-navigation-bar-drawer/view.html",[],(function(){return'\x3c!--\n  Copyright (c) 2015, 2018, Oracle and/or its affiliates.\n  The Universal Permissive License (UPL), Version 1.0\n--\x3e\n<div id="oj-ext-mobile-app-drawer" role="navigation" class="oj-hybrid-applayout-offcanvas oj-offcanvas-start oj-contrast-marker">\n  \x3c!-- User Profile --\x3e\n  <div>\n\n    <oj-slot name="header">\n    </oj-slot>\n\n    \x3c!-- Navigation List--\x3e\n    <oj-navigation-list class="oj-navigationlist-stack-icon-label"\n                        data="[[navDataSource]]"\n                        as=\'item\'\n                        on-selection-changed="[[navBarChangeHandler.bind($data)]]"\n                        on-oj-before-select="[[beforeSelectHandler.bind($data)]]"\n                        on-click="[[toggle.bind($data)]]"\n                        selection="[[$properties.selection]]">\n      \x3c!-- Navigation Drawer Template --\x3e\n      <template slot=\'itemTemplate\'>\n        <li><a href="#">\n          <span data-bind="css: item.data[\'iconClass\'] + \' oj-navigationlist-item-icon\' "></span>\n          <oj-bind-text value=\'[[item.data.name]]\'></oj-bind-text>\n        </a></li>\n      </template>\n    </oj-navigation-list>\n\n    <oj-slot name="footer">\n    </oj-slot>\n  </div>\n</div>\n\n\n'})),define("vb/components/mobile-navigation-bar-drawer/viewModel",["jquery","hammerjs","ojs/ojoffcanvas","ojs/ojarraydataprovider","ojs/ojbutton","ojs/ojnavigationlist"],((e,t,i,r)=>{const n={displayMode:"push",selector:"#oj-ext-mobile-app-drawer",content:"div.oj-hybrid-applayout-page"},s={recognizers:[[t.Swipe,{direction:t.DIRECTION_HORIZONTAL}]]};return class{constructor(e){this.composite=e.element,this._props=e.properties,this.configure()}connected(){const r=this._props,a="rtl"===(document.documentElement.getAttribute("dir")||"").toLowerCase();e(n.selector).on("ojopen",(()=>{r.expanded||(r.expanded=!0)})).on("ojclose",(()=>{r.expanded&&(r.expanded=!1)}));const o=document.querySelector(n.content),c=new t.Manager(o,s);return c.on("swiperight",(e=>{e.preventDefault(),a||i.open(n)})),c.on("swipeleft",(e=>{e.preventDefault(),a&&i.open(n)})),c.on("swipeleft",(e=>{e.preventDefault(),a||i.close(n)})),c.on("swiperight",(e=>{e.preventDefault(),a&&i.close(n)})),o.style.cssText+="-webkit-user-select: auto",r.expanded?i.open(n):i.close(n)}propertyChanged(e){"expanded"===e.property&&(e.value?i.open(n):i.close(n))}configure(){const e=e=>{const t={};return t.name=e.getAttribute("name"),t.view=e.getAttribute("view"),t.action=e.getAttribute("action"),t.takeFocus=!("false"===e.getAttribute("takeFocus")),t.iconClass=e.getAttribute("iconclass"),t},t=[],i=this.composite.getElementsByTagName("oj-ext-mobile-navigation-item");for(let r=0;r<i.length;r+=1)t.push(e(i[r]));this.navData=t,this.navDataSource=new r(t,{idAttribute:"action"})}_raiseNavigationAction(e,t){const i={detail:{value:t.action}};this.composite.dispatchEvent(new CustomEvent("navigationAction",i))}toggle(){this._props.expanded=!this._props.expanded}navBarChangeHandler(e){if("external"!==e.detail.updatedFrom){const t=this._findNavItem(e.detail.value);t.action&&this._raiseNavigationAction(e,t)}}beforeSelectHandler(e){this._findNavItem(e.detail.key).takeFocus||e.preventDefault()}_findNavItem(e){return this.navData.find((t=>t.action===e))}}})),define("text!vb/components/mobile-navigation-bar-drawer/component.json",[],(function(){return'{\r\n  "name": "oj-ext-mobile-navigation-bar-drawer",\r\n  "displayName": "Mobile Navigation Bar - Drawer",\r\n  "description": "A component to assist in creating a simple but compelling navigation framework. All configured navigation items are displayed in a vertical drawer along the left side of the view.  The user can elect to either associate ojModule pages to the navigation items, in which case those pages will be displayed above the bar, or they can associate an action value and react to events raised when a navigation item is selected. The drawer can be hidden or exposed via methods of this CCA.",\r\n  "version": "1.0.0",\r\n  "jetVersion": ">=6.0.0",\r\n  "properties": {\r\n    "selection": {\r\n      "type": "string",\r\n      "description": "Stores the currently selected item in the navigation drawer."\r\n    },\r\n    "expanded": {\r\n      "type": "boolean",\r\n      "description": "Indicates whether the navigation drawer is expanded or collapsed.",\r\n      "value": false\r\n    }\r\n  },\r\n  "methods": {\r\n    "toggle": {\r\n      "params": [],\r\n      "description": "Toggles the visibility of the navigation drawer."\r\n    }\r\n  },\r\n  "events": {\r\n    "navigationAction": {\r\n      "description": "Triggered when a navigation item is selected and has an action property defined.",\r\n      "bubbles": false,\r\n      "detail": {\r\n        "value": {\r\n          "description": "The action value of the navigation item selected.",\r\n          "type": "string"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  "slots": {\r\n    "header": {\r\n      "description": "Material to place above the list of Navigation Items, giving a better product identification capability."\r\n    },\r\n    "footer": {\r\n      "description": "Material to place under the list of Navigation Items."\r\n    }\r\n  },\r\n  "license": "https://opensource.org/licenses/UPL",\r\n  "extension": {\r\n    "catalog": {\r\n      "readme": "README.md",\r\n      "category": "Navigation",\r\n      "tags": [\r\n        "mobile",\r\n        "shell",\r\n        "navigation drawer",\r\n        "drawer"\r\n      ],\r\n      "coverImage": "extension/catalog/images/oj-ext-mobile-navigation-bar-drawer-cover.JPG",\r\n      "screenshots": [\r\n        "extension/catalog/images/oj-ext-mobile-navigation-bar-drawer-shot1.JPG"\r\n      ]\r\n    }\r\n  }\r\n}'})),define("text!vb/components/mobile-navigation-bar-drawer/styles.css",[],(function(){return"/**\r\n  Copyright (c) 2015, 2018, Oracle and/or its affiliates.\r\n  The Universal Permissive License (UPL), Version 1.0\r\n*/\r\n\r\n/**\r\n * Important! This CSS is loaded through requirejs/text plugin vs require css plugin in VB packaging.  Hence relative\r\n * resource urls will not work in the css selectors as expected. It is fine since this component does not need any css resource urls\r\n */\r\noj-ext-mobile-navigation-bar-drawer:not(.oj-complete){\r\n  visibility: hidden;\r\n}\r\n\r\n/**\r\n   external style overridden so that the off canvas wrapper can be positioned correctly inside the absolutely\r\n   positioned body element\r\n */\r\n.oj-offcanvas-outer-wrapper.oj-offcanvas-page {\r\n  position: inherit;\r\n}\r\n\r\noj-ext-mobile-navigation-bar-drawer .oj-contrast-marker h2,\r\noj-ext-mobile-navigation-bar-drawer .oj-contrast-marker h3,\r\noj-ext-mobile-navigation-bar-drawer .oj-contrast-marker h4 {\r\n  color: #fff;\r\n  font-size: 1.75rem;\r\n}\r\n\r\n/* Add extra padding to the item. The default is too small compared to the native ios and android implementations */\r\nhtml[dir=rtl] oj-ext-mobile-navigation-bar-drawer .oj-navigationlist-vertical:not(.oj-navigationlist-icon-only) .oj-navigationlist-item {\r\n  padding-right: calc(1.25rem - 3px);\r\n}\r\n\r\nhtml:not([dir=rtl]) oj-ext-mobile-navigation-bar-drawer .oj-navigationlist-vertical:not(.oj-navigationlist-icon-only) .oj-navigationlist-item {\r\n  padding-left: calc(1.25rem - 3px);\r\n}\r\n\r\n/* Fix the size of the icon to 16px. Jet 9.0 has 24px size by default */\r\noj-ext-mobile-navigation-bar-drawer .oj-navigationlist-item-icon {\r\n  font-size: 16px;\r\n}\r\n\r\n/* Safe margins for the drawer */\r\noj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas > div  {\r\n  margin-top: 0px;\r\n  margin-top: calc(0px + constant(safe-area-inset-top));\r\n  margin-top: calc(0px + env(safe-area-inset-top));\r\n  margin-bottom: 5px;\r\n  margin-bottom: calc(5px + constant(safe-area-inset-bottom));\r\n  margin-bottom: calc(5px + env(safe-area-inset-bottom));\r\n  overflow-y: hidden;\r\n}\r\n\r\noj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas > div > *[slot='header'] {\r\n  text-align: center;\r\n  padding-top: 10px;\r\n  padding-bottom: 10px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n}\r\n\r\n/* In landscape mode add safe margins for iphone to the left */\r\n@media screen and (orientation: landscape) {\r\n  oj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas > div  {\r\n    /* safe area margins at the left and right */\r\n    margin-left: calc(constant(safe-area-inset-left));\r\n    margin-left: calc(env(safe-area-inset-left));\r\n  }\r\n}\r\n\r\n/* min-height 100vh messes with mobile browsers since 100vh is more than the viewport. So override it */\r\noj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas {\r\n  min-height: 100vh;\r\n}\r\n\r\nbody:not(.oj-platform-ios):not(.oj-platform-android) oj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas {\r\n  min-height: 100%;\r\n}\r\n\r\n/*\r\n * Styles specific to DT preview for supporting device safe areas (notch on iphoneX)\r\n */\r\n.vbdt-preview-iphonex oj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas > div  {\r\n  margin-bottom: 29px;\r\n}\r\n\r\n@media screen and (orientation: portrait) {\r\n  .vbdt-preview-iphonex oj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas > div {\r\n    margin-top: 35px;\r\n  }\r\n}\r\n\r\n@media screen and (orientation: landscape) {\r\n  .vbdt-preview-iphonex oj-ext-mobile-navigation-bar-drawer .oj-hybrid-applayout-offcanvas > div  {\r\n    margin-left: 24px;\r\n  }\r\n}"})),define("vb/components/mobile-navigation-bar-drawer/loader",["ojs/ojcomposite","text!./view.html","./viewModel","text!./component.json","text!./styles.css","../mobile-navigation-item/loader"],((e,t,i,r,n)=>{const s=document.createElement("style");document.querySelector("head").appendChild(s),s.appendChild(document.createTextNode(n)),e.register("oj-ext-mobile-navigation-bar-drawer",{view:t,viewModel:i,metadata:JSON.parse(r)})})),define("text!vb/components/mobile-page-template/view.html",[],(function(){return'\x3c!--\n  Copyright (c) 2015, 2018, Oracle and/or its affiliates.\n  The Universal Permissive License (UPL), Version 1.0\n--\x3e\n<div class="oj-applayout-fixed-top">\n  <header role="banner" class="oj-hybrid-applayout-header">\n    <div class="oj-ext-mobile-header-content">\n      <div id="startActionControl" class="oj-flex-bar-start">\n        <oj-slot name="startControl"></oj-slot>\n      </div>\n\n      <div class="oj-hybrid-applayout-bar-title">\n        <h1 class="oj-hybrid-applayout-header-title" data-bind="text: $properties.pageTitle"></h1>\n      </div>\n\n      <div id="endActionControl" class="oj-flex-bar-end">\n        <oj-slot name="endControl"></oj-slot>\n      </div>\n    </div>\n  </header>\n  <div role="navigation" class="oj-hybrid-applayout-navbar-page">\n    <oj-slot name="navigationBarTop"></oj-slot>\n  </div>\n</div>\n\n\x3c!-- Content --\x3e\n<div class="oj-ext-mobile-page-content oj-flex oj-sm-flex-direction-column oj-sm-flex-wrap-nowrap">\n  <oj-slot>\n  </oj-slot>\n</div>'})),define("vb/components/mobile-page-template/viewModel",[],(()=>class{constructor(e){this.composite=e.element,this.configure()}configure(){document.body.classList.add("oj-ext-mobile-app"),document.querySelector('link[href*="alta-android"]')?this.composite.classList.add("oj-ext-android-theme"):document.querySelector('link[href*="alta-ios"]')&&this.composite.classList.add("oj-ext-ios-theme")}bindingsApplied(){const e=this.composite.getElementsByClassName("oj-hybrid-applayout-navbar-page")[0];if(e.children.length>0){const e=this.composite.getElementsByTagName("header")[0];e.classList.remove("oj-hybrid-applayout-header"),e.classList.add("oj-hybrid-applayout-header-no-border"),this.composite.classList.add("oj-ext-mobile-page-with-navbar")}else e.style.display="none";const t=this._statusTapListener.bind(this),i=this.composite.getElementsByClassName("oj-applayout-fixed-top")[0];i&&i.addEventListener("click",(e=>{const{className:i}=e.target;i.match(/oj-hybrid-applayout-header|oj-hybrid-applayout-bar-title|oj-ex-mobile-header-content|oj-hybrid-applayout-header-title/)&&t()})),window.addEventListener("statusTap",t)}_statusTapListener(){const e=this.composite.getElementsByClassName("oj-ext-mobile-page-content")[0],t=this._nearestScrollableElement(e);t&&this._scrollElementToTop(t,300)}_scrollElementToTop(e,t){const i=e.scrollTop/2;let r=0,n=window.performance.now();const s=a=>{r+=Math.PI/(t/(a-n)),r>=Math.PI&&(e.scrollTop=0),0!==e.scrollTop&&(e.scrollTop=Math.round(0+i+i*Math.cos(r)),n=a,window.requestAnimationFrame(s))};window.requestAnimationFrame(s)}_nearestScrollableElement(e){return e.scrollHeight-e.clientHeight>=2&&e.scrollTop>0?e:e.children.length>0?this._nearestScrollableElement(e.children[0]):null}})),define("text!vb/components/mobile-page-template/component.json",[],(function(){return'{\r\n  "name": "oj-ext-mobile-page-template",\r\n  "displayName": "Mobile Page Template",\r\n  "description": "A fairly generic page template for mobile applications. This template provides for a text header in the top center of the page, and two slots for actionable components to the left and right of the header text (start and end locations, for BiDi compatibility). There is also a slot for displaying navigation items under the header",\r\n  "version": "1.0.0-beta.20180307",\r\n  "jetVersion": ">=4.2.0",\r\n  "properties": {\r\n    "pageTitle": {\r\n      "type": "string",\r\n      "description": "Stores the title of the page, which is displayed in the center of the page header."\r\n    }\r\n  },\r\n  "methods": {\r\n  },\r\n  "events": {\r\n  },\r\n  "slots": {\r\n    "startControl": {\r\n      "description": "Provide the content for the startControl."\r\n    },\r\n    "endControl": {\r\n      "description": "Provide the content for the endControl."\r\n    },\r\n    "navigationBarTop": {\r\n      "description": "Provide the content for the navigation bar at the top."\r\n    },\r\n    "": {\r\n      "description": "Contains the user defined page content."\r\n    }\r\n  },\r\n  "license": "https://opensource.org/licenses/UPL",\r\n  "extension": {\r\n    "catalog": {\r\n      "readme": "README.md",\r\n      "category": "Layout",\r\n      "tags": [\r\n        "mobile",\r\n        "page",\r\n        "layout"\r\n      ],\r\n      "coverImage": "extension/catalog/images/oj-ext-mobile-page-template-cover.JPG",\r\n      "screenshots": [\r\n        "extension/catalog/images/oj-ext-mobile-page-template-shot1.JPG"\r\n      ]\r\n    }\r\n  }\r\n}'})),define("text!vb/components/mobile-page-template/styles.css",[],(function(){return"/**\r\n  Copyright (c) 2015, 2018, Oracle and/or its affiliates.\r\n  The Universal Permissive License (UPL), Version 1.0\r\n*/\r\noj-ext-mobile-page-template:not(.oj-complete) {\r\n    visibility: hidden;\r\n}\r\n\r\n/**\r\n * Important! This CSS is loaded through requirejs/text plugin vs require css plugin in VB packaging.  Hence relative\r\n * resource urls will not work in the css selectors as expected. It is fine since this component does not need any css resource urls\r\n */\r\n\r\n/*\r\n* The following effects content outside the page template because we want to make our container absolutely positioned\r\n* without any scrollbars. The scrollbars will be set inside the template content.\r\n* This is fair since there is only 1 page template and it sets the layout for the entire mobile application\r\n*/\r\nhtml {\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\nbody.oj-ext-mobile-app {\r\n    /* important style to prevent the entire body from being scrolled. 'oj-web-applayout-body' is set in index.html */\r\n    overflow-y: hidden;\r\n    overflow-x: hidden;\r\n    margin: 0;\r\n    padding: 0;\r\n    position: absolute;\r\n    width: 100%;\r\n    max-width: 100%;\r\n    height: 100%;\r\n    max-height: 100%;\r\n    -webkit-font-smoothing: antialiased;\r\n    font-smoothing: antialiased;\r\n    text-rendering: optimizeLegibility;\r\n}\r\n\r\n/* On the actual device use 100vh since the app is full screen */\r\nbody.oj-platform-ios,\r\nbody.oj-platform-android{\r\n    height: 100vh;\r\n    max-height: 100vh;\r\n}\r\n\r\n.oj-hybrid-applayout-page {\r\n    height: 100%;\r\n    width: 100%;\r\n    position: absolute;\r\n    overflow-y: hidden;\r\n    left: 0px;\r\n    top: 0px;\r\n}\r\n\r\n/* Override JET style since min-height 100vh messes with mobile browsers.*/\r\nbody:not(.oj-platform-ios):not(.oj-platform-android) .oj-hybrid-applayout-page {\r\n    min-height: 100%;\r\n}\r\n\r\n/* For oj-messages account for the iphone notch */\r\n.oj-ext-mobile-app oj-messages .oj-messages-container {\r\n    margin-top: calc(10px + env(safe-area-inset-top));\r\n}\r\n\r\n.vbdt-preview-iphonex.oj-ext-mobile-app oj-messages .oj-messages-container {\r\n    margin-top: 54px;\r\n}\r\n\r\n\r\n/* page template specific styles */\r\n\r\noj-ext-mobile-page-template .oj-ext-mobile-header-content oj-button.oj-button .oj-button-button {\r\n    /* remove borders on buttons in the header area */\r\n    border-style: none;\r\n    background-color: transparent;\r\n}\r\n\r\noj-ext-mobile-page-template .oj-ext-mobile-header-content oj-button.oj-button.oj-hover .oj-button-button,\r\noj-ext-mobile-page-template .oj-ext-mobile-header-content oj-button.oj-button.oj-active .oj-button-button {\r\n    /* remove background-color hover/active effect on buttons */\r\n    background-color: transparent;\r\n}\r\n\r\noj-ext-mobile-page-template .oj-applayout-fixed-top {\r\n    -webkit-tap-highlight-color: transparent;\r\n    -webkit-touch-callout: none;\r\n}\r\n\r\n@media screen and (orientation: landscape) {\r\n    /* On iOS give extra padding on the header so that it is not too close to the corners in landscape mode */\r\n    .oj-platform-ios oj-ext-mobile-page-template .oj-ext-mobile-header-content {\r\n        /* CSS paddings cannot be negative. So it will be 0 in case the safe area is 0 */\r\n        padding-left: calc(env(safe-area-inset-left) - .625rem);\r\n        padding-right: calc(env(safe-area-inset-right) - .625rem);\r\n        box-sizing: border-box;\r\n    }\r\n\r\n    /* On iOS landscape add padding for the content inside the navigation bar at the top */\r\n    .oj-platform-ios oj-ext-mobile-page-template .oj-hybrid-applayout-navbar-page {\r\n        padding-left: .625rem;\r\n        padding-right: .625rem;\r\n        /* For iphoneX Safari browsers(since they supports css4 max) */\r\n        padding-left: max(.625rem, env(safe-area-inset-left));\r\n        padding-right: max(.625rem, env(safe-area-inset-right));\r\n    }\r\n}\r\n\r\noj-ext-mobile-page-template .oj-hybrid-applayout-header {\r\n    padding-top: 0px;\r\n    padding-top: calc(env(safe-area-inset-top));\r\n    height: 45px;\r\n    height: calc(45px + env(safe-area-inset-top));\r\n    box-sizing: border-box;\r\n}\r\n\r\noj-ext-mobile-page-template .oj-hybrid-applayout-header-no-border {\r\n    padding-top: 0px;\r\n    padding-top: calc(env(safe-area-inset-top));\r\n    height: 44px;\r\n    height: calc(44px + env(safe-area-inset-top));\r\n    box-sizing: border-box;\r\n}\r\n\r\n/* Android has a default height of 56px */\r\noj-ext-mobile-page-template.oj-ext-android-theme .oj-hybrid-applayout-header {\r\n    height: 56px;\r\n}\r\n\r\noj-ext-mobile-page-template.oj-ext-android-theme .oj-hybrid-applayout-header-no-border {\r\n    height: 55px;\r\n}\r\n\r\noj-ext-mobile-page-template .oj-ext-mobile-header-content {\r\n    width: 100%;\r\n    border: 0;\r\n    display: flex;\r\n    align-items: center;\r\n    -webkit-transform: translateZ(0);\r\n}\r\n\r\n/* Actual content of the mobile page. This will provide scrolling (with momentum on ios) */\r\noj-ext-mobile-page-template .oj-ext-mobile-page-content {\r\n    /* safe area margins at the top */\r\n    margin-top: 45px;\r\n    margin-top: calc(45px + env(safe-area-inset-top));\r\n    /* safe area margins at the left and right */\r\n    margin-left: calc(env(safe-area-inset-left));\r\n    margin-right: calc(env(safe-area-inset-right));\r\n\r\n    left: 0;\r\n    right: 0;\r\n    top: 0;\r\n    bottom: 0;\r\n    position: absolute;\r\n    z-index: 1;\r\n    overflow-x: hidden;\r\n    overflow-y: auto;\r\n    -webkit-overflow-scrolling: touch;\r\n    -webkit-transform: translateZ(0);\r\n}\r\n\r\n/*\r\n * Sometimes ios has a weird issue with panning when webkit-overflow-scrolling is inherited from parent element.\r\n * So disable it for all the descendant elements. Descendant elements would need to explicitly enable when necessary\r\n */\r\noj-ext-mobile-page-template .oj-ext-mobile-page-content *{\r\n    -webkit-overflow-scrolling: revert;\r\n}\r\n\r\n/* Override JET style so that the title does not wrap */\r\noj-ext-mobile-page-template .oj-hybrid-applayout-bar-title {\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n}\r\n\r\noj-ext-mobile-page-template.oj-ext-mobile-page-with-navbar .oj-ext-mobile-page-content {\r\n    /* safe area margins at the top */\r\n    margin-top: 89px;\r\n    margin-top: calc(89px + env(safe-area-inset-top));\r\n}\r\n\r\n/* Android has a default height of 56px */\r\noj-ext-mobile-page-template.oj-ext-android-theme .oj-ext-mobile-page-content {\r\n    margin-top: 56px;\r\n}\r\n\r\n/* Android has a default height of 103px when used with the navigation bar at top*/\r\noj-ext-mobile-page-template.oj-ext-android-theme.oj-ext-mobile-page-with-navbar .oj-ext-mobile-page-content {\r\n    /* safe area margins at the top */\r\n    margin-top: 103px;\r\n}\r\n\r\n/* When used without the bottom navigation bar the page should have safe area margins at the bottom */\r\n.oj-hybrid-applayout-page:not(.oj-ext-mobile-navbar-bottom-page) .oj-ext-mobile-page-content {\r\n    margin-bottom: 0px;\r\n    margin-bottom: calc(0px + env(safe-area-inset-bottom));\r\n}\r\n\r\n/*\r\n * Styles specific to DT preview for supporting device safe areas (notch on iphoneX)\r\n */\r\n@media screen and (orientation: landscape) {\r\n    .vbdt-preview-iphonex oj-ext-mobile-page-template.oj-ext-ios-theme .oj-ext-mobile-header-content {\r\n        padding-left: calc(24px - .625rem);\r\n        padding-right: calc(35px - .625rem);\r\n    }\r\n\r\n    /* On iOS landscape add padding for the content inside the navigation bar at the top */\r\n    .vbdt-preview-iphonex oj-ext-mobile-page-template.oj-ext-ios-theme .oj-hybrid-applayout-navbar-page {\r\n        padding-left: 24px;\r\n        padding-right: 35px;\r\n    }\r\n\r\n    .vbdt-preview-iphonex oj-ext-mobile-page-template .oj-ext-mobile-page-content {\r\n        /* safe area margins at the left and right */\r\n        margin-left: 24px;\r\n        margin-right: 35px;\r\n    }\r\n}\r\n\r\n@media screen and (orientation: portrait) {\r\n    .vbdt-preview-iphonex oj-ext-mobile-page-template .oj-hybrid-applayout-header {\r\n        padding-top: 35px;\r\n        height: 80px;\r\n    }\r\n\r\n    .vbdt-preview-iphonex oj-ext-mobile-page-template .oj-hybrid-applayout-header-no-border {\r\n        padding-top: 35px;\r\n        height: 79px;\r\n    }\r\n    .vbdt-preview-iphonex oj-ext-mobile-page-template .oj-ext-mobile-page-content {\r\n        /* safe area margins at the top */\r\n        margin-top: 79px;\r\n    }\r\n\r\n    .vbdt-preview-iphonex oj-ext-mobile-page-template.oj-ext-mobile-page-with-navbar .oj-ext-mobile-page-content {\r\n        margin-top: 123px;\r\n    }\r\n}\r\n\r\n.vbdt-preview-iphonex .oj-hybrid-applayout-page:not(.oj-ext-mobile-navbar-bottom-page) oj-ext-mobile-page-template .oj-ext-mobile-page-content {\r\n    margin-bottom: 24px;\r\n}"})),define("vb/components/mobile-page-template/loader",["ojs/ojcomposite","text!./view.html","./viewModel","text!./component.json","text!./styles.css"],((e,t,i,r,n)=>{const s=document.createElement("style");document.querySelector("head").appendChild(s),s.appendChild(document.createTextNode(n)),e.register("oj-ext-mobile-page-template",{view:t,viewModel:i,metadata:JSON.parse(r)})})),define("text!vb/components/oj-vb-switcher/component.json",[],(function(){return'{\n  "name": "oj-vb-switcher",\n  "displayName": "Visual Builder Switcher",\n  "description": "A component to switch the content of Visual Builder page between flows",\n  "version": "22.10.0",\n  "jetVersion": ">=12.0.0",\n  "properties": {\n    "bridge": {\n      "type": "Object",\n      "description": "A factory to create a bridge between CCA and VB"\n    },\n    "data": {\n      "type": "Object",\n      "description": "data"\n    },\n    "currentItem": {\n      "type": "String",\n      "description": "The current item to display in the switcher",\n      "writeback": true\n    },\n    "animation": {\n      "type": "Object"\n    }\n  }\n}'})),define("vb/components/oj-vb-switcher/switcherViewModel",["vb/private/log"],(e=>{const t=e.getLogger("/vb/components/oj-vb-switcher");return class{constructor(e){const t=e.properties;if(this.composite=e.element,this.properties=e.properties,!t.data){throw new Error("A data property was not provided. This is required in order to load and render the content of a switcher. Check the configuration of the oj-vb-switcher CCA!")}t.data.addEventListener("mutate",this.mutateArrayListener.bind(this));const i=t.bridge;this.bridge=i.create("switcher",t)}connected(e){this.bridge.connected(e)}disconnected(e){const t=e?e.children:void 0;this.bridge.disconnected(t)}get moduleConfig(){return this.bridge.moduleConfig}mutateArrayListener(e){const{detail:t}=e;if(t.add)if(t.remove){const e=t.add.data,i=t.remove.data.filter((t=>e.filter((e=>e.id!==t.id)).length>0));this.bridge.arrayRemove(i)}else this.bridge.arrayAdd(t.add.data);else t.remove&&this.bridge.arrayRemove(t.remove.data)}propertyChanged(e){if("currentItem"===e.property){const{previousValue:i,value:r}=e;this.bridge.currentItemChanged(r,i,"external"!==e.updatedFrom).catch((e=>{this.properties.currentItem=i,t.error(e)}))}}}})),define("css!vb/components/oj-vb-switcher/styles",[],(function(){})),define("vb/components/oj-vb-switcher/loader",["ojs/ojcomposite","text!./component.json","./switcherViewModel","ojs/ojmodule-element","css!./styles.css"],((e,t,i)=>{const r=JSON.parse(t);e.register("oj-vb-switcher",{view:'<oj-module config="[[moduleConfig]]" animation="[[$props.animation]]"></oj-module>',viewModel:i,metadata:r})})),define("vb/extensions/dynamic/private/constants",[],(()=>{const e={LayoutType:{COMPONENT:"component",CONTAINER:"container"}};return e})),define("vb/extensions/dynamic/private/helpers/baseHelper",["signals"],(e=>class{constructor(){this.propChanged=new e.Signal}notify(e,t){this.propChanged.dispatch(e,t)}addListener(e){this.propChanged.add(e)}dispose(){this.propChanged.removeAll()}})),define("vb/private/services/servicesManager",["vb/private/services/endpointReference","vb/private/stateManagement/router","vb/private/stateManagement/application"],((e,t,i)=>{class r{static getEndpoint(e,t,i){return r._findEndpoint(e,i).then((e=>e&&e.endpoint))}static getDefinitionInfo(e){return r.FindDefinition(e).then((e=>e?{serviceDef:e.serviceDef,configInfo:e.configInfo,requestInit:e.requestInit}:null))}static addServiceProvider(e){return i.getServices().addServiceProvider(e)}static _traverseServices(r,n){"string"==typeof r&&(r=new e(r));const s=t.getCurrentPage();return(s&&s.getAllServices()||i.getAllServices()).filter((e=>e.namespace===r.containerNamespace)).reduce(((e,t)=>e.then((e=>e||n(t,r)))),Promise.resolve())}static _findEndpoint(e,t){return this._traverseServices(e,((e,i)=>e.getEndpoint(i,t).then((e=>e&&{endpoint:e}))))}static findContainerServices(e){const t=new Set,i=(e,r)=>!t.has(e)&&(t.add(e),e.containsDeclaration(r).then((t=>t?e:e.searchDelegates((e=>i(e,r))))));return this._traverseServices(e,i)}static FindDefinition(e){return Promise.resolve().then((()=>{if(e.serviceId)return r.findContainerServices(e);throw new Error(`An EndpointReference with no service ID was used, trying to find a service: ${e}`)})).then((t=>t&&t.LoadService(e.serviceId,!1,e))).then((t=>Promise.all([t,t&&t.getDefinition(e)]))).then((([t,i])=>{if(t){const r=i,n=t&&t.requestInit;return{endpoint:t&&t.findEndpoint(e),service:t,serviceDef:r,requestInit:n}}return null}))}static disposeService(e){return Promise.resolve().then((()=>r.findContainerServices(e))).then((t=>{if(t)return t.disposeService(e),t;throw new Error(`unable to find service to dispose: ${e}`)}))}}return r})),define("vb/private/stateManagement/context/layoutBaseContext",["vb/private/stateManagement/context/baseContext"],(e=>class extends e{get layout(){return this}})),define("vb/private/stateManagement/context/layoutContext",["vb/private/constants","vb/private/stateManagement/context/containerContext","vb/private/stateManagement/context/layoutBaseContext","vb/private/utils"],((e,t,i,r)=>{const n=Symbol("layout-accessor");class s extends t{constructor(t){super(t),Object.defineProperty(this,n,{value:{get builtins(){return t.scope.variableNamespaces[e.VariableNamespace.BUILTIN]}}})}static get BaseContextType(){return i}static getAvailableContexts(t){const i=super.getAvailableContexts(t);return r.isHostApplication()||delete i.$global,delete i.$application,delete i.$metadata,Object.defineProperties(i,{$layout:{enumerable:!0,configurable:!0,get:()=>t.expressionContext},$extension:{enumerable:!0,configurable:!0,value:{get[e.PATH_VARIABLE](){return t.extension.getAbsoluteUrl()}}}}),i}get[e.INFO_CONTEXT](){return this[n].builtins[e.INFO_CONTEXT]}}return s})),define("vb/private/stateManagement/context/layoutExtensionContext",["vb/private/stateManagement/context/extensionContext","vb/private/stateManagement/context/layoutBaseContext"],((e,t)=>class extends e{static get BaseContextType(){return t}static getAvailableContexts(e){const t=super.getAvailableContexts(e);return delete t.$application,delete t.$metadata,Object.defineProperties(t,{$layout:{enumerable:!0,configurable:!0,get:()=>e.expressionContext}}),t}})),define("vb/private/stateManagement/layoutMixin",["vb/private/translations/bundlesModel"],(e=>t=>class extends t{loadTranslationBundles(){return this.loadBundlesPromise||(this.loadBundlesPromise=e.loadBundlesModel(this.application.runtimeEnvironment,this.definition,this.getResourceFolder(),{initParams:this.application.initParams,allowSelfRelative:!1},this.extension).then((e=>(this.bundles=e,this.bundles)))),this.loadBundlesPromise}})),define("vb/private/stateManagement/layoutExtension",["vb/helpers/mixin","vb/private/stateManagement/containerExtension","vb/private/stateManagement/context/layoutExtensionContext","vb/private/stateManagement/layoutMixin","vb/private/stateManagement/fragmentHolderExtensionMixin","vb/private/stateManagement/eventBehaviorMixin","vb/private/utils","vb/private/constants","vb/private/stateManagement/baseModuleViewModel"],((e,t,i,r,n,s,a,o,c)=>{class l extends(e(t).with(n,r,s)){constructor(e,t,i,r="LayoutExtension"){super(e,null,t,i,r)}static get extensionClass(){return l}get eventPrefix(){return"layout"}descriptorLoader(e){const t=`${e}-x.json`;return this.application.runtimeEnvironment.getExtensionTextResource(t).then((e=>a.parseJsonResource(e,t)))}functionsLoader(e){return super.functionsLoader(`${e}-x`)}templateLoader(e){return super.templateLoader(`${e}-x.html`)}getCapability(e){return e!==o.FragmentCapability.ALLOWS_SLOTS&&null}static get resourceSuffix(){return"-x.json"}static get functionsLoaderName(){return"getExtensionModuleResource"}static get templateLoaderName(){return"getExtensionTextResource"}getViewModel(){return Promise.all([this.load(),this.loadFunctionModule(),this.loadTemplate()]).then((()=>new c(this)))}static get ContextType(){return i}getScopeResolverMap(){const e={[o.LAYOUT_PREFIX]:this};return this.extensionId!==o.ExtensionNamespaces.BASE?Object.assign(e,{[o.GLOBAL_PREFIX]:this.application}):Object.assign(e,{[o.APPLICATION_PREFIX]:this.application}),e}dispose(){this.disposeFragments(),super.dispose()}getLeafContainer(){return this.base}}return l})),define("vb/private/stateManagement/layout",["vb/private/stateManagement/container","vb/private/stateManagement/context/layoutContext","vb/private/stateManagement/layoutExtension","vb/private/stateManagement/layoutMixin","vb/private/utils","vb/private/constants","vb/errors/httpError","vb/helpers/mixin","vb/private/stateManagement/fragmentHolderBaseMixin","vb/private/stateManagement/eventBehaviorMixin","vb/private/stateManagement/fragment","vb/private/stateManagement/packageFragment","vb/private/stateManagement/baseModuleViewModel"],((e,t,i,r,n,s,a,o,c,l,h,p,u)=>{class d extends(o(e).with(r,c,l)){constructor(e,t,i,r,n="Layout"){super(e,t,n),t&&t.registerLayout(this),this._extension=i||this.extension,Object.defineProperties(this,{path:{value:d.calculatePath(r,this.extension.baseUrl),enumerable:!0}})}get name(){return"layout"}defineInfoBuiltinVariable(){return{id:this.id}}allowsDynamicComponentEventBehavior(e){return e===s.EventBehaviors.DYNAMIC_COMP}static get extensionClass(){return i}getCapability(e){return e!==s.FragmentCapability.ALLOWS_SLOTS&&null}getFragmentClass(){return Promise.resolve().then((()=>this.extensionId!==s.ExtensionNamespaces.BASE?p:h))}static calculatePath(e,t){return e&&t&&e.startsWith(t)?e.substring(t.length):e}static isFileNotFoundError(e){return e instanceof a&&e.isFileNotFound()}descriptorLoader(e){return Promise.resolve().then((()=>{this.extension.fileExists(`${this.resourceLoc}${this.name}.json`);const t=`${e}.json`;return this.application.runtimeEnvironment.getTextResource(t).then((e=>n.parseJsonResource(e,t)))})).catch((e=>{if(d.isFileNotFoundError(e))return{layouts:{}};throw e}))}dispose(){Object.keys(this.fragments).forEach((e=>{this.fragments[e].dispose()})),super.dispose()}functionsLoader(e){return Promise.resolve().then((()=>(this.extension.fileExists(`${this.resourceLoc}${this.name}.js`),super.functionsLoader(e)))).catch((e=>{if(d.isFileNotFoundError(e))return{};throw e}))}templateLoader(e){return Promise.resolve().then((()=>(this.extension.fileExists(`${this.resourceLoc}${this.name}.html`),super.templateLoader(`${e}.html`)))).catch((e=>{if(d.isFileNotFoundError(e))return"";throw e}))}loadTemplate(){return super.loadTemplate().catch((e=>(e.requireType&&"scripterror"===e.requireType||this.log.error("Error loading module",this.getResourcePath(),e),Promise.resolve())))}static get functionsLoaderName(){return"getModuleResource"}static get templateLoaderName(){return"getTextResource"}static get ContextType(){return t}initDefault(e){const t=e;return t.types&&!t.layoutTypes&&delete t.types,super.initDefault(t)}load(){return this.loadPromise=this.loadPromise||this.loadMetadata().then((()=>Promise.all([this.loadExtensions(),this.loadImports(),this.loadTranslationBundles()]))).then((()=>(this.combineExtensions(),this.initializeEvents(),this.initializeActionChains(),this.initAllVariableNamespace()))),this.loadPromise}getViewModel(){return Promise.all([this.load(),this.loadFunctionModule(),this.loadTemplate()]).then((()=>new u(this)))}getLeafContainer(){return this}getScopeResolverMap(){const e={[s.LAYOUT_PREFIX]:this};return this.extensionId!==s.ExtensionNamespaces.BASE?Object.assign(e,{[s.GLOBAL_PREFIX]:this.application}):Object.assign(e,{[s.APPLICATION_PREFIX]:this.application}),e}getCallingContext(){const e=this.parent&&this.parent.getCallingContext();return e&&e.sourceExtension?{sourceExtension:e.sourceExtension}:super.getCallingContext()}getNewScopeName(){return`${this.className}/${this.extensionId}/${this.fullPath}`}}return d})),define("vb/extensions/dynamic/private/models/emptyContextModel",["vb/private/stateManagement/context/extensionContext"],(e=>{const t={variables:{},metadata:{},constants:{},chains:{},functions:{},listeners:{},translations:{}};return new class{getViewModel(){return e.getAvailableContexts({scope:{},bundles:{},application:{expressionContext:t},expressionContext:Object.assign({base:t,extension:t},t),base:{application:{expressionContext:t},expressionContext:t}})}}})),define("vb/extensions/dynamic/private/helpers/metadataHelperFactory",["vb/private/utils"],(e=>class{static createHelper(t,i){const r={},n=t;return Promise.resolve().then((()=>{if(!t)throw new Error("Invalid options argument to MetadataHelperFactory.createHelper");if(n.endpoint)return e.getResource("vb/extensions/dynamic/private/helpers/serviceMetadataProviderHelper");if(n.path)return e.getResource("vb/extensions/dynamic/private/helpers/dataDescriptionMetadataProviderHelper");if(n.ref)return e.getResource("vb/extensions/dynamic/private/helpers/referenceMetadataProviderHelper");throw new Error(`MetadataHelperFactory was unable to create helper: ${JSON.stringify(t)}`)})).then((e=>{if(e)return e.get(n,r,i);throw new Error("MetadataHelperFactory is unable to find the ServiceMetadataProviderHelper class")}))}})),define("vb/extensions/dynamic/private/helpers/configurableMetadataProviderHelper",["vb/private/constants","vb/private/utils","vb/private/log","vb/private/monitoring/loadMonitorOptions","vb/private/services/servicesManager","vb/private/services/readers/openApiObjectFactory","vb/private/stateManagement/container","vb/private/stateManagement/application","vb/private/model/modelUtils","vb/private/ui/responsiveUtils","vb/private/configLoader","vb/private/stateManagement/layout","vb/extensions/dynamic/private/helpers/baseHelper","vb/extensions/dynamic/private/models/emptyContextModel","vb/extensions/dynamic/private/helpers/metadataHelperFactory","vb/extensions/dynamic/private/constants","vb/private/monitoring/loadMonitorOptions"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v)=>{const f=i.getLogger("/vb/extensions/dynamic/private/helpers/configurableMetadataProviderHelper",[{name:"greenInfo",severity:"info",style:"green"}]),m=[{property:"data",baseFile:"field-templates-overlay.json",extensionFile:"field-templates-x.json",prefix:"text!",modelClass:"vb/extensions/dynamic/private/models/layoutOverlayModel",extensionModelClass:"vb/extensions/dynamic/private/models/layoutOverlayExtensionModel",optional:!0},{property:"template",baseFile:"field-templates-overlay.html",extensionFile:"field-templates-x.html",prefix:"text!",optional:!0}];function b(e){return`${e}Model`}function y(e,t){if("PageExtension"!==t.className){const t=e;delete t.$application,delete t.$global}return e}class E extends u{static get(e,t,i){return new E(e,t,i).init()}constructor(e,i,r){super(),this.id=e.id||"",this.options=e,this.options.root&&t.isHostApplication()&&(f.warn("Ignoring root option",this.options.root,"which is not supported for V2 extension applications"),delete this.options.root),this.context=i,this.container=r,this.layoutType=e.layoutType||v,this.descriptors=e.helper&&e.helper.descriptors||{},this.descriptors.files=this.descriptors.files||[],this.descriptors.layout=this.descriptors.files.find((e=>"data"===e.property))||{},this.urlMapperDisabled=E.getMapperDisabled(),this.globalDescriptors=E.getGlobalConfiguration(),this.vbContext=this.container&&"string"==typeof this.container.extensionId?Object.freeze({extensionId:this.container.extensionId}):void 0}static getGlobalConfiguration(){return m.map((e=>Object.assign({},e)))}init(){return this.getExtension().then((()=>t.getRuntimeEnvironment())).then((e=>{Object.defineProperties(this,{textResourceLoader:{value:t=>e.getTextResource(t)},moduleResourceLoader:{value:t=>e.getModuleResource(t)},extnTextResourceLoader:{value:t=>e.getExtensionTextResource(t)},extnModuleResourceLoader:{value:t=>e.getExtensionModuleResource(t)}});return[...this.descriptors.files,...this.globalDescriptors].forEach((e=>{const t=e;"text!"===e.prefix?(t.loader=this.textResourceLoader,t.extnLoader=this.extnTextResourceLoader):(t.loader=this.moduleResourceLoader,t.extnLoader=this.extnModuleResourceLoader,t.removeExtRelative=!0),"layout.json"===t.baseFile&&this.container&&(t.modelClass=this.container.layoutModelClass||t.modelClass)})),this}))}getExtension(){return Promise.resolve().then((()=>{if(this.extensionId===e.ExtensionFolders.BASE)this.extension=a.createEmptyExtension();else{if(this.extensionId){const e=o.extensionRegistry.getExtensionById(this.extensionId);return e?(this.extension=e,e.init()):void 0}this.extension=this.container&&this.container.extension}}))}setLayoutRoot(e){return this.layoutRootPrefix=t.addTrailingSlash(e),this}getLayoutRoot(){if(!this.layoutRootPrefix){const t=h.configurationDeclaration&&h.configurationDeclaration.dynamicLayouts;let i=t&&t.path||this.options.helper&&this.options.helper.root||this.options.root;i||(i=this.extension&&this.extension.id!==e.ExtensionFolders.BASE?`${e.DefaultPaths.LAYOUTS}${e.ExtensionFolders.SELF}/`:e.DefaultPaths.LAYOUTS),this.setLayoutRoot(i)}return this.layoutRootPrefix}static getMapperDisabled(){const e=(window.vbInitConfig||{}).SERVICE_WORKER_CONFIG||{};return e&&e.urlMapping&&e.urlMapping.disabled}getLayoutParts(){let e;const t=[];return this._getLayoutPath().then((t=>{if(e=t,!t)throw new Error("No path for dynamic UI resources.",this.id);return this._loadResource(e,this.descriptors.layout).then((e=>E.transformLayoutModel(e)))})).then((i=>(t.push({name:"main",data:i.contents}),this._loadLayoutExtensions(e,this.descriptors.files)))).then((e=>(t.push(...e),t))).catch((e=>(f.error("returning empty layouts",e),[])))}getLayoutResources(){const e=this.descriptors.files||[];return this._getLayoutPath().then((t=>this._getResources(t,e)))}_getResources(e,t){const i=[];let r;return Promise.resolve().then((()=>{if(!e)throw new Error("No path for dynamic UI resources.",this.id);return this.loadResources(e,t)})).then((n=>{const s=n.resourceMap;return r=n.modelMap,i.push(s),this._loadLayoutExtensions(e,t)})).then((e=>{const i=e.map((e=>this._initializeModules(t,e)));return Promise.all(i)})).then((e=>this._createExtensionModels(t,r,e))).then((e=>{const t=e.map((e=>(delete e._extInfo,e)));return i.push(...t),f.isInfo&&f.info("Metadata provider resources",this.id,JSON.stringify(i.map((e=>({name:e.name,keys:Object.keys(e)}))))),i})).catch((e=>(f.error("returning empty layouts",e),[])))}_createExtensionModels(i,r,n){return Promise.resolve().then((()=>{const s=[];return n.length&&i.forEach((i=>{const o=n.map((n=>Promise.resolve().then((()=>{const s=n,o=r[i.property];let c;if(o instanceof a&&o.extensions&&Object.keys(o.extensions).length>0){const e=o.extensions[s.name]?o.extensions[s.name]:d;c=Promise.resolve(e)}else if(i.extensionModelClass&&s[i.property]){const e=s[i.property],r=t.removeFileName(s._extInfo.paths[i.property]),n={text:this.extnTextResourceLoader,module:this.extnModuleResourceLoader};c=this.loadModelClass(i.property,i.extensionModelClass,e||{},r,i.baseFile,n,s.name)}return c?c.then((t=>{if(t){const r=b(i.property);return o&&t&&t.addChildModel&&t.addChildModel(e.ExtensionNamespaces.BASE,o),Promise.resolve(t.getViewModel()).then((e=>{s[r]=y(e,t)}))}return s})):n}))));s.push(Promise.all(o))})),Promise.all(s).then((()=>n))}))}static transformLayoutModel(e){try{const t=JSON.parse(e);return delete t.layoutModelVersion,delete t.constants,delete t.variables,delete t.interface,delete t.chains,delete t.eventListeners,delete t.events,delete t.imports,delete t.translations,delete t.types,JSON.stringify(t)}catch(t){return e}}getLayoutModel(){return this._loadLayout().then((e=>e.getViewModel())).catch((e=>(f.error("Returning empty model",e),{})))}getMetadata(){return this._loadMetadata().then((e=>{const t={data:e.contents};return e.model&&(t[b("data")]=e.model.getViewModel()),t}))}getGlobalResources(){return this._loadGlobals()}fetch(){return this._loadMetadata().then((e=>new Response(e.contents)))}_loadMetadata(){return Promise.resolve().then((()=>{if(!this.descriptors.metadata)throw new Error("vbHelper._loadMetadata called when no metadata is defined");return this._getLayoutPath().then((e=>this._loadResource(e,this.descriptors.metadata)))}))}_loadGlobals(){return this._getResources(this.getLayoutRoot(),this.globalDescriptors)}getPossibleValues(e){return Promise.resolve().then((()=>{const t=(e||"").split(".");if("$context"!==t[0])return null;if(t.shift(),t.length>0&&t[0]){const e=this.context&&this.context[t[0]];switch(t[0]){case"user":if(t[1]&&e&&t[1]in e){const i=e&&e[t[1]]||[];return Array.isArray(i)?i:[i]}return null;case"responsive":return t[1]&&e&&t[1]in e?[!0,!1]:null;default:return null}}return null}))}_getLayoutPath(){return this._pathPromise||(this._pathPromise=this._calcLayoutPath().then((e=>(this.notify("path",e),this.notify("baseUrl",this.extension&&this.extension.baseUrl||""),e)))),this._pathPromise}_calcLayoutPath(){return Promise.resolve(this.getLayoutRoot())}_loadLayout(){return this.loadLayoutPromise=this.loadLayoutPromise||this._getLayoutPath().then((e=>{let i=this.descriptors.layout.baseContainer;return i||t.getResource(this.container.layoutModelClass).then((t=>{const r=this._buildAbsolutePath(e);return i=new t(`${this.id}_deprecated`,this.container,void 0,r),this.layout=i,i}))})),this.loadLayoutPromise}loadResources(t,i){return Promise.resolve().then((()=>{const e=i.map((e=>this._loadResource(t,e)));return Promise.all(e)})).then((t=>{const r={name:"PageExtension"===this.container.className&&this.layoutType===v.LayoutType.CONTAINER?this.container.extensionId:"main"},n={},s=[];return t.forEach(((t,o)=>{if(t){const c=i[o];r[c.property]=t.contents,t.model&&(s.push(Promise.resolve(t.model.getViewModel()).then((i=>{r[b(c.property)]=i,t.model instanceof a&&"Layout"===t.model.className&&t.model.invokeEvent(e.ENTER_EVENT)}))),n[c.property]=t.model)}})),Promise.all(s).then((()=>({resourceMap:r,modelMap:n})))}))}_buildAbsolutePath(e){if(this.options.root)return e;let t,i=e;return t=this.extension?this.extension.baseUrl:this.container&&this.container.baseUrl||"",t&&0!==i.indexOf(t)&&(i=`${t}${i}`),i}_loadResource(e,i){let n;return Promise.resolve().then((()=>{if(i.baseContainer)return Promise.resolve(i.baseContainer.definition);if(i.baseFile){let n=i.baseFile;const s=`${e}${n}`;if(this.extension)try{this.extension.fileExists(s)}catch(e){if(i.defaultResource)return i.defaultResource;if(i.optional)return void f.info("No",i.property,"for",n,"skipping.");throw e}i.removeExtRelative&&(n=t.removeFileExtension(n));const a=`${this._buildAbsolutePath(e)}${n}`;let o="text!"===i.prefix?this.textResourceLoader(a,i.defaultResource):this.moduleResourceLoader(a);i.baseFile===this.descriptors.layout.baseFile?o=o.then((e=>E.transformLayoutModel(e))):i.isModule&&(o=o.then((e=>E._initializeModule(e))));const c=new r(r.SPAN_NAMES.LOAD_LAYOUT,a,this);return f.monitor(c,(t=>o.then((e=>(f.greenInfo(a,"loaded.",t()),e))).catch((r=>{if(t(r),!i.optional)throw r;f.info("No",i.property,"for",e,"skipping.",r)}))))}return null})).then((t=>{if(n=t,i.baseContainer)return i.baseContainer;const r={text:this.textResourceLoader,module:this.moduleResourceLoader},s=this._buildAbsolutePath(e);return this.loadModelClass(i.property,i.modelClass,n,s,i.baseFile,r)})).then((e=>({contents:n,model:e})))}_loadLayoutExtensions(e,i){return Promise.resolve().then((()=>{if(!e)throw new Error("unexpected empty path");const r=t.removeFileExtension(e),n=[],s=[];i.forEach((e=>{e.extensionContainers?Object.keys(e.extensionContainers).forEach((t=>{const i=e.extensionContainers[t],r=Promise.resolve(i.container.getAvailableContexts()).then((e=>y(e,i.container))),s=[i.container.loadDescriptor(),r],a=Promise.all(s).then((([e,r])=>({name:t,contents:e,model:r,property:i.property})));n.push(a)})):s.push(e)}));const a=this.extension?this.extension.id:"base",c=o.extensionRegistry.loadLayoutExtensions(r,s,{extensionId:a});return Promise.all([Promise.all(n),c]).then((e=>{const t=e[0],i=e[1];return t.forEach((e=>{let t=i.find((t=>t.name===e.name));t||(t={name:e.name},i.push(t)),t[e.property]=e.contents,e.model&&(t[b(e.property)]=e.model)})),i}))}))}_initializeModules(e,t){const i=[],r=Object.assign({},t);return e.filter((e=>e.isModule)).forEach((e=>{if(r[e.property]){const t=r[e.property],n=E._initializeModule(t).then((t=>{r[e.property]=t}));i.push(n)}})),Promise.all(i).then((()=>r))}static _initializeModule(e){return Promise.resolve().then((()=>c.initializeJsModule(e)))}loadModelClass(e,i,r,n,s,o=!1,c){return Promise.resolve().then((()=>i?t.getResource(i).then((t=>{if(t&&r)try{if(t.prototype instanceof a)return new t(this.id,this.container,this.extension,n);return new t(JSON.parse(r),n,s,o,c||this.vbContext&&this.vbContext.extensionId).init().catch((e=>(f.warn("Unable to initialize descriptor model class, continuing",i,e),null)))}catch(t){f.warn("Unable to parse dynamic UI resource for model, continuing",e,t)}return null})):null)).catch((t=>(f.warn("Unable to create model, continuing",e,t),null)))}getHelper(e){return g.createHelper(e,this.container)}dispose(){super.dispose(),this.layout&&this.layout.dispose()}}return E})),define("vb/extensions/dynamic/private/helpers/dataDescriptionMetadataProviderHelper",["vb/private/constants","vb/private/utils","vb/private/log","vb/private/services/servicesManager","vb/private/services/readers/openApiObjectFactory","vb/private/stateManagement/application","vb/private/stateManagement/router","vb/private/model/modelUtils","vb/private/ui/responsiveUtils","vb/private/configLoader","vb/private/stateManagement/layout","vb/private/stateManagement/context/layoutContext","vb/private/stateManagement/context/layoutBaseContext","vb/extensions/dynamic/private/helpers/configurableMetadataProviderHelper"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d)=>{const g="data-description",v="data-description-x.json",f="vb/extensions/dynamic/private/models/dataDescriptionModel",m="vb/extensions/dynamic/private/models/dataDescriptionExtensionModel",b=[{property:"data",baseFile:"layout.json",extensionFile:"layout-x.json",prefix:"text!",modelClass:"vb/private/stateManagement/layout",defaultResource:{layouts:{}}},{property:"source",baseFile:"layout.js",extensionFile:"layout-x.js",isModule:!0,removeExtRelative:!0,optional:!0},{property:"template",baseFile:"layout.html",extensionFile:"layout-x.html",prefix:"text!",optional:!0},{property:"clientMetadata",baseFile:null,extensionFile:v,prefix:"text!",optional:!0,modelClass:null,extensionModelClass:m}];class y extends d{static get(e,t,i){const r=y.getHelperConfiguration(),n=Object.assign({},e,{helper:r});return new y(n,t,i).init()}constructor(e,t,i){super(e,t,i),e.path&&this.setLayoutRoot(e.path)}getMetadata(){let e;return super.getMetadata().then((t=>(e=t,this.getLayoutModel()))).then((t=>(e.dataModel&&t&&t.$layout instanceof p&&(e.dataModel=o.chooseCorrectFunctionsModel(e.dataModel,t,"data-description.js")),e)))}static getHelperConfiguration(){return{descriptors:{files:t.cloneObject(b),metadata:{baseFile:"data-description.json",prefix:"text!",modelClass:f}}}}}return y.RESOURCE_DESCRIPTORS=b,y.METADATA_NAME_ROOT=g,y.METADATA_OVERLAY_EXT_NAME=v,y.BASE_MODEL=f,y.EXTENSION_MODEL=m,y})),define("vb/extensions/dynamic/private/helpers/referenceMetadataProviderHelper",["vb/extensions/dynamic/private/helpers/dataDescriptionMetadataProviderHelper"],(e=>{class t extends e{static get(i,r,n){const s=e.getHelperConfiguration(),a=Object.assign({},i,{helper:s});return new t(a,r,n).init()}constructor(e,t,i){super(e,t,i),this.extensionId=e.ref.extensionId||i.extensionId}_calcLayoutPath(){return Promise.resolve(`${this.getLayoutRoot()}${this.options.ref.businessObject}/`)}}return t})),define("vb/extensions/dynamic/private/helpers/serviceMetadataProviderHelper",["vb/helpers/rest","vb/private/utils","vb/private/log","vb/private/services/endpointReference","vb/private/services/servicesManager","vb/private/services/readers/openApiObjectFactory","vb/private/model/modelUtils","vb/private/stateManagement/context/layoutContext","vb/private/stateManagement/context/layoutBaseContext","vb/extensions/dynamic/private/helpers/dataDescriptionMetadataProviderHelper"],((e,t,i,r,n,s,a,o,c,l)=>{const h=i.getLogger("/vb/extensions/dynamic/private/helpers/serviceMetadataProviderHelper"),p="layout.json",u=`${l.METADATA_NAME_ROOT}-overlay.json`,d=l.METADATA_OVERLAY_EXT_NAME,g="indirect";class v extends l{static get(e,t,i){const r=e.endpoint,n=v.getHelperConfiguration();delete n.descriptors.metadata;const s=Object.assign({endpointId:r},e,{helper:n});return new v(s,t,i).init()}static getHelperConfiguration(){const e=l.getHelperConfiguration();return e.descriptors.files=e.descriptors.files.filter((e=>"clientMetadata"!==e.property)),e.descriptors.files.push({property:"clientMetadata",baseFile:u,extensionFile:d,prefix:"text!",optional:!0,modelClass:l.BASE_MODEL,extensionModelClass:l.EXTENSION_MODEL}),e}constructor(e,t,i){super(e,t,i),this.endpointId=e.endpointId||"",this.endpointReference=new r(e.endpointId,i);const{namespace:n}=this.endpointReference;n&&(this.extensionId=n,this.vbContext="string"==typeof this.extensionId?Object.freeze({extensionId:this.extensionId}):void 0)}toUrl(){return Promise.resolve().then((()=>`${this.extension.id}/${this.container.fullPath}/${this.id}`))}mode(e){return this._mode=e,e===g&&h.warn('Metadata variable is using deprecated "indirect" mode. This will be removed in the next release'),this}fetch(){return this._fetchPromise||(this._mode===g?this._fetchPromise=super.fetch():this._fetchPromise=this._fetchDirect()),this._fetchPromise.catch((e=>{throw h.error("error during metadata provider helper fetch",e),e}))}getMetadata(){return this.fetch().then((e=>({data:e})))}getLayoutResources(){return super.getLayoutResources().then((e=>(e.forEach((e=>{e.clientMetadataModel&&e.dataModel&&(e.dataModel.$layout instanceof o||e.dataModel.$base instanceof c)&&(e.clientMetadataModel=a.chooseCorrectFunctionsModel(e.clientMetadataModel,e.dataModel,"data-description-overlay.js"))})),e)))}_fetchServiceInfo(){return this._fetchServiceInfoPromise||(this._fetchServiceInfoPromise=n.getDefinitionInfo(this.endpointReference)),this._fetchServiceInfoPromise}_fetchDirect(){return this._fetchServiceInfo().then((e=>{if(e&&e.serviceDef){const t=JSON.stringify(e.serviceDef);return new Response(t)}throw new Error(`unable to load service definition: ${this.endpointReference.serviceId}`)}))}setLayoutPath(e){return this.layoutPathOverride=e,this}_calcLayoutPath(){if(!this._layoutPrefixPromise)if(this.layoutPathOverride){let e=this.layoutPathOverride;e.endsWith(p)&&(e=e.substring(0,e.length-p.length)),this._layoutPrefixPromise=Promise.resolve(e)}else this.endpointReference.operationId?this._layoutPrefixPromise=this.fetch().then((e=>{if(e.ok)return e.clone().json();throw new Error(`unable to get layout prefix for ${this.endpointId}`)})).then((e=>{let t=null;return s.get(e).pathObjects.some((e=>(e.operationObjects.find((e=>e.operationId===this.endpointReference.operationId))&&(t=this.normalizePath(e.path)),t))),t||h.error("unable to find operationId for layout prefix:",this.operationId),t})):(h.warn("no operationId, using empty path"),this._layoutPrefixPromise=Promise.resolve(this.normalizePath("")));return this._layoutPrefixPromise}loadExternalServiceMetadata(e){if(h.warn("ServiceMetadataProviderHelper.loadExternalServiceMetadata is DEPRECATED! ","It will be removed in a future release."),this.urlMapperDisabled){let i;return Promise.resolve().then((()=>{if(!e)throw new Error("invalid URL passed to loadExternalServiceMetadata.");return this._fetchServiceInfo()})).then((e=>(i=e.requestInit,t.getRuntimeEnvironment()))).then((t=>t.getServiceDefinition(e,i))).catch((t=>{throw h.error("failed to load serviceDefinition for metadata url",e,t),t}))}return fetch(e).then((t=>{if(t.ok)return t.json();throw h.error("failed to load serviceDefinition for metadata url",e,t.status),Error(`unable to load service metadata: status: ${t.status}`)}))}normalizePath(e=""){const i=e.split("/").filter((e=>e&&"{"!==e[0])).join("/"),r=t.addTrailingSlash(i);return`${this.getLayoutRoot()}${r}`}}return v})),define("vb/extensions/dynamic/private/models/abstractModel",["vb/private/constants","vb/private/utils","vb/private/log","vb/private/model/modelUtils"],((e,t,i,r)=>{const n=i.getLogger("/vb/extensions/dynamic/private/models/abstractModel");return(e,i)=>class extends e{constructor(e,r,n,s,a){super(e,r,n,a),this.moduleLoader=s.module,this.jsFileName=t.removeFileExtension(i||n)}init(){return this.loadPromise||(this.loadPromise=Promise.all([this.load(),super.load()]).then((([e])=>(this.jsModule=r.initializeJsModule(e),this)))),this.loadPromise}getContext(){return this.context||(this.context=super.getContext(),Object.defineProperty(this.context,"functions",{get:()=>this.jsModule,enumerable:!0,configurable:!1})),this.context}load(){const e=`${this.folder}${this.jsFileName}`;return this.moduleLoader(e).catch((e=>(n.warn("Unable to load JS module, ignoring.",this.jsFileName,e),null)))}}})),define("vb/extensions/dynamic/private/models/emptyModel",["vb/private/utils"],(e=>class{constructor(t,i,r){this.folder=i||"",this.namespace=e.hyphenatedToCamelCase(r||""),this.models=[]}init(){return Promise.resolve(this)}addChildModel(e,t){this.models.push({namespace:e,model:t})}getContext(){return this.context||(this.context={}),this.context}load(){return Promise.resolve()}getViewModel(){if(!this.expressionContext){this.expressionContext={},this.getContext(),Object.keys(this.context).forEach((e=>{Object.defineProperty(this.expressionContext,`$${e}`,{get:()=>this.context[e],enumerable:!0})}));const e=Object.assign({},this.context);this.namespace&&Object.defineProperty(this.expressionContext,`$${this.namespace}`,{get:()=>e,enumerable:!0}),this.models.length&&this.models.forEach((t=>{const i={[t.model.namespace]:t.model.getContext()};Object.defineProperty(this.expressionContext,`$${t.namespace}`,{get:()=>i,enumerable:!0}),this.namespace&&Object.defineProperty(e,t.namespace,{get:()=>i,enumerable:!0})}))}return this.expressionContext}})),define("vb/extensions/dynamic/private/models/translationsModel",["vb/private/translations/bundlesModel","vb/private/translations/translationContext","vb/private/constants","vb/private/configLoader","vb/private/utils","vb/extensions/dynamic/private/models/emptyModel"],((e,t,i,r,n,s)=>class extends s{constructor(e,t,i,r){super(e,t,i),this.definition=e,this.extensionId=r}init(){return this.loadPromise||(this.loadPromise=this.load()),this.loadPromise}getContext(){if(!this.context){const e=this.bundles;let r;this.context={get[i.TRANSLATIONS_CONTEXT](){return r||(r=t.createContext(e)),r}}}return this.context}load(){let t=null;return this.extensionId&&(t=e.getExtensions().then((e=>e[this.extensionId]))),Promise.resolve(t).then((t=>n.getRuntimeEnvironment().then((i=>e.loadBundlesModel(i,this.definition,this.folder,{initParams:r.initParams,allowSelfRelative:!1},t))).then((e=>(this.bundles=e,this)))))}})),define("vb/extensions/dynamic/private/models/dataDescriptionExtensionModel",["vb/extensions/dynamic/private/models/abstractModel","vb/extensions/dynamic/private/models/translationsModel"],((e,t)=>e(t,"data-description-x.js"))),define("vb/extensions/dynamic/private/models/dataDescriptionModel",["vb/extensions/dynamic/private/models/abstractModel","vb/extensions/dynamic/private/models/translationsModel"],((e,t)=>e(t))),define("vb/extensions/dynamic/private/models/layoutOverlayExtensionModel",["vb/extensions/dynamic/private/models/abstractModel","vb/extensions/dynamic/private/models/emptyModel"],((e,t)=>e(t,"field-templates-x.js"))),define("vb/extensions/dynamic/private/models/layoutOverlayModel",["vb/extensions/dynamic/private/models/abstractModel","vb/extensions/dynamic/private/models/emptyModel"],((e,t)=>e(t))),define("vb/types/typeUtils",["vb/private/stateManagement/stateUtils"],(e=>class{static setPropertyValue(e,t,i){let r=e;const n=i;if("string"==typeof t){const e=t.split(".");e.forEach(((t,i)=>{i+1===e.length?r[t]=n:(r[t]||(r[t]={}),r=r[t])}))}else r[t]=i}static getPropertyValue(e,t){let i,r=e;if("string"==typeof t){const e=t.split(".");return e&&e.some(((t,n)=>n+1===e.length?(i=r?r[t]:void 0,!0):!r||!r[t]||(r=r[t],!1))),i}return e[t]}static getType(t,i,r){return e.getType(t,i,r)}})),define("vb/types/extendedType",["vb/private/log","vb/private/constants","vb/types/typeUtils"],((e,t,i)=>{const r=e.getLogger("/vb/types/ServiceDataProvider.FetchContext",void 0);return class{getTypeDefinition(e,t){return null}hoistValueObjectProperties(){return!0}init(e,t,i,r){this.setId(e)}activate(){}dispose(){}getId(){return this.id}setId(e){this.id=e}getValue(){return this.value}setValue(e){this.value=e}getInternalState(e){return e?i.getPropertyValue(this.internalState,e):this.internalState}setInternalState(e,t){if(e){const r=Object.assign({},this.internalState);i.setPropertyValue(r,e,t),this.internalState=r}else r.error("unable to set internal state property",e,"to",t)}handlePropertyVariableChangeEvent(e){}isExtendedType(){return!0}getWritableOptions(){return{propertiesWritable:t.VariableWritablePropertyOptions.ALL}}getType(e,t=this.constructor.name){const{handler:i}=this;return i.getType(e,t)}invokeEvent(e,t){const{handler:i}=this;return i.invokeEvent(e,t)}}})),define("vb/private/types/builtinExtendedTypeMixin",["vb/types/extendedType","vb/private/stateManagement/stateUtils"],((e,t)=>{class i{callActionChain(e,t={},i){return this.handler.callActionChain(e,t,i)}isBuiltinType(){return!0}setupVariableProperties(e,t,i,r){Object.keys(e).forEach((e=>{Object.defineProperty(this,e,this.getVariablePropertyDefinition(e,t,i,r))}))}getVariablePropertyDefinition(e,i,r,n){return t.getVariablePropertyDefinition(this,e,i,r,n)}}return t=>{class r extends t{}return((e,...t)=>{const i=e;t.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((t=>{i.prototype[t]||(i.prototype[t]=e.prototype[t])}))}))})(r,i,e),r}})),define("vb/private/types/metadataDescriptor",["vb/private/log","vb/private/constants","vb/private/utils","vb/binding/expression","vb/helpers/mixin","vb/private/types/builtinExtendedTypeMixin"],((e,t,i,r,n,s)=>{class a extends(n().with(s)){constructor(){super(),this.log=e.getLogger("/vb/types/metadataDescriptor")}init(e,t,i,r){return Promise.resolve().then((()=>{super.init(e,t,i,r),this.container=r}))}getTypeDefinition(){return{type:"object"}}dispose(){}}return a})),define("vb/private/types/factoryMetadataProviderDescriptor",["knockout","vb/private/constants","vb/private/utils","vb/private/types/metadataDescriptor"],((e,t,i,r)=>class extends r{constructor(){super(),this._providerObservable=e.observable()}get provider(){return this._providerObservable()}activate(){return Promise.resolve().then((()=>{const e=this.getValue();return e.options.id=this.id,this.createProvider(e)})).then((()=>super.activate()))}createProvider(e){return e?this.getProviderFactory(e).then((t=>{const i={context:this.getVbContext(),container:this.container};return Object.assign(i,e.options),t.createMetadataProvider(i)})).then((t=>(this._providerObservable(t),e))):Promise.reject(new Error("No definition for MetadataDescriptor."))}getVbContext(){const e=this.container.application.expressionContext||{},t=()=>({});Object.keys(e.responsive).filter((e=>"screenRange"!==e)).forEach((i=>{Object.defineProperty(t,i,{get:()=>e.responsive[i],enumerable:!0})}));const i={};return Object.defineProperties(i,{user:{value:e.user,enumerable:!0},responsive:{value:t,enumerable:!0}}),i}getTypeDefinition(){return{type:{factory:"string",options:"object"}}}getProviderFactory(e){return Promise.resolve().then((()=>{if(!e||!e.factory)throw new Error('MetadataDescriptor requires a "factory" for configuration.');return i.getResource(e.factory).then((e=>new e))}))}})),define("vb/extensions/dynamic/private/types/abstractMetadataProviderDescriptor",["vb/private/types/metadataDescriptor","vb/private/types/factoryMetadataProviderDescriptor","vb/private/utils"],((e,t,i)=>class extends t{activate(){return Promise.resolve().then((()=>{const e={options:this.createOptions(this.getValue())};return this.setValue(e),this.getFactoryBridge(),super.activate()}))}createOptions(e){return e?i.cloneObject(e):{}}getFactoryBridge(){return this.bridge||(this.bridge=this.createFactoryBridge()),this.bridge}createFactoryBridge(){throw new Error("do not use directly, createFactoryBridge() must be implemented")}getTypeDefinition(){throw new Error("do not use directly, getTypeDefinition() must be implemented")}getProviderFactory(e){return Promise.resolve(this.getFactoryBridge())}createMetadataProvider(e){return this.getFactoryBridge().createMetadataProvider(e)}dispose(){super.dispose(),this.bridge&&this.bridge.dispose()}})),define("vb/extensions/dynamic/private/types/bridges/metadataProviderFactoryBridge",["vb/private/utils"],(e=>class{createMetadataProvider(t){let i;return this.delegatePromise||(this.delegatePromise=e.getResource(this.getDelegatePath(t)).then((e=>new e))),this.delegatePromise.then((e=>{i=e})).then((()=>this.translateOptions(t))).then((e=>{const t=Object.assign({},e);return delete t.container,delete t.helper,delete t.layoutConfig,i.createMetadataProvider(t)}))}getDelegatePath(){throw new Error("MetadataProviderFactoryBridge: getDelegatePath() must be overridden by subclasses.")}translateOptions(e){return Promise.resolve(Object.assign({},e))}dispose(){}})),define("vb/extensions/dynamic/private/types/bridges/helperMetadataProviderFactoryBridge",["vb/extensions/dynamic/private/types/bridges/metadataProviderFactoryBridge","vb/private/utils"],((e,t)=>class extends e{constructor(){super(),this.propertyQueue=[]}translateOptions(e){let i;return t.getRuntimeEnvironment().then((t=>(this.runtimeEnv=t,super.translateOptions(e)))).then((e=>(i=e,this.getHelper(i)))).then((e=>(this.helper=e,i.vbHelper=e,e.addListener(((e,t)=>{this.provider?this.runtimeEnv.annotate(this.provider,e,t):this.propertyQueue.push({name:e,value:t})})),i)))}getDelegatePath(e){return e&&e.factory?e.factory:"oj-dynamic/providers/JsonMetadataProviderFactory"}getHelper(e){return Promise.resolve().then((()=>e&&e.helper&&e.helper.class?t.getResource(e.helper.class).then((t=>t.get(e,e.context,e.container))):t.getResource("vb/extensions/dynamic/private/helpers/dataDescriptionMetadataProviderHelper").then((t=>t.get(e,e.context,e.container)))))}createMetadataProvider(e){return super.createMetadataProvider(e).then((e=>(this.provider=e,this.propertyQueue.length&&(this.propertyQueue.forEach((t=>{this.runtimeEnv.annotate(e,t.name,t.value)})),this.propertyQueue=[]),e)))}dispose(){super.dispose(),this.helper&&this.helper.dispose()}})),define("vb/extensions/dynamic/private/types/bridges/serviceMetadataProviderFactoryBridge",["vb/extensions/dynamic/private/types/bridges/helperMetadataProviderFactoryBridge","vb/private/utils","vb/private/constants"],((e,t,i)=>class extends e{translateOptions(e){const t=e;return Promise.resolve().then((()=>{if(t.endpoint){const r=e.endpoint.split(i.PATH_SEPARATOR);if(t.service=r[0]||t.service,t.operationId=r[1]||t.operationId,!t.service||!t.operationId)throw new Error(`Invalid service configuration: ${t.service}/${t.operationId}`)}return super.translateOptions(e)}))}getDelegatePath(){return"oj-dynamic/providers/ServiceMetadataProviderFactory"}getHelper(e){return Promise.resolve().then((()=>e.service&&e.operationId?t.getResource("vb/extensions/dynamic/private/helpers/serviceMetadataProviderHelper").then((t=>t.get(e,e.context,e.container))):super.getHelper(e,e.context,e.container)))}})),define("vb/extensions/dynamic/private/types/bridges/dynamicLayoutMetadataProviderFactoryBridge",["vb/extensions/dynamic/private/types/bridges/serviceMetadataProviderFactoryBridge"],(e=>class extends e{getDelegatePath(){return"oj-dynamic/providers/DynamicLayoutMetadataProviderFactory"}translateOptions(e){const t=e;return Promise.resolve().then((()=>(t.path&&(delete t.endpoint,t.helper={path:"vb/extensions/dynamic/private/helpers/dataDescriptionMetadataProviderHelper"}),super.translateOptions(e))))}getHelper(e){return super.getHelper(e).then((t=>{const i=e.layoutConfig&&e.layoutConfig.path,r=e.layoutConfig&&e.layoutConfig.root;return e.path?t.setLayoutRoot(e.path):i?t.setLayoutPath(i):null!=r&&t.setLayoutRoot(r),t}))}})),define("vb/extensions/dynamic/private/types/bridges/jsonMetadataProviderFactoryBridge",["vb/private/utils","vb/extensions/dynamic/private/types/bridges/metadataProviderFactoryBridge"],((e,t)=>class extends t{getDelegatePath(){return"oj-dynamic/providers/JsonMetadataProviderFactory"}})),define("vb/extensions/dynamic/private/types/containerMetadataProviderDescriptor",["vb/extensions/dynamic/private/types/abstractMetadataProviderDescriptor","vb/extensions/dynamic/private/types/bridges/helperMetadataProviderFactoryBridge","vb/extensions/dynamic/private/constants"],((e,t,i)=>class extends e{createOptions(e){let t=super.createOptions(e);if(!t.factory){const e={},r=this.container;if(!r)throw new Error("Missing container when creating MetadataProvider");r.extensionsArray.forEach((t=>{e[t.extensionId]={container:t,property:"data"}}));const n={files:[{property:"data",extensionFile:`${r.path}-x.json`,baseContainer:r,extensionContainers:e},{property:"template",baseFile:`${r.fullName}-template${r.base?"-x":""}.html`,extensionFile:`${r.fullName}-template-x.html`,prefix:"text!",optional:!0}]};t=Object.assign({},t,{layoutType:i.LayoutType.CONTAINER,factory:"oj-dynamic/providers/ContainerMetadataProviderFactory",helper:{class:"vb/extensions/dynamic/private/helpers/configurableMetadataProviderHelper",root:r.resourceLoc,descriptors:n}})}return t}createFactoryBridge(){return new t}getTypeDefinition(){return{type:"any"}}})),define("vb/extensions/dynamic/private/types/serviceMetadataProviderDescriptor",["vb/private/constants","vb/private/utils","vb/extensions/dynamic/private/types/abstractMetadataProviderDescriptor","vb/extensions/dynamic/private/types/bridges/serviceMetadataProviderFactoryBridge"],((e,t,i,r)=>class extends i{createFactoryBridge(){return new r}getTypeDefinition(){return{type:{endpoint:"string"}}}})),define("vb/extensions/dynamic/private/types/dynamicLayoutMetadataProviderDescriptor",["vb/private/utils","vb/private/log","vb/extensions/dynamic/private/types/serviceMetadataProviderDescriptor","vb/extensions/dynamic/private/types/abstractMetadataProviderDescriptor","vb/extensions/dynamic/private/types/bridges/dynamicLayoutMetadataProviderFactoryBridge"],((e,t,i,r,n)=>{const s=t.getLogger("/vb/extensions/dynamic/private/types/DynamicLayoutMetadataProviderDescriptor");return class extends r{createFactoryBridge(){return new n}activate(){return Promise.resolve().then((()=>{const e=this.getValue();return e.operationId&&e.endpoint&&s.warn(`Variable ${this.id} defined with both "endpoint" and "operationId"; "operationId" will be ignored`),super.activate()}))}getTypeDefinition(){return{type:{endpoint:"string",path:"string",operationId:"string",metadataPath:"string",layoutConfig:{path:"string",root:"string"}}}}}})),define("vb/extensions/dynamic/private/types/heterogeneousMetadataProviderDescriptor",["vb/private/utils","vb/private/log","vb/extensions/dynamic/private/types/abstractMetadataProviderDescriptor","vb/extensions/dynamic/private/types/bridges/helperMetadataProviderFactoryBridge"],((e,t,i,r)=>class extends i{createFactoryBridge(){return new r}createOptions(e){let t=super.createOptions(e);if(!t.factory){if(!this.container)throw new Error("Missing container when creating MetadataProvider");const e={};t=Object.assign({},t,{factory:"oj-dynamic/providers/HeterogeneousMetadataProviderFactory",helper:{class:"vb/extensions/dynamic/private/helpers/configurableMetadataProviderHelper",root:this.container.getResourceFolder(),descriptors:e}})}return t}getTypeDefinition(){return{type:{discriminator:"string"}}}})),define("vb/extensions/dynamic/private/types/jsonMetadataProviderDescriptor",["vb/extensions/dynamic/private/types/abstractMetadataProviderDescriptor","vb/extensions/dynamic/private/types/bridges/jsonMetadataProviderFactoryBridge"],((e,t)=>class extends e{createOptions(e){const t=super.createOptions(e);return t.path&&t.data&&0===Object.keys(t.data).length&&t.data.constructor===Object&&delete t.data,t}createFactoryBridge(){return new t}getTypeDefinition(){return{type:{path:"string",data:"object"}}}})),define("vb/extensions/process/action/builtin/processAction",["vb/action/action","vb/action/builtin/restAction"],((e,t)=>{const i=Object.freeze({container:Object.freeze({scopeResolver:Object.freeze([])})});return class extends e{static endpoint(){throw new Error("Subclass must override")}static responseType(){throw new Error("Subclass must override")}static restActionIdentification(){throw new Error("Subclass must override")}static computeOutcome(t){if(!t)return;const i={content:{},info:{status:t.result.status,headers:t.result.headers}},r=(t,r,n)=>{let s=`Error during ${this.restActionIdentification().id}`;if(t){const e=n&&n.body&&"string"==typeof n.body.detail&&n.body.detail;e&&(s=`${s}\nDetail: ${e}`)}const a=e.createFailureOutcome(s,r,n);return a.result=Object.assign(i,a.result),a};if("success"!==t.name)return r(!0,t.result.error,t.result.payload);const n=t.result.body;if(Array.isArray(n)||"object"==typeof n)i.content=n;else try{i.content=JSON.parse(n)}catch(e){return r(!1,e,t.result)}return i.error=null,i.message={summary:""},e.createSuccessOutcome(i)}_send(e,r,n){const s=this.constructor.restActionIdentification(),a=new t(s.id,s.description),o={uriParams:e,body:r},c=n||this.constructor.responseType();return c&&(a.setContext(i),o.responseType=c),o.endpoint=this.constructor.endpoint(),o.headers={accept:"application/json"},r&&(o.headers["content-type"]="application/json"),a.perform(o).then((e=>this.constructor.computeOutcome(e)))}perform(e){return this._send(Object.assign({},e))}}})),define("text!vb/extensions/process/helpers/processModel.json",[],(function(){return'{\n  "deployedProcessCollection": {\n    "totalResults": "number",\n    "count": "number",\n    "hasMore": "boolean",\n    "limit": "number",\n    "offset": "number",\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "items": [\n      {\n        "links": [\n          {\n            "href": "string",\n            "rel": "string"\n          }\n        ],\n        "id": "string",\n        "label": "string",\n        "aliases": "string[]"\n      }\n    ]\n  },\n  "deployedProcess": {\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "id": "string",\n    "label": "string",\n    "aliases": "string[]"\n  },\n  "extendedDeployedProcessCollection": {\n    "totalResults": "number",\n    "count": "number",\n    "hasMore": "boolean",\n    "limit": "number",\n    "offset": "number",\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "items": [\n      {\n        "links": [\n          {\n            "href": "string",\n            "rel": "string"\n          }\n        ],\n        "id": "string",\n        "label": "string",\n        "aliases": "string[]",\n        "version": "string",\n        "application": "string",\n        "name": "string",\n        "default": "boolean",\n        "processInstanceCount": "number",\n        "interfaces": [\n          {\n            "id": "string",\n            "label": "string",\n            "parameters": "object"\n          }\n        ]\n      }\n    ]\n  },\n  "extendedDeployedProcess": {\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "id": "string",\n    "label": "string",\n    "aliases": "string[]",\n    "version": "string",\n    "application": "string",\n    "name": "string",\n    "default": "boolean",\n    "processInstanceCount": "number",\n    "interfaces": [\n      {\n        "id": "string",\n        "label": "string",\n        "parameters": "object"\n      }\n    ]\n  },\n  "processInstanceCollection": {\n    "totalResults": "number",\n    "count": "number",\n    "hasMore": "boolean",\n    "limit": "number",\n    "offset": "number",\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "items": [\n      {\n        "links": [\n          {\n            "href": "string",\n            "rel": "string"\n          }\n        ],\n        "id": "string",\n        "label": "string",\n        "deployedProcess": {\n          "id": "string",\n          "label": "string",\n          "aliases": "string[]"\n        },\n        "startDate": "string",\n        "startUser": "string",\n        "state": "string",\n        "priority": "number"\n      }\n    ]\n  },\n  "processInstance": {\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "id": "string",\n    "label": "string",\n    "deployedProcess": {\n      "id": "string",\n      "label": "string",\n      "aliases": "string[]"\n    },\n    "startDate": "string",\n    "startUser": "string",\n    "state": "string",\n    "priority": "number"\n  },\n  "taskCollection": {\n    "totalResults": "number",\n    "count": "number",\n    "hasMore": "boolean",\n    "limit": "number",\n    "offset": "number",\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "items": [\n      {\n        "links": [\n          {\n            "href": "string",\n            "rel": "string"\n          }\n        ],\n        "id": "string",\n        "label": "string",\n        "deployedProcess": {\n          "id": "string",\n          "label": "string",\n          "aliases": "string[]"\n        },\n        "processInstance": {\n          "id": "string",\n          "label": "string"\n        },\n        "description": "string",\n        "creationDate": "string",\n        "creationUser": "string",\n        "assignedDate": "string",\n        "state": "string",\n        "priority": "number",\n        "actions": [\n          {\n            "id": "string",\n            "label": "string",\n            "taskId": "string",\n            "type": "string",\n            "actionId": "string"\n          }\n        ]\n      }\n    ]\n  },\n  "task": {\n    "links": [\n      {\n        "href": "string",\n        "rel": "string"\n      }\n    ],\n    "id": "string",\n    "label": "string",\n    "deployedProcess": {\n      "id": "string",\n      "label": "string",\n      "aliases": "string[]"\n    },\n    "processInstance": {\n      "id": "string",\n      "label": "string"\n    },\n    "description": "string",\n    "creationDate": "string",\n    "creationUser": "string",\n    "assignedDate": "string",\n    "state": "string",\n    "priority": "number",\n    "actions": [\n      {\n        "id": "string",\n        "label": "string",\n        "taskId": "string",\n        "type": "string",\n        "actionId": "string"\n      }\n    ]\n  }\n}\n'})),define("text!vb/extensions/process/helpers/service.json",[],(function(){return'{\n  "swagger": "2.0",\n  "info": {\n    "version": "1.0.0",\n    "title": "VBCS Process Integration Service",\n    "x-vb": {\n      "authenticationType": "oraclecloud"\n    }\n  },\n  "basePath": "/resources/vbprocess",\n  "host": "application",\n  "schemes": ["vb-extension"],\n  "paths": {\n    "/deployedProcesses": {\n      "get": {\n        "summary": "Returns a collection with the deployed processes accessible by the logged in user.",\n        "operationId": "getDeployedProcessCollection",\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "extended",\n            "in": "query",\n            "required": false,\n            "type": "boolean"\n          },\n          {\n            "name": "showProcessInstanceCount",\n            "in": "query",\n            "required": false,\n            "type": "boolean"\n          },\n          {\n            "name": "suppressUnregistered",\n            "in": "query",\n            "required": false,\n            "type": "boolean"\n          },\n          {\n            "name": "alias",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "deployedProcessId",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "retrieveMany"\n      }\n    },\n    "/deployedProcesses/{aliasOrDeployedProcessId}": {\n      "get": {\n        "summary": "Returns a deployed process.",\n        "operationId": "getDeployedProcess",\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "aliasOrDeployedProcessId",\n            "in": "path",\n            "required": true,\n            "type": "string"\n          },\n          {\n            "name": "extended",\n            "in": "query",\n            "required": false,\n            "type": "boolean"\n          },\n          {\n            "name": "showProcessInstanceCount",\n            "in": "query",\n            "required": false,\n            "type": "boolean"\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "retrieveOne"\n      }\n    },\n    "/deployedProcesses/{aliasOrDeployedProcessId}/start": {\n      "post": {\n        "summary": "Starts a deployed process, creating a process instance.",\n        "operationId": "startProcess",\n        "consumes": [\n          "application/json"\n        ],\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "aliasOrDeployedProcessId",\n            "in": "path",\n            "required": true,\n            "type": "string"\n          },\n          {\n            "in": "body",\n            "name": "body",\n            "required": true\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "custom"\n      }\n    },\n    "/processInstances": {\n      "get": {\n        "summary": "Returns a collection with the process instances accessible by the logged in user.",\n        "operationId": "getProcessInstanceCollection",\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "alias",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "deployedProcessId",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "state",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "priority",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "since",\n            "in": "query",\n            "required": false,\n            "type": "string"\n          },\n          {\n            "name": "until",\n            "in": "query",\n            "required": false,\n            "type": "string"\n          },\n          {\n            "name": "startUser",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "limit",\n            "in": "query",\n            "required": false,\n            "type": "integer"\n          },\n          {\n            "name": "offset",\n            "in": "query",\n            "required": false,\n            "type": "integer"\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "retrieveMany"\n      }\n    },\n    "/processInstances/{processInstanceId}": {\n      "get": {\n        "summary": "Returns a process instance.",\n        "operationId": "getProcessInstance",\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "processInstanceId",\n            "in": "path",\n            "required": true,\n            "type": "string"\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "retrieveOne"\n      }\n    },\n    "/tasks": {\n      "get": {\n        "summary": "Returns a collection with the tasks accessible by the logged in user.",\n        "operationId": "getTaskCollection",\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "suppressActions",\n            "in": "query",\n            "required": false,\n            "type": "boolean"\n          },\n          {\n            "name": "alias",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "deployedProcessId",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "processInstanceId",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "state",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "priority",\n            "in": "query",\n            "required": false,\n            "type": "array",\n            "items": {\n              "type": "string"\n            },\n            "collectionFormat": "multi"\n          },\n          {\n            "name": "since",\n            "in": "query",\n            "required": false,\n            "type": "string"\n          },\n          {\n            "name": "until",\n            "in": "query",\n            "required": false,\n            "type": "string"\n          },\n          {\n            "name": "relation",\n            "in": "query",\n            "required": false,\n            "type": "string"\n          },\n          {\n            "name": "limit",\n            "in": "query",\n            "required": false,\n            "type": "integer"\n          },\n          {\n            "name": "offset",\n            "in": "query",\n            "required": false,\n            "type": "integer"\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "retrieveMany"\n      }\n    },\n    "/tasks/{taskId}": {\n      "get": {\n        "summary": "Returns a task.",\n        "operationId": "getTask",\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "taskId",\n            "in": "path",\n            "required": true,\n            "type": "string"\n          },\n          {\n            "name": "suppressActions",\n            "in": "query",\n            "required": false,\n            "type": "boolean"\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "retrieveOne"\n      }\n    },\n    "/tasks/{taskId}/performAction": {\n      "post": {\n        "summary": "Performs a task action.",\n        "operationId": "performTaskAction",\n        "consumes": [\n          "application/json"\n        ],\n        "produces": [\n          "application/json"\n        ],\n        "parameters": [\n          {\n            "name": "taskId",\n            "in": "path",\n            "required": true,\n            "type": "string"\n          },\n          {\n            "in": "body",\n            "name": "body",\n            "required": true\n          }\n        ],\n        "responses": {\n          "default": {}\n        },\n        "x-vb-actionHint": "custom"\n      }\n    }\n  }\n}'})),define("vb/extensions/process/helpers/processService",["text!./processModel.json","text!./service.json","vb/private/services/serviceProvider","vb/private/services/servicesManager"],((e,t,i,r)=>{const n=Symbol("cache");class s{constructor(e){this._computeFunction=e}get deployedProcessCollection(){return this._computeFunction("getDeployedProcessCollection")}get deployedProcess(){return this._computeFunction("getDeployedProcess")}get processInstanceCollection(){return this._computeFunction("getProcessInstanceCollection")}get processInstance(){return this._computeFunction("getProcessInstance")}get taskCollection(){return this._computeFunction("getTaskCollection")}get task(){return this._computeFunction("getTask")}get startProcess(){return this._computeFunction("startProcess")}get performTaskAction(){return this._computeFunction("performTaskAction")}}class a{constructor(e){this[n]=e}get deployedProcessCollection(){return this[n].deployedProcessCollection}get deployedProcess(){return this[n].deployedProcess}get extendedDeployedProcessCollection(){return this[n].extendedDeployedProcessCollection}get extendedDeployedProcess(){return this[n].extendedDeployedProcess}get processInstanceCollection(){return this[n].processInstanceCollection}get processInstance(){return this[n].processInstance}get taskCollection(){return this[n].taskCollection}get task(){return this[n].task}}return new class{constructor(){this[n]={processServiceProvider:new i("oracle.vb.internal.service.integration.process","vb/extensions/process/helpers/service.json",JSON.parse(t)),endpoint:new s((e=>this.computeEndpoint(e))),definition:new a(JSON.parse(e))},r.addServiceProvider(this[n].processServiceProvider)}computeEndpoint(e){return`${this.getServiceId()}/${e}`}getServiceId(){return this[n].processServiceProvider.getServiceName()}get endpoint(){return this[n].endpoint}get definition(){return this[n].definition}isRequestingExtendedPayload(e){if(e){const t=e.extended;return!0===t||"true"===t}return!1}}})),define("vb/extensions/process/action/builtin/getDeployedProcessAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.deployedProcess}static responseType(){return t.definition.extendedDeployedProcess}static restActionIdentification(){return{id:"getDeployedProcessAction",description:"Get a deployed process"}}perform(e){const i=Object.assign({},e);i.aliasOrDeployedProcessId=i.alias||i.deployedProcessId,delete i.alias,delete i.deployedProcessId;const r=t.isRequestingExtendedPayload(i)?t.definition.extendedDeployedProcess:t.definition.deployedProcess;return this._send(i,void 0,r)}})),define("vb/extensions/process/action/builtin/getDeployedProcessCollectionAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.deployedProcessCollection}static responseType(){return t.definition.extendedDeployedProcessCollection}static restActionIdentification(){return{id:"getDeployedProcessCollectionAction",description:"Get a deployed process collection"}}perform(e){const i=Object.assign({},e),r=t.isRequestingExtendedPayload(i)?t.definition.extendedDeployedProcessCollection:t.definition.deployedProcessCollection;return this._send(i,void 0,r)}})),define("vb/extensions/process/action/builtin/getProcessInstanceAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.processInstance}static responseType(){return t.definition.processInstance}static restActionIdentification(){return{id:"getProcessInstanceAction",description:"Get a process instance"}}})),define("vb/extensions/process/action/builtin/getProcessInstanceCollectionAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.processInstanceCollection}static responseType(){return t.definition.processInstanceCollection}static restActionIdentification(){return{id:"getProcessInstanceCollectionAction",description:"Get a process instance collection"}}})),define("vb/extensions/process/action/builtin/getTaskAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.task}static responseType(){return t.definition.task}static restActionIdentification(){return{id:"getTaskAction",description:"Get a task"}}})),define("vb/extensions/process/action/builtin/getTaskCollectionAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.taskCollection}static responseType(){return t.definition.taskCollection}static restActionIdentification(){return{id:"getTaskCollectionAction",description:"Get a task collection"}}})),define("vb/extensions/process/action/builtin/performTaskAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.performTaskAction}static responseType(){return t.definition.task}static restActionIdentification(){return{id:"performTaskAction",description:"Perform a task action"}}perform(e){const t=Object.assign({},e),i={};return i.taskAction=t.taskAction,delete t.taskAction,this._send(t,i)}})),define("vb/extensions/process/action/builtin/startProcessAction",["vb/extensions/process/action/builtin/processAction","vb/extensions/process/helpers/processService"],((e,t)=>class extends e{static endpoint(){return t.endpoint.startProcess}static responseType(){return t.definition.processInstance}static restActionIdentification(){return{id:"startProcessAction",description:"Start a process"}}perform(e){const t=Object.assign({},e);t.aliasOrDeployedProcessId=t.alias||t.deployedProcessId,delete t.alias,delete t.deployedProcessId;const i={};if(i.interface=t.interface,i.interface)delete t.interface;else{i.interface={},i.interface.id=t.interfaceId,delete t.interfaceId;const e="arguments";i.interface[e]=t[e],delete t[e]}return this._send(t,i)}})),define("vb/helpers/restHookHandler",[],(()=>class{handlePreFetchHook(){return Promise.resolve()}handleRequestHook(e){return Promise.resolve(e)}handleResponseHook(e){return Promise.resolve(e)}handlePostFetchHook(){return Promise.resolve()}handlePostFetchErrorHook(){return Promise.resolve()}})),define("vb/private/helpers/restHelperFactory",["vb/helpers/rest"],(e=>{class t{static get(e,i){return t._createRestHelper(t.getRestHelperModule(),e,i)}static _createRestHelper(e,t,i){const r=e;return t&&t.url&&t.operationRef?new r(t,"vb/private/services/operationRefEndpointProvider",i):new r(t,"vb/private/services/servicesManager",i)}static getRestHelperModule(){return e}}return t})),define("vb/private/types/utils/serviceDataProviderRestHelper",["knockout","vb/helpers/rest","vb/private/services/transformsUtils","vb/private/types/dataProviderConstants"],((e,t,i,r)=>{const n={};class s extends t{static storeInCache(t,i,r){n[t]=n[t]||{};const s=n[t][i];e.isObservable(s)?s(r):n[t][i]=r}static retrieveFromCache(e,t){return n[e]&&n[e][t]}getRequestTransformsToRun(e){if(e.fetchConfiguration){const t=e.fetchConfiguration.capability,i=e.fetchConfiguration.fetchParameters;if("fetchByKeys"===t&&i.keys.size>0&&this.transformRequestFuncMap.fetchByKeys)return["fetchByKeys"]}return Object.keys(this.transformRequestFuncMap).filter(i.excludeFetchByKeys).sort(i.selectTransformFirst).sort(i.bodyTransformLast)}storeState(e,t,i){s.storeInCache(e,t,i)}retrieveState(e,t){return s.retrieveFromCache(e,t)}getAndStoreCapabilities(t){let i={},n=this.retrieveState(t,r.CAPABILITIES_KEY);return n||(n=new Promise((n=>{this._getEndpoint().then((a=>{a?a.getConfig(this.params,{ignoreMissingParams:!0}).then((o=>{const c=a.getMetadata(),l={url:o.url,readOnlyParameters:this.parameters,endpointDefinition:c,initConfig:{}};Object.assign(l.initConfig,this.initRequestMap);const h=a.getMetadataTransforms();if(h){const e=h.capabilities;e&&(i=e.call(null,l),s.storeInCache(t,r.CAPABILITIES_KEY,i))}const p=e.observable(-1);s.storeInCache(t,"totalSize",p),n(i)})):(this.log.error("AbstractRestHelper",this.id,"error fetching endpoint details",JSON.stringify(this.endpointReference)),n(i))})).catch((e=>{this.log.error("AbstractRestHelper",this.id,"error fetching full URL for endpoint",JSON.stringify(this.endpointReference),e),n(i)}))})),s.storeInCache(t,r.CAPABILITIES_KEY,n)),n}}return s})),define("vb/private/types/utils/serviceDataProviderRestHelperFactory",["vb/private/helpers/restHelperFactory","vb/private/types/utils/serviceDataProviderRestHelper"],((e,t)=>class extends e{static get(i,r){return e._createRestHelper(t,i,r)}})),define("vb/private/types/capabilities/serviceTransformsHookHandler",["vb/helpers/restHookHandler","vb/private/types/utils/serviceDataProviderRestHelperFactory"],((e,t)=>class extends e{constructor(e){super(),this.context=e}getRestHelper(e,i){return t.get(e,i)}handlePreFetchHook(e){return Promise.resolve(this.setupTransforms(e))}handlePostFetchHook(e){return this.processResponseTransforms(e.transformResults)}setupTransforms(e){this.context.setupTransforms(e)}processResponseTransforms(e){return this.context.processResponseTransforms(e)}})),define("vb/private/types/capabilities/fetchContext",["vb/private/constants","vb/private/log","vb/private/action/assignmentHelper","vb/private/utils","vb/private/types/utils/dataProviderUtils","vb/private/types/capabilities/serviceTransformsHookHandler","vb/private/types/utils/serviceDataProviderRestHelperFactory","vb/types/typeUtils","ojs/ojdatasource-common","ojs/ojeventtarget","ojs/ojdataprovider"],((e,t,i,r,n,s,a,o)=>{const c="transformsContext",l={VB_PREPARE:"vbPrepare",SORT:"sort",FILTER:"filter",PAGINATE:"paginate",QUERY:"query",SELECT:"select",BODY:"body",FETCH_BY_KEYS:"fetchByKeys"},h={BODY:"body",PAGINATE:"paginate"},p=t.getLogger("/vb/types/ServiceDataProvider.FetchContext",void 0),u=(e,t,i)=>(t.finer("ServiceDataProvider",e,"fetch failed with error:",i),i),d=(e,t,i)=>(t.finer("ServiceDataProvider",e,"fetch succeeded with result:",i),i);class g{constructor(e,t){this.log=p,this.id=r.generateUniqueId(),this.sdp=e,this.sdpState={value:r.cloneObject(e.getValue())||{},defaultValue:r.cloneObject(e.getDefinitionValue())||{}},this.fetchOptions=this.whiteListFetchOptions(t),this.originalFetchOptions=t,this.lifecycleStageChangedListener=this.handleLifecycleStageChanged(),this.sdp.getLifecycleStageChangedSignal().add(this.lifecycleStageChangedListener,{id:this.id}),this.internalState={}}handleLifecycleStageChanged(){return(e,t)=>this.handleVariableLifecycleStageChange(e,t)}handleVariableLifecycleStageChange(t,i){t===e.VariableLifecycleStage.DISPOSE&&(this.sdp=i,this.sdp.getLifecycleStageChangedSignal().remove(this.lifecycleStageChangedListener,{id:this.id}))}static get DEFAULT_SIZE(){return 10}static get DEFAULT_OFFSET(){return 0}static get DEFAULT_TOTAL_SIZE(){return-1}static get DEFAULT_MAX_SIZE(){return 1e3}static get REQUEST_TRANSFORM_TYPE(){return l}static get RESPONSE_TRANSFORM_TYPE(){return h}static get LOGGER(){return p}static usePropValue(e,t){const i=["sortCriteria","filterCriteria","filterCriterion","pagingCriteria","transforms","uriParameters","body"],r=["mergeTransformOptions"];return!(t.fetchChain||t.fetchChainId)||(!(i.indexOf(e)>=0)||r.indexOf(e)>=0)}whiteListFetchOptions(e){return e}getActionChainParams(){const e={};return e.hookHandler=new s(this),{configuration:e}}createRestHelper(){const e=this.sdpState.value,t=r.cloneObject(e.body),i=r.cloneObject(this.getQueryOptions()||e.uriParameters),n={},o=this.getFetchTransformsContext();e.headers&&Object.keys(e.headers).length>0&&(n.headers=r.cloneObject(e.headers));const c=new s(this),l=this.sdp.createRestHelper?this.sdp.createRestHelper():e.endpoint&&a.get(e.endpoint,this.sdp.container);return l?l.parameters(i).hookHandler(c).initConfiguration(n).body(t).transformsContext(o):null}fetch(){return Promise.resolve().then((()=>{const e=`${this.sdp.id} [${this.id}]`,t=this.sdpState.value,{fetchChainId:r,fetchChain:s}=t,a=!!s,o=s||r;if(o){const t=this.getActionChainParams();return this.log.finer("ServiceDataProvider",e,"initiating fetch using action chain:",r,"with parameters:",t),this.sdp.callActionChain(o,t,a).then((t=>{if(a)return d(e,this.log,t);if("success"===t.name)return d(e,this.log,t.result);throw u(e,this.log,t.result)})).catch((t=>{throw u(e,this.log,t)}))}const{uriParameters:c}=t,l=this.createRestHelper();if(l)return this.log.finer("ServiceDataProvider",e,"initiating fetch against endpoint:",l.getName(),"with parameters:",JSON.stringify(c)),l.fetch().then((t=>{const r={status:t.response.status,headers:t.response.headers,body:t.body};if(t.response.ok){if(!this.sdp.getValue()){const t=`unable to process response with status ${r.status} from endpoint '${l.getName()}' as the ServiceDataProvider instance no longer exists!`;throw u(e,this.log,t)}const t=this.getResponseType();if(t&&!n.isTypeDefIncomplete(t)){const n=r.body;r.body=i.coerceType(n,t),this.log.finer("ServiceDataProvider",e,"response",n,"was coerced to",r.body)}return d(e,this.log,r)}throw u(e,this.log,r)})).catch((t=>{throw u(e,this.log,t)}));throw u(e,this.log,"invalid service or endpoint name")}))}getInternalState(e){const t=`${this.id}.${e}`;return o.getPropertyValue(this.internalState,t)}setInternalState(e,t){const i=e?`${this.id}.${e}`:`${this.id}`,r=Object.assign({},this.internalState);o.setPropertyValue(r,i,t),this.internalState=r;const n=void 0===t?"clears":"sets";this.log.finer("iterator",this.id,n,"internal state for SDP:",this.sdp.id,"with key:",i,":",t)}getFetchCapability(){throw new Error("fetch capability cannot be determined!")}getResponseType(){const{sdp:e}=this,t=this.sdpState.value,i=this.sdpState.defaultValue;if(g.usePropValue("responseType",t)){const{responseType:t}=i;return n.getResolvedType(t,e,!0)}}getFetchTransformsContext(){const e=this.getInternalState(c);return e&&Object.keys(e).length>0?r.cloneObject(e):this.getTransformsContext()}getTransformsContext(){const e=this.sdpState.value;return Object.assign({},e.transformsContext)}setupTransforms(e){const t=`${this.sdp.id} [${this.id}]`,i=this.getRequestTransformOptions(),n=this.reconcileTransformOptions(i,e.transformRequestOptionsMap),s=this.callMergeTransformsOptionsFunc(n,e);e.requestTransformationOptions(s);let a=r.cloneObject(e.params);const o=s.query;"object"==typeof o&&Object.keys(o).length>0&&(a=Object.assign({},a,o),e.parameters(a)),e.transformsContext(this.getFetchTransformsContext()),s.body&&e.body(s.body),this.log.finer("ServiceDataProvider",t,"final request transform options:",s);const c=this.getRequestTransformFunctions(),l=this.getResponseTransformFunctions();if(c){const i=Object.assign({},e.transformRequestFuncMap,c);e.requestTransformationFunctions(i),this.log.finer("ServiceDataProvider",t,"final request transform functions:",i)}if(l){const i=Object.assign({},e.transformResponseFuncMap,l);e.responseTransformationFunctions(i),this.log.finer("ServiceDataProvider",t,"final response transform functions:",i)}}reconcileTransformOptions(e,t){return Object.assign({},t,e)}callMergeTransformsOptionsFunc(e,t){let i=e;const n=t.transformRequestOptionsMap,s={context:r.cloneObject(this.sdpState.value),externalContext:r.cloneObject(n),fetchParameters:r.cloneObject(this.fetchOptions),capability:this.getFetchCapability()};t.setFetchConfiguration(s);const a=this.getMergeTransformOptionsFunc();if(a&&"function"==typeof a){const t=`${this.sdp.id} [${this.id}]`,r=a.call(null,s,e);this.log.finer("ServiceDataProvider",t,"mergeTransformOptions function called with input options:",e,". The final merged transform options for the fetch:",r),i=r}return this.setInternalState("finalTransformsOptions",i),s.transformsOptions=r.cloneObject(i),i}getRequestTransformOptions(){const e={},t=`${this.sdp.id} [${this.id}]`,i=this.getPaginateOptions();i&&(e[l.PAGINATE]=i);const r=this.getSortOptions();r&&(e[l.SORT]=r);const n=this.getFilterOptions();n&&(e[l.FILTER]=n);const s=this.getQueryOptions();s&&(e[l.QUERY]=s);const a=this.getSelectOptions();a&&(e[l.SELECT]=a);const o=this.getBodyOptions();return o&&(e[l.BODY]=o),this.log.finer("ServiceDataProvider",t,"hook handler setting request transform options:",e),e}getFilterOptions(){const e=this.fetchOptions||{},t=this.sdpState.value,i=this.sdpState.defaultValue;let r,n;if(g.usePropValue("filterCriteria",t)&&i.filterCriteria)return r=t.filterCriteria||[],r;const s=e.filterCriterion;return g.usePropValue("filterCriterion",t)&&!s?n=t.filterCriterion||{}:s&&Object.keys(s).length>0&&(n=s),n}getPaginateOptions(){const{sdp:e}=this,t=this.fetchOptions||{},i=this.sdpState.value;let r,n;if(g.usePropValue("pagingCriteria",i)){const e=i.pagingCriteria||{};r=e.offset,n=e.size}const s=t.size>=0?t.size:n||10,a={offset:t.offset>=0?t.offset:r||0,size:s};return e.log.finer("calling rest with new pagingCriteria:",JSON.stringify(a)),a}getSortOptions(){let e;const t=this.fetchOptions||{},i=this.sdpState.value,r=t.sortCriteria;return!g.usePropValue("sortCriteria",i)||r&&0!==r.length?r&&r.length>0&&(e=r):e=i.sortCriteria||[],e}getBodyOptions(){let e;const t=this.sdpState.value;return g.usePropValue("body",t)&&({body:e}=t),e}getQueryOptions(){const e=this.sdpState.value;let t;return g.usePropValue("uriParameters",e)&&(t=e.uriParameters),t}getSelectOptions(){let e;const t=this.getResponseType();return t&&(e={type:t}),e}getRequestTransformFunctions(){const{sdp:e}=this,t=this.sdpState.value,i=`${this.sdp.id} [${this.id}]`;let r;if(g.usePropValue("transforms",t)){r={};const e=t.transforms&&t.transforms.request||{};Object.values(l).forEach((t=>{e[t]&&(r[t]=e[t])}))}return e.log.finer("ServiceDataProvider",i,"hook handler setting request transform functions:",r),r}getMergeTransformOptionsFunc(){const e=this.sdpState.value;let t;if(g.usePropValue("mergeTransformOptions",e)){const i=e.mergeTransformOptions;i&&"function"==typeof i&&(t=i)}return t}getResponseTransformFunctions(){const{sdp:e}=this,t=this.sdpState.value,i=`${this.sdp.id} [${this.id}]`;let r;if(g.usePropValue("transforms",t)){r={};const e=t.transforms&&t.transforms.response||{};Object.values(h).forEach((t=>{e[t]&&(r[t]=e[t])}))}return e.log.finer("ServiceDataProvider",i,"hook handler setting response transform functions:",r),r}getFetchOptionsForResponse(){const e=this.getInternalState("finalTransformsOptions");let t;var i;return e&&e.filter&&((i=e.filter).op&&i.attribute&&i.value||Array.isArray(i.criteria)&&i.criteria.length>0)&&(t=t||{},t.filterCriterion=e.filter),e&&e.sort&&Array.isArray(e.sort)&&e.sort.length>0&&(t=t||{},t.sortCriteria=e.sort),this.fetchOptions||t?Object.assign({},this.fetchOptions,t):this.fetchOptions}invokeNotificationEvent(t,i){const n=`${this.sdp.id} [${this.id}]`,s={severity:t,detail:i,capability:this.getFetchCapability(),fetchParameters:this.fetchOptions,context:r.cloneObject(this.sdpState.value),id:n,key:r.generateUniqueId()};this.sdp.invokeEvent(e.DATAPROVIDER_NOTIFICATION_EVENT,s)}processResponseTransforms(e){return Promise.resolve().then((()=>{const t=e.transformsContext;t&&Object.keys(t).length>0&&this.setInternalState(c,t)}))}}return g})),define("vb/private/types/capabilities/noOpFetchByKeys",["vb/private/log"],(e=>class{constructor(t){this.options=t,this.log=e.getLogger("/vb/types/ServiceDataProvider.NoOpFetchByKeys")}fetchByKeys(){return this.log.info("no results returned from no op fetchByKeys implementation"),Promise.resolve({fetchParameters:this.options,results:{}})}containsKeys(){return this.log.info("no results returned from no op containsKeys implementation"),Promise.resolve({containsParameters:this.options,results:[]})}})),define("vb/private/types/capabilities/noOpFetchFirst",["vb/private/log"],(e=>{class t{constructor(e){this.asyncIter=e,this[Symbol.asyncIterator]=function(){return this.asyncIter}}}class i{constructor(e,t,i){this.fetchParameters=e,this.data=t,this.metadata=i}}class r{constructor(e,t){this.value=e,this.done=t}}return class{constructor(t){this.options=t,this.log=e.getLogger("/vb/types/ServiceDataProvider.NoOpFetchFirst")}fetchFirst(){return this.log.info("no results returned from no op fetchFirst implementation"),new t(this)}next(){const e=!(!0===this.doneIterating),t=new i(this.options,[],[]),n=new r(t,!e);return this.doneIterating=!0,this.log.info("no results returned from no op fetchFirst implementation:",n),Promise.resolve(n)}getCapability(){return{implementation:"iteration"}}}})),define("vb/private/types/capabilities/noOpFetchByOffset",["vb/private/log"],(e=>class{constructor(t){this.options=t,this.log=e.getLogger("/vb/types/ServiceDataProvider.NoOpFetchByOffset")}fetchByOffset(){return this.log.info("no results returned from no op fetchByOffset implementation"),Promise.resolve({fetchParameters:this.options,results:[],done:!0})}})),define("vb/private/types/capabilities/fetchByOffsetUtils",["vb/private/log","vb/private/constants","vb/private/utils","vb/private/types/dataProviderConstants","vb/private/types/utils/dataProviderUtils"],((e,t,i,r,n)=>{class s{constructor(e){this.key=e}}class a{constructor(e,t){this.data=e,this.metadata=t}}class o{constructor(e,t,i){this.done=e,this.fetchParameters=t,this.results=i}}class c{static buildFetchResult(e,t){const i=t.body,{itemsPath:r}=e.sdpState.value,s=e.fetchOptions,l=[],h=function(t){if(t){const i=c.getItemMetadata(e,t),r=new a(t,i);l.push(r)}},p=n.getObjectByPath(i,r);p&&Array.isArray(p)?p.forEach((e=>{h(e)})):h(p);const u=e.hasMore();let d=!1;return void 0===u||!1===u?(e.log.finer("iterator",e.id,"returning last result set from fetch call"),d=!0):d=!1,new o(d,s,l)}static getItemMetadata(e,t){const{sdpState:i}=e,{sdp:r}=e,a=i.value[r.getIdAttributeProperty()],o=n.getIdAttributeHelper(a).getKey(t);return o?new s(o):(r.log.error("idAttribute is not set. using the key provided via fetch options"),{})}}return c})),define("vb/private/types/capabilities/fetchFirst",["vb/private/constants","vb/private/types/dataProviderConstants","vbc/private/logConfig","vb/private/log","vb/private/utils","vb/private/types/capabilities/fetchContext","vb/private/types/utils/dataProviderUtils","vbc/private/monitorOptions","vb/private/types/capabilities/noOpFetchFirst"],((e,t,i,r,n,s,a,o,c)=>{const l=["attributes","size","sortCriteria","filterCriterion","fetchMetadata"],h="filterCriterion",p="sortCriteria",u="pagingCriteria",d="body",g="responseType",v="selectAttributes",f=r.getLogger("/vb/types/ServiceDataProvider.AsyncIterator",[{name:"custom",severity:e.Severity.INFO,style:i.FancyStyleByFeature.serviceDataProviderStart}]),m=e=>null==e,b={op:void 0,attribute:void 0,value:void 0};class y{constructor(e){this.asyncIter=e,this[Symbol.asyncIterator]=()=>this.asyncIter}}class E{constructor(e,t,i,r){this.fetchParameters=e,this.data=t,this.metadata=i,this.response=r}}class P{constructor(e,t){this.value=e,this.done=t}}class x extends s{constructor(e,t){super(e,t),this.log=f,this.doneIterating=void 0}static createCapability(e,t){return new x(e,t)}whiteListFetchOptions(e){let t;if(e){t={};this.getFetchParams().forEach((i=>{void 0!==e[i]&&(t[i]=e[i])}))}return t}getFetchParams(){return l}getFetchCapability(){return t.CapabilityType.FETCH_FIRST}fetch(){return new y(this)}next(){const t=!(!0===this.doneIterating),{sdp:i}=this,r=`${i.id} [${this.id}]`;if(!1===t){const e=this.getFetchOptionsForResponse(),i=new E(e,[],[]),n=new P(i,!t);return this.setInternalState(),this.log.custom("ServiceDataProvider",r,"next() on iterator skipped and is done. Returns result:",n),Promise.resolve(n)}return Promise.resolve().then((()=>{i.log.startFetch("ServiceDataProvider",r,"next() called with options",this.fetchOptions,"and state:",this.sdpState);const t=new o(o.SPAN_NAMES.SDP_FETCH_FIRST,r);return i.log.monitor(t,(t=>s.prototype.fetch.call(this).then((e=>{const n=this.buildFetchResult(e);return!n.done&&void 0!==this.hasMore()&&this.hasMore()||this.markIteratorAsDone(),i.log.endFetch("ServiceDataProvider",r,"fetch succeeded with result:",n,t()),n})).catch((n=>{if(this.markIteratorAsDone(),i.log.endFetch("ServiceDataProvider",r,"fetch failed with error:",n,t(n)),this.invokeNotificationEvent(e.MessageType.ERROR,n),this.sdp.isDisconnected())return new c(this.fetchOptions).next();throw n}))))}))}buildFetchResult(e){let t;const i=this.getFetchOptionsForResponse(),r=e.body,{itemsPath:n}=this.sdpState.value,s=a.getObjectByPath(r,n),o=this.getItemsMetadata(s),c=this.hasMore();let l;return void 0===c||!1===c?(this.log.finer("iterator",this.id,"returning last result set from fetch call"),s&&s.length>0?(l=!1,t=new E(i,s,o,r)):(l=!0,t=new E(i,[],[],r))):(l=!1,t=new E(i,s,o,r)),new P(t,l)}getItemsMetadata(e){const t=this.sdpState.value[this.sdp.getIdAttributeProperty()],i=a.getIdAttributeHelper(t),r=i.getKeys(e);if(r&&t){if(!r.has(void 0)&&r.size===e.length)return a.createFetchByKeysResultItemMetadata(r);this.log.warn("The keys",r,"determined using the key attributes:",t,"are either not unique or are invalid for the data",e,". Reverting to using @index as the key! Provide a valid idAttribute or ensure that the data is valid!")}this.log.finer(this.sdp.getIdAttributeProperty()," is not set. Using index of item as key to build items metadata");const n=this.getInternalState(u)||{},o=n&&n.offset>=0?n.offset:s.DEFAULT_OFFSET,c=i.getIndices(e,o);return a.createFetchByKeysResultItemMetadata(c)}getTransformsContext(){const e=this.fetchOptions||{},t=this.sdpState.value,i=Object.assign({},t.transformsContext);return e.fetchMetadata&&(i.fetchMetadata=e.fetchMetadata),i}hasMore(){const e=this.getInternalState(s.RESPONSE_TRANSFORM_TYPE.PAGINATE),t=e&&e.hasMore;return"boolean"==typeof t?t:void 0}markIteratorAsDone(){this.doneIterating=!0,this.log.finer("iterator",this.id,"'done' flag:",this.doneIterating)}getFilterOptions(){let e;const t=this.sdpState.value,i=this.sdpState.defaultValue;if(s.usePropValue("filterCriteria",t)&&i.filterCriteria)return e=t.filterCriteria||[],e;let r;const n=this.fetchOptions?this.fetchOptions.filterCriterion:void 0,o=this.getInternalState(h)||{},c=Object.keys(o).length>0,l=t.filterCriterion;return s.usePropValue("filterCriterion",t)?(r=!n||n&&0===Object.keys(n).length?c?o:l||{}:c?o:a.combineFilterCriterionFromMultipleSources(n,l),c||this.setInternalState(h,r)):r=c?o:n,r}getPaginateOptions(){const e=this.getPaginateOptionsSize(),t=this.getPaginateOptionsOffset(e),i=this.getPaginateOptionsIterationLimit(),r=s.RESPONSE_TRANSFORM_TYPE.PAGINATE,n={offset:t,size:e,iterationLimit:i,pagingState:"object"==typeof this.getInternalState(r)?this.getInternalState(r).pagingState:null};return this.setInternalState(u,n),this.log.finer("calling rest with new pagingCriteria:",n),n}getPaginateOptionsIterationLimit(){const e=this.sdpState.value;let t;if(s.usePropValue("pagingCriteria",e)){t=(e.pagingCriteria||{}).iterationLimit||-1}return t}getPaginateOptionsSize(){const e=this.fetchOptions||{},t=this.sdpState.value,i=this.getInternalState(u)||{};let r,n,a;if(s.usePropValue("pagingCriteria",t)){const e=t.pagingCriteria||{};r=e.size||s.DEFAULT_SIZE,n=e.maxSize}return e.size>=0?a=i.size>0?i.size:e.size:-1===e.size?i.size>0?({size:a}=i):a=n||e.size:a=r,a}getPaginateOptionsOffset(e){let t;const i=this.fetchOptions||{},r=this.sdpState.value;if(s.usePropValue("pagingCriteria",r)){t=(r.pagingCriteria||{}).offset||s.DEFAULT_OFFSET}let n;const a=this.getInternalState(u)||{};return void 0===i.offset&&a.offset>=0&&e>=0?n=a.offset+e:i.offset>=0?({offset:n}=i):n=t,n}getResponseType(){let e=this.getInternalState(g);return e||(e=super.getResponseType(),this.setInternalState(g,e)),e}getSelectOptions(){const e=this.fetchOptions||{};let i;const r=this.getResponseType(),n=this.getInternalState(v);let s,a;return!n&&e.attributes&&e.attributes.length>0?(a=e.attributes,s=t.DEFAULT_ANY_TYPE,this.setInternalState(v,a),this.setInternalState(g,s)):(s=r,a=n),s&&(i={type:s,attributes:a}),i}getSortOptions(){let e;const t=this.fetchOptions?this.fetchOptions.sortCriteria:void 0,i=this.sdpState.value,r=this.getInternalState(p)||[],n=r.length>0;return!s.usePropValue("sortCriteria",i)||t&&0!==t.length?t&&t.length>0&&(e=n?r:t,this.setInternalState(p,e)):e=n?r:i.sortCriteria||[],e}getBodyOptions(){let e;const t=this.sdpState.value,i=this.getInternalState(d);return s.usePropValue("body",t)&&!i?(({body:e}=t),this.setInternalState(d,e)):e=i,e}reconcileTransformOptions(e,t){const i=super.reconcileTransformOptions(e,t),r=e.paginate,n=t.paginate,s=this.reconcilePaginateOptions(r,n);s&&(i.paginate=s);const a=e.filter,o=t.filter,c=this.reconcileFilterOptions(a,o);return c&&(i.filter=c),i}reconcileFilterOptions(e,t){const i=this.getInternalState(h);if(i&&Object.keys(i).length>=0)return i;let r;const n=e&&Object.keys(e).length>0;return r=t&&Object.keys(t).length>0?n?a.combineFilterCriterionFromMultipleSources(e,t):t:n?e:b,this.setInternalState(h,r),this.getInternalState(h)}reconcilePaginateOptions(e,t){let i=this.getInternalState(u)||{},r=!1;const n=this.reconcilePaginateOptionsSize(e,t);m(n)||m(i.size)&&n===i.size||(i.size=n,r=!0);const s=this.reconcilePaginateOptionsOffset(e,t);m(s)||m(i.offset)&&s===i.offset||(i.offset=s,r=!0);const a=this.reconcilePaginateOptionsIterationLimit(e,t);return m(a)||m(i.iterationLimit)&&a===i.iterationLimit||(i.iterationLimit=a,r=!0),r&&(i=this.getInternalState(u),this.setInternalState(u,i),this.log.finer("calling rest with updated pagingCriteria:",i)),i}reconcilePaginateOptionsSize(e,t){let i;const r=e,n=t;return r.size||0===r.size?-1===r.size&&n&&n.maxSize>0&&(i=n.maxSize):i=n&&n.size&&n.size>=0?n.size:s.DEFAULT_SIZE,i||-1!==r.size||(i=s.DEFAULT_MAX_SIZE),i}reconcilePaginateOptionsOffset(e,t){let i;const r=e,n=t;return r.offset||0===r.offset||(i=n&&n.offset>=0?n.offset:s.DEFAULT_OFFSET),i}reconcilePaginateOptionsIterationLimit(e,t){let i;const r=t;return e.iterationLimit||(i=r&&r.iterationLimit>0?r.iterationLimit:-1),i}processResponseTransforms(e){try{return e&&Object.keys(e).length>0?super.processResponseTransforms(e).then((()=>{Object.values(s.RESPONSE_TRANSFORM_TYPE).forEach((t=>{t===s.RESPONSE_TRANSFORM_TYPE.PAGINATE&&this.setInternalState(t,e[t])}));const t=this.totalSize();return this.sdp.getTotalSize().then((e=>{if(t!==e){this.sdp.totalSize=t,this.sdpState.value.totalSize=t,this.sdp.setTotalSize(t);const e=`${this.sdp.id} [${this.id}]`;this.log.finer("ServiceDataProvider",e,"canonical totalSize updated:",t)}}))})):Promise.resolve()}catch(e){return Promise.resolve()}}totalSize(){const e=this.getInternalState(s.RESPONSE_TRANSFORM_TYPE.PAGINATE);return e&&e.totalSize>=0?e.totalSize:s.DEFAULT_TOTAL_SIZE}getIterationLimit(){const e=this.getInternalState(u);return e&&e.iterationLimit||-1}}return x})),define("vb/private/types/capabilities/fetchByOffsetIteration",["vb/private/log","vb/private/constants","vb/private/types/dataProviderConstants","vb/private/utils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByOffsetUtils","vb/private/types/capabilities/fetchFirst","vbc/private/monitorOptions"],((e,t,i,r,n,s,a,o)=>{const c=["size","sortCriteria","filterCriterion"],l="iteration";return class extends a{getFetchParams(){return c}getFetchCapability(){return i.CapabilityType.FETCH_BY_OFFSET}fetch(){const e=`${this.sdp.id} [${this.id}]`,t=this.sdp.getCapability("fetchByOffset");if(t&&t.implementation===l)return Promise.resolve().then((()=>{const{sdp:t}=this,{fetchOptions:i}=this;t.log.startFetch("ServiceDataProvider",e,"fetchByOffset using iteration, with options",JSON.stringify(i),"and state:",this.sdpState);const r=new o(o.SPAN_NAMES.SDP_FETCH_BY_OFFSET_ITERATION,e);return t.log.monitor(r,(i=>{const r=super.fetch()[Symbol.asyncIterator]();return this.optimizedFetch(r).then((r=>{const n={fetchParameters:this.originalFetchOptions,results:r.results,done:r.done};return t.log.endFetch("ServiceDataProvider",e,"fetchByOffset using iteration succeeded with result:",n,i()),n})).catch((r=>{throw t.log.endFetch("ServiceDataProvider",e,"fetchByOffset using iteration failed with error:",r,i(r)),r}))}))}));const i=`ServiceDataProvider ${e}: FetchByOffset iteration based implementation cannot be used for ${t.implementation} based implementation! Check your configuration!`;return this.log.error(i),Promise.reject(i)}optimizedFetch(e,t,i){const r=t||[];let n,s=i||0;return e.next().then((t=>{const{done:i}=t;n=n||this.getIterationLimit();const{value:a}=t,{data:o}=a,c=o.length||0,{metadata:l}=a,h=this.originalFetchOptions&&this.originalFetchOptions.offset,{size:p}=this.fetchOptions;if(h<s+c){for(let e=h<=s?0:h-s;e<c&&r.length!==p;e++)r.push({metadata:l[e],data:o[e]})}return s+=c,r.length<p&&!i?-1!==n&&s>=n?{done:i,results:r}:this.optimizedFetch(e,r,s):{done:i,results:r}}))}}})),define("vb/private/types/disconnectedServiceDataProvider",["vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/noOpFetchByKeys","vb/private/types/capabilities/noOpFetchFirst","vb/private/types/capabilities/noOpFetchByOffset","vb/private/types/capabilities/fetchByOffsetIteration"],((e,t,i,r)=>class{constructor(e){this.sdp=e,this.id=e.id,this.log=e.log}callActionChain(e,t={},i){this.log.info("Unable to call action chain",e,"with params",t,"because the ServiceDataProvider instance",this.id,"has been disposed")}isDisconnected(){return!0}getLifecycleStageChangedSignal(){return this.sdp.getLifecycleStageChangedSignal()}addEventListener(e,t){this.log.info("Unable to add event listener",e,"because the ServiceDataProvider variable",this.id,"has been disposed")}removeEventListener(e,t){this.log.info("Unable to remove event listener",e,"because the ServiceDataProvider variable",this.id,"has been disposed")}removeAllEventListeners(){this.log.info("Unable to remove all event listeners because the ServiceDataProvider variable",this.id,"has been disposed")}fetchFirst(e){return new i(e).fetchFirst()}fetchByKeys(e){return new t(e).fetchByKeys()}containsKeys(e){return new t(e).containsKeys()}fetchByOffset(e){return new r(e).fetchByOffset()}getCapability(e){return null}getInternalState(e){this.log.info("Unable to get internalState",e,"because the ServiceDataProvider variable",this.id,"has been disposed")}getIdAttributeProperty(){return this.sdp.getIdAttributeProperty()}getTotalSize(){return Promise.resolve(e.DEFAULT_TOTAL_SIZE)}getValue(){}invokeEvent(e,t,i=!0){this.log.info("Unable to fire event",e,"with payload",t,"because the ServiceDataProvider instance",this.id,"has been disposed!")}isEmpty(){return"unknown"}setTotalSize(e){this.totalSize=e}setInternalState(e,t){this.log.info("Unable to set internalState",e,"to value",t,"because the ServiceDataProvider instance",this.id,"has been disposed")}})),define("vb/types/eventTargetMixin",[],(()=>e=>class extends e{addEventListener(e,t){this._eventListeners||(this._eventListeners=[]),this._eventListeners.push({type:e.toLowerCase(),listener:t})}removeEventListener(e,t){this._eventListeners&&this._eventListeners.forEach(((i,r)=>{i.type===e&&i.listener===t&&this._eventListeners.splice(r,1)}))}removeAllEventListeners(){this._eventListeners=null}dispatchEvent(e){if(this._eventListeners){let t;this._eventListeners.forEach((i=>i.type!==e.type||(t=i.listener.apply(this,[e]),!1!==t)))}return!0}})),define("vb/private/types/capabilities/fetchByKeysUtils",["vb/private/log","vb/private/constants","vb/private/utils","vb/private/types/dataProviderConstants","vb/private/types/utils/dataProviderUtils","vb/private/types/capabilities/fetchContext"],((e,t,i,r,n,s)=>{const a=["attributes","keys"],o="keys";class c{constructor(e){this.key=e}}class l{constructor(e,t){this.data=e,this.metadata=t}}class h{constructor(e,t){this.fetchParameters=e,this.results=t}}const p=function(e){return e[r.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION]===r.CapabilityValues.FETCH_BY_KEYS_IMPLEMENTATION_LOOKUP};class u{static whiteListFetchOptions(e,t){let i;return t&&(i={},a.forEach((n=>{const s=t[n];if(void 0!==s){const t=e.getCapability(r.CapabilityType.FETCH_BY_KEYS);n===o&&(t&&(p(t)||function(e){return e[r.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION]===r.CapabilityValues.FETCH_BY_KEYS_IMPLEMENTATION_ITERATION}(t))&&(!s||s&&Array.isArray(s)&&0===s.length)&&e.log.error("FetchByKeys called on ServiceDataProvider",e.id,"with no keys when the SDP variable is configured with a fetchByKeys capability","and a lookup based implementation"),t&&p(t)&&!function(e){return!0===e[r.CapabilityKeys.FETCH_BY_KEYS_MULTI_KEY_LOOKUP]}(t)&&s&&Array.isArray(s)&&s.length>1&&e.log.warn("FetchByKeys called on ServiceDataProvider",e.id,"that only allows single key lookup")),i[n]=s}}))),i}static buildFetchResult(e,t){const i=t.body,{itemsPath:r}=e.sdpState.value,s=e.fetchOptions,a=new Map,o=function(t){if(t){const i=u.getItemMetadata(e,t);if(i){const e=new l(t,i);a.set(i.key,e)}}},c=n.getObjectByPath(i,r);return c&&Array.isArray(c)?c.forEach((e=>{o(e)})):o(c),new h(s,a)}static getItemMetadata(e,t){const{sdpState:i}=e,{sdp:s}=e,a=i.value[s.getIdAttributeProperty()],o=e.fetchOptions,l=n.getIdAttributeHelper(a),h=l.getKey(t);if(h){let e=!1;const t=o.keys.values();let i;do{i=t.next().value,e=l.compare(i,h)}while(!e&&i);if(i)return new c(i)}return l.idAttr!==r.DataProviderIdAttribute.AT_INDEX?e.log.warn("Either keyAttributes was not set or item does not have key values that can be used to"," construct the key value using the keyAttributes!"):e.log.warn("keyAttributes is set to @index which cannot be used as a key to fetch data!"),null}static getPaginateOptions(e){const{sdpState:t}=e,i=e.fetchOptions||{},r=t.value;let n,a;if(s.usePropValue("pagingCriteria",r)){const e=r.pagingCriteria||{};n=e.offset,a=e.size}let o=i.size>=-1?i.size:a,c=i.offset>=0?i.offset:n;(0===o||o||0===c||c)&&(o=o>=-1?o:s.DEFAULT_SIZE,c=c>=0?c:s.DEFAULT_OFFSET);return{offset:c,size:o}}static reconcileTransformOptions(e,t,i){let r,n,a;const o=i,c=e.paginate,l=t.paginate;return c.size||0===c.size||(n=l&&l.size),c.offset||0===c.offset||(a=l&&l.offset),(0===n||n||0===a||a)&&(r=r||{},r.size=n>=-1?n:s.DEFAULT_SIZE,r.offset=a>=0?a:s.DEFAULT_OFFSET),r&&(o.paginate=r),o}}return u})),define("vb/private/types/capabilities/fetchByKeys",["vb/private/log","vb/private/constants","vb/private/types/dataProviderConstants","vb/private/utils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeysUtils","vbc/private/monitorOptions"],((e,t,i,r,n,s,a)=>{const o="lookup";return class extends n{whiteListFetchOptions(e){return s.whiteListFetchOptions(this.sdp,e)}getFetchCapability(){return i.CapabilityType.FETCH_BY_KEYS}fetch(){const e=`${this.sdp.id} [${this.id}]`,t=this.sdp.getCapability("fetchByKeys");if(t&&t.implementation===o){if(t.multiKeyLookup&&t.multiKeyLookup===i.CapabilityValues.FETCH_BY_KEYS_MULTI_KEY_LOOKUP_YES)return this.fetchByKeysLookup();const r=`ServiceDataProvider ${e}: FetchByKeys implementation called with multiple keys when the capability only supports fetching by a single key at a time`;return this.log.error(r),Promise.reject(r)}const r=`ServiceDataProvider ${e}: FetchByKeys lookup based implementation cannot be used for iteration based implementation! Check your configuration!`;return this.log.error(r),Promise.reject(r)}fetchByKeysLookup(){return Promise.resolve().then((()=>{const{sdp:e}=this,{fetchOptions:i}=this,r=`${this.sdp.id} [${this.id}]`;e.log.startFetch("ServiceDataProvider",r,"fetchByKeys called with options",JSON.stringify(i),"and state:",this.sdpState);const n=new a(a.SPAN_NAMES.SDP_FETCH_BY_KEYS,r);return e.log.monitor(n,(i=>this.fetchForReal().then((t=>{const n=s.buildFetchResult(this,t);return e.log.endFetch("ServiceDataProvider",r,"fetchByKeys succeeded with result:",n,i()),n})).catch((n=>{throw e.log.endFetch("ServiceDataProvider",r,"fetchByKeys failed with error:",n,i(n)),this.invokeNotificationEvent(t.MessageType.ERROR,n),n}))))}))}fetchForReal(){return super.fetch()}getPaginateOptions(){return s.getPaginateOptions(this)}reconcileTransformOptions(e,t){const i=super.reconcileTransformOptions(e,t);return s.reconcileTransformOptions(e,t,i)}}})),define("vb/private/types/capabilities/fetchByKeysIteration",["vb/private/log","vb/private/constants","vb/private/types/dataProviderConstants","vb/private/utils","vb/private/types/utils/dataProviderUtils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeysUtils","vb/private/types/capabilities/fetchFirst","vbc/private/monitorOptions"],((e,t,i,r,n,s,a,o,c)=>{const l="iteration";return class extends o{whiteListFetchOptions(e){return a.whiteListFetchOptions(this.sdp,e)}getFetchCapability(){return i.CapabilityType.FETCH_BY_KEYS}getPaginateOptionsSize(){const e=this.fetchOptions||{},t=this.sdpState.value;let i,r;if(s.usePropValue("pagingCriteria",t)){i=(t.pagingCriteria||{}).maxSize||1e3}return r=void 0===e.size||null===e.size||-1===e.size?i:super.getPaginateOptionsSize(),r}reconcilePaginateOptionsSize(e,t){let i;const r=e,n=t;return(!r.size&&0!==r.size||r&&-1===r.size&&n.maxSize)&&(i=n&&n.maxSize&&n.maxSize>=0?n.maxSize:1e3),i}fetch(){const e=`${this.sdp.id} [${this.id}]`,t=this.sdp.getCapability("fetchByKeys");if(t&&t.implementation===l)return Promise.resolve().then((()=>{const{sdp:t}=this,{fetchOptions:i}=this;t.log.startFetch("ServiceDataProvider",e,"fetchByKeys called with options",i,"and state :",this.sdpState);const r=new c(c.SPAN_NAMES.SDP_FETCH_BY_KEYS_ITERATION,e);return t.log.monitor(r,(i=>{const r=super.fetch()[Symbol.asyncIterator]();return this.fetchKeysByIteration(r).then((r=>{const n=new Map;r.forEach(((e,t)=>{const i=[e];n.set(t,i[0])}));const s={fetchParameters:this.getFetchOptionsForResponse(),results:n};return t.log.endFetch("ServiceDataProvider",e,"fetchByKeys using iteration succeeded with result:",s,i()),s})).catch((r=>{throw t.log.endFetch("ServiceDataProvider",e,"fetchByKeys using iteration failed with error:",r,i(r)),r}))}))}));const i=`ServiceDataProvider ${e}: FetchByKeys lookup based implementation cannot be used for iteration based implementation! Check your configuration!`;return this.log.error(i),Promise.reject(i)}fetchKeysByIteration(e,t,i){const r=`${this.sdp.id} [${this.id}]`,s=t||new Map;let a,o=i||0;const{fetchOptions:c}=this;let l=!1;const h=c&&c.keys;return h&&h instanceof Set&&(l=h.has("")||h.has(null)||h.has(void 0),l&&this.log.warn("ServiceDataProvider",r,": fetchByKeys using iteration called with empty keys",h,". Check to make sure that this is a valid key that returns data!")),e.next().then((t=>{let i=!0;a=a||this.getIterationLimit();const{value:r}=t,{data:c}=r,{metadata:l}=r,p=l.map((function(e){return e.key}));return h.forEach((e=>{s.has(e)||p.forEach(((t,i)=>{const r=this.sdpState.value[this.sdp.getIdAttributeProperty()];if(n.getIdAttributeHelper(r).compare(t,e)){const t=l[i];t.fixupKey(e),s.set(e,{metadata:t,data:c[i]})}})),s.has(e)||(i=!1)})),o+=c.length,i||t.done||-1!==a&&o>=a?s:this.fetchKeysByIteration(e,s,o)}))}}})),define("vb/private/types/capabilities/fetchBySingleKey",["vb/private/log","vb/private/constants","vb/private/types/dataProviderConstants","vb/private/utils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeysUtils","vb/private/types/capabilities/noOpFetchByKeys","vbc/private/monitorOptions","jsondiff"],((e,t,i,r,n,s,a,o,c)=>{const l=e=>e&&(e instanceof Set?e.size:e.length);class h extends n{whiteListFetchOptions(e){return s.whiteListFetchOptions(this.sdp,e)}getFetchCapability(){return i.CapabilityType.FETCH_BY_KEYS}fetch(){const e=this.fetchOptions&&this.fetchOptions.keys||[],t=l(e);if(t>1)return this.log.info("FetchByKeys using lookup is called with multiple keys",e,"when capability only supports fetching by a single key at a time."),this.fetchByMultipleKeys();if(0===t){const e=`${this.sdp.id} [${this.id}]`;return this.log.error("FetchByKeys called with an empty set of keys; using a noop FetchByKeys","implementation. Please check the ServiceDataProvider",e,"configuration"),new a(this.fetchOptions).fetchByKeys()}return this.fetchBySingleKey()}fetchByMultipleKeys(){return Promise.resolve().then((()=>{const{sdp:e}=this,i=this.fetchOptions&&this.fetchOptions.keys||[],n={},s=[],a=`${this.sdp.id} [${this.id}]`;e.log.startFetch("ServiceDataProvider",a,"fetchByKeys called with options",this.fetchOptions,"and state:",this.sdpState);const c=new o(o.SPAN_NAMES.SDP_FETCH_BY_SINGLE_KEY,a);return e.log.monitor(c,(o=>(i.forEach((e=>{const t=r.cloneObject(this.fetchOptions);t.keys=new Set([e]);const i=new h(this.sdp,t);s.push(i.fetchForReal())})),Promise.all(s).then((t=>(n.fetchParameters=this.getFetchOptionsForResponse(),n.results=new Map,t.forEach((e=>{e.results.forEach(((e,t)=>{n.results.set(t,e)}))})),e.log.endFetch("ServiceDataProvider",a,"fetchByKeys succeeded with result:",n,o()),n))).catch((i=>{throw e.log.endFetch("ServiceDataProvider",a,"fetchByKeys failed with error:",i,o(i)),this.invokeNotificationEvent(t.MessageType.ERROR,i),i})))))}))}fetchBySingleKey(){return this.fetchForReal().catch((e=>{throw this.invokeNotificationEvent(t.MessageType.ERROR,e),e}))}fetchForReal(){return Promise.resolve().then((()=>{const{sdp:e}=this,{fetchOptions:t}=this,i=`${e.id} [${this.id}]`;e.log.startFetch("ServiceDataProvider",i,"fetchByKeys called with options",t,"and state:",this.sdpState);const r=e.log.monitor();return super.fetch().then((t=>{const n=s.buildFetchResult(this,t);return e.log.endFetch("ServiceDataProvider",i,"fetchByKeys succeeded with result:",n,r()),n})).catch((t=>{throw e.log.endFetch("ServiceDataProvider",i,"fetchByKeys failed with error:",t,r()),t}))}))}getPaginateOptions(){return s.getPaginateOptions(this)}reconcileTransformOptions(e,t){const i=super.reconcileTransformOptions(e,t);return s.reconcileTransformOptions(e,t,i)}getQueryOptions(){const e=this.sdpState.value,t=e[this.sdp.getIdAttributeProperty()];let i,s;if(n.usePropValue("uriParameters",e))if(s=this._getKeysForFetchRequest(),s){const n=r.cloneObject(e.uriParameters);[n[t]]=s,i=n}else i=e.uriParameters;return i}_getKeysForFetchRequest(){const e=this.sdpState.value,t=e[this.sdp.getIdAttributeProperty()];let i;const r=this.fetchOptions&&this.fetchOptions.keys,s=l(r);if(n.usePropValue("uriParameters",e)&&s>0&&t&&"string"==typeof t){const n=e.uriParameters&&e.uriParameters[t];n&&(c.diff([n],r)&&this.log.fine("using the keys",r,"passed in via fetch call, instead of the value",n,"set on property uriParameters",t),i=r)}return i}}return h})),define("vb/private/types/capabilities/containsKeys",["vb/private/log","vb/private/types/dataProviderConstants","vb/private/utils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeysUtils","vb/private/types/capabilities/noOpFetchByKeys","vb/private/types/capabilities/fetchByKeys","vb/private/types/capabilities/fetchBySingleKey"],((e,t,i,r,n,s,a,o)=>{const c="lookup",l="iteration",h="keys",p="results";return class{constructor(e,t,n){this.fetchByKeysImpl=e,this.sdp=t,this.fetchOptions=n,this.log=r.LOGGER,this.id=i.generateUniqueId()}contains(){return Promise.resolve().then((()=>{const{sdp:e}=this,t=`${e.id} [${this.id}]`,i=e.getCapability("fetchByKeys");if(i&&(i.implementation===c||i.implementation===l)){const e=this.fetchByKeysImpl.sdpState;this.log.info("ServiceDataProvider",t,"containsKeys called with options",this.fetchOptions,"and state :",e);return this.fetchByKeysImpl.fetch().then((e=>{const i=this.buildContainsKeysResult(e);return this.log.info("ServiceDataProvider",t,"containsKeys returned:",i),i}))}return new s(this.fetchOptions).containsKeys()}))}buildContainsKeysResult(e){const t=new Set;return this.fetchOptions[h].forEach((i=>{null!=e[p].get(i)&&t.add(i)})),Promise.resolve({containsParameters:this.fetchByKeysImpl.getFetchOptionsForResponse(),results:t})}}})),define("vb/private/types/capabilities/fetchByOffset",["vb/private/log","vb/private/constants","vb/private/types/dataProviderConstants","vb/private/utils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByOffsetUtils","vb/types/typeUtils","vbc/private/monitorOptions"],((e,t,i,r,n,s,a,o)=>{const c="randomAccess",l=["attributes","size","offset","sortCriteria","filterCriterion"];return class extends n{whiteListFetchOptions(e){let t;return e&&(t={},l.forEach((i=>{void 0!==e[i]&&(t[i]=e[i])}))),t}getFetchCapability(){return i.CapabilityType.FETCH_BY_OFFSET}getPaginateOptions(){const e=this.getPaginateOptionsSize();return{offset:this.getPaginateOptionsOffset(),size:e,iterationLimit:this.getPaginateOptionsIterationLimit()}}getPaginateOptionsIterationLimit(){const e=this.sdpState.value;let t;if(n.usePropValue("pagingCriteria",e)){t=(e.pagingCriteria||{}).iterationLimit||-1}return t}getPaginateOptionsSize(){const e=this.fetchOptions||{},t=this.sdpState.value;let i,r,s;if(n.usePropValue("pagingCriteria",t)){const e=t.pagingCriteria||{};i=e.size||n.DEFAULT_SIZE,r=e.maxSize}return e.size>=0?({size:s}=e):s=-1===e.size?r||e.size:i,s}getPaginateOptionsOffset(){let e;const t=this.fetchOptions||{},i=this.sdpState.value;if(n.usePropValue("pagingCriteria",i)){e=(i.pagingCriteria||{}).offset||n.DEFAULT_OFFSET}let r;return t.offset>=0?({offset:r}=t):r=e,r}reconcileTransformOptions(e,t){const i=super.reconcileTransformOptions(e,t),r=e.paginate,n=t.paginate,s=this.reconcilePaginateOptions(r,n);return s&&(i.paginate=s),i}reconcilePaginateOptions(e,t){const i=e,r=function(e){return null==e},n=this.reconcilePaginateOptionsSize(e,t);r(n)||r(i.size)&&n===i.size||(i.size=n);const s=this.reconcilePaginateOptionsOffset(e,t);r(s)||r(i.offset)&&s===i.offset||(i.offset=s);const a=this.reconcilePaginateOptionsIterationLimit(e,t);return r(a)||r(i.iterationLimit)&&a===i.iterationLimit||(i.iterationLimit=a),i}reconcilePaginateOptionsSize(e,t){let i;const r=e,s=t;return r.size||0===r.size?-1===r.size&&s&&s.size&&s.maxSize&&(i=s.maxSize):i=s&&s.size&&s.size>=0?s.size:n.DEFAULT_SIZE,i}reconcilePaginateOptionsOffset(e,t){let i;const r=e,s=t;return r.offset||0===r.offset||(i=s&&s.offset>=0?s.offset:n.DEFAULT_OFFSET),i}reconcilePaginateOptionsIterationLimit(e,t){let i;const r=t;return e.iterationLimit||(i=r&&r.iterationLimit>0?r.iterationLimit:-1),i}fetch(){const e=`${this.sdp.id} [${this.id}]`,i=this.sdp.getCapability("fetchByOffset");if(i&&i.implementation===c)return Promise.resolve().then((()=>{const{sdp:i}=this,{fetchOptions:r}=this;i.log.startFetch("ServiceDataProvider",e,"fetchByOffset called with options",JSON.stringify(r),"and state:",this.sdpState);const n=new o(o.SPAN_NAMES.SDP_FETCH_BY_OFFSET,e);return i.log.monitor(n,(r=>this.fetchForReal().then((t=>{const n=s.buildFetchResult(this,t);return i.log.endFetch("ServiceDataProvider",e,"fetchByOffset succeeded with result:",n,r()),this.clearInternalState(),n})).catch((n=>{throw i.log.endFetch("ServiceDataProvider",e,"fetchByOffset failed with error:",n,r(n)),this.clearInternalState(),this.invokeNotificationEvent(t.MessageType.ERROR,n),n}))))}));const r=`ServiceDataProvider ${e}: FetchByOffset randomAccess based implementation cannot be used as an iteration based implementation! Check your configuration!`;return this.log.error(r),Promise.reject(r)}fetchForReal(){return super.fetch()}processResponseTransforms(e){e&&Object.keys(e).length>0&&Object.keys(n.RESPONSE_TRANSFORM_TYPE).forEach((t=>{const i=n.RESPONSE_TRANSFORM_TYPE[t];this.setInternalState(i,e[i])}));const t=this.totalSize();return this.sdp.getTotalSize().then((e=>{t!==e&&(this.sdp.totalSize=t)}))}clearInternalState(){const e=`${this.id}`,t=Object.assign({},this.internalState);a.setPropertyValue(t,e,void 0),this.internalState=t,this.log.finer("iterator",this.id,"clears internal state on SDP:",this.sdp.id,"with key:",e)}hasMore(){const e=this.getInternalState(n.RESPONSE_TRANSFORM_TYPE.PAGINATE),t=e&&e.hasMore;return"boolean"==typeof t?t:void 0}totalSize(){const e=this.getInternalState(n.RESPONSE_TRANSFORM_TYPE.PAGINATE);return e&&e.totalSize||n.DEFAULT_TOTAL_SIZE}}})),define("vb/private/types/dataProviders/serviceDataProviderUtils",["knockout","vb/private/types/dataProviderConstants","vb/private/types/utils/dataProviderUtils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeys","vb/private/types/capabilities/fetchByKeysIteration","vb/private/types/capabilities/fetchBySingleKey","vb/private/types/capabilities/containsKeys","vb/private/types/capabilities/fetchByOffset","vb/private/types/capabilities/fetchByOffsetIteration"],((e,t,i,r,n,s,a,o,c,l)=>{class h{static getCapabilityByFeature(e,i){let r=null;switch(e){case t.CapabilityType.SORT:r={},i&&i.attributes?r.attributes=i.attributes:r.attributes=t.CapabilityValues.SORT_ATTRIBUTES_MULTIPLE;break;case t.CapabilityType.FILTER:r={},r.operators=i&&i.operators&&i.operators.length>0?i.operators:t.CapabilityValues.FILTER_OPERATORS_OPS,r.textFilter={};break;case t.CapabilityType.FETCH_FIRST:r={},r[t.CapabilityKeys.FETCH_FIRST_IMPLEMENTATION]=i&&i[t.CapabilityKeys.FETCH_FIRST_IMPLEMENTATION]||t.CapabilityValues.FETCH_FIRST_IMPLEMENTATION_ITERATION,r[t.CapabilityKeys.FETCH_FIRST_ITERATE_AFTER_DONE]=t.CapabilityValues.FETCH_FIRST_ITERATE_AFTER_DONE_NOT_ALLOWED;break;case t.CapabilityType.FETCH_BY_KEYS:{r={};const e=i&&i[t.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION],n=i&&i[t.CapabilityKeys.FETCH_BY_KEYS_MULTI_KEY_LOOKUP];i&&e?(r[t.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION]=e,e===t.CapabilityValues.FETCH_BY_KEYS_IMPLEMENTATION_LOOKUP&&(r[t.CapabilityKeys.FETCH_BY_KEYS_MULTI_KEY_LOOKUP]=n||t.CapabilityValues.FETCH_BY_KEYS_MULTI_KEY_LOOKUP_YES)):r[t.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION]=t.CapabilityValues.FETCH_BY_KEYS_IMPLEMENTATION_ITERATION;break}case t.CapabilityType.FETCH_BY_OFFSET:r={},r[t.CapabilityKeys.FETCH_BY_OFFSET_IMPLEMENTATION]=i&&i[t.CapabilityKeys.FETCH_BY_OFFSET_IMPLEMENTATION]||t.CapabilityValues.FETCH_BY_OFFSET_IMPLEMENTATION_ITERATION;break;default:r=null}return r}static getConfiguredFetchCapabilities(r){let n;const s=[t.CapabilityType.FETCH_BY_OFFSET,t.CapabilityType.FETCH_BY_KEYS,t.CapabilityType.FETCH_FIRST],a=i.unwrapData(r);return s.forEach((t=>{if(a[t]){const i=(t=>{let i=t;return e.isObservable(i)&&(i=e.utils.unwrapObservable(t)),i})(a[t]);n=n||{},n[t]=i}})),n}static getResolvedFetchCapabilities(e){let i;return[t.CapabilityType.FETCH_BY_OFFSET,t.CapabilityType.FETCH_BY_KEYS,t.CapabilityType.FETCH_FIRST].forEach((t=>{const r=e[t];i=i||{},i[t]=h.getCapabilityByFeature(t,r)})),i}static hasMultipleFetchCapabilities(e){const i=e&&function(e){const i=t.CapabilityType.FETCH_FIRST;return e[i]&&e[i][t.CapabilityKeys.FETCH_FIRST_IMPLEMENTATION]?1:0}(e)|function(e){const i=t.CapabilityType.FETCH_BY_KEYS;return e[i]&&e[i][t.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION]?2:0}(e)|function(e){const i=t.CapabilityType.FETCH_BY_OFFSET;return e[i]&&e[i][t.CapabilityKeys.FETCH_BY_OFFSET_IMPLEMENTATION]?4:0}(e)||0;return 0!==i&&!(1===i||2===i||4===i)}static initFetchByKeysMethods(e,i){const r=e;let n=!0;if(i&&i[t.CapabilityType.FETCH_BY_KEYS]){const e=i[t.CapabilityType.FETCH_BY_KEYS];h.isImplementationLookup(e)&&(h.initFetchByKeysLookupMethods(r,e),n=!1)}n&&void 0===r.fetchByKeys&&(r.log.fine("ServiceDataProvider",r.id,"using non-optimized fetchFirst implementation for fetchByKeys,","because a lookup based implementation was not provided!"),h.initFetchByKeysIterationMethods(r))}static initFetchByKeysLookupMethods(e,t){const i=e;void 0===i.fetchByKeys&&(i.fetchByKeys=function(e){return h.isMultiKeyLookupAllowed(t)?new n(i,e).fetch():new a(i,e).fetch()},i.containsKeys=function(e){let r;return r=h.isMultiKeyLookupAllowed(t)?new n(i,e):new a(i,e),new o(r,i,e).contains()})}static initFetchByKeysIterationMethods(e){const t=e;void 0===t.fetchByKeys&&(t.fetchByKeys=function(e){return new s(t,e).fetch()},t.containsKeys=function(e){const i=new s(t,e);return new o(i,t,e).contains()})}static initFetchByOffsetMethods(e,i){const r=e;let n=!0;if(i&&i[t.CapabilityType.FETCH_BY_OFFSET]){const e=i[t.CapabilityType.FETCH_BY_OFFSET];h.isImplementationRandomAccess(e)&&(h.initFetchByOffsetRandomAccess(r),n=!1)}n&&void 0===r.fetchByOffset&&(r.log.fine("ServiceDataProvider",r.id,"using non-optimized fetchFirst implementation for fetchByOffset, because a randomAccess based implementation was not provided!"),h.initFetchByOffsetIteration(r))}static initFetchByOffsetRandomAccess(e){const t=e;void 0===t.fetchByOffset&&(t.fetchByOffset=function(e){return new c(t,e).fetch()})}static initFetchByOffsetIteration(e){const t=e;void 0===t.fetchByOffset&&(t.fetchByOffset=function(e){return new l(t,e).fetch()})}static isImplementationLookup(e){return e[t.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION]===t.CapabilityValues.FETCH_BY_KEYS_IMPLEMENTATION_LOOKUP}static isImplementationRandomAccess(e){return e[t.CapabilityKeys.FETCH_BY_OFFSET_IMPLEMENTATION]===t.CapabilityValues.FETCH_BY_OFFSET_IMPLEMENTATION_RANDOM_ACCESS}static isMultiKeyLookupAllowed(e){return e[t.CapabilityKeys.FETCH_BY_KEYS_MULTI_KEY_LOOKUP]===t.CapabilityValues.FETCH_BY_KEYS_MULTI_KEY_LOOKUP_YES}static isServiceDataProviderInstanceValid(e){const t=["endpoint","idAttribute"],i=["fetchChainId","idAttribute"],r=e&&e.getDefinitionValue()||{};if(r){const e=[],n=[];if(t.forEach((t=>{r[t]&&e.push(t)})),0===e.length&&i.forEach((e=>{r[e]&&n.push(e)})),e.length>0||n.length>0)return!0}return!1}static getTotalSize(e){return"number"==typeof e&&e>=0?e:r.DEFAULT_TOTAL_SIZE}}return h})),define("vb/private/types/serviceDataProvider",["ojs/ojdataprovider","vb/private/constants","vb/private/log","vbc/private/logConfig","vb/private/types/disconnectedServiceDataProvider","vb/helpers/mixin","vb/private/types/builtinExtendedTypeMixin","vb/types/eventTargetMixin","vb/private/utils","vb/private/types/dataProviders/serviceDataProviderUtils","vb/private/types/dataProviderConstants","vb/private/types/utils/dataProviderUtils","vb/private/stateManagement/stateUtils","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeys","vb/private/types/capabilities/fetchByKeysIteration","vb/private/types/capabilities/fetchBySingleKey","vb/private/types/capabilities/fetchFirst","vb/private/types/capabilities/fetchByKeysUtils","vb/private/types/capabilities/containsKeys","vb/private/types/capabilities/fetchByOffset","vb/private/types/capabilities/fetchByOffsetIteration","signals"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v,f,m,b,y,E,P,x)=>{const T=i.getLogger("/vb/types/ServiceDataProvider",[{name:"startFetch",severity:t.Severity.INFO,style:r.FancyStyleByFeature.serviceDataProviderStart},{name:"endFetch",severity:t.Severity.INFO,style:r.FancyStyleByFeature.serviceDataProviderEnd}]);class A extends(s().with(o,a)){constructor(){super(),this.log=T,this.variableLifecycleStage=void 0,this.variableLifecycleStageChanged=new x.Signal}getLifecycleStageChangedSignal(){return this.variableLifecycleStageChanged}init(e,i,r,n){super.init(e,i,r),this.definition=i,this.variableLifecycleStage=t.VariableLifecycleStage.INIT,this.variableLifecycleStageChanged.dispatch(t.VariableLifecycleStage.INIT),this.container=n}activate(){if(this.variableLifecycleStage===t.VariableLifecycleStage.ACTIVE)return void this.log.fine("skipping activation for variable",this.id,"because it is already active");const e=this.getValue(),i=e&&e.capabilities||{},r=l.getConfiguredFetchCapabilities(i,e)||{};if(l.hasMultipleFetchCapabilities(r))return void this.log.error("ServiceDataProvider",this.getId(),"is configured with multiple fetch capabilities when only one should be used!");const n=l.getResolvedFetchCapabilities(r);l.initFetchByKeysMethods(this,n),l.initFetchByOffsetMethods(this,n);const s=e.idAttribute,a=e.keyAttributes;this.useKeyAttributes=!0,a&&s?this.log.warn("The property 'idAttribute' with value '",s,"is ignored as the property 'keyAttributes'","is also configured for the ServiceDataProvider",this.id,". 'idAttribute' is deprecated and will be removed in future releases.","Use 'keyAttributes' instead."):s&&(this.log.warn("The property 'idAttribute' is deprecated and will be removed in","future releases. Use the 'keyAttributes' property instead in the configuration","for ServiceDataProvider",this.id),this.useKeyAttributes=!1),this.variableLifecycleStage=t.VariableLifecycleStage.ACTIVE,this.variableLifecycleStageChanged.dispatch(t.VariableLifecycleStage.ACTIVE)}dispose(){this.variableLifecycleStage=t.VariableLifecycleStage.DISPOSE,this.variableLifecycleStageChanged.dispatch(t.VariableLifecycleStage.DISPOSE,new n(this)),this.removeAllEventListeners()}isDisconnected(){return this.variableLifecycleStage===t.VariableLifecycleStage.DISPOSE}getDefinitionValue(){return this.definition.defaultValue}getIdAttributeProperty(){return this.useKeyAttributes?h.DataProviderIdAttributeProperty.KEY_ATTRIBUTES:h.DataProviderIdAttributeProperty.ID_ATTRIBUTE}fetchFirst(e){const t=new m(this,e);return this.log.finer("iterator",t.id,"created for fetchFirst() on SDP:",this.getId()),t.fetch()}_fireEvent(t){switch(t){case h.DataProviderEvent.REFRESH:try{this.dispatchEvent(new e.DataProviderRefreshEvent)}catch(e){const t=`unable to refresh data provider due to error ${e}`;throw this.log.error(t),t}break;case h.DataProviderMutationEvent.ADD:case h.DataProviderMutationEvent.UPDATE:case h.DataProviderMutationEvent.REMOVE:default:{const e=`unable to trigger event of type ${t}`;throw this.log.error(e),e}}}getCapability(e){const t=this.getValue()&&this.getValue().capabilities||{},i=this.definition.defaultValue&&this.definition.defaultValue.capabilities||{},r=Object.assign({},i,t)[e];return l.getCapabilityByFeature(e,r)}getTotalSize(){return Promise.resolve(l.getTotalSize(this.getValue().totalSize))}isEmpty(){const e=this.getValue().totalSize;return void 0===e||-1===e?h.DataProviderIsEmptyValues.UNKNOWN:0===e?h.DataProviderIsEmptyValues.YES:h.DataProviderIsEmptyValues.NO}setTotalSize(e){this.getValue().totalSize=e}handlePropertyVariableChangeEvent(e){const{oldValue:t}=e,{value:i}=e,{id:r}=this;if(e.name.endsWith("internalState"))this.log.finer("ServiceDataProvider",r,"change event ignored for internalState change:",JSON.stringify(e.diff,null,2));else if(e.diff){const n=Object.keys(e.diff);if(1===n.length&&"totalSize"===n[0])return;n.forEach((e=>{e&&this.log.finer("ServiceDataProvider",r,"change event dispatches 'refresh' event for property",e,"from old:",t[e],"to new",i[e])}),this),this._fireEvent(h.DataProviderEvent.REFRESH)}}getTypeDefinition(e,t){let i="any";if(e.defaultValue&&e.defaultValue.responseType){const{responseType:t}=e.defaultValue;"string"==typeof t&&(i=`${t}`)}const r=e.defaultValue&&e.defaultValue.filterCriteria;return r&&("string"==typeof r||Array.isArray(r)&&r.length>0)&&this.log.warn("ServiceDataProvider property filterCriteria has been deprecated. Use","filterCriterion instead."),{type:{body:"any",endpoint:"string",headers:"object",itemsPath:"string",idAttribute:"any",keyAttributes:"any",transformsContext:"object",uriParameters:"object",fetchChainId:"string",fetchChain:"string",responseType:u.getType(`${this.getId()}:${i}`,{type:i},t),pagingCriteria:{offset:"number",size:"number",maxSize:"number",iterationLimit:"number"},sortCriteria:[{attribute:"string",direction:"string"}],filterCriteria:[{attribute:"string",op:"string",value:"string"}],filterCriterion:"any",capabilities:{sort:{attributes:"string"},filter:{operators:"string[]",textFilter:"any"},fetchByKeys:{implementation:"string",multiKeyLookup:"string"},fetchByOffset:{implementation:"string"},fetchFirst:{implementation:"string"}},mergeTransformOptions:"string",totalSize:"number",transforms:{request:{paginate:"string",query:"string",filter:"string",sort:"string",select:"string",body:"string"},response:{paginate:"string",body:"string"}}},resolved:!0}}}return A})),define("vb/extensions/process/private/types/processDataProvider",["vb/extensions/process/helpers/processService","vb/private/types/serviceDataProvider"],((e,t)=>{const i=(e,t,i)=>{const r=e.indexOf("?")>0?"&":"?";return e.indexOf(`${t}=`)<0?`${e}${r}${t}=${i}`:e},r=(e,t)=>{let r=e.url;return r=i(r,"limit",t.size),r=i(r,"offset",t.offset),e.url=r,e},n=e=>{const t={},i=e.body;return i&&(i.totalResults&&(t.totalSize=i.totalResults),t.hasMore=!!i.hasMore),t},s=(e,t,i,s,a)=>{e&&e.defaultValue&&!e.defaultValue.responseType&&(e.defaultValue.responseType=s),t.endpoint=t.endpoint||i,t.itemsPath=t.itemsPath||"items",t.idAttribute=t.idAttribute||"id",t.responseType=t.responseType||s,Object.assign(t.uriParameters,t.parameters),!0!==a&&(t.transforms.request.paginate=t.transforms.request.paginate||r),t.transforms.response.paginate=t.transforms.response.paginate||n};return class extends t{init(t,i,r){switch(r.objectType){case"deployedProcess":s(i,r,e.endpoint.deployedProcessCollection,e.definition.extendedDeployedProcessCollection,!0);break;case"processInstance":s(i,r,e.endpoint.processInstanceCollection,e.definition.processInstanceCollection);break;case"task":s(i,r,e.endpoint.taskCollection,e.definition.taskCollection)}super.init(t,i,r),this.definition=i}getTypeDefinition(e){const t=super.getTypeDefinition(e);return t.type.objectType="string",t.type.parameters="object",t}}})),define("vb/extensions/protocol/vbExtensionHandler",["vb/private/utils","vb/private/constants"],((e,t)=>{const i=(t,i,r)=>({namespace:r,type:"vb-extension",name:t,extensions:{},url:e.removeTrailingSlash(i)});class r{constructor(e,t,i){this.config=e||{},this.initConfig=this.config.initConfig||{},this.applicationPath=r.appendSegments(this.initConfig.VB_SERVER,this.initConfig.CONTEXT_ROOT,this.initConfig.APP_URL_PREFIX,this.initConfig.APP_ID,t?`${this.initConfig.APP_VERSION};profile=${encodeURIComponent(t)}`:this.initConfig.APP_VERSION),i&&(this.idcsPath=i.idcsInfo&&i.idcsInfo.hostName)}dispose(){}static shouldInstall(){return!0}getResolvedObject(e,t,n){return Promise.resolve().then((()=>{const e=n.hostname;switch(e){case"tenant":if(this.idcsPath&&n.path&&n.path.startsWith("/idcs")){const s=r.appendToPath(this.idcsPath,n.path.substring(5));return i(e,s,t)}return null;case"application":{const s=r.appendToPath(this.applicationPath,n.path);return i(e,s,t)}default:return null}}))}static _createProtocolObject(e,t,r){return i(e,t,r)}static appendToPath(i=t.PATH_SEPARATOR,r){return r?(i=e.removeTrailingSlash(i),r.startsWith(t.PATH_SEPARATOR)&&(r=r.substring(1)),i+t.PATH_SEPARATOR+r):i}static appendSegments(...e){return e.length>0?e.reduce(((e,t)=>r.appendToPath(e,t))):void 0}}return r.PROTOCOLS=["vb-extension"],r})),define("vb/helpers/bootstrapRest",["vb/helpers/rest","vb/private/configLoader"],((e,t)=>{class i extends e{static get(e){return new i(e)}_getEndpointProvider(){return Promise.resolve({getEndpoint:e=>t.getServices().then((t=>t.getEndpoint(e)))})}}return i})),define("vb/helpers/extendedTypeHandler",[],(()=>class{getType(e,t){return e}invokeEvent(e,t){return Promise.resolve()}})),define("vb/helpers/securityHelpers",["vb/private/stateManagement/application","vb/private/utils"],((e,t)=>class{static securityCallback(t){return e.securityProvider.securityCallback(t)}static getDefaultServiceWorkerPluginsForVbEnvironment(){return Promise.resolve().then((()=>(window.vbInitConfig||{}).VB_SERVER?t.getResource("vb/private/types/defaultSecurityProvider").then((t=>{const i=e.securityProvider;if(i){const e=new t,r=i.config||{};return e.idcsInfo=r.idcsInfo||{},e.getServiceWorkerPlugins(r,!i.userInfo.isAuthenticated)}return[]})):[]))}static getImplicitFlowAccessToken(t){return Promise.resolve().then((()=>{const{securityProvider:i}=e,{idcsInfo:r}=i;if(!r||!r.hostName)return null;if("function"==typeof i.vbRefreshImplicitFlowAccessToken)return i.vbRefreshImplicitFlowAccessToken(t);throw new Error("Unsupported method for the current security provider")}))}static getImplicitFlowAllowedScopes(){const{securityProvider:t}=e,{idcsInfo:i}=t;return i&&i.allowedScopes?i.allowedScopes:[]}})),define("vb/private/stateManagement/context/actionChainContext",["vb/private/stateManagement/context/containerContext","vb/private/constants"],((e,t)=>{const i=Symbol("chain-accesssor");class r{constructor(e){Object.defineProperty(this,i,{value:{chain:e,scope:e.scope}})}get[t.VariableNamespace.VARIABLES](){return this[i].scope.variableNamespaces.variables}get[t.VariableNamespace.METADATA](){return this[i].scope.variableNamespaces.metadata}get[t.VariableNamespace.CONSTANTS](){return this[i].scope.variableNamespaces.constants}get results(){return this[t.VariableNamespace.VARIABLES][t.RESULTS_VARIABLE_KEY]}getVariable(...e){return this[i].scope.getVariable(...e)}static getAvailableContexts(t,i={}){const r=e.cloneContext.bind(i)();return Object.defineProperties(r,{$chain:{enumerable:!0,configurable:!0,value:t.expressionContext},$variables:{enumerable:!0,configurable:!0,value:t.expressionContext.variables},$metadata:{enumerable:!0,configurable:!0,value:t.expressionContext.metadata},$constants:{enumerable:!0,configurable:!0,value:t.expressionContext.constants}}),r}}return r})),define("vb/private/action/actionChain",["vb/private/action/actionChainUtils","vb/action/action","vb/private/stateManagement/scope","vb/private/stateManagement/redux/storeManager","vb/private/stateManagement/stateUtils","vb/private/utils","vb/private/stateManagement/context/actionChainContext","vb/private/log","vbc/private/logConfig","vb/private/constants","vb/private/action/assignmentHelper","vb/private/debug/actionChainDebugStream","vbc/private/monitorOptions"],((e,t,i,r,n,s,a,o,c,l,h,p,u)=>{const d=o.getLogger("/vb/action/actionChain",[{name:"startChain",severity:l.Severity.INFO,style:c.FancyStyleByFeature.actionChainStart},{name:"endChain",severity:l.Severity.INFO,style:c.FancyStyleByFeature.actionChainEnd}]);class g extends u{constructor(e,t,i){super(u.SPAN_NAMES.ACTION,`${t.module} ${i.logLabel}`),this.addTags((()=>({actionId:e,actionType:t.module})))}}class v extends u{constructor(e,t,i){super(u.SPAN_NAMES.ACTION_CHAIN,`action chain ${i}`),this.addTags((()=>({chainId:e,rootAction:t})))}}class f extends t{constructor(e,t){super(e),this.log=d,this.id=e,this.constantDefs=t.constants||{},this.variableDefs=t.variables,this.actionDefs=t.actions,this.rootAction=t.root,this.returnType=t.returnType,this.outcomes=t.outcomes,this.scope=i.createScope(`chain_${e}`,null,{unique:!0,silent:!0}),this.scope.results=this.scope.createVariable(l.RESULTS_VARIABLE_KEY,l.VariableNamespace.VARIABLES,"object",{}),this.scope.createVariable("vb_parameters",l.VariableNamespace.VARIABLES,"object",{}),this.variables=this.scope.variableNamespaces[l.VariableNamespace.VARIABLES],this.expressionContext=new a(this),this.finallyCallbacks=[],this.targetScopeResolver=null,this.debugStream=new p}run(e,t){let i;return this.injectContext(e),this.start(t,this.callingContexts).catch((e=>{i=e})).then((e=>{if(i)throw i;return e}))}injectContext(t){this.executionContext=t,this.context=e.getInternalContext(t)||{},this.callingContexts=this.context.callingContexts,this.targetScopeResolver=this.context.targetContainer?this.context.targetContainer.scopeResolver:null,this.availableContexts=a.getAvailableContexts(this,t),this.context.availableContexts=this.availableContexts,this.debugStream=this.context.debugStream||this.debugStream,this.debugStream.isDebuggerInstalled&&this.debugStream.setChainLocator(this.context.targetContainer.getResourcePath())}start(e,t){return Promise.resolve().then((()=>(this.initializeConstants(e),this.initializeVariables(e,t).then((()=>{r.addScopeToStore(this.scope),this.activateVariables(),this.log.startChain("Starting action chain",this.logLabel,"with parameters:",e);const t=new v(this.id,this.rootAction,this.logLabel);return this.log.monitor(t,(e=>(this.totalTime=e,this.debugStream.start().then((()=>this.runActionStep(this.rootAction))))))}))))).then((e=>(this.end(),e))).catch((e=>{throw this.end(e),e}))}initializeConstants(e={}){const t=this.targetScopeResolver;Object.keys(this.constantDefs).forEach((i=>{const r=this.constantDefs[i],n=e&&e[i];if(s.isExtendedType(n))throw new Error(`Constant '${i}' cannot be an extended type.`);if(s.isInstanceType(r.type))throw new Error(`Constant '${i}' cannot be a built-in type.`);this.createConstant(i,r,t,n)}))}createConstant(e,t,i,r){const s=n.createNonInstanceTypeDefaultValue(e,t,i,this.availableContexts);this.scope.createConstant(e,l.VariableNamespace.CONSTANTS,t.type,s,r)}initializeVariables(e={},t,i=l.VariableNamespace.VARIABLES){if(!this.variableDefs)return Promise.resolve();const r=[],a=this.targetScopeResolver;return Object.keys(this.variableDefs).forEach((o=>{const c=this.variableDefs[o];if(this.constantDefs[o])r.push(Promise.reject(new Error(`Variable '${o}' cannot have the same name as a constant.`)));else{let l;const h=e&&e[o];if(s.isExtendedType(h)&&(l=this.addReferenceVariables(h,o,i,t)),!l){const e=n.createVariableDefaultValue(o,c,a,this.scope,this.availableContexts,i).then((e=>{const t=n.getType(o,c,a);this.scope.createVariable(o,i,t,e,h)}));r.push(e)}}})),Promise.all(r)}activateVariables(){this.scope.activateVariables()}addReferenceVariables(e,t,i,r){const{id:n}=e;let s;if(n){const a=r=>{if(r){const s=r.getVariable(n,l.VariableNamespace.VARIABLES);if(s&&s.getValue()===e){const e=r.getVariable(`${n}${l.BuiltinVariableName.VALUE}`,l.VariableNamespace.VARIABLES);if(e)return this.scope.createReferenceVariable(t,i,s),this.scope.createReferenceVariable(`${t}${l.BuiltinVariableName.VALUE}`,i,e),!0}}return!1},o=this.context.container.getAvailableContexts();s=["$fragment","$page","$flow","$application","$global"].some((e=>a(o[e]))),s||(s=a(r.$chain))}if(!s)throw new Error(`Failed to add reference variables for ${t}.`);return!0}end(e){this.totalTime&&this.log.endChain("Ending action chain",this.logLabel,"successfully",this.totalTime(e)),this.debugStream.end(),this.dispose()}static createActionParameters(e,t={},r){const n=`parameters_${e.id}`,s=Object.keys(t);if(0===s.length)return[];const a=i.createScope(n,null,{silent:!0});return s.forEach((i=>{const n=e.constructor.buildParamValue(i,t[i],r);a.createConstant(i,l.VariableNamespace.CONSTANTS,"any",n,void 0,null,{freeze:!1})})),a.variableNamespaces[l.VariableNamespace.CONSTANTS]}runActionStep(t,i=this.availableContexts){const r=this.log.monitor();let n,s=t;if("string"==typeof s){if(n=this.actionDefs[s],!n)throw new Error(`The action chain '${this.id}' does not contain action with ID '${s}', aborting.`)}else n=s,s=n.id;return e.loadActionModule(n.module).then((t=>{const a=n.outcomes,o=e.getActionConfig(s,this.executionContext),c=new t(s,n.label,o);e.addHelpersToAction(c,this.context),this.addContextToAction(n.module,n,c,i);const l=f.createActionParameters(c,n.parameters,i),h=this.debugStream.isEnabled?f.createActionParameters(c,n.parameters,i):null;this.log.info("Chain",this.logLabel,"starting action step",c.logLabel,"with parameters:",l," setup:",r());const p=new g(s,n,c);return this.log.monitor(p,(e=>this.debugStream.actionStart(c,h).then((()=>c.start(l).then((t=>{const r=this.handleActionOutcome(s,a,t);return this.log.info("Chain",this.logLabel,"ending action step",c.logLabel,"with outcome",t,e()),this.debugStream.actionEnd(c,t),r.nextAction?this.runActionStep(r.nextAction,i):r.outcome})).catch((t=>{throw this.log.error("Chain",this.logLabel,"action step",c.logLabel,"failed.",t,e(t)),t}))))))}))}handleActionOutcome(e,t,i){const r=i,s=t?t[r.name]:null;if(!s){if(this.outcomes&&-1===this.outcomes.indexOf(r.name))throw new Error(`The ${r.name} outcome does not match one of the chain's possible outcomes.`);if(this.returnType){const e=this.context&&this.context.container&&this.context.container.scopeResolver,t=n.getType(null,{type:this.returnType},e);r.result=h.coerceType(r.result,t)}return this.addActionResult(e,r),{outcome:r}}return this.addActionResult(e,r),{nextAction:s}}addActionResult(e,t){e&&(this.scope.results.getValue()[e]=t.result)}addContextToAction(e,t,i,r=this.availableContexts){if(e.startsWith(l.BUILTIN_ACTION_PATH_PREFIX))switch(e.substr(l.BUILTIN_ACTION_PATH_PREFIX.length)){case"assignVariablesAction":case"callVariableMethodAction":case"resetVariablesAction":i.setAvailableContext(r);break;case"callChainAction":{const e=this.availableContexts.clone();delete e.$variables,i.setContext(e,this.context);break}case"forkAction":{const e=t.outcomes?s.cloneObject(t.outcomes):{};e.join&&delete e.join,i.setContext(this,e);break}case"downloadExtensionsAction":case"forEachAction":i.setContext(this,r);break;case"restAction":case"callModuleFunctionAction":case"fireNotificationEventAction":case"loginAction":case"logoutAction":case"editorUrlAction":case"checkForExtensionsAction":case"restartApplicationAction":case"getDirtyDataStatusAction":case"resetDirtyDataStatusAction":i.setContext(this.context);break;case"takePhotoAction":i.setAvailableContexts(r);break;case"fireCustomEventAction":i.setInternalContext(this.context,this.context.internalContext)}this.context&&this.context.container&&Object.defineProperty(i,"containerLifecycleState",{get:()=>this.context.container.lifecycleState})}dispose(){delete this.variables,this.scope.dispose(),r.removeScopeFromStore(this.scope)}}return f})),define("vb/private/action/assignmentUtils",[],(()=>class{static assignValue(e,t,i){return i}})),define("vb/private/helpers/runtimeEnvironment",["vb/private/utils","vb/private/services/servicesLoader","vb/private/configLoader"],((e,t,i)=>{const r=/\/(undefined|null)\//gi;return class{getExtensionManifest(){return Promise.resolve(null)}getUserInfoType(){return i.loadSecurityProvider().then((e=>e&&e.constructor.getUserInfoType()))}disableAppUis(){return Promise.resolve(!1)}getApplicationDescriptor(t){return e.loadAndParse(`${t}-flow.json`)}getApplicationFunctions(t){return e.getResource(`${t}-flow`)}getFlowDescriptor(t){return e.loadAndParse(`${t}-flow.json`)}getFlowFunctions(t){return e.getResource(`${t}-flow`)}getFlowExtensionDescriptor(t){return e.loadAndParse(`${t}-flow-x.json`)}getFlowExtensionFunctions(t){return e.getResource(`${t}-flow-x`)}getAppUiDescriptor(t){return e.loadAndParse(`${t}.json`)}getAppUiFunctions(t){return e.getResource(t)}getAppUiExtensionDescriptor(t){return e.loadAndParse(`${t}-x.json`)}getAppUiExtensionFunctions(t){return e.getResource(`${t}-x`)}getPageDescriptor(t){return e.loadAndParse(`${t}-page.json`)}getPageTemplate(t){return e.getResource(`text!${t}-page.html`)}getPageFunctions(t){return e.getResource(`${t}-page`)}getPageExtensionDescriptor(t){return e.loadAndParse(`${t}-page-x.json`)}getPageExtensionFunctions(t){return e.getResource(`${t}-page-x`)}getFragmentDescriptor(t){return e.loadAndParse(`${t}-fragment.json`)}getFragmentTemplate(t){return e.getResource(`text!${t}-fragment.html`)}getFragmentFunctions(t){return e.getResource(`${t}-fragment`)}getFragmentExtensionDescriptor(t){return e.loadAndParse(`${t}-fragment-x.json`)}getFragmentExtensionFunctions(t){return e.getResource(`${t}-fragment-x`)}getLocaleBundle(t){return e.getResource(`ojL10n!${t}`)}getV2Strings(t,i){const n=t.replace(r,"/");return e.getResource(n).then((e=>({functions:e})))}getTextResource(t){return e.getTextResource(t)}getModuleResource(t){return e.getResource(t)}getExtensionTextResource(t){return e.getTextResource(t)}getExtensionModuleResource(t){return e.getResource(t)}getModulesToPreload(){return Promise.resolve([])}notifyError(...e){}canNavigateToPage(e,t){return Promise.resolve(!0)}canNavigate(e,t){return Promise.resolve(!0)}canNavigateToUrl(e,t){return Promise.resolve(!0)}canNavigateBack(e){return Promise.resolve(!0)}canOpenUrl(e,t,i){return Promise.resolve(!0)}getUserRolesOverride(){return Promise.resolve()}getUserPermissionsOverride(){return Promise.resolve()}saveInputParameters(e){}loadInputParameters(){}getServiceWorkerRequireConfig(){return Promise.resolve({})}getServiceWorkerPlugins(){return Promise.resolve([])}sessionExpired(e){return e?new Promise(((t,i)=>{const r=document.getElementById("vb-refresh-access-token-iframe");if(r){let n;const s=e=>{e.origin===window.location.origin&&"vbRefreshAuthToken"===e.data.method&&(clearTimeout(n),window.removeEventListener("message",s),t(!0))};window.addEventListener("message",s),r.src=e,n=setTimeout((()=>{window.removeEventListener("message",s),i("Refreshing auth token timed out."),window.location.href=e}),3e3)}else i("Redirecting the application to the login url"),window.location.href=e})):Promise.reject("Cannot refresh session without a login url.")}getServiceExtensionOverride(){return Promise.resolve(null)}getServiceDefinition(e,i={}){return t.loadWithTimeout(e,i)}getTransformsSource(t){return e.getResource(t)}getServiceExtensionCatalog(t){return e.getResource(`text!${t}`)}getCatalogOverride(){return Promise.resolve("{}")}getEndpointPlugin(t){return e.getResource(t)}isOpenTraceEnabled(){return!0}annotate(e,t,i){return!1}getOfflineHandlerUrl(){return Promise.resolve(null)}}})),define("vb/private/helpers/runtimeManager",["vb/private/utils","vb/private/constants","vb/private/history","vb/private/stateManagement/stateMonitor","vb/private/stateManagement/navigationContext"],((e,t,i,r,n)=>{const s="__VB_PAGE_CONTAINER__";return new class{constructor(){this.readyFlags={[s]:!1},this.readyPromises={},this.readyPromiseResolvers={},this.readyTimeout=0,this.stateChangeListener=(e,t)=>{this.handleStateChange(e,t)},r.addStateChangeListener(this.stateChangeListener)}applicationReady(){return this.containerReady("")}containerReady(e){return this.readyPromises[e]||(this.readyFlags[e]?this.readyPromises[e]=Promise.resolve(!0):this.readyPromises[e]=new Promise(((t,i)=>{this.readyPromiseResolvers[e]=t,this.readyTimeout>0&&setTimeout(i,this.readyTimeout)}))),this.readyPromises[e]}setReadyTimeout(e){this.readyTimeout=e}refreshContainer(e){return this.containerReady(e).then((()=>this.getStateManagement())).then((([t,r,s])=>{const a=t.getContainer(r,e);if(a instanceof s){const e=a;return e.dispose(),i.setPagePath(""),this.refreshPage(e).then((t=>{const i=new n(t);return r.getLeafPageInstance(e.getNavPath(),i)})).then((e=>t.go(e.getNavPath())))}return Promise.reject(`Unknown container for ${e}`)}))}refreshContainerDescriptor(e){return this.containerReady(e).then((()=>this.getStateManagement())).then((([t,i,r])=>{const n=t.getContainer(i,e);if(n instanceof r){const e=n;return e.loadPagePromise=null,e.loadMetadataPromise=null,e.loadBundlesPromise=null,e.loadDescriptorPromise=null,e.loadAndStartPromise=null,e.initializePromise=null,e.viewModelPromise=null,Object.keys(e.fragments).forEach((t=>{const i=e.fragments[t];i&&i.disposeScope()})),e.layouts.forEach((e=>e.disposeScope())),e.disposeScope(),e.availableContexts=null,this.refreshPage(e)}return Promise.reject(`Unsupported container for ${e}`)}))}refreshContainerFunctions(e){return this.containerReady(e).then((()=>this.getStateManagement())).then((([t,i,r])=>{const n=t.getContainer(i,e);if(n instanceof r){const e=n;return e.loadFunctionsPromise=null,e.initializePromise=null,e.viewModelPromise=null,e.disposeScope(),this.refreshPage(e)}return Promise.reject(`Unsupported container for ${e}`)}))}refreshContainerTemplate(e){return this.containerReady(e).then((()=>this.getStateManagement())).then((([t,i,r])=>{const n=t.getContainer(i,e);if(n instanceof r){const e=n;return e.loadPagePromise=null,e.loadHtmlPromise=null,e.viewModelPromise=null,this.refreshPage(e)}return Promise.reject(`Unsupported container for ${e}`)}))}refreshContainerBundles(e){let t;return this.containerReady(e).then((()=>this.getStateManagement())).then((([i,r,n])=>{if(t=i.getContainer(r,e),t)return t.loadBundlesPromise=null,t instanceof n&&(t.initializePromise=null,t.viewModelPromise=null),t.loadTranslationBundles();throw new Error(`Unsupported container for ${e}`)}))}navigateToPage(e,i){return this.applicationReady().then((()=>this.getStateManagement())).then((([r,n])=>r.queueNavigate(n,{page:e,params:i,operation:t.NavigateOperation.PAGE_OLD}).then((e=>e&&!0===e.navigated))))}refreshPage(e){const i=e.getNavPath(),r=e.parent;this.setContainerReady(i,!1),e.resetParentModuleConfig(),e.lifecycleState=t.ContainerState.REFRESHING,e.started=!1;const s=new n(r);return r.loadPageFromInfo({id:e.id},s).then((i=>(i.enter(),i===e&&(i.lifecycleState=t.ContainerState.REFRESHING),i)))}refreshService(e){return this.getServicesManager().then((t=>t.disposeService(e))).then((t=>t.load([e])))}refreshServiceExtensionCatalog(){return this.getStateManagement().then((([,e])=>e.protocolRegistry&&e.protocolRegistry.disposeCatalog()))}refreshFlow(e){}dispose(){r.removeStateChangeListener(this.stateChangeListener)}handleStateChange(e,t){e===r.RuntimeState.CONTAINER_ACTIVATED&&this.setContainerReady(t.getNavPath(),!0)}setApplicationReady(e){this.setContainerReady("",e)}setPageReady(e){this.setContainerReady(s,e)}setContainerReady(e,t){this.readyFlags[e]!==t&&(this.readyFlags[e]=t,t?this.readyPromiseResolvers[e]&&(this.readyPromiseResolvers[e](),this.readyPromiseResolvers[e]=null):(this.readyPromiseResolvers[e]=null,this.readyPromises[e]=null))}getStateManagement(){return this.stateManagementPromise=this.stateManagementPromise||e.getResources(["vb/private/stateManagement/router","vb/private/stateManagement/application","vb/private/stateManagement/page"]),this.stateManagementPromise}getServicesManager(){return this.serviceManagerPromise=this.serviceManagerPromise||e.getResource("vb/private/services/servicesManager"),this.serviceManagerPromise}}})),define("vb/private/mobile/db",["vb/private/mobile/fileIo"],(e=>{const t="vbcs-preferences-1.0.0";class i{static setAppPreference(e,r){return i._readJson(t).then((n=>{const s=n;s[e]=r,i._writeJson(t,s)}))}static getAppPreference(e){return i._readJson(t).then((t=>t[e]))}static removeAppPreference(e){return i._readJson(t).then((r=>{const n=r;return n[e]?(delete n[e],i._writeJson(t,n)):Promise.resolve()}))}static _readJson(t){return e.readFileFromLib("metadata",`${t}.db`).then((e=>e?JSON.parse(e):e)).catch((()=>({})))}static _writeJson(t,i){const r=JSON.stringify(i);return e.saveFileToLib("metadata",`${t}.db`,r).catch((e=>{console.error(e)}))}}return i})),define("vb/private/mobile/security/constants",[],(()=>{const e={OAUTH2_V1_PATH:"/oauth2/v1/"};return e.IDM_ERROR_CODES=new Map([["10001","Could not connect to server"],["10003","Username or password invalid"],["10005","Could not parse response from server"],["10011","Username, password or tenant invalid"],["10015","Setup failed default"],["10021","Setup is not invoked"],["10023","Not yet authenticated"],["10025","Initialization failed"],["10029","User cancelled authentication"],["10030","User denied"],["10034","Logout timed out"],["10035","Logout failed"],["10036","Username required"],["10037","Identity domain required"],["10039","Password required"],["10040","Username and Identity domain are required"],["10041","Application not available"],["10042","Authentication timed out"],["10043","Logout is in progress"],["10044","Network not available"],["10045","Challenge input response is invalid"],["10100","Invalid app name"],["10101","Invalid login URL"],["10102","Invalid logout URL"],["10103","Invalid session timeout time"],["10104","Invalid idle session timeout time"],["10105","Invalid idle session timeout delta"],["10106","Invalid retry counts"],["10107","Invalid required tokens format"],["10108","Invalid identity domain format"],["10109","Invalid collect identity domain format"],["10110","Invalid remember credentials enabled parm"],["10111","Invalid remember username default parm"],["10112","Invalid autologin parm"],["10113","Invalid remember credentails parm"],["10114","Invalid remember username parm"],["10115","Invalid auth server type"],["10116","INVALID_OFFLINE_AUTH_ALLOWED_PARM"],["10117","Invalid connectivity mode"],["10119","Invalid browser modes"],["10401","Could not filter tokens"],["10403","Parameter or value is out of range"],["10404","Invalid property value"],["10406","Value or parameter cannot be null"],["10407","The URI did not contain query parameters"],["10408","Authentication failed"],["10409","Invalid authentication URL"],["10414","The server responded with more number of redirect responses than maximum allowed"],["10415","Invalid HTML. One or more required fields missing"],["10416","The loaded web page contains an unresponsive or long-running script"],["10417","This flow requires a web-view"],["10418","Authentication has been retried max allowed times"],["10419","HTML view error"],["10421","Client certificate is not specified"],["10422","Untrusted server certificate import was canceled"],["10423","Unknown error"],["10424","Client certificate based authentication is not enabled"],["10425","A handler is required for authentication challenge events"],["10426","A handler is required for logout events"],["10501","Key for credential or for map nil"],["10502","Input is not proper, invalid input or missing input"],["10503","Out of memory in keychain"],["10504","Random generation failure"],["10505","Salt length less then min length"],["10506","Input text empty"],["10507","Unsupported encrypt algorithm"],["10508","Key size not supported"],["10509","Length not matching to block size"],["10510","Padding missing error"],["10511","ENCRYPTION SYSTEM ERROR"],["10512","Key length not multiple of 4"],["10513","Salt required error"],["10514","Salt not supported for algorithm"],["10515","Cannot prefix salt in not supported salt algorithm"],["10516","Algorithm name missing"],["10517","Input has to be NSString type"],["10518","Unknown input type"],["10519","Input length error"],["10520","Key-pair generation system error"],["10521","Tag require to identify key in key-chain error"],["10522","Key-chain system error"],["10523","Key-chain item missing"],["10524","Signing missing error"],["10525","Sign cannot be empty"],["10526","System verification failed"],["10527","Decryption system error"],["10528","Key-chain item already there"],["10529","Unsupported key type"],["10530","Invalid key chain protection level"],["10531","PBKDF2 key generation error"],["10532","Delegate missing error"],["10533","File not found at resource path error"],["12412","Value or parameter type mismatch occurred"],["12413","Message length is not a multiple of block length"],["20001","Invalid basic auth url"],["30001","The server did not request for a client certificate"],["30002","Access to the certificate was denied or an error occurred while attempting to use the client certificate"],["30003","No client certificates installed/found"],["40001","Unsupported response"],["40002","Unauthorized client"],["40017","Tokens not available"],["40200","OAuth setup failed"],["40210","OAuth authentication failed"],["40211","OAuth context invalid"],["40213","OAuth client assertion invalid"],["40214","OAuth client secret invalid"],["40215","OAuth MSpre authz code invalid"],["40219","OAuth redirect URI is invalid"],["40220","OAuth state is invalid"],["40230","Invalid request"],["40231","Access denied"],["40232","Invalid scope"],["40233","Internal server error"],["40234","Oauth temporarily not available"],["40235","Unknown error"],["40236","Bad request"],["40237","Client assertion"],["40238","unsupported_grant_type"],["40239","invalid_client"],["40240","invalid_grant"],["40241","Client secret can not be null or empty for this grant type"],["40242","Client id can not be null or empty for this grant type"],["40243","Invalid auth token endpoint"],["40244","Invalid authorization endpoint"],["40245","Error while parsing OAuth token"],["40410","Assertion cannot be NULL"],["50001","Fedauth invalid login successes url"],["50002","Fedauth invalid login failure url"],["50003","Invalid value for parse token relay"],["50306","Cannot Connect"],["50400","Bad Request"],["50405","External browser mode is unsupported"],["50406","Parse token relay enabled, but no token was found"],["50407","Error while parsing token relay response"],["70009","Authentication error during PIN change"],["P1001","Invalid redirect encountered while authenticating. Check the auth setup being used by the app"],["P1002","Untrusted server error encountered while authenticating. Check the auth setup being used by the app"],["P1003","Unsupported challenge encountered while authenticating"],["P1004","Idle timeout reset failed"],["P1005","Init expects a map of properties to be passed"],["P1006","Challenge fields are not passed"],["P1007","Invalid arguments passed. AuthFlowKey is expected to be passed"],["P1008","Null or empty AuthFlowKey passed"],["P1009","Invalid AuthFlowKey passed"],["P1010","No auth context available to fetch headers"],["P1011","This error code is deprecated and no longer in use"],["P1012","Error while launching external browser"],["P1013","No local authenticator enabled"],["P1014","Unidentified local authenticator type"],["P1015","Ongoing enable or disable task. Try after the current one is completed"],["P1016","Attempt to enable biometric when PIN is not enabled"],["P1017","Attempt to disable PIN when biometric is enabled"],["P1018","Error while enabling local authenticator"],["P1019","Either the device does not support biometric or is not enrolled"],["P1020","Attempt to change PIN when PIN is not enabled"],["P1021","Error while getting enabled local authentications"],["P1022","Saving value to secured storage failed"],["P1023","Saving value to default storage failed"],["P1024","Getting value from secured storage failed"],["P1025","Getting value from default storage failed"]]),e.lookupErrorCode=t=>t&&t.errorCode&&e.IDM_ERROR_CODES.get(t.errorCode)?e.IDM_ERROR_CODES.get(t.errorCode):"",e})),define("vb/private/mobile/security/strategy",["vbsw/private/constants","vb/private/log","vb/private/utils"],((e,t,i)=>{const r=window.vbInitConfig||{};return class{constructor(e){this.log=t.getLogger("vb/private/mobile/security/strategy"),this.idmAuthFlows=window.cordova.plugins.IdmAuthFlows,this.appName=r.APP_ID?r.APP_ID:"",this.appName+=r.APP_VERSION?r.APP_VERSION:"",this.appName+=r.APP_PATH?r.APP_PATH:"",this.authKey=i.generateUniqueId(),this.idcsHostName=e.hostName,this.authenticationFlow=null,this.allowedScopes=[]}init(e={}){return this.idmAuthFlows.init(e).then((e=>{this.authenticationFlow=e}))}loginToApplication(){return Promise.reject(new Error("loginToApplication needs to be implemented by each subclass"))}isUserLoggedIn(){return this.authenticationFlow?this.authenticationFlow.isAuthenticated().then((e=>{if(!e)throw new Error("User is not authenticated");return!0})):Promise.reject(new Error("init must be invoked prior to calling isUserLoggedIn"))}logout(){return this.authenticationFlow?this.authenticationFlow.logout().then((()=>{this.authenticationFlow=null})):Promise.reject(new Error("init must be invoked prior to calling logout"))}retrieveHeaders(){if(!this.getHeadersPromise){const e={fedAuthSecuredUrl:null,oauthScopes:this.allowedScopes};this.getHeadersPromise=this.authenticationFlow.getHeaders(e).then((e=>e||{}))}return this.getHeadersPromise}getHeaders(){return this.authenticationFlow?this.authenticationFlow.isAuthenticated().then((e=>e?this.retrieveHeaders():(this.getHeadersPromise=null,this.loginToApplication().then((()=>this.retrieveHeaders()))))):Promise.reject(new Error("init must be invoked prior to calling getHeaders"))}}})),define("vb/private/mobile/security/strategyOpenidOAuthIdm",["vb/private/mobile/security/strategy","vb/private/mobile/security/constants"],((e,t)=>class extends e{constructor(e){super(e),this.clientId=e.clientId,this.oAuthRedirectEndpoint=e.oAuthRedirectEndpoint,this.allowedScopes=e.allowedScopes,this.allowedScopes.push("openid")}init(e=null){const i=this.idmAuthFlows.OAuthPropertiesBuilder.OAuthAuthorizationGrantType.OAuthAuthorizationCode,r=e||(new this.idmAuthFlows.OpenIDConnectPropertiesBuilder).appName(this.appName).oAuthAuthorizationGrantType(i).discoveryEndpoint(`${this.idcsHostName}/.well-known/idcs-configuration`).oAuthClientID(this.clientId).oAuthRedirectEndpoint(this.oAuthRedirectEndpoint).oAuthScope(this.allowedScopes).logoutURL(`${this.idcsHostName}${t.OAUTH2_V1_PATH}userlogout`).browserMode(this.idmAuthFlows.OAuthPropertiesBuilder.BrowserMode.External).enablePKCE(!0).build();return super.init(r)}loginToApplication(){return this.authenticationFlow?(this.loginPromise||(this.loginPromise=this.authenticationFlow.login().then((e=>{if(!e)throw new Error("Failed to login to application because there was no login response provided!")})).finally((()=>{this.loginPromise=null}))),this.loginPromise):Promise.reject(new Error("init must be invoked prior to calling loginToApplication"))}})),define("vb/private/mobile/security/strategyBasicAuthIdm",["vb/private/mobile/security/constants","vb/private/mobile/db","vb/private/mobile/security/strategy","vb/private/log"],((e,t,i,r)=>class extends i{constructor(e){super(e),this.log=r.getLogger("vb/private/mobile/security/strategyBasicAuthIdm"),this.loginUrl=e.login,this.logoutUrl=e.logout,this.headers=e.headers||{},this.loginWindow=null,this.shouldRememberUsername=null}init(i=null){const r=i||(new this.idmAuthFlows.HttpBasicAuthPropertiesBuilder).appName(this.appName).loginUrl(this.loginUrl).logoutUrl(this.logoutUrl).challengeCallback(((i,r)=>{const n=i,s=r;let a=null;const o=e=>{const i="vbcs-login:",r=e.url.indexOf(i);if(r>0){if("loadstart"===e.type)a=e.url;else if("loadstop"===e.type&&e.url===a)return void(a=null);const c=e.url.substring(r+i.length).split(",");"login"===c[0]?t.setAppPreference(`vbcs:app:${this.appName}:rememberUsername`,"true"===c[3]).catch((e=>{this.log.error(e)})).then((()=>{n.username_key=c[1],n.password_key=window.atob(c[2]),this.loginWindow&&(this.loginWindow.removeEventListener("loadstart",o),this.loginWindow.removeEventListener("loadstop",o)),s(n)})):"cancel"===c[0]&&this.loginWindow&&this.loginWindow.close()}};if(n.error&&this.loginWindow){let t=e.lookupErrorCode(n.error);t||(t="Login was not successful. Please try again.");const i=`error('${t}')`;return this.loginWindow.executeScript({code:i}),this.loginWindow.addEventListener("loadstart",o),void this.loginWindow.addEventListener("loadstop",o)}let c="";this.shouldRememberUsername?(c=n.username_key,c||(c="")):this.shouldRememberUsername=!1;const l=`${`${cordova.file.applicationDirectory}www/vb/package/mobile/basicAuth/login/default.login.html`}?savedUsername=${c}&rememberUsername=${this.shouldRememberUsername}`;this.loginWindow=cordova.InAppBrowser.open(l,"_blank","toolbar=no,location=no"),this.loginWindow.addEventListener("loadstart",o),this.loginWindow.addEventListener("loadstop",o)})).maxLoginAttempts(3).offlineAuthAllowed(!0).rememberUsernameAllowed(!0).rememberCredentialsAllowed(!0).rememberCredentialDefault(!0).autoLoginDefault(!0).autoLoginAllowed(!0).customAuthHeaders(this.headers).put("AuthKey",this.authKey).build();return super.init(r)}loginToApplication(){return this.authenticationFlow?t.getAppPreference(`vbcs:app:${this.appName}:rememberUsername`).then((t=>(this.loginWindow=null,this.shouldRememberUsername=t,this.authenticationFlow.login().then((e=>{if(!e)throw new Error("Failed to login into application")})).catch((t=>{this.loginWindow&&this.loginWindow.close();const i=e.lookupErrorCode(t);throw i?new Error(i):t})).then((()=>{this.loginWindow&&this.loginWindow.close()}))))):Promise.reject(new Error("init must be invoked prior to calling loginToApplication"))}getHeaders(){return this.authenticationFlow?this.authenticationFlow.getHeaders().then((e=>e||{})).catch((t=>{throw new Error(e.lookupErrorCode(t))})):Promise.reject(new Error("init must be invoked prior to calling getHeaders"))}})),define("vb/private/mobile/security/strategyOAuthIdm",["vb/private/mobile/security/strategy","vb/private/mobile/security/constants"],((e,t)=>class extends e{constructor(e){super(e),this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.oAuthRedirectEndpoint=e.oAuthRedirectEndpoint,this.allowedScopes=e.allowedScopes,this.allowedScopes.push("offline_access"),this.allowedScopes.push("openid")}init(e=null){const i=this.idmAuthFlows.OAuthPropertiesBuilder.OAuthAuthorizationGrantType.OAuthAuthorizationCode,r=e||(new this.idmAuthFlows.OpenIDConnectPropertiesBuilder).appName(this.appName).oAuthAuthorizationGrantType(i).discoveryEndpoint(`${this.idcsHostName}/.well-known/idcs-configuration`).oAuthTokenEndpoint(`${this.idcsHostName}${t.OAUTH2_V1_PATH}token`).oAuthClientID(this.clientId).oAuthClientSecret(this.clientSecret).oAuthAuthorizationEndpoint(`${this.idcsHostName}${t.OAUTH2_V1_PATH}authorize`).oAuthRedirectEndpoint(this.oAuthRedirectEndpoint).oAuthScope(this.allowedScopes).logoutURL(`${this.idcsHostName}${t.OAUTH2_V1_PATH}userlogout`).browserMode(this.idmAuthFlows.OAuthPropertiesBuilder.BrowserMode.External).enablePKCE(!0).build();return super.init(r)}loginToApplication(){return this.authenticationFlow?(this.loginPromise||(this.loginPromise=this.authenticationFlow.login().then((e=>{if(!e)throw new Error("Failed to login to application because there was no login response provided!")})).finally((()=>{this.loginPromise=null}))),this.loginPromise):Promise.reject(new Error("init must be invoked prior to calling loginToApplication"))}})),define("vb/private/mobile/security/security",["vb/private/mobile/security/strategyOpenidOAuthIdm","vb/private/mobile/security/strategyBasicAuthIdm","vb/private/mobile/security/strategyOAuthIdm"],((e,t,i)=>{const r={AUTHENTICATION_TYPE:{ORACLE_CLOUD:"oraclecloud",BASIC:"basic",OAUTH:"oauth"}};let n=null;return r.initialize=s=>{if(!s||!s.authentication)return Promise.reject(new Error("No security configuration has been provided, switching to anonymous mode"));switch(s.authentication.type){case r.AUTHENTICATION_TYPE.ORACLE_CLOUD:n=new e(s.idcsInfo);break;case r.AUTHENTICATION_TYPE.BASIC:n=new t(s.authentication.options);break;case r.AUTHENTICATION_TYPE.OAUTH:n=new i(s.idcsInfo);break;default:return Promise.reject(new Error("No security configuration has been provided, switching to anonymous mode"))}return n.init()},r.getSecurityStrategy=()=>n?Promise.resolve(n):Promise.reject(new Error("Security has not been initialized.")),r.login=()=>r.getSecurityStrategy().then((e=>e.isUserLoggedIn().catch((()=>n.loginToApplication())))),r.logout=()=>r.getSecurityStrategy().then((e=>e.logout())),r.getHeaders=()=>r.getSecurityStrategy().then((e=>e.getHeaders())),r})),define("vb/private/pwa/pwaServiceWorkerManagerClass",["vb/private/utils","vb/private/log","vb/versions","vbsw/private/serviceWorkerManagerClass"],((e,t,i,r)=>{const n=t.getLogger("/vb/private/pwa/serviceLWorkerManager"),s=()=>window.vbInitConfig.DEBUG?n.warn:n.info;return class extends r{constructor(){super(),this.config={},window.__WB_DISABLE_DEV_LOGS=!0}getServiceWorkerVersion(){return this.wb.messageSW({type:"GET_VERSION"}).then((e=>(n.info(`Version from the service worker: ${JSON.stringify(e,null,2)}`),e))).catch((e=>{n.warn("Failed to detect service worker version:",e)}))}serviceWorkerReady(e){return new Promise((t=>{const i=navigator.serviceWorker.controller;i&&i.scriptURL.endsWith(e)?(s()(`Activated service worker found: ${i.scriptURL}`),t()):(this.controllerChangeHandler=e=>{s()(`navigator.serviceWorker.controller change for ${e.target.controller.scriptURL}`),t()},navigator.serviceWorker.addEventListener("controllerchange",this.controllerChangeHandler))}))}installServiceWorkers(e,t,i){const r=[];return this.getServiceWorkerConfig(e,t,i).then((e=>this.installServiceWorker(e))).then((e=>(this.configureLoggingLevel(this.config.logConfig),r.push(e),r))).catch((e=>{n.warn("Failed to install service worker:",e)}))}getWorkboxCdnPath(e=window.vbInitConfig){return`${e.WORKBOX_CDN_PATH||i.workbox.cdnPath}${i.workbox.version}/`}isCachingEnabled(e=window.vbInitConfig){return!0!==e.PWA_CONFIG.disableCaching}installServiceWorker(t){if(this.config=Object.assign(this.config,t),!("serviceWorker"in navigator))return n.warn(`Service worker is not supported/enabled in the browser: ${navigator.userAgent}`),super.installServiceWorker(t.scopes[0],t);const i=window.vbInitConfig.PWA_CONFIG.scriptUrl;if(this.scriptUrl=i?`${t.applicationUrl}${i}`:`${t.applicationUrl}sw.js`,n.info(`Service worker url: ${this.scriptUrl}`),!window.location.href.startsWith(t.applicationUrl)){throw new Error(`Service worker scope: ${t.applicationUrl} does not match initial request: ${window.location.href}`)}let r;const s={updateViaCache:"imports"},a=`${this.getWorkboxCdnPath(window.vbInitConfig)}workbox-window.${window.vbInitConfig.DEBUG?"dev":"prod"}.umd.js`;return e.getResource(a).then((e=>(this.wb=new e.Workbox(this.scriptUrl,s),this.workboxEventHandler=this.handleEvent.bind(this),this.wb.addEventListener("installed",this.workboxEventHandler),this.wb.addEventListener("redundant",this.workboxEventHandler),this.wb.addEventListener("activated",this.workboxEventHandler),this.wb.addEventListener("waiting",this.workboxEventHandler),this.wb.register({immediate:!0})))).catch((e=>{n.error("Service worker registration failed with",e)})).then((e=>(e&&(r=e.installing||e.waiting||e.active),r&&n.info(`workbox register returned ${r.state} service worker`),n.info(`emulating service worker functionality with scope: ${t.scopes[0]}`),this.emulateServiceWorker(t.scopes[0]))))}removeEventListeners(){this.wb&&this.workboxEventHandler&&(this.wb.removeEventListener("installed",this.workboxEventHandler),this.wb.removeEventListener("redundant",this.workboxEventHandler),this.wb.removeEventListener("activated",this.workboxEventHandler),this.wb.removeEventListener("waiting",this.workboxEventHandler)),this.controllerChangeHandler&&navigator.serviceWorker.removeEventListener("controllerchange",this.controllerChangeHandler)}configureLoggingLevel(e){return e&&e.level?this.wb.messageSW({type:"SET_LOGGING_LEVEL",payload:{level:e.level}}):Promise.resolve}getApplication(){return this.applicationPromise=this.applicationPromise||e.getResource("vb/private/stateManagement/application"),this.applicationPromise}informUser(e){return s()(`Application needs to be reloaded. ${e}`),this.getApplication().then((t=>t.onNewContentAvailable({message:e}))).catch((e=>{n.error(e)}))}handleEvent(e){const t=e.type;switch(s()(`Event handler invoked for service worker '${t}' event`),t){case"installed":n.info("Service worker installed "+(e.isUpdate?"after update":"for the first time"));break;case"activated":e.isUpdate&&n.info("Service worker activated after update"),e.isExternal&&this.informUser("New version of the service worker has been activated");break;case"redundant":n.info("Service worker is now redundant");break;case"waiting":{const t=`A new service worker, ${e.sw.scriptURL} has installed, but it can't activate until all tabs\n    running current version have fully unloaded.`;n.info(t),n.warn(e.sw),this.wb.messageSkipWaiting();break}default:n.warn(`Event: ${t} was not handled`)}}}})),define("vb/private/services/boss/responseTransforms",[],(()=>{class e{static paginate(e){const t={};if(e.body){const i=e.body;i.estimateTotalResults>=0&&(t.totalSize=i.estimateTotalResults),t.hasMore=i.hasMore}return t}static toObject(){return{paginate:e.paginate}}}return e})),define("vb/private/services/boss/bossTransformsConstants",[],(()=>{const e={};return e.Common=Object.freeze({PROPERTIES:"properties",DATA_TYPE_STRING:"string",DATA_TYPE_ANY:"any",DOUBLE_QUOTES:"''",NULL:"null",MAX_LIMIT:1e3,METHOD_TYPE_GET:"GET"}),e.CapabilityType=Object.freeze({FETCH_BY_KEYS:"fetchByKeys",FILTER:"_filter",LIMIT:"_limit",OFFSET:"_offset",FIELDS:"_fields",SORT_BY:"_sortBy"}),e.CapabilityValues=Object.freeze({FETCH_FIRST_IMPLEMENTATION_ITERATION:"iteration",FETCH_BY_KEYS_IMPLEMENTATION_LOOKUP:"lookup",FETCH_BY_KEYS_MULTI_KEY_LOOKUP_YES:"yes",SORT_DIRECTION_ASCENDING:"ascending",SORT_ORDER_ASC:":asc",SORT_ORDER_DESC:":desc",ATTRIBUTE_X_SORTABLE_PROP:"x-sortable",ATTRIBUTE_X_SEARCHABLE_PROP:"x-searchable",ATTRIBUTE_X_PRIMARY_KEY:"x-primaryKey",VB_TEXT_FILTER_ATTRS:"vb-textFilterAttributes",SENSITIVITY_ACCENT:"accent",IN_QUERY:"query"}),e.Delimiters=Object.freeze({AMPERSAND:"&",QUESTION_MARK:"?",DOLLAR:"$",PERCENTAGE:"%",TILDE:"~",COMMA:","}),e.Operators=Object.freeze({SCIM:{$eq:"=",$ne:"!=",$gt:">",$ge:">=",$lt:"<",$le:"<=",$sw:"$sw",$ew:"$ew",$co:"$co",$pr:"$pr"},Comparison:{in:"IN",like:"LIKE",isNull:"IS NULL",isNotNull:"IS NOT NULL"},Logical:{or:{op:"$or",val:"or"},and:{op:"$and",val:"and"},exists:{op:"$exists",val:"exists"}}}),e.RegExp=Object.freeze({CI_FLAG:"i",QUERY_DELIMITER_GROUP:"([?&])",QUERY_PARAM_KEY_GROUP:"(?:\\$|%24)",QUERY_PARAM_VALUE_GROUP:"=.*?(&|$)",MATCH1:"$1",MATCH2:"$2",SINGLE_QUOTE:/'/g}),e})),define("vb/private/services/boss/transformsUtils",[],(()=>{class e{static getKeyValue(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&null!==e[t]&&void 0!==e[t]?{key:t,value:e[t]}:null}static searchProperty(t,i){const r=Object.keys(t);return r.includes(i)?[t[i]]:r.reduce(((r,n)=>"object"==typeof t[n]?r.concat(e.searchProperty(t[n],i)):r),[])}static getPropertiesFromResponse(t){if(t){const i=e.searchProperty(t,"schema");if(i.length>0)return e.searchProperty(i,"properties")}}static isObject(e){return!!e&&e.constructor===Object}}return e})),define("vb/private/services/boss/requestTransforms",["urijs/URI","vb/private/log","vb/private/services/boss/bossTransformsConstants","vb/private/services/boss/transformsUtils"],((e,t,i,r)=>{const n=t.getLogger("/vb/private/services/boss/requestTransforms");class s{static addOrUpdateURLParameter(t,r,n){const s=t.includes(i.Delimiters.QUESTION_MARK)?i.Delimiters.AMPERSAND:i.Delimiters.QUESTION_MARK,a=null==n?n:`${n}`,o=a&&a===e.decodeQuery(a)?e.encodeQuery(a):a;if(r&&o){const e=i.RegExp.QUERY_DELIMITER_GROUP,n=r.replace(i.Delimiters.DOLLAR,i.RegExp.QUERY_PARAM_KEY_GROUP),a=i.RegExp.QUERY_PARAM_VALUE_GROUP,c=new RegExp(`${e}${n}${a}`,i.RegExp.CI_FLAG);if(t.match(c)){const e=`${i.RegExp.MATCH1}${r}=${o}${i.RegExp.MATCH2}`;return t.replace(c,e)}return`${t+s+r}=${o}`}return t}static getQueryParameterName(e,t){const i=e&&e.endpointDefinition&&e.endpointDefinition.componentParameters;return i&&i[t]&&i[t].name||t}static buildSortExpr(e){return e.attribute+(e.direction===i.CapabilityValues.SORT_DIRECTION_ASCENDING?i.CapabilityValues.SORT_ORDER_ASC:i.CapabilityValues.SORT_ORDER_DESC)}static urlParamExists(t,i){return e(t).hasQuery(i)}static encodeValue(e){const t="string"==typeof e&&e.replace(i.RegExp.SINGLE_QUOTE,i.Common.DOUBLE_QUOTES);return"string"==typeof t?`'${t}'`:e}static convertTextFilterCriterionToExpr(e,t){const r=t&&t[i.CapabilityValues.VB_TEXT_FILTER_ATTRS];if(Array.isArray(r)&&null!==e.text&&void 0!==e.text){const n={op:i.Operators.Logical.or.op,criteria:[]};return r.forEach((t=>{const r={op:i.Operators.SCIM.$sw,attribute:t,value:e.text};n.criteria.push(r)})),s.buildFilterExpression(n,t)}return""}static convertAttributeFilterCriterionToExpr(e,t){const r=(e,t,i,n)=>i&&"object"==typeof i&&!Array.isArray(i)?Object.entries(i).reduce(((i,[s,a])=>"object"==typeof a?i.concat(r(e,`${t}.${s}`,a,n)):i.concat({op:e,attribute:`${t}.${s}`,value:a,collationOptions:n})),[]):[{op:e,attribute:t,value:i,collationOptions:n}];if(e&&"object"==typeof e&&!Array.isArray(e)&&e.op&&e.value&&"object"==typeof e.value&&!Array.isArray(e.value)){const n={op:i.Operators.Logical.and.op,criteria:[]};return Object.keys(e.value).forEach((t=>{const i=r(e.op,t,e.value[t],e.collationOptions);n.criteria.push(...i)})),s.buildFilterExpression(n,t)}return""}static convertAttrExprFilterCriterionToExpr(e){let t="",r="",a="";if(r=i.Operators.SCIM[e.op]||r,!r&&e.op){let t=e.op;t.startsWith(i.Delimiters.TILDE)&&(t=e.op.substring(1),a=i.Delimiters.TILDE),r=Object.values(i.Operators.Comparison).includes(t)||Object.values(i.Operators.SCIM).includes(t)?t:r}a=(e.collationOptions||{}).sensitivity===i.CapabilityValues.SENSITIVITY_ACCENT?i.Delimiters.TILDE:a;let o="";switch(r){case i.Operators.SCIM.$sw:o=`'${e.value}${i.Delimiters.PERCENTAGE}'`,t=`${a}${i.Operators.Comparison.like} ${o}`;break;case i.Operators.SCIM.$ew:o=`'${i.Delimiters.PERCENTAGE}${e.value}'`,t=`${a}${i.Operators.Comparison.like} ${o}`;break;case i.Operators.SCIM.$co:o=`'${i.Delimiters.PERCENTAGE}${e.value}${i.Delimiters.PERCENTAGE}'`,t=`${a}${i.Operators.Comparison.like} ${o}`;break;case i.Operators.SCIM.$pr:case i.Operators.Comparison.isNotNull:t=`${i.Operators.SCIM.$ne} ${i.Common.NULL}`;break;case i.Operators.Comparison.isNull:t=`${i.Operators.SCIM.$eq} ${i.Common.NULL}`;break;case i.Operators.Comparison.in:if(Array.isArray(e.value)){const r=e.value.map((e=>s.encodeValue(e))).join(i.Delimiters.COMMA);t=`${a}${e.op} (${r})`}else n.warn("skipping, value is not supported by IN operator:",e.value);break;default:t=r?`${a}${r} ${s.encodeValue(e.value)}`:""}return t?`${e.attribute} ${t}`:t}static convertFilterCriteriaToExpr(e,t){return null!==e.text&&void 0!==e.text?s.convertTextFilterCriterionToExpr(e,t):null===e.attribute||void 0===e.attribute?s.convertAttributeFilterCriterionToExpr(e,t):s.convertAttrExprFilterCriterionToExpr(e)}static buildFilterExpression(e,t){if(e&&"object"==typeof e){if(Array.isArray(e)&&e.length>0)return s.buildFilterExpression({op:i.Operators.Logical.and.op,criteria:e},t);if(Array.isArray(e.criteria)&&e.criteria.length>0||e.criterion){const r=(e.criteria||[e.criterion]).reduce(((e,i)=>[...e,s.buildFilterExpression(i,t)]),[]);let n;return n=e.op===i.Operators.Logical.exists.op&&e.attribute&&r.length>0?`${e.attribute}[${r.join(` ${i.Operators.Logical.and.op} `)}]`:r.length>0?r.join(` ${e.op===i.Operators.Logical.or.op?i.Operators.Logical.or.val:i.Operators.Logical.and.val} `):"",n?`(${n})`:n}return s.convertFilterCriteriaToExpr(e,t)}}static paginate(e,t){const r=e;if(t){if(null!==t.size&&void 0!==t.size){const e=s.getQueryParameterName(r,i.CapabilityType.LIMIT);r.url=s.addOrUpdateURLParameter(r.url,e,Math.min(t.size,i.Common.MAX_LIMIT))}if(null!==t.offset&&void 0!==t.offset&&t.offset>=0){const e=s.getQueryParameterName(r,i.CapabilityType.OFFSET);r.url=s.addOrUpdateURLParameter(r.url,e,t.offset)}}return r}static sort(e,t){const n=e,a=n.endpointDefinition.componentParameters,o=r.getKeyValue(a,i.CapabilityType.SORT_BY);if(o&&t&&Array.isArray(t)&&t.length>0){const e=t.reduce(((e,t)=>e&&t&&t.attribute?`${e},${s.buildSortExpr(t)}`:e+s.buildSortExpr(t)),"");n.url=s.addOrUpdateURLParameter(n.url,o.value.name,e)}return n}static filter(e,t,r){const n=e,a=s.getQueryParameterName(n,i.CapabilityType.FILTER),o=s.buildFilterExpression(t,r);return o&&(n.url=s.addOrUpdateURLParameter(n.url,a,o)),n}static select(e,t){const n=e,a=s.getQueryParameterName(n,i.CapabilityType.FIELDS);let o;if(n.initConfig&&n.initConfig.method!==i.Common.METHOD_TYPE_GET)return n;const c=e=>e[0]===i.Delimiters.DOLLAR,l=e=>Array.isArray(e)?e.filter((e=>!c(e))):[],h=(e,t)=>Array.isArray(t)&&!c(e)?t.map((t=>`${e}.${t}`)):[],p=e=>Array.isArray(e)&&e.reduce(((e,t)=>t&&!t.attributes?[...e,...l([t.name])]:[...e,...h(t.name,p(t.attributes))]),[]),u=e=>{const t=[];return(Array.isArray(e)?e:[e||{}]).forEach((e=>{const i=r.isObject(e)&&Object.keys(e).reduce(((t,i)=>r.isObject(e[i])?[...t,...h(i,u(e[i].items||e[i]))]:[...t,i]),[]);t.push(...l(i))})),t};let d=t&&t.type&&t.type!==i.Common.DATA_TYPE_ANY&&(t.type.items||t.type);return d?o=u(d):(d=t&&t.attributes,o=p(d)),Array.isArray(o)&&o.length>0&&(n.url=s.addOrUpdateURLParameter(n.url,a,o.join(`${i.Delimiters.COMMA}`))),n}static fetchByKeys(e){const t=e.fetchConfiguration,a=t.capability,o=t.fetchParameters.keys,c=e.endpointDefinition,l=c.componentParameters||{},h=l&&r.getKeyValue(l,i.CapabilityType.FILTER);if(t.fetchParameters&&t.fetchParameters.attributes&&s.select(e,t.fetchParameters),a===i.CapabilityType.FETCH_BY_KEYS&&h&&h.key===i.CapabilityType.FILTER&&o&&o instanceof Set&&o.size>0){const a=t.context.keyAttributes||t.context.idAttribute,l=[];if(a&&"string"==typeof a)l.push(a);else if(Array.isArray(a))l.push(...a);else{if(!c.xPrimaryKey){const e=r.getPropertiesFromResponse(c.responses),t=e&&r.searchProperty(e,i.CapabilityValues.ATTRIBUTE_X_PRIMARY_KEY);c.xPrimaryKey=Array.isArray(t)?t.pop():[]}l.push(...c.xPrimaryKey)}if(Array.isArray(l)&&l.length>0){const t={op:i.Operators.Logical.and.op,criteria:[]};if(1===l.length)t.criteria.push({op:i.Operators.Comparison.in,attribute:l[0],value:[...o]});else{const e=[...o],r={};l.forEach((e=>{r[e]=[]})),e.forEach((e=>{if(e.length===l.length)for(let t=0;t<e.length;t+=1)r[l[t]].push(e[t])})),l.forEach((e=>t.criteria.push({op:i.Operators.Comparison.in,attribute:e,value:r[e]})))}return s.filter(e,t)}n.warn("skipping, invalid key attributes")}return e}static toObject(){return{paginate:s.paginate,sort:s.sort,filter:s.filter,select:s.select,fetchByKeys:s.fetchByKeys}}}return s})),define("vb/private/services/boss/metadataTransforms",["vb/private/services/boss/transformsUtils","vb/private/types/dataProviderConstants","vb/private/services/boss/bossTransformsConstants"],((e,t,i)=>{class r{static capabilities(r){const n={},s=r.endpointDefinition,a=s.responses,o=e.getPropertiesFromResponse(a),[c]=o&&e.searchProperty(o,i.Common.PROPERTIES)||[{}],l=s&&s.componentParameters;if(l){const r=e.getKeyValue(l,i.CapabilityType.SORT_BY);if(r){const e=r.value;e&&e.in===i.CapabilityValues.IN_QUERY&&(n.sort={attributes:Object.keys(c).filter((e=>!(!1===c[e][i.CapabilityValues.ATTRIBUTE_X_SORTABLE_PROP])))})}const s=e.getKeyValue(l,i.CapabilityType.FILTER);if(s){const e=s.value;e&&e.in===i.CapabilityValues.IN_QUERY&&(n.filter={operators:t.CapabilityValues.FILTER_OPERATORS_OPS,textFilter:!1,attributes:Object.keys(c).filter((e=>!(!1===c[e][i.CapabilityValues.ATTRIBUTE_X_SEARCHABLE_PROP])))},n.fetchByKeys={implementation:i.CapabilityValues.FETCH_BY_KEYS_IMPLEMENTATION_LOOKUP,multiKeyLookup:i.CapabilityValues.FETCH_BY_KEYS_MULTI_KEY_LOOKUP_YES})}const a=e.getKeyValue(l,i.CapabilityType.LIMIT);if(a){const r=a.value;if(r&&r.in===i.CapabilityValues.IN_QUERY){n.fetchFirst={implementation:i.CapabilityValues.FETCH_FIRST_IMPLEMENTATION_ITERATION};const r=e.getKeyValue(l,i.CapabilityType.OFFSET);if(r){const e=r.value;e&&e.in===i.CapabilityValues.IN_QUERY&&(n.fetchByOffset={implementation:t.CapabilityValues.FETCH_BY_OFFSET_IMPLEMENTATION_RANDOM_ACCESS})}}}}return n}static toObject(){return{capabilities:r.capabilities}}}return r})),define("vb/private/services/boss/bossTransforms",["vb/private/services/boss/responseTransforms","vb/private/services/boss/requestTransforms","vb/private/services/boss/metadataTransforms"],((e,t,i)=>{function r(e){const t=e;Object.keys(t||{}).forEach((e=>{t[e].doesQueryEncoding=!0}))}const n=t.toObject(),s=e.toObject(),a=i.toObject();return r(n),r(s),r(a),{request:n,response:s,metadata:a}})),define("vb/private/services/catalogHandler",["vb/private/utils","vb/private/constants","vb/private/services/serviceConstants","vb/private/log","vb/private/pathHandler","vbc/private/constants","vb/private/services/endpoint","vb/private/services/catalogRegistry","vb/private/services/swaggerUtils","vb/private/services/readers/openApiObjectFactory","vb/private/services/readers/openApiUtils","urijs/URI"],((e,t,i,r,n,s,a,o,c,l,h,p)=>{const u=r.getLogger("/vb/private/services/catalogHandler"),d={getResolvedInfoOrDefault:(e,t)=>Promise.resolve({url:e,namespace:t,extensions:{[i.ExtensionTypes.SERVICES]:{},[i.ExtensionTypes.BACKENDS]:{}},chain:[]})};class g{constructor(e,t,i,r){this.config=e||{},this.config.catalog&&this.config.catalog.path&&(this.catalogPath=new n(this.config.catalog.path,this.config.relativePath||"",{allowParent:!0}).getResolvedPath()),this.catalogPath=this.catalogPath||g.getDefaultPath(),this.profile=t||"",this.registry=r,this.registry.register(o.ROOT_CATALOG,this.catalogPath)}static shouldInstall(){return!0}static getDefaultPath(){return g._defaultCatalogPath||(g._defaultCatalogPath=t.DefaultPaths.CATALOG_JSON),g._defaultCatalogPath}dispose(){this.loadPromise=null,this.registry.dispose()}getResolvedObject(i,r,n,s){return this.registry.loadPending().then((()=>{const i=n.hostname,a=(n.path||"").split(t.PATH_SEPARATOR)[1]||"",o=r||t.ExtensionNamespaces.BASE,{prefix:c,main:l}=e.parseQualifiedIdentifier(a);return c&&o!==c&&!this.registry.isVisibleExtension(o,c)?Promise.reject(new Error(`The extension '${c}' is not visible from '${r}'`)):this._resolve(l,c||o,n,i,!c,s).then((e=>e&&o!==e.namespace&&!this.registry.ignoreExtensionAccessFlag(i)&&!0!==e.extensionAccess?Promise.reject(new Error(`The catalog object '${l}' from '${c}' is not exported so it cannot be used by '${o}'`)):e))}))}_resolve(e,t,i,r,n,s){return this._findObjectInNamespaces(e,t,r,n).then((i=>{let n=t;if(i){const t=g._filterCatalogObject(i.catalogObject,r);return n=i.namespace,Promise.all([n,t,g.createOpenApiMetadata(e,t,this.catalogPath)])}throw new Error(`The catalog object '${r}/${e}' was not found in '${t}'`)})).then((([i,n,s])=>n?(s&&(n.metadata=s),Promise.all([i,n,this._resolveServer(r,t,e,n)])):[])).then((([t,n,a])=>{if(n){const o={},c=a.getUrl(this.config,i,r,e,s,o),l=this._createResolvedInfo(n,a,c,r,e,t);return l.variables=o||{},u.info("catalog handler, resolving",e,"to",l.url),l}return u.error("No catalog object matching type and id",r,e,"was found"),null}))}_findObjectInNamespaces(e,i,r,n,s){return this.registry.get(i).then((t=>t&&t[r]&&t[r][e])).then((a=>{if(a)return{catalogObject:a,namespace:i};if(i!==t.ExtensionNamespaces.BASE&&!0===n){let n=Promise.resolve();const a=this.registry.getRequiredExtensionIds(i);return a.length>0&&(n=a.reduce(((t,i)=>t.then((t=>t||this._findObjectInNamespaces(e,i,r,!0,!0)))),n)),!0!==s&&(n=n.then((i=>i||this._findObjectInNamespaces(e,t.ExtensionNamespaces.BASE,r)))),n}}))}static _filterCatalogObject(e,t){let r=e;return r&&(r=Object.assign({},r),t===i.ExtensionTypes.BACKENDS?(delete r.proxyUrls,delete r.tokenRelayUrls,Array.isArray(r.servers)&&(r.servers=r.servers.map((e=>{const t=e[i.VB_EXTENSIONS];if(t&&(t.proxyUrls||t.tokenRelayUrls)){u.error("service catalog backends should not contain proxyUrls or tokenRelayUrls;","removing and continuing");const r=Object.assign({},t);return delete r.proxyUrls,delete r.tokenRelayUrls,Object.assign({},e,{[i.VB_EXTENSIONS]:r})}return e})))):t===i.ExtensionTypes.SERVICES&&(e.openapi||u.warn("deprecated catalog services syntax. headers will not be merged with backends"))),r}static createOpenApiMetadata(e,t,i){return Promise.resolve().then((()=>{if(!t)throw new Error(`Catalog object "${e}" not found in catalog.json.`);return t.openapi?g.getEndpointConfiguration(e,t,i):null})).then((e=>{if(e){const i=new p(e.url),r=i.path(),n=decodeURIComponent(i.query()),a=e.method.toLowerCase(),o=e.headers[s.Headers.VB_INFO_EXTENSION];return{openapi:t.openapi,path:r,query:n,extensions:o?c.parseServiceText(o):{},method:a}}return t.openapi?{openapi:t.openapi}:null}))}static _resolvedUrl(i,r){const n=e.uriSafeOperation((e=>new e(i))),s=n.clone().search("").toString(),a=s.endsWith(t.PATH_SEPARATOR),o=(r.path.startsWith(t.PATH_SEPARATOR)?r.path.substring(1):r.path).split(t.PATH_SEPARATOR);o.shift();let c,l=o.join(t.PATH_SEPARATOR);if(l.startsWith(t.PATH_SEPARATOR)&&(l=l.substring(1)),l){c=`${s}${a?"":t.PATH_SEPARATOR}${l}`}else c=a&&s===`${i}${t.PATH_SEPARATOR}`?s.substring(0,s.length-1):s;const h=[r.query,n.query()].filter((e=>!!e));return h.length&&(c=`${c||""}?${h.join("&")}`),c}mergeExtensions(...e){e.forEach((e=>{Object.keys(e).forEach((t=>{void 0===e[t]&&delete e[t]}))}));const t=e.reduce(((e,t)=>Object.assign(e,t&&t.headers||{})),{});return Object.assign({},...e,{headers:t})}getPropertiesForCrossObjectMerge(e,t,r,n){const s=Object.assign({},t);if(r===i.ExtensionTypes.SERVICES&&n===i.ExtensionTypes.BACKENDS){e&&e.metadata&&e.metadata.services&&e.metadata.services.openapi||delete s.headers}else u.warn("unexpected source or destination types. source =",r,"destination =",n);return s}_findServer(e=[]){const t=h.findServerForProfile(e,this.profile);return u.info("catalog handler using server with url",t.getUrl(),"for profile",this.profile),t}_resolveServer(e,i=t.ExtensionNamespaces.BASE,r,n){return Promise.resolve().then((()=>this.registry.getCatalogOverride(e,i,r))).then((e=>e||this._findServer(n.servers)))}_createResolvedInfo(e,t,r,n,s,a){const o=e.info&&e.info[i.VB_EXTENSIONS]||{},c={headers:e.headers,transforms:e.transforms},l=this.mergeExtensions({},c,o,t[i.VB_EXTENSIONS]||{}),h=n===i.ExtensionTypes.SERVICES?!0===(l&&l.extensionAccess):!0===e.extensionAccess;return Object.assign({},{namespace:a,type:n,name:s,url:r,extensionAccess:h,extensions:{[n]:l},metadata:{[n]:e.metadata},serviceType:e.serviceType})}getNames(){return this.registry.getAllNames()}static getEndpointConfiguration(e,t,i){return Promise.resolve().then((()=>{const r=l.get(t,{definitionUrl:i}).pathObjects[0];if(!r)return null;const n=r.name,s=r.getOperationObjects()[0];if(!s)return null;const o=s.name,c=a.createEmptyService(e);return new a({name:`_internal_${e}`,service:c,protocolRegistry:d,pathKey:n,pathObject:r,operationKey:o,operationObject:s}).getConfig()}))}}return g._defaultCatalogPath=void 0,g.PROTOCOLS=[s.VbProtocols.CATALOG],g})),define("vb/private/services/definition/catalogFactory",["vb/private/configLoader","vb/private/services/definition/openApiServiceDefFactory","vb/private/services/serviceUtils","vbc/private/constants"],((e,t,i,r)=>{const n="catalogServices";class s extends t{constructor(e,t){super(e,t),this._catalogPaths=t.extensions&&t.extensions.catalogPaths,this._initializeServiceMapPromise=null,this._serviceFileMap={}}findDeclaration(e){return this._serviceFileMap[e.serviceName]}updateServiceDeclarations(){if(!this._initializeServiceMapPromise){const e=this._serviceFileMap;this._initializeServiceMapPromise=Promise.resolve().then((()=>i.getAndRegisterAllCatalogNames(this.services))).then((t=>{t&&t.services&&Array.isArray(t.services)&&t.services.forEach((t=>{const i=t;e[i]||(e[i]={path:`${r.VbProtocols.CATALOG}://services/${i}`,type:n})}))}))}return this._initializeServiceMapPromise}getAndRegisterCatalogNames(){return Promise.resolve().then((()=>this._catalogPaths?(Object.keys(this._catalogPaths).forEach((t=>{e.catalogRegistry.register(t,this._catalogPaths[t])})),this._catalogPaths={},e.catalogRegistry.getNames(this.services.namespace)):null))}}return s.TYPE=n,s})),define("vb/private/services/definition/extensionServiceMapFactory",["vb/private/services/definition/serviceMapFactory"],(e=>class extends e{constructor(t,i){super(t,i);const r=this._serviceFileMap,n=i.extensionServiceMap;n&&Object.keys(n).forEach((t=>{const i=t;r[i]||(r[i]={path:n[t],type:e.TYPE})}))}})),define("vb/private/services/extensionServices",["vb/private/constants","vb/private/utils","vb/private/services/services","vb/private/services/definition/extensionServiceMapFactory","vb/private/services/definition/catalogFactory","vb/private/services/definition/programmaticPluginFactory","vb/private/services/definition/serviceMapFactory","vb/private/services/definition/serviceProviderFactory"],((e,t,i,r,n,s,a,o)=>class extends i{getServiceDefTypes(){return[s.TYPE,n.TYPE,a.TYPE,o.TYPE]}createServiceDefFactory(e,t={}){switch(e){case a.TYPE:return new r(this,t);case n.TYPE:return new n(this,t);default:return super.createServiceDefFactory(e,t)}}getDefinitionPath(i){const r=i.startsWith(e.RELATIVE_FOLDER_PREFIX)?this._relativePath:this.namespace;return t.isAbsolutePath(i)?i:`${e.EXTENSION_PATH}${r}/${i}`}})),define("vb/private/services/operationRefEndpoint",["vb/private/log","vb/private/services/servicesManager","vb/private/services/uriTemplate","vb/private/services/endpointReference"],((e,t,i,r)=>{const n=e.getLogger("/vb/private/services/operationRefEndpoint");return class{constructor(e,t,s,a){this.url=t;const o=((s||"").split("#")[1]||"").split("/").map((e=>e.replace(/~1/g,"/")));4===o.length&&o[3]||n.warn('Unable to determine HTTP method from "operationRef", using "GET"',s),this.method=o[3]||"GET",this.uriTemplate=new i(t),this.endpointReference=new r({serviceId:e,url:t,operationRef:s},a)}init(){return this.servicePromise||(this.servicePromise=Promise.resolve().then((()=>this.endpointReference.serviceId?t.FindDefinition(this.endpointReference).then((e=>(this.service=e?e.service:null,this.service?this.service.load():null))).catch((e=>{n.warn("Error while loading parts of the endpoint: ",this.url,e)})):(this.service=null,null))).then((()=>this))),this.servicePromise}getConfig(e,t){return this.init().then((()=>{const i=t&&t.ignoreMissingParams;return{url:this.uriTemplate.replace(e,i),method:this.method,headers:{},requestContentTypes:[],responseContentTypes:[]}}))}getMetadata(){return{}}getRequestTransforms(){return this.service&&this.service.getRequestTransforms?this.service.getRequestTransforms():{}}getResponseTransforms(){return this.service&&this.service.getResponseTransforms?this.service.getResponseTransforms():{}}getMetadataTransforms(){return this.service&&this.service.getMetadataTransforms?this.service.getMetadataTransforms():{}}}})),define("vb/private/services/operationRefEndpointProvider",["vb/private/log","vb/private/configLoader","vb/private/services/operationRefEndpoint","vb/private/services/services"],((e,t,i,r)=>{const n=e.getLogger("/vb/private/services/operationRefEndpointProvider");class s{static getOperationRefUrl(e){return e&&e.split("#")[0]||""}static getEndpoint(e,t){return s.getMapping(e).then((r=>r?new i(r.serviceName,e.url,e.operationRef,t).init():(n.info("Unable to map URL, using Endpoint with no Service",e.url),new i(null,e.url,e.operationRef,t).init())))}static getMapping(e){return t.urlMapper.getUrlMapping(e.url).then((i=>{if(!i){const i=s.getOperationRefUrl(e.operationRef);return t.urlMapper.getUrlMapping(i).then((r=>{if(r&&r.serviceName){return s.createServicesModel(r.serviceName,i).load().then((i=>(console.log(i),t.urlMapper.getUrlMapping(e.url))))}return null}))}return i}))}static createServicesModel(e,i){return new r({relativePath:"",serviceFileMap:{[e]:i},expressionContext:{},protocolRegistry:t.protocolRegistry})}}return s})),define("vb/private/services/ramp/expandableField",[],(()=>{const e=e=>"@default"===e,t=e=>e&&e.startsWith("!");class i{constructor(e,t,r){if(this.parent=t,this.parentName=r,this.fields=[],this.children=[],this.excludes=[],"string"!=typeof(n=e)||!["object","object[]","any","any[]"].includes(n)){const t=Array.isArray(e)?e[0]||{}:e;Object.keys(t).forEach((e=>{const r=t[e];if(r&&"object"==typeof r){const t=r.items||r;t&&Array.isArray(t)&&"links"!==e&&this.children.push(new i(t,this,e))}else"links"!==e&&this.fields.push(e)}),this)}var n}addComponentFetchAttributes(r){(Array.isArray(r)?r:[r||{}]).forEach((r=>{if("string"!=typeof r&&(!r.name||r.attributes&&r.attributes.length)){if(r.name&&r.attributes&&r.attributes.length>0)if(e(r.name))this.hasDefaultAttribute=!0;else if(t(r.name))this.excludes.push(r.name.substring(1));else{let e=this.children.find((e=>e.parentName===r.name));e||(e=new i({},this,r.name),this.children.push(e)),e.addComponentFetchAttributes(r.attributes)}}else{const i="string"==typeof r?r:r.name;e(i)?this.hasDefaultAttribute=!0:t(i)?this.excludes.push(i.substring(1)):this.fields.indexOf(i)<0&&this.fields.push(i)}}))}getPrefix(){let e=this;const t=[];for(;e&&e.parentName;)t.unshift(e.parentName),e=e.parent;return t.join(".")+(t.length?":":"")}getQueryParameterName(){return"fields"}toString(){let e;return e=this.hasDefaultAttribute?this.getPrefix()+(this.excludes.length?this.excludes.map((e=>"-"+e)).join(","):"*"):this.fields.length?this.getPrefix()+this.fields.join(","):"",this.children.forEach((t=>{const i=t.toString();i&&(e+=(e?";":"")+i)}),this),e}}return i})),define("vb/private/services/ramp/filterCriterionUtils",["vb/private/log","urijs/URI","vb/private/types/dataProviderConstants"],((e,t,i)=>{const r=(()=>{const e={};return i.CapabilityValues.FILTER_OPERATORS_OPS.forEach((t=>{const i=t.replace("$","").toUpperCase();return e[i]=t,e})),e})();class n{static encodeValue(e){return"string"==typeof e?`'${e}'`:e}static getFilterOpsMap(){return r}static isEmptyValue(e){return void 0===e}static escapeSingleQuotes(e){const t="string"==typeof e&&e.replace(/'/g,"''");return"string"==typeof t?t:e}static isAttributeOperator(e){return e===r.EQ||e===r.NE||e===r.GT||e===r.GE||e===r.LT||e===r.LE||e===r.SW||e===r.EW||e===r.CO||e===r.PR}static isUnaryAttributeOperator(e){return e===r.PR}static isAttributeCriterion(e){return e&&"object"==typeof e&&n.isAttributeOperator(e.op)&&e.attribute&&(n.isUnaryAttributeOperator(e.op)||!n.isEmptyValue(e.value))&&(!e.criteria||Array.isArray(e.criteria)&&0===e.criteria.length)}static wrapInParentheses(e){return`(${e})`}static buildAttributeQuery(e,t){if(!n.isAttributeCriterion(e))return"";let i="";const s=e.op,a=n.escapeSingleQuotes(e.value),o=e.attribute;switch(s){case r.EQ:i=null===a?"is null":`= ${n.encodeValue(a)}`;break;case r.NE:i=`!= ${n.encodeValue(a)}`;break;case r.GT:i=`> ${n.encodeValue(a)}`;break;case r.GE:i=`>= ${n.encodeValue(a)}`;break;case r.LT:i=`< ${n.encodeValue(a)}`;break;case r.LE:i=`<= ${n.encodeValue(a)}`;break;case r.SW:i=`LIKE '${a}%'`;break;case r.EW:i=`LIKE '%${a}'`;break;case r.CO:i=`LIKE '%${a}%'`;break;case r.PR:i="is not null"}if(i){const e=`${o} ${i}`;return t?n.wrapInParentheses(e):e}return""}static isCompoundOperator(e){return e&&(e===r.AND||e===r.OR)}static isSingularCompoundCriterion(e){return!(e.op&&!n.isCompoundOperator(e.op))&&(e.criteria&&Array.isArray(e.criteria)&&1===e.criteria.length&&!e.attribute&&!e.value)}static isPluralCompoundCriterion(e){return!(e.op&&!n.isCompoundOperator(e.op))&&(e.criteria&&Array.isArray(e.criteria)&&e.criteria.length>1&&!e.attribute&&!e.value)}static isCompoundCriterion(e){let t=!0;return e&&"object"==typeof e&&(n.isSingularCompoundCriterion(e)||n.isPluralCompoundCriterion(e))?e.criteria.forEach((e=>{!t||n.isTextCriterion(e)||n.isAttributeCriterion(e)||n.isCompoundCriterion(e)||(t=!1)})):t=!1,t}static buildCompoundQuery(e,t,i){let n,s=t;switch(e){case r.OR:n=" or ";break;case r.AND:default:n=" and "}return s=s&&n?s+n+i:`${i}`,s}static buildQueryExpression(e,t,i,r){let s=i||"",a=r||!1;return n.isCompoundCriterion(t)?t.criteria.forEach(((i,r,o)=>{o.length>1&&(a=!0),s=n.buildCompoundQuery(t.op,s,n.buildQueryExpression(e,i,"",a)),r===o.length-1&&a&&(s=n.wrapInParentheses(s))})):n.isAttributeCriterion(t)&&(s=n.buildAttributeQuery(t,a)),s}static isTextCriterion(e){return e&&"object"==typeof e&&!n.isEmptyValue(e.text)}}return n})),define("vb/private/services/ramp/rampTransforms",["vb/private/log","urijs/URI","vb/private/types/dataProviderConstants","vb/private/services/ramp/expandableField","vb/private/services/ramp/filterCriterionUtils"],((e,t,i,r,n)=>{const s=e.getLogger("/vb/private/services/ramp/rampTransforms"),a="?";function o(e,i,r){if(null!=r){const n=e.indexOf(a)>=0?"&":a,o=r.toString();if(o)return`${e}${n}${i}=${t.encodeQuery(o)}`;s.warn("skipping empty transform parameter:",i)}return e}function c(e){const t=e;Object.keys(t||{}).forEach((e=>{t[e].doesQueryEncoding=!0}))}function l(e,t){if(Object.prototype.hasOwnProperty.call(e,t)&&e[t])return{key:t,value:e[t]};let i,r;for(i=0;i<Object.keys(e).length;i++)if("object"==typeof e[Object.keys(e)[i]]&&(r=l(e[Object.keys(e)[i]],t),null!=r))return r;return null}const h=(()=>{function e(e,t,i){const r=e,s=function(e,t,i){const r=i&&i["vb-textFilterAttributes"];let s,a,o=t;if(o&&n.isCompoundCriterion(o)){const e=o.criteria[0];s=e.text,a=!0}else n.isTextCriterion(o)&&(s=o&&o.text);if(null!=s){const e={op:"$or",criteria:[]};(r||[]).forEach((t=>{const i={op:"$sw",attribute:t,value:s};e.criteria.push(i)})),a?o.criteria[0]=e:o=e}return o}(0,t,i);if("object"==typeof s&&Object.keys(s).length>0){const e=n.buildQueryExpression(r,s);e&&(r.url=o(r.url,"q",e))}return r}function t(e,t){const i=e;let r;return t&&Array.isArray(t)&&t.length>0&&t.forEach((e=>{if(e.attribute&&("eq"===(i=e.op)||"ne"===i||"gt"===i||"ge"===i||"lt"===i||"le"===i||"sw"===i||"ew"===i||"co"===i||"pr"===i)&&(t=e.value,"pr"===e.op||void 0!==t)){r?r+=" and ":r="";const t=n.escapeSingleQuotes(e.value);r+=`${e.attribute} ${function(e,t){switch(e){case"eq":return null===t?"is null":`= ${n.encodeValue(t)}`;case"ne":return`!= ${n.encodeValue(t)}`;case"gt":return`> ${n.encodeValue(t)}`;case"ge":return`>= ${n.encodeValue(t)}`;case"lt":return`< ${n.encodeValue(t)}`;case"le":return`<= ${n.encodeValue(t)}`;case"sw":return`LIKE '${t}%'`;case"ew":return`LIKE '%${t}'`;case"co":return`LIKE '%${t}%'`;case"pr":return"is not null"}return e}(e.op,t)}`}var t,i})),r&&(i.url=o(i.url,"q",r)),i}function i(i,r,n){return r&&Array.isArray(r)&&r.length>0?t(i,r):e(i,r,n)}function c(e,t,i){const n=e;if(n.initConfig&&"GET"!==n.initConfig.method)return n;if(function(e,t){const i=e.indexOf(a);return i>=0&&(e.indexOf(`?${t}`)===i||e.indexOf(`&${t}`)>i)}(n.url,"fields"))return n;const s=t&&t.type&&(t.type.items||t.type),c=t&&t.attributes;if(s&&"object"==typeof s||c){const e=new r(s||{});e.addComponentFetchAttributes(c);const t=e.toString(),i=e.getQueryParameterName();t&&(n.url=o(n.url,i,t))}return n}return{filter:(e,t,r)=>i(e,t,r),sort:(e,t)=>function(e,t,i){const r=e;let n;return t&&Array.isArray(t)&&t.length>0&&t.forEach((e=>{n?n+=",":n="";let t="";e.direction&&(t="ascending"===e.direction?":asc":":desc"),n+=e.attribute+t})),n&&(r.url=o(r.url,"orderBy",n)),r}(e,t),paginate:(e,t)=>function(e,t,i){const r=e;if(t){let e=t.size;e<0&&(e=1e3),r.url=o(r.url,"limit",e),r.url=o(r.url,"offset",t.offset)}return r}(e,t),select:(e,t)=>c(e,t),fetchByKeys:e=>function(e){const t=e,r=t.fetchConfiguration,a=r.capability,o=r.fetchParameters.keys,c=t.endpointDefinition.parameters||{},h=l(c,"q");if("fetchByKeys"===a&&h&&"q"===h.key&&o&&o instanceof Set&&o.size>0){const t=r.context.keyAttributes||r.context.idAttribute;if(t&&"string"==typeof t){const r={op:n.getFilterOpsMap().OR,criteria:[]};return o.forEach((e=>{r.criteria.push({op:n.getFilterOpsMap().EQ,attribute:t,value:e})})),i(e,r)}s.warn("The key attribute provided",t,"requires that author build a custom fetchByKeys transforms function.")}return l(c,"limit"),l(c,"offset"),t}(e)}})(),p={paginate:(e,t)=>function(e,t){const i={};if(e.body){const t=e.body;t.totalResults>=0&&(i.totalSize=t.totalResults),i.hasMore=t.hasMore}return i}(e)},u={capabilities:e=>function(e){const t={},r=e.endpointDefinition,s=r&&r.parameters;if(s){let e,a,o,c;const h=s.query||{};if(h){const r=l(h,"orderBy");if(r){const t=r.value;e=t&&"query"===t.in&&"orderBy"===t.name}const s=l(h,"q");if(s){const e=s.value;a=e&&"query"===e.in&&"q"===e.name}const p=l(h,"limit");if(p){const e=p.value;o=e&&"query"===e.in&&"limit"===e.name}if(o){t.fetchFirst={implementation:"iteration"};const e=l(h,"offset");if(e){const t=e.value;c=t&&"query"===t.in&&"offset"===t.name}c&&(t.fetchByOffset={implementation:i.CapabilityValues.FETCH_BY_OFFSET_IMPLEMENTATION_RANDOM_ACCESS})}e&&(t.sort={attributes:i.CapabilityValues.SORT_ATTRIBUTES_MULTIPLE}),a&&(t.filter={operators:Object.values(n.getFilterOpsMap()),textFilter:!0},t.fetchByKeys={implementation:"lookup",multiKeyLookup:"yes"})}const p=s.path;a||e||o||"GET"!==r.method||!p||(t.fetchByKeys={implementation:"lookup",multiKeyLookup:"no"})}return t}(e)};return c(h),c(p),c(u),{request:h,response:p,metadata:u}})),define("vb/private/serviceWorker/serviceWorkerManagerFactory",["vb/private/utils"],(e=>{class t{static createServiceWorkerManager(i){let r;return t.getServiceWorkerManagerClass(i).then((t=>(r=new t,e.getResource("vbsw/private/serviceWorkerManager")))).then((e=>(e.setInstance(r),e)))}static getServiceWorkerManagerClass(t={}){let i="vbsw/private/serviceWorkerManagerClass";return e.getResource("vbc/private/pwa/pwaUtils").then((r=>(!t.IS_DT_MODE&&r.isWebPwaConfig(t)&&(i="vb/private/pwa/pwaServiceWorkerManagerClass"),e.getResource(i))))}}return t})),define("vb/private/stateManagement/applicationUtils",["vb/private/action/assignmentUtils"],(e=>({assignmentUtils:e}))),define("vb/private/stateManagement/packageFragmentReferenceable",["vb/private/stateManagement/packageFragment","vb/private/constants"],((e,t)=>class extends e{getPackage(e){return e&&e.base&&e.base.package}getScopeResolverMap(){const e=super.getScopeResolverMap();if(!e[t.GLOBAL_PREFIX]){const i=this.parent.base&&this.parent.base.getScopeResolverMap()||{};i[t.GLOBAL_PREFIX]&&(e[t.GLOBAL_PREFIX]=i[t.GLOBAL_PREFIX])}return e}})),define("vb/private/stateManagement/pageModuleViewModel",["vb/private/constants","vb/private/utils","vb/private/stateManagement/baseModuleViewModel"],((e,t,i)=>class extends i{constructor(e){super(e);let i=null;this.connected=e=>{if(e&&e.length>0){const r=e[0].parentNode;!t.vbModuleObserver.getIntersectionObserver()&&r&&r.getElementsByTagName("oj-vb-fragment").length>0&&(i=t.vbModuleObserver.getIntersectionObserver(r))}},this.disconnected=r=>{r&&r.length>0&&i&&(t.vbModuleObserver.clearIntersectionObserver(),i=null),e.disconnected(r)}}getPropertyDescriptors(t){const i=t,r=super.getPropertyDescriptors(i);return r[e.routerModuleConfig]={value:i.moduleConfig,enumerable:!0},r}})),define("vb/private/types/arrayDataManager",["vb/private/types/utils/dataProviderUtils","vb/private/types/dataProviderConstants"],((e,t)=>{const i={DEFAULT:"default",DEPRECATED:"deprecated"},r=e=>e&&(e instanceof Set?e.size:e.length);return class{constructor(e,t,i="default"){this.adp=e,this.reInit(t,i)}static get DATAPROVIDER_EVENT_MODES(){return i}reInit(e,t){this.dataArray=e,this.mode=t,this.dataProp=this.mode===i.DEPRECATED&&this.adp.getValue().data}appendToData(e){this.dataArray.push(e),this.isDeprecatedMode()&&this.dataProp.push(e)}applyDataMutations(e){let t,i,n,s,a=!1;const o=this;if(e.detail.remove){const c=e.detail.remove;({data:t}=c),i=c.keys||c.metadata&&c.metadata.map((e=>e.key)),({indexes:s}=c),n=r(i),i&&0!==n||s&&0!==s.length||!t||!(t.length>0)||(i=o.getKeysFromData(t),n=r(i),n||(s=o.getIndexesFromData(t))),i&&n>0?a=!!o.removeDataAtKeys(i,t)||a:s&&s.length>0&&(a=!!o.removeDataAtIndexes(s,t)||a)}if(e.detail.add){const c=e.detail.add;({data:t}=c),i=c.keys||c.metadata&&c.metadata.map((e=>e.key)),n=r(i),({indexes:s}=c);const{afterKeys:l}=c,{addBeforeKeys:h}=c;t&&t.length>0&&(a=i&&n>0&&n<=t.length?h&&h.length>0?!!o.insertAtAddBeforeKeys(h,t)||a:s&&s.length>0?!!o.insertAtIndexes(s,t)||a:l&&l.length>0?!!o.insertAtAfterKeys(l,t)||a:!!o.insertAtEnd(t)||a:s&&s.length>0&&s.length===t.length?!!o.insertAtIndexes(s,t)||a:!!o.insertAtEnd(t)||a)}if(e.detail.update){const c=e.detail.update;({data:t}=c),i=c.keys||c.metadata&&c.metadata.map((e=>e.key)),({indexes:s}=c),n=r(i),t&&t.length>0&&(i&&0!==n||s&&0!==s.length||(i=o.getKeysFromData(t),n=r(i),n||(s=o.getIndexesFromData(t))),s&&s.length>0&&s.length===t.length?a=!!o.updateDataAtIndexes(s,t)||a:i&&n>0&&n===t.length&&(a=!!o.updateDataAtKeys(i,t)||a))}return a}isDeprecatedMode(){return this.mode===i.DEPRECATED}getIndexByKey(i){let r=-1;const n=this.dataArray,s=this.adp.options[t.DataProviderIdAttributeProperty.KEY_ATTRIBUTES];if(s){const t=e.getIdAttributeHelper(s);n&&t&&n.some(((e,n)=>!!t.compare(t.getKey(e),i)&&(r=n,!0)))}return r}getKeysFromData(i){if(i){const n=t.DataProviderIdAttributeProperty.KEY_ATTRIBUTES,s=e.getIdAttributeHelper(this.adp.options[n]).getKeys(i);if(r(s)<=i.length)return s}return null}getIndexesFromData(i){const r=t.DataProviderIdAttributeProperty.KEY_ATTRIBUTES,n=this.adp.options[r]||this.adp.options[r]===t.DataProviderIdAttribute.AT_INDEX;if(i&&n){return e.getIdAttributeHelper(this.adp.options[r]).getIndices(i)}return null}getDataItemForKey(i,r){let n;if(r){const s=t.DataProviderIdAttributeProperty.KEY_ATTRIBUTES,a=e.getIdAttributeHelper(this.adp.options[s]);r&&a&&r.some((e=>!!a.compare(a.getKey(e),i)&&(n=e,!0)))}return n}insertAtIndexes(e,t){let i;const r=[],n={};return e.forEach(((e,i)=>{n[e]=t[i]})),e.forEach((e=>{const t=n[e];e>=0?(this.spliceData(e,0,t),i=i||{},i[e]=t):-1===e?(this.appendToData(t),i=i||{},i[e]=t):r.push(e)})),r.length>0&&this.adp.log.error("skipped adding items at the specified indices",r,"because the 'indexes' are not valid"),!i&&t?this.adp.log.finer("unable to add items",t,"at the indexes",e):this.adp.log.finer("added items at indexes",Object.keys(i),"with values",Object.values(i)),!!i}insertAtAfterKeys(e,t){const i=[];return e.forEach((e=>{const t=this.getIndexByKey(e);i.push(t<0?-1:t)})),this.insertAtIndexes(i,t)}insertAtAddBeforeKeys(e,t){const i=[];return e.forEach((e=>{const t=this.getIndexByKey(e);i.push(t<0?-1:t)})),this.insertAtIndexes(i,t)}insertAtEnd(e){let t=!1;return e.forEach((e=>{this.appendToData(e),t=!0})),t}removeDataAtIndexes(e,t){let i,r;return e&&(e.sort(((e,t)=>t-e)),e.forEach((e=>{this.dataArray[e]?(this.spliceData(e,1),i=i||[],i.push(e)):(r=r||[],r.push(e))}))),r&&this.adp.log.error("skipped removing items because an item could not be located at the specified indexes:",r),i?this.adp.log.finer("removed items at indexes",i):this.adp.log.finer("unable to remove items",t,"as they no longer exist"),!!i}removeDataAtKeys(e,t){const i=[];return e.forEach((e=>{const t=this.getIndexByKey(e);t>=0&&i.push(t)})),this.removeDataAtIndexes(i,t)}spliceData(e,t,i){i?(void 0===this.dataArray[e]?this.dataArray[e]=i:this.dataArray.splice(e,t,i),this.isDeprecatedMode()&&this.dataProp.splice(e,t,i)):void 0!==this.dataArray[e]&&(this.dataArray.splice(e,t),this.isDeprecatedMode()&&this.dataProp.splice(e,t))}updateDataAtKeys(e,t){let i,r;const n=e instanceof Set;return e.forEach(((e,s)=>{const a=n?this.getDataItemForKey(e,t):t[s],o=this.getIndexByKey(e);o>=0?(this.spliceData(o,1,a),i=i||{},i[o]=a):(r=r||[],r.push(e))})),r&&this.adp.log.error("unable to update items because an item with the keys",r,"could not be located"),i?this.adp.log.finer("updated items at indexes",Object.keys(i),"with values",Object.values(i)):this.adp.log.finer("unable to update items",t,"with these keys",e),!!i}updateDataAtIndexes(e,t){let i;const r=[],n={};return e.forEach(((e,i)=>{n[e]=t[i]})),e.sort(((e,t)=>t-e)),e.forEach((e=>{this.dataArray[e]?(this.spliceData(e,1,n[e]),i=i||{},i[e]=n[e]):r.push(e)})),r.length>0&&this.adp.log.error("skipped updating items because no item exists at indexes",r),!i&&t?this.adp.log.finer("unable to update items",t,"at these indexes",e):this.adp.log.finer("updated items at indexes",Object.keys(i),"with values",Object.values(i)),!!i}}})),define("vb/private/types/utils/jsonDiffer",["vb/private/utils","vb/private/types/dataProviderConstants","vb/private/types/utils/dataProviderUtils","jsondiff"],((e,t,i,r)=>{const n="_t",s=r.create();class a{constructor(e){this.customPlugin=this.customPlugin||a.setupPlugin(),this.idAttribute=e}processDeltas(t,i){const r={detail:{}};let s=this.diffWithObjectHash(t,i),o=e.cloneObject(t);const c={},l={};if(s&&"a"===s._t){const e=Object.keys(s).filter((e=>e!==n));e.length>0&&(e.forEach((e=>{const t=s[e];if(Number.isNaN(parseInt(e,10))&&Array.isArray(t)&&3===t.length&&0===t[1]&&0===t[2]){const i=t[0],r=parseInt(e.substring(1),10);o[r]=void 0,a.buildDeltaItemKeys(i,this.idAttribute,r,c)}})),Object.keys(c).length>0&&(r.detail.remove=c))}if(o=o.filter((e=>void 0!==e)),s=this.diffWithObjectHash(o,i),s&&"a"===s._t){Object.keys(s).filter((e=>e!==n)).forEach((e=>{const t=s[e];if(!Number.isNaN(parseInt(e,10))&&Array.isArray(t)&&1===t.length){const i=t[0],r=parseInt(e,10);l.data=l.data||[],l.data.push(i),o.splice(r,0,i),a.buildDeltaItemKeys(t,this.idAttribute,r,l)}})),Object.keys(l).length>0&&(r.detail.add=l)}if(s=this.diffWithObjectHash(o,i),s&&"a"===s._t){const e=Object.keys(s).filter((e=>e!==n));if(e.length>0){const t={};e.forEach((e=>{const r=s[e];if("object"==typeof r&&!Array.isArray(r)){const r=parseInt(e,10),n=i[r];t.data=t.data||[],t.data.push(n),a.buildDeltaItemKeys(n,this.idAttribute,r,t)}})),Object.keys(t).length>0&&(r.detail.update=t)}}return r}static buildDeltaItemKeys(e,t,r,n={}){const s=n,a=i.getIdAttributeHelper(t),o=a.getCapabilities()||{};if(t&&"none"!==o.getKeys){const t=e&&Array.isArray(e)?a.getKeys(e):a.getKeys([e]),i=[];t.forEach((e=>{i.push(e)})),s.keys=s.keys||new Set,s.keys.add(i[0])}return r>=0&&(s.indexes=s.indexes||[],s.indexes.push(r)),s}diffWithNoObjectHash(e,t){return s.diff(e,t)}diffWithObjectHash(e,t){return this.customPlugin.options(a.getPluginOptions(this.idAttribute,e,t)),this.customPlugin.diff(e,t)}static getPluginOptions(e,t,r){return{objectHash:n=>{let s;const a=()=>{if(void 0!==s)return s;const e=i.getIdAttributeHelper("@value");return s=e.getKey(n),JSON.stringify(s)},o=Array.isArray(t)&&t.indexOf(n)>=0||Array.isArray(r)&&r.indexOf(n)>=0;if(n&&e&&o&&("string"==typeof e||Array.isArray(e))){const t=i.getIdAttributeHelper(e).getKey(n);if("@value"===e||Array.isArray(e))return JSON.stringify(t);if("@index"===e)return a();if(null!=t)return t}return a()},arrays:{detectMove:!1},cloneDiffValues:!1}}static setupPlugin(){return r.create()}}return a})),define("vb/private/types/arrayDataProvider",["knockout","vb/private/constants","ojs/ojarraydataprovider","ojs/ojdataprovider","vb/helpers/mixin","vb/private/types/builtinExtendedTypeMixin","vb/private/log","vb/private/utils","vb/private/types/utils/dataProviderUtils","vb/private/types/dataProviderConstants","vb/private/types/utils/jsonDiffer","vb/private/stateManagement/stateUtils","vb/private/types/arrayDataManager","ojs/ojdatasource-common"],((e,t,i,r,n,s,a,o,c,l,h,p,u)=>{const d=a.getLogger("/vb/types/ArrayDataProvider"),g=new r.DataProviderRefreshEvent;class v extends(n(i).with(s)){constructor(){const i={implicitSort:[],get idAttribute(){return this.keyAttributes},set idAttribute(e){this.keyAttributes=e},keyAttributes:undefined},r=e.observableArray([]);super(r,i),this._dataObservable=r,this.jsonDiffer=void 0,this.adm=void 0,this.log=d,this.useKeyAttributes=void 0,this.variableLifecycleStage=t.VariableLifecycleStage.INIT}activate(){if(this.variableLifecycleStage===t.VariableLifecycleStage.ACTIVE)return void this.log.fine("skipping activation for variable",this.id,"because it is already active");this.variableLifecycleStage=t.VariableLifecycleStage.ACTIVE;const i=this.getValue()||{},r=l.DataProviderIdAttributeProperty.KEY_ATTRIBUTES,n=l.DataProviderIdAttributeProperty.ID_ATTRIBUTE;this.useKeyAttributes=!0;const s=i&&i[n];if(i&&i[r]){const e=c.unwrapData(i[r]);this.options[r]=e,s&&this.log.warn("The property 'idAttribute' with value '",s,"' is ignored","as the property 'keyAttributes'","is also configured for the ArrayDataProvider",this.id,". 'idAttribute' is deprecated and will be removed in future releases.","Use 'keyAttributes' instead.")}else if(s){const e=c.unwrapData(i[n]);this.options[n]=e,this.useKeyAttributes=!1,this.log.warn("The property 'idAttribute' is deprecated and will be removed in","future releases. Use the 'keyAttributes' property instead in the configuration","for ArrayDataProvider",this.id)}this.jsonDiffer=new h(this.options[this.getIdAttributeProperty()]);const{implicitSort:a}=i;a&&(this.options.implicitSort=c.unwrapData(a)||[]);const{data:o}=i;if(o){const t=c.unwrapData(o);if(t&&Array.isArray(t)&&t.length>0){const i=e.utils.unwrapObservable(this._dataObservable);e.utils.arrayPushAll(i,t),this._dataObservable.valueHasMutated()}}}getIdAttributeProperty(){return this.useKeyAttributes?l.DataProviderIdAttributeProperty.KEY_ATTRIBUTES:l.DataProviderIdAttributeProperty.ID_ATTRIBUTE}getVariablePropertyDefinition(i,r,n,s){const a=r;return"data"===i?{get:()=>{const i=this.getValue().data;if(i&&this.variableLifecycleStage!==t.VariableLifecycleStage.INIT){const t=c.unwrapData(i),r=e.utils.unwrapObservable(this._dataObservable);if(Array.isArray(i)){const e=this.jsonDiffer.processDeltas(r,t);(e.detail.add||e.detail.update||e.detail.remove)&&this.dispatchMutationEvent(e)}}return i},set:e=>{a.variableNamespaces[n][s.name][i]=e},enumerable:!0,configurable:!0}:super.getVariablePropertyDefinition(i,r,n,s)}buildKeys(e){let t;const i=this.options[l.DataProviderIdAttributeProperty.KEY_ATTRIBUTES];if(i){const r=c.getIdAttributeHelper(i);t=e&&r.getKeys(e)}return t}getTypeDefinition(e,t){let i;if(e.defaultValue&&e.defaultValue.itemType){const{itemType:t}=e.defaultValue;i="string"==typeof t?`${t}[]`:[t]}else i="any[]";return{type:{data:p.getType("data",{type:i},t),idAttribute:"any",keyAttributes:"any",itemType:"any",implicitSort:[{attribute:"string",direction:"string"}]},resolved:!0}}dispatchEvent(e,t=!1){return t?e.detail&&e.detail.refresh&&(e.detail.add||e.detail.update||e.detail.remove)?(this.log.error("unable to dispatch both refresh and mutation events at the same time.",e.detail),!1):(this.log.warn("It is recommended that changes to the ArrayDataProvider 'data' ",this.id,"be done using assignVariables action as this event does not mutate the data property. Changing the data property automatically takes care of notifying all registered listeners, such as components of the change."),e.type===l.DataProviderEvent.REFRESH||e.detail&&e.detail.refresh?this.dispatchRefreshEvent(e):this.dispatchMutationEvent(e,u.DATAPROVIDER_EVENT_MODES.DEPRECATED)):super.dispatchEvent(e)}dispatchMutationEvent(t,i="default"){let r=!1;const n=e.utils.unwrapObservable(this._dataObservable);return this.adm=this.adm&&this.adm.reInit(n,i)||new u(this,n,i),r=this.adm.applyDataMutations(t),r?(this._dataObservable.valueHasMutated(),this.dispatchRefreshEvent(g),r):(this.log.error("Unable to dispatch the mutation event due to inadequate information",t),!1)}dispatchRefreshEvent(e){return this.log.info("Dispatching a REFRESH event, after data mutation"),super.dispatchEvent(e)}handlePropertyVariableChangeEvent(e){e.name.endsWith("value")&&e.diff&&(e.diff.data?this._updateDataObservable(e):(this.log.info("Dispatching a REFRESH event, after for mutation of",e.name),this.dispatchEvent(g)))}_updateDataObservable(t){const{value:i}=t,r=e.utils.unwrapObservable(this._dataObservable),n=i&&i.data||[],s=this.jsonDiffer.processDeltas(r,n);if(s.detail.add||s.detail.update||s.detail.remove){if(i.implicitSort&&i.implicitSort.length>0){const e=o.resolveIfObservable(this.options.implicitSort);this.jsonDiffer.diffWithNoObjectHash(i.implicitSort,e)&&(this.options.implicitSort=i.implicitSort,this.log.info("implicitSort property for ADP variable",this.id,"has changed! old value:",e,"new data:",i.implicitSort))}const e=l.DataProviderIdAttributeProperty.KEY_ATTRIBUTES,r=o.resolveIfObservable(this.options[e]),a=this.getIdAttributeProperty(),c=i[a];o.diff(r,c)&&(this.options[a]=c,this.jsonDiffer=new h(c),this.log.info(`${a} property for ADP variable`,this.id,"has changed! old value:",r,"new data:",c)),this.log.info("data property for ADP variable",this.id,"has changed! old data:",t.oldValue,"new data:",n),this.dispatchMutationEvent(s)}}}return v})),define("vb/private/types/arrayDataProvider2",["knockout","ojs/ojdataprovider","ojs/ojarraydataprovider","vb/helpers/mixin","vb/private/types/builtinExtendedTypeMixin","vb/private/log","vb/private/constants","vb/private/utils","vb/private/types/utils/dataProviderUtils","vb/private/types/dataProviderConstants","vb/private/types/utils/jsonDiffer","vb/private/stateManagement/stateUtils","vb/private/types/arrayDataManager"],((e,t,i,r,n,s,a,o,c,l,h,p,u)=>{const d=s.getLogger("/vb/types/ArrayDataProvider2"),g=new t.DataProviderRefreshEvent,v=e=>e.every((e=>Array.isArray(e)));class f extends(r(i).with(n)){constructor(){const t={implicitSort:[],keyAttributes:undefined,sortComparators:undefined},i=e.observableArray([]);super(i,t),this._dataObservable=i,this.adm=void 0,this.jsonDiffer=void 0,this.log=d,this.variableLifecycleStage=a.VariableLifecycleStage.INIT}activate(){if(this.variableLifecycleStage===a.VariableLifecycleStage.ACTIVE)return void this.log.fine("skipping activation for variable",this.id,"because it is already active");this.variableLifecycleStage=a.VariableLifecycleStage.ACTIVE;const t=this.getValue()||{},i=l.DataProviderIdAttributeProperty.KEY_ATTRIBUTES;if(t[i]){const e=c.unwrapData(t[i]);this.options[i]=e}this.jsonDiffer=new h(this.options[i]);const{implicitSort:r}=t;r&&(this.options.implicitSort=c.unwrapData(r)||[]);const{textFilterAttributes:n}=t;n&&(this.options.textFilterAttributes=c.unwrapData(n)||[]);const{sortComparators:s}=t;if(s){const e=c.unwrapData(s);if(e&&e.comparators){const t=c.unwrapData(e.comparators);let i;if(Array.isArray(t)&&v(t)){const e=[];t.forEach(((t,i)=>{e[i]=[t[0],c.unwrapData(t[1])]})),i=new Map(e)}else t instanceof Map?i=t:t&&this.log.info("ArrayDataProvider2",this.getId(),"is configured with sortComparators thatcannot be evaluated at  this time!",s);this.options.sortComparators=i?{comparators:i}:void 0}}const{data:o}=t;if(o){const t=c.unwrapData(o);if(t&&Array.isArray(t)&&t.length>0){const i=e.utils.unwrapObservable(this._dataObservable);e.utils.arrayPushAll(i,t),this._dataObservable.valueHasMutated()}}}getIdAttributeProperty(){return l.DataProviderIdAttributeProperty.KEY_ATTRIBUTES}getVariablePropertyDefinition(t,i,r,n){const s=i;return"data"===t?{get:()=>{const t=this.getValue().data;if(t&&this.variableLifecycleStage!==a.VariableLifecycleStage.INIT){const i=c.unwrapData(t),r=e.utils.unwrapObservable(this._dataObservable);if(Array.isArray(t)){const e=this.jsonDiffer.processDeltas(r,i);(e.detail.add||e.detail.update||e.detail.remove)&&this.dispatchMutationEvent(e)}}return t},set:e=>{const t=s.variableNamespaces[r][n.name],i=Object.assign({},t,{data:e});s.variableNamespaces[r][n.name]=i},enumerable:!0,configurable:!0}:super.getVariablePropertyDefinition(t,i,r,n)}buildKeys(e){let t;const i=this.options[l.DataProviderIdAttributeProperty.KEY_ATTRIBUTES];if(i){const r=c.getIdAttributeHelper(i);t=e&&r.getKeys(e)}return t}getTypeDefinition(e,t){let i;if(e.defaultValue&&e.defaultValue.itemType){const{itemType:t}=e.defaultValue;i="string"==typeof t?`${t}[]`:[t]}else i="any[]";return{type:{data:p.getType("data",{type:i},t),keyAttributes:"any",itemType:"any",implicitSort:[{attribute:"string",direction:"string"}],sortComparators:{comparators:"any"},textFilterAttributes:"string[]"},resolved:!0}}dispatchEvent(e,t=!1){return t?e.detail&&e.detail.refresh&&(e.detail.add||e.detail.update||e.detail.remove)?(this.log.error("unable to dispatch both refresh and mutation events at the same time.",e.detail),!1):e.type===l.DataProviderEvent.REFRESH||e.detail&&e.detail.refresh?this.dispatchRefreshEvent(e):this.processExternalMutationEvent(e):super.dispatchEvent(e)}getWritableOptions(){return{propertiesWritable:a.VariableWritablePropertyOptions.NONE}}processExternalMutationEvent(e){const t=this.getValue().data,i=o.cloneObject(t);if(!new u(this,i).applyDataMutations(e)&&e.detail){const t=`Unable to dispatch the mutation event due to inadequate or inaccurate information to perform \n        the operation, ${JSON.stringify(e.detail,o.setToJSONReplacer,2)}`;throw this.log.error(t),t}const r=this.jsonDiffer.processDeltas(t,i);return r.detail.add||r.detail.update||r.detail.remove?(this.data=i,!0):(this.log.info("The mutation event did not affect the value of variable",this.name,"because its value before and after mutation is the same",i),!1)}dispatchMutationEvent(t){const i=e.utils.unwrapObservable(this._dataObservable);this.adm=this.adm&&this.adm.reInit(i)||new u(this,i);const r=this.adm.applyDataMutations(t);return r?(this._dataObservable.valueHasMutated(),r):(this.log.error("Unable to dispatch the mutation event due to inadequate information",t),!1)}dispatchRefreshEvent(e){return this.log.info("Dispatching a REFRESH event, after data mutation"),super.dispatchEvent(e)}handlePropertyVariableChangeEvent(e){if(e.name.endsWith("value")&&e.diff)if(e.diff.data)this.detectDataChanged(e);else{["detectSortComparatorsChanged","detectKeyAttributesChanged","detectImplicitSortChanged","detectTextFilterAttributesChanged"].map((t=>this[t](e))).reduce(((e,t)=>e||t))&&(this.log.info("Dispatching a REFRESH event because the ADP configuration",this.getId(),"changed",e),this.dispatchEvent(g))}}detectSortComparatorsChanged(e){const{value:t}=e;if(e.diff&&e.diff.sortComparators){const e=o.resolveIfObservable(this.options.sortComparators),i=e&&Array.from(e.comparators.entries());let r;if(t.sortComparators&&t.sortComparators.comparators){const e=t.sortComparators.comparators;r=e instanceof Map?Array.from(e.entries()):e,v(r)||this.log.error("value set for sortComparators property of ADP variable",this.id,"is invalid!",t.sortComparators)}if(this.jsonDiffer.diffWithNoObjectHash(r,i))return this.options.sortComparators={comparators:new Map(r)},this.log.info("sortComparators property for ADP variable",this.id,"has changed! old value:",e,"new data:",t.sortComparators),!0}return!1}detectImplicitSortChanged(e){return this.detectArrayPropertyChanged(e,"implicitSort")}detectTextFilterAttributesChanged(e){return this.detectArrayPropertyChanged(e,"textFilterAttributes")}detectArrayPropertyChanged(e,t){const{value:i}=e;if(i[t]&&i[t].length>0){const e=o.resolveIfObservable(this.options[t]);if(this.jsonDiffer.diffWithNoObjectHash(i[t],e))return this.options[t]=i[t],this.log.info(t,"property for ADP variable",this.id,"has changed! old value:",e,"new value:",i[t]),!0}return!1}detectKeyAttributesChanged(e){const{value:t}=e,i=this.getIdAttributeProperty(),r=o.resolveIfObservable(this.options[i]),n=t[i];return!!o.diff(r,n)&&(this.options[i]=n,this.jsonDiffer=new h(this.options[i]),this.log.info("Key attribute property for ADP variable",this.id,"has changed! old value:",r,"new data:",n),!0)}detectDataChanged(t){const{value:i}=t,r=e.utils.unwrapObservable(this._dataObservable),n=i&&i.data||[];let s=!1;const a=this.jsonDiffer.processDeltas(r,n);(a.detail.add||a.detail.update||a.detail.remove)&&(this.detectSortComparatorsChanged(t),this.detectImplicitSortChanged(t),this.detectKeyAttributesChanged(t),this.detectTextFilterAttributesChanged(t),this.log.info("data property for ADP variable",this.id,"has changed! old data:",t.oldValue,"new data:",n,". The diff is",a),s=!0),s&&this.dispatchMutationEvent(a)}}return f})),define("vb/private/types/dataProviders/multiServiceDataProviderUtils",["knockout","vb/private/types/dataProviderConstants","vb/private/types/dataProviders/serviceDataProviderUtils","vb/private/types/capabilities/noOpFetchFirst","vb/private/types/capabilities/noOpFetchByKeys","vb/private/types/capabilities/noOpFetchByOffset"],((e,t,i,r,n,s)=>{class a{static initFetchFirstMethods(e){const i=e;i.fetchFirst=e=>{const n=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_FIRST);return n?(n.getLifecycleStageChangedSignal().add(i.getVariableStageChangeCallback(t.DataProviderFetchType.FETCH_FIRST)),n.fetchFirst(e)):new r(e).fetchFirst()},i.getCapability=e=>{const r=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_FIRST);return r&&r.getCapability(e)||null},i.getTotalSize=()=>{const e=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_FIRST);return e&&e.getTotalSize()},i.isEmpty=()=>{const e=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_FIRST);return e&&e.isEmpty()}}static initFetchByKeysMethods(e){const i=e;"function"!=typeof i.fetchFirst&&(i.fetchFirst=e=>new r(e).fetchFirst()),i.fetchByKeys=e=>{const r=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_BY_KEYS);return r?(r.getLifecycleStageChangedSignal().add(i.getVariableStageChangeCallback(t.DataProviderFetchType.FETCH_BY_KEYS)),r.fetchByKeys(e)):new n(e).fetchByKeys()},i.containsKeys=e=>{const r=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_BY_KEYS);return r?r.containsKeys(e):new n(e).containsKeys()},"function"!=typeof i.getCapability&&(i.getCapability=e=>{const r=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_BY_KEYS);return r&&r.getCapability(e)||null})}static initFetchByOffsetMethods(e){const i=e;"function"!=typeof i.fetchFirst&&(i.fetchFirst=e=>new r(e).fetchFirst()),i.fetchByOffset=e=>{const r=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_BY_OFFSET);return r?(r.getLifecycleStageChangedSignal().add(i.getVariableStageChangeCallback(t.DataProviderFetchType.FETCH_BY_OFFSET)),r.fetchByOffset(e)):new s(e).fetchByOffset()},"function"!=typeof i.getCapability&&(i.getCapability=e=>{const r=a.getDataProviderByType(i,t.DataProviderFetchType.FETCH_BY_OFFSET);return r&&r.getCapability(e)||null})}static implementsCapability(e,r){let n=!1;const s=r.dataProvider,a=r.capability;if(!s||!i.isServiceDataProviderInstanceValid(s))return e.log.error("unable to verify if capability",a,"supported, since the dataProvider is not the expected type or its configuration is invalid!"),!1;switch(a){case t.CapabilityType.FETCH_BY_KEYS:if("function"==typeof s.getCapability){(s.getCapability(a)||{})[t.CapabilityKeys.FETCH_BY_KEYS_IMPLEMENTATION]&&(n=!0)}break;case t.CapabilityType.FETCH_BY_OFFSET:if("function"==typeof s.getCapability){(s.getCapability(a)||{})[t.CapabilityKeys.FETCH_BY_OFFSET_IMPLEMENTATION]&&(n=!0)}break;case t.CapabilityType.FETCH_FIRST:default:if("function"==typeof s.getCapability){(s.getCapability(a)||{})[t.CapabilityKeys.FETCH_FIRST_IMPLEMENTATION]===t.CapabilityValues.FETCH_FIRST_IMPLEMENTATION_ITERATION&&(n=!0)}}return n}static isConfigurationValid(e){return e&&(e.fetchFirst||e.fetchByOffset||e.fetchByKeys)}static getDataProviderByType(e,i,r){const{dataProviders:n}=r||e.getValue();let s;const o=i||t.CapabilityType.FETCH_FIRST,c={capability:o,dataProvider:n[o]};return a.implementsCapability(e,c)&&(s=n[o]),s}static getSDPReferencesByType(e){const i=e.getValue(),{dataProviders:r}=i,n={};let s;return r.fetchFirst&&(s=a.getDataProviderByType(e,t.DataProviderFetchType.FETCH_FIRST,i),s&&(n[t.DataProviderFetchType.FETCH_FIRST]=s)),r.fetchByKeys&&(s=a.getDataProviderByType(e,t.DataProviderFetchType.FETCH_BY_KEYS,i),s&&(n[t.DataProviderFetchType.FETCH_BY_KEYS]=s)),r.fetchByOffset&&(s=a.getDataProviderByType(e,t.DataProviderFetchType.FETCH_BY_OFFSET,i),s&&(n[t.DataProviderFetchType.FETCH_BY_OFFSET]=s)),n}}return a})),define("vb/private/types/dataProviders/dynamicServiceDataProvider",["vb/private/constants","vb/private/log","vbc/private/logConfig","vb/private/utils","vb/types/typeUtils","vb/helpers/mixin","vb/types/eventTargetMixin","vb/private/types/dataProviderConstants","vb/private/types/dataProviders/serviceDataProviderUtils","vb/private/types/capabilities/noOpFetchFirst","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeys","vb/private/types/capabilities/fetchByKeysIteration","vb/private/types/capabilities/fetchBySingleKey","vb/private/types/capabilities/fetchFirst","vb/private/types/utils/serviceDataProviderRestHelperFactory"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v)=>{const f=()=>{},m={add:f,addOnce:f,dispatch:f,dispose:f,forget:f,getNumListeners:f,halt:f,has:f,remove:f,removeAll:f,toString:f},b={op:"string",attribute:"string",value:"any"};b.criteria=[b];const y={body:"any",capabilities:{sort:{attributes:"string"},filter:{operators:"string[]"},fetchByKeys:{implementation:"string",multiKeyLookup:"string"},fetchByOffset:{implementation:"string"},fetchFirst:{implementation:"string"}},endpoint:"string",filterCriterion:b,headers:"object",itemsPath:"string",keyAttributes:"any",mergeTransformOptions:"string",pagingCriteria:{offset:"number",size:"number",maxSize:"number",iterationLimit:"number"},responseType:"any",sortCriteria:[{attribute:"string",direction:"string"}],totalSize:"number",transforms:{request:{paginate:"string",query:"string",filter:"string",sort:"string",select:"string",body:"string"},response:{paginate:"string",body:"string"}},transformsContext:"object",uriParameters:"object"},E=t.getLogger("/vb/dataProviders/DynamicServiceDataProvider",[{name:"startFetch",severity:e.Severity.INFO,style:i.FancyStyleByFeature.serviceDataProviderStart},{name:"endFetch",severity:e.Severity.INFO,style:i.FancyStyleByFeature.serviceDataProviderEnd}]);class P extends(s().with(a)){constructor(e,t,i){super(),this.id="sdp-"+r.generateUniqueId(),this.log=E;const n=e||{};this.state=Object.keys(y).reduce(((e,t)=>{const i=e,r=n[t];return r&&(i[t]=r),i}),{}),Object.defineProperty(this,"totalSize",{value:this.state.totalSize,enumerable:!0,writable:!0}),this.serviceOptions=t,this.createRestHelper=()=>v.get(t||n.endpoint||"",i),this.init()}init(){const e=this.state&&this.state.capabilities||{},t=c.getConfiguredFetchCapabilities(e)||{};if(c.hasMultipleFetchCapabilities(t))return void this.log.error("ServiceDataProvider",this.id,"is configured with multiple fetch capabilities when only one should be used!");const i=c.getResolvedFetchCapabilities(t);c.initFetchByKeysMethods(this,i),c.initFetchByOffsetMethods(this,i)}callActionChain(e,t,i){throw new Error(`unable to call action chain ${e} with the params, ${t} because this feature\n        is not supported!`)}fetchFirst(e){if(this.state.endpoint){const t=new g(this,e);return this.log.finer("iterator",t.id,"created for fetchFirst() on SDP:",this.getId()),t.fetch()}return this.log.info("a valid endpoint was not provided for the ServiceDataProvider",this.id,". Using a noop implementation"),new l(e).fetchFirst()}getCapability(e){const t=this.getValue()&&this.getValue().capabilities||{},i=Object.assign({},t)[e];return c.getCapabilityByFeature(e,i)}getId(){return this.id}getIdAttributeProperty(){return o.DataProviderIdAttributeProperty.KEY_ATTRIBUTES}getValue(){return this.state}getDefinitionValue(){return this.state}getType(){return this.getValue().responseType||o.DEFAULT_ANY_TYPE}getLifecycleStageChangedSignal(){return m}getTotalSize(){return Promise.resolve(c.getTotalSize(this.getValue().totalSize))}isDisconnected(){return!1}invokeEvent(e,t,i=!0){this.log.info("unable to raise a VB event",e,"with payload",t,"because this feature is not supported on standalone service data provider instances!")}isEmpty(){const e=this.getValue().totalSize;return void 0===e||-1===e?o.DataProviderIsEmptyValues.UNKNOWN:0===e?o.DataProviderIsEmptyValues.YES:o.DataProviderIsEmptyValues.NO}setTotalSize(e){this.getValue().totalSize=e}}return P})),define("vb/private/types/dataProviders/dynamicMultiServiceDataProvider",["vb/private/constants","vb/private/log","vbc/private/logConfig","vb/private/utils","vb/types/typeUtils","vb/helpers/mixin","vb/types/eventTargetMixin","vb/private/types/dataProviderConstants","vb/private/types/dataProviders/multiServiceDataProviderUtils","vb/private/types/utils/serviceDataProviderRestHelperFactory","vb/private/types/dataProviders/dynamicServiceDataProvider","vb/private/types/capabilities/noOpFetchByKeys","vb/private/types/capabilities/noOpFetchFirst","vb/private/types/capabilities/noOpFetchByOffset"],((e,t,i,r,n,s,a,o,c,l)=>{const h=()=>{},p={dataProviders:{fetchFirst:"object",fetchByKeys:"object",fetchByOffset:"object"}},u=t.getLogger("/vb/private/types/dataProviders/DynamicMultiServiceDataProvider");class d extends(s().with(a)){constructor(e,t,i){super(),this.id="msdp-"+r.generateUniqueId(),this.log=u;const n=e||{},s=Object.keys(p).reduce(((e,t)=>{const i=e,r=n[t];return r&&(i[t]=r),i}),{});this.state=s,this.serviceOptions=t,this.createRestHelper=()=>l.get(t||{},i),this.sdpRefsByType=void 0,this.init()}init(){const{dataProviders:e}=this.state;e&&c.isConfigurationValid(e)?(e.fetchFirst&&void 0===this.fetchFirst&&c.initFetchFirstMethods(this),e.fetchByKeys&&void 0===this.fetchByKeys&&c.initFetchByKeysMethods(this),e.fetchByOffset&&void 0===this.fetchByOffset&&c.initFetchByOffsetMethods(this)):this.log.error("MultiServiceDataProvider",this.id,"has no dataProviders set!",this.state)}getVariableStageChangeCallback(e){return h}getDefinitionValue(){return this.state}getUniqueSDPReferences(){const e=this.getValue();return!this.sdpRefsByType&&e&&(this.sdpRefsByType=c.getSDPReferencesByType(this)),new Set(Object.values(this.sdpRefsByType||{}))}getValue(){return this.state}addEventListener(e,t){this.getUniqueSDPReferences().forEach((i=>{i.addEventListener(e,t)}))}removeEventListener(e,t){const i=this.getUniqueSDPReferences();0===i.size&&this.log.warn("MultiServiceDataProvider",this.id,"unable to remove listeners registered with dataProvider because the value appears to have been cleared"),i.forEach((i=>{i.removeEventListener(e,t)}))}removeAllEventListeners(){this.getUniqueSDPReferences().forEach((e=>{e.removeAllEventListeners()}))}}return d})),define("vb/private/types/dataProviders/multiServiceDataProvider2",["vb/private/constants","vb/private/log","vbc/private/logConfig","vb/private/utils","vb/types/typeUtils","vb/helpers/mixin","vb/types/eventTargetMixin","vb/private/types/dataProviderConstants","vb/private/types/dataProviders/multiServiceDataProviderUtils","vb/private/types/utils/serviceDataProviderRestHelperFactory","vb/private/types/dataProviders/dynamicServiceDataProvider","vb/private/types/capabilities/noOpFetchByKeys","vb/private/types/capabilities/noOpFetchFirst","vb/private/types/capabilities/noOpFetchByOffset"],((e,t,i,r,n,s,a,o,c,l)=>{const h=()=>{},p={dataProviders:{fetchFirst:"object",fetchByKeys:"object",fetchByOffset:"object"}},u=t.getLogger("/vb/private/types/dataProviders/MultiServiceDataProvider2");class d extends(s().with(a)){constructor(e,t){super(),this.id="msdp-"+r.generateUniqueId(),this.log=u;const i=e||{},n=Object.keys(p).reduce(((e,t)=>{const r=e,n=i[t];return n&&(r[t]=n),r}),{});this.state=n,this.dataProviderOptions=this.state,this.serviceOptions=t,this.createRestHelper=()=>l.get(t||{},this.variableBridge&&this.variableBridge.scope&&this.variableBridge.scope.container),this.sdpRefsByType=void 0;const{dataProviders:s}=this.state;s&&c.isConfigurationValid(s)?(s.fetchFirst&&void 0===this.fetchFirst&&c.initFetchFirstMethods(this),s.fetchByKeys&&void 0===this.fetchByKeys&&c.initFetchByKeysMethods(this),s.fetchByOffset&&void 0===this.fetchByOffset&&c.initFetchByOffsetMethods(this)):this.log.error("MultiServiceDataProvider",this.id,"has no dataProviders set!",this.state)}setVariableBridge(e){this.variableBridge=e}getVariableStageChangeCallback(e){return h}getDefinitionValue(){return this.state}getUniqueSDPReferences(){const e=this.getValue();return!this.sdpRefsByType&&e&&(this.sdpRefsByType=c.getSDPReferencesByType(this)),new Set(Object.values(this.sdpRefsByType||{}))}getValue(){return this.state}addEventListener(e,t){this.getUniqueSDPReferences().forEach((i=>{i.addEventListener(e,t)}))}removeEventListener(e,t){const i=this.getUniqueSDPReferences();0===i.size&&this.log.warn("MultiServiceDataProvider",this.id,"unable to remove listeners registered with dataProvider because the value appears to have been cleared"),i.forEach((i=>{i.removeEventListener(e,t)}))}removeAllEventListeners(){this.getUniqueSDPReferences().forEach((e=>{e.removeAllEventListeners()}))}}return d})),define("vb/private/types/dataProviders/serviceDataProvider2",["knockout","vb/private/constants","vb/private/log","vbc/private/logConfig","vb/private/utils","vb/types/typeUtils","vb/helpers/mixin","vb/types/eventTargetMixin","vb/private/types/dataProviderConstants","vb/private/types/dataProviders/serviceDataProviderUtils","vb/private/types/capabilities/noOpFetchFirst","vb/private/types/capabilities/fetchContext","vb/private/types/capabilities/fetchByKeys","vb/private/types/capabilities/fetchByKeysIteration","vb/private/types/capabilities/fetchBySingleKey","vb/private/types/capabilities/fetchFirst","vb/private/types/utils/serviceDataProviderRestHelperFactory"],((e,t,i,r,n,s,a,o,c,l,h,p,u,d,g,v,f)=>{const m=()=>{},b={add:m,addOnce:m,dispatch:m,dispose:m,forget:m,getNumListeners:m,halt:m,has:m,remove:m,removeAll:m,toString:m},y={op:"string",attribute:"string",value:"any"};y.criteria=[y];const E={body:"any",capabilities:{sort:{attributes:"string"},filter:{operators:"string[]"},fetchByKeys:{implementation:"string",multiKeyLookup:"string"},fetchByOffset:{implementation:"string"},fetchFirst:{implementation:"string"}},endpoint:"string",fetchChainId:"string",fetchChain:"string",headers:"object",itemsPath:"string",keyAttributes:"any",mergeTransformOptions:"string",pagingCriteria:{offset:"number",size:"number",maxSize:"number",iterationLimit:"number"},responseType:"any",totalSize:"number",transforms:{request:{paginate:"string",query:"string",filter:"string",sort:"string",select:"string",body:"string"},response:{paginate:"string",body:"string"}},transformsContext:"object",uriParameters:"object"},P=i.getLogger("/vb/dataProviders/ServiceDataProvider2",[{name:"startFetch",severity:t.Severity.INFO,style:r.FancyStyleByFeature.serviceDataProviderStart},{name:"endFetch",severity:t.Severity.INFO,style:r.FancyStyleByFeature.serviceDataProviderEnd}]);class x extends(a().with(o)){constructor(t,i){super(),this.id="sdp-"+n.generateUniqueId(),this.log=P;const r=t||{};this.dataProviderOptions=Object.keys(E).reduce(((e,t)=>{const i=e,n=r[t];return n&&(i[t]=n),i}),{}),this.state=this.dataProviderOptions,Object.defineProperty(this,"totalSize",{get:()=>e.pureComputed({read:()=>{const e=this.createRestHelper(),t=`${this.variableBridge.scope.name}:${this.dataProviderOptions.endpoint}`;return e.retrieveState(t,c.TOTAL_SIZE)()}}),set:e=>{const t=this.createRestHelper(),i=`${this.variableBridge.scope.name}:${this.dataProviderOptions.endpoint}`;t.storeState(i,c.TOTAL_SIZE,e)}}),this.serviceOptions=i,this.createRestHelper=()=>f.get(i||r.endpoint||"",this.variableBridge.scope.container),this.resolvedResponseType=void 0,this.mergedCaps=void 0,this.fetchMethodsSetup=void 0}setVariableBridge(e){this.variableBridge=e}activateAsync(){const e=this.dataProviderOptions,t=n.cloneObject(e.uriParameters),i={},r=this.createRestHelper(),s=`${this.variableBridge.scope.name}:${e.endpoint}`,a=r.retrieveState(s,c.CAPABILITIES_KEY);return a?Promise.resolve(a):(r.parameters(t).initConfiguration(i),r.getAndStoreCapabilities(s))}callActionChain(e,t,i){return this.variableBridge.callActionChain(e,t,i)}fetchFirst(e){if(this.dataProviderOptions.endpoint){const t=new v(this,e);return this.log.finer("iterator",t.id,"created for fetchFirst() on SDP:",this.getId()),t.fetch()}return this.log.info("a valid endpoint was not provided for the ServiceDataProvider",this.id,". Using a noop implementation"),new h(e).fetchFirst()}getCapability(e){if(!this.fetchMethodsSetup){const e=this.createRestHelper(),t=`${this.variableBridge.scope.name}:${this.dataProviderOptions.endpoint}`,i=e.retrieveState(t,c.CAPABILITIES_KEY),r=this.dataProviderOptions&&this.dataProviderOptions[c.CAPABILITIES_KEY]||{},n=Object.assign({},i,r),s=l.getConfiguredFetchCapabilities(n)||{},a=l.getResolvedFetchCapabilities(s);this.mergedCaps=Object.assign(n,a),l.initFetchByKeysMethods(this,a),l.initFetchByOffsetMethods(this,a),this.fetchMethodsSetup=!0}const t=this.mergedCaps[e];return n.cloneObject(l.getCapabilityByFeature(e,t))}getId(){return this.id}getIdAttributeProperty(){return c.DataProviderIdAttributeProperty.KEY_ATTRIBUTES}getValue(){return this.dataProviderOptions}getDefinitionValue(){return this.dataProviderOptions}getType(e,t){return this.variableBridge.getType(t,e)}getLifecycleStageChangedSignal(){return b}getTotalSize(){return Promise.resolve(l.getTotalSize(this.totalSize()))}isEmpty(){const e=this.totalSize();return void 0===e||-1===e?c.DataProviderIsEmptyValues.UNKNOWN:0===e?c.DataProviderIsEmptyValues.YES:c.DataProviderIsEmptyValues.NO}isDisconnected(){return!1}invokeEvent(e,t,i=!0){return this.variableBridge.invokeEvent(e,t,i)}setTotalSize(e){this.getValue().totalSize=e}}return x})),define("vb/types/securityProvider",["ojs/ojconfig","vbsw/private/serviceWorkerManager","vb/private/stateManagement/application","vb/helpers/navigate","urijs/URI","vb/private/configuration","vbsw/private/constants","vb/helpers/bootstrapRest","vb/private/constants","vb/private/utils"],((e,t,i,r,n,s,a,o,c,l)=>class{constructor(){window.vbInitConfig=window.vbInitConfig||{},this.returnPathQueryParam="endUri",this.userInfo={userId:c.User.DEFAULT,username:c.User.DEFAULT,longId:c.User.DEFAULT,fullName:c.User.DEFAULT,email:c.User.DEFAULT,roles:[],permissions:[],isAdmin:!1,isAuthenticated:!1},t.getInstance().installMessageHandler(this)}initialize(e){this.config=e,window.vbInitConfig.bypassProxy=!e||!e.disableTokenRelay;const t=window.vbInitConfig,i=t&&t.APP_PATH;this.appPath="string"==typeof i?i.trim():s.applicationUrl,this.appPath=l.addTrailingSlash(this.appPath);const{isAuthenticated:r}=this.userInfo;return this.getServiceWorkerPlugins(e,!r).then((e=>this.installServiceWorkerPlugins(e))).then((()=>this.fetchCurrentUser(e))).then((()=>r!==this.userInfo.isAuthenticated?this.getServiceWorkerPlugins(e,r).then((e=>this.installServiceWorkerPlugins(e,!1))):Promise.resolve()))}installServiceWorkerPlugins(e=[],i=!0){return t.getInstance().installServiceWorkerPlugins(e,i)}processRolesOrPerms(e,t,i=!1){e=e||[];const r=Array.isArray(e)?e:e.split(",");let n;return n=i?r.concat(t||[]):t||r,n.forEach((e=>{n[e]=!0})),n}getUserRolesOverride(){return i.runtimeEnvironment.getUserRolesOverride()}getUserPermissionsOverride(){return i.runtimeEnvironment.getUserPermissionsOverride()}fetchCurrentUser(e){let t;const i=window.vbInitConfig;if(i.INJECTED&&i.INJECTED.security&&i.INJECTED.security.user){const e={body:i.INJECTED.security.user,response:{ok:!0}};t=Promise.resolve(e)}else t=e.endpoint?this.fetchCurrentUserFromEndpoint(e.endpoint,e.uriParams):this.fetchCurrentUserRaw(e);return t.then((e=>{const t=e.response;if(t.ok){const i=e.body?Promise.resolve(e.body):t.json();return Promise.all([i,this.getUserRolesOverride(),this.getUserPermissionsOverride()]).then((e=>{const t=e[0],i=this.processRolesOrPerms(t.roles,e[1]),r=this.processRolesOrPerms(t.permissions,e[2]);void 0===t.isAnonymous||t.isAnonymous||(this.userInfo={userId:t.id,username:t.userName,longId:t.longId,fullName:t.fullName,email:t.email,isAdmin:t.isAdmin,isAuthenticated:!t.isAnonymous}),this.userInfo.roles=i,this.userInfo.permissions=r,this.loginUrl=t.loginUrl,this.logoutUrl=t.logoutUrl}))}return Promise.resolve()})).catch((e=>{console.error(e)}))}fetchCurrentUserRaw(e){return Promise.resolve().then((()=>{const t={credentials:"same-origin",headers:{[a.USE_CACHED_RESPONSE_WHEN_OFFLINE]:!0,"Cache-Control":"no-cache, no-store",Pragma:"no-cache",[c.Headers.VB_INFO_EXTENSION]:"{}"}};let i=e.url;l.isAbsolutePath(i)||(i=`${s.applicationUrl}${i}`);const r=new Request(i,t);return fetch(r)})).then((e=>({response:e})))}fetchCurrentUserFromEndpoint(e,t){return Promise.resolve().then((()=>{const i=o.get(e);return t&&i.parameters(t),i.fetch()}))}getServiceWorkerPlugins(t,i=!1){const r=t&&t.plugins?t.plugins.slice():[];return r.push({url:"vbsw/private/plugins/generalHeadersHandlerPlugin",params:{"Accept-Language":e.getLocale()}}),Promise.resolve(r)}static getServiceWorkerPluginsForVbEnvironment(){return Promise.resolve().then((()=>{const e=window.vbInitConfig||{},t=e.VB_SERVER,i=l.addTrailingSlash(l.cleanUpExtraSlashes(e.INGRESS_PATH||"")),r=e.ORGANIZATION_ID;return t?[void 0===r?"vbsw/private/plugins/csrfTokenHandlerPlugin":{url:"vbsw/private/plugins/multiTenantCsrfTokenHandlerPlugin",params:{orgId:r,vbServer:t,serverRoot:i}}]:[]}))}static getUserInfoType(){return{userId:"string",username:"string",fullName:"string",email:"string",roles:"string[]",permissions:"string[]",isAuthenticated:"boolean"}}handleLoadError(e,t){return(401===e.statusCode||403===e.statusCode&&!this.userInfo.isAuthenticated)&&this.handleLogin(t)}handleLogin(e){if(this.loginUrl){let t=r.getUrlFromPath(e);return t=`${this.appPath}${t}`,r.toUrl({url:this.loginUrl,params:{[this.returnPathQueryParam]:t},history:c.HistoryMode.REPLACE}),!0}return!1}getLoginUrl(){if(this.loginUrl){let e=r.getUrlFromPath("/");return e=`${this.appPath}${e}`,`${this.loginUrl}&${this.returnPathQueryParam}=${e}`}return null}handleLogout(e){const t=e||this.logoutUrl;t&&r.toUrl({url:t,params:{[this.returnPathQueryParam]:this.appPath},history:c.HistoryMode.REPLACE})}isAccessAllowed(e,t,i={requiresAuthentication:!0,roles:[],permissions:[]}){const r=i.roles||[],n=i.permissions||[];let s=!1;if(void 0===i.requiresAuthentication||i.requiresAuthentication){if(!this.userInfo.isAuthenticated)return!1;s=r.some((e=>this.userInfo.roles.includes(e)))||n.some((e=>this.userInfo.permissions.includes(e)))}return s||0===r.length&&0===n.length}securityCallback(){return Promise.resolve()}vbGetCookie(e){return Promise.resolve().then((()=>{const t=document.cookie.split(";").find((t=>t.includes(`${e}=`)));return t?this.decodeCookie(t):null}))}vbDeleteCookie(e){return Promise.resolve().then((()=>{const t=`${e}=; Expires=Thu, 01 Jan 1970 00:00:00 GMT`;document.cookie=t}))}vbSetCookie(e,t){return Promise.resolve().then((()=>{const i=this.encodeCookie(e,t);document.cookie=i}))}decodeCookie(e){const t=e.substring(e.indexOf("=")+1);return t?JSON.parse(decodeURIComponent(t)):null}encodeCookie(e,t){let i=`${e}=${encodeURIComponent(JSON.stringify(t))}`;const r=(...e)=>{i=i.concat("; ",...e)};let s;if(t.url&&(s=new n(t.url).host()),t.expires&&r("Expires=",new Date(t.expires).toUTCString()),t.domain?r("Domain=",t.domain):s&&r("Domain=",s),t.path&&r("Path=",t.path),t.secure&&r("Secure"),t.sameSite)switch(t.sameSite){case"unrestricted":default:break;case"strict":r("SameSite=","Strict");break;case"lax":r("SameSite=","Lax")}return i}})),define("vb/private/types/defaultSecurityProvider",["vb/types/securityProvider","vb/private/utils","vb/private/stateManagement/router","vb/private/stateManagement/application","vb/private/log","urijs/URI","vbsw/private/serviceWorkerManager","vbsw/private/fetchHandler","vbsw/private/pwa/pwaUtils","vbsw/private/constants"],((e,t,i,r,n,s,a,o,c,l)=>class extends e{initialize(e){return this.idcsInfo=e.idcsInfo||{},this.defaultAuthentication=e.authentication,this.jwtClockSkewTolerance=e.jwtClockSkewTolerance,super.initialize(e)}fetchCurrentUser(e){if(!e.url&&!e.endpoint){if(window.vbInitConfig.IS_DT_MODE){const t=this.getContextRoot();e.url=`${t}resources/security/user`}else e.url=`${i.baseUrl}_currentuser`}return super.fetchCurrentUser(e)}fetchCurrentUserRaw(e,i){if(t.isMobileSafari()&&c.isPwaConfig(window.vbInitConfig)){const t=[{url:e.url.replace(":443",""),method:"GET"},{url:e.url,method:"GET"}];return a.getInstance().addRequestsToSkip(t).then((()=>{const r=new o("/",{useCacheResponseWhenOfflineHeaderEnabled:!0}),n=fetch,s=Request;return r.installPlugins(["vbsw/private/plugins/authPostprocessorHandlerPlugin"]).then((()=>r.initializePersistenceManagerWithStore())).then((o=>{i&&o.forceOffline(!0);const c={credentials:"same-origin",headers:{[l.USE_CACHED_RESPONSE_WHEN_OFFLINE]:!0,"Cache-Control":"no-cache, no-store",Pragma:"no-cache"}},h=new Request(e.url,c);return r.handleRequest(h).then((e=>(fetch=n,Request=s,a.getInstance().removeRequestsToSkip(t).then((()=>({response:e}))))))}))}))}return super.fetchCurrentUserRaw(e)}getContextRoot(){const e=window.vbInitConfig;let t=e.CONTEXT_ROOT?e.CONTEXT_ROOT:"/";return t.startsWith("/")||(t=`/${t}`),t.endsWith("/")||(t=`${t}/`),t}getServiceWorkerPlugins(e,i=!1){return t.getRuntimeEnvironment().then((r=>Promise.all([super.getServiceWorkerPlugins(e,i),r.getServiceWorkerPlugins()]).then((r=>{const n=r[0],s=window.vbInitConfig||{},a=s.BASE_URL_TOKEN,o=s.ORGANIZATION_ID,c=s.VB_SERVER,l=t.addTrailingSlash(t.cleanUpExtraSlashes(s.INGRESS_PATH||"")),h=s.INJECTED&&s.INJECTED.security&&s.INJECTED.security.csrfToken;return[{url:"vbsw/private/plugins/sessionExpirePlugin",params:{contextRoot:this.getContextRoot(),idcsHost:this.idcsInfo.hostName}},{url:"vbsw/private/plugins/authPreprocessorHandlerPlugin",params:{isAnonymous:i,defaultAuthentication:this.defaultAuthentication,passthroughs:e.configuration&&e.configuration.passthroughs||[]}},{url:"vbsw/private/plugins/sessionTrackingHandlerPlugin",params:{userId:this.userInfo.email}},void 0===o?{url:"vbsw/private/plugins/csrfTokenHandlerPlugin",params:{versionId:a,csrfToken:h}}:{url:"vbsw/private/plugins/multiTenantCsrfTokenHandlerPlugin",params:{orgId:o,serverRoot:l,vbServer:c}},{url:"vbsw/private/plugins/implicitFlowHandlerPlugin",params:{allowedScopes:this.idcsInfo.allowedScopes?this.idcsInfo.allowedScopes:[],jwtClockSkewTolerance:this.jwtClockSkewTolerance}},{url:"vbsw/private/plugins/tokenRelayHandlerPlugin",params:{jwtClockSkewTolerance:this.jwtClockSkewTolerance}},{url:"vbsw/private/plugins/authHeaderHandlerPlugin",params:{isAnonymous:i}},{url:"vbsw/private/plugins/resourceChangedPlugin",params:{contextRoot:this.getContextRoot(),versionId:a}}].forEach((e=>{-1===n.indexOf(e)&&n.push(e)})),n.push(...r[1]),n.push("vbsw/private/plugins/authPostprocessorHandlerPlugin"),n}))))}vbSessionExpired(){const e=this.getLoginUrl();return r.runtimeEnvironment.sessionExpired(e)}vbRefreshImplicitFlowAccessToken(e){return new Promise(((t,r)=>{const n=document.getElementById("vb-refresh-access-token-iframe");if(n){let s;const a=e=>{if(e.origin===window.location.origin&&"vbRefreshAuthToken"===e.data.method){const r=e.data.args[0];if(r){clearTimeout(s),window.removeEventListener("message",a);const e=i.parseFragment(r),n=`${e.token_type} ${e.access_token}`;t(n)}}};window.addEventListener("message",a);const o=this.getOAuthAuthorizationUrl(e);n.src=o,s=setTimeout((()=>{window.removeEventListener("message",a),r("Refreshing access token timed out."),window.location.href=o}),3e3)}}))}getOAuthAuthorizationUrl(e){const t=new s(`${this.idcsInfo.hostName}/oauth2/v1/authorize`);return t.addSearch("client_id",this.idcsInfo.clientId).addSearch("response_type","token").addSearch("scope",e).addSearch("redirect_uri",this.idcsInfo.oAuthRedirectEndpoint),t.href()}})),define("vb/private/types/mobileDefaultSecurityProvider",["vb/types/securityProvider","vb/private/utils","vb/private/constants","vb/private/mobile/security/security","vb/private/stateManagement/router","vb/private/stateManagement/application","vbsw/private/serviceWorkerManager","vbsw/private/constants","vb/private/log"],((e,t,i,r,n,s,a,o,c)=>{const l=c.getLogger("/vb/private/types/mobileDefaultSecurityProvider");return class extends e{initialize(e){return this.config=e,this.defaultAuthentication=e.authentication,this.jwtClockSkewTolerance=e.jwtClockSkewTolerance,this.userInfoUrl=e.oauthUrl,super.initialize(e)}fetchCurrentUser(){return Promise.resolve()}getServiceWorkerPlugins(e,t=!1){return super.getServiceWorkerPlugins(e,t).then((e=>([{url:"vbsw/private/plugins/mobileAuthPreprocessorHandlerPlugin",params:{isAnonymous:t,defaultAuthentication:this.defaultAuthentication}},{url:"vbsw/private/plugins/sessionTrackingHandlerPlugin",params:{userId:this.userInfo.email}},{url:"vbsw/private/plugins/tokenRelayHandlerPlugin",params:{jwtClockSkewTolerance:this.jwtClockSkewTolerance}},"vbsw/private/plugins/csrfTokenHandlerPlugin",{url:"vbsw/private/plugins/mobileAuthHandlerPlugin",params:{allowedScopes:this.config&&this.config.idcsInfo&&this.config.idcsInfo.allowedScopes?this.config.idcsInfo.allowedScopes:[],currentUserUrl:this.userInfoUrl||""}}].forEach((t=>{-1===e.indexOf(t)&&e.push(t)})),e.push("vbsw/private/plugins/authPostprocessorHandlerPlugin"),e)))}getUserInfo(){if(this.config.authentication.type===o.AuthenticationType.BASIC||!this.userInfoUrl)return Promise.resolve({userId:"",userName:"",longId:"",fullName:"",email:"",roles:[],permissions:[],isAnonymous:!1});const e=new Headers;e.set(o.USE_CACHED_RESPONSE_WHEN_OFFLINE,"true");const t=new Request(this.userInfoUrl,{credentials:"same-origin",headers:e});return fetch(t).then((e=>{if(e.ok)return e.json().then((e=>{const t=this.processRolesOrPerms(e.roles,void 0);return Promise.resolve({userId:e.id,userName:e.userName,longId:e.id,fullName:e.fullName,email:e.email,roles:t,permissions:[],isAnonymous:e.isAnonymous})}));throw new Error("Failed to retrieve user information")}))}handleLogin(e){const o=document.getElementsByTagName("oj-vb-message-bar");for(let e=0;e<o.length;e+=1)o[e].closeAll();return a.getInstance().isOnline().then((e=>e?r.initialize(this.config).then((()=>r.login())):Promise.resolve())).then((()=>this.getUserInfo())).then((e=>{e&&void 0!==e.isAnonymous&&!e.isAnonymous?(l.info("Successfully retrieved user information..."),Object.assign(this.userInfo,{userId:e.userId,username:e.userName,longId:e.longId,fullName:e.fullName,email:e.email,roles:e.roles,permissions:e.permissions,isAuthenticated:!e.isAnonymous})):l.info("Running in anonymous mode...")})).catch((e=>{e&&(l.error(e),l.info("Running in anonymous mode..."))})).then((()=>this.getServiceWorkerPlugins(null,!this.userInfo.isAuthenticated).then((e=>this.installServiceWorkerPlugins(e))).then((()=>{if(s.router){const t=s.scope.getVariable(i.APPLICATION_USER_VARIABLE,i.VariableNamespace.BUILTIN);t&&t.setValueInternal(this.userInfo);const r={page:e||"/",operation:i.NavigateOperation.PAGE};n.queueNavigate(s,r)}else s.dispose(),t.getResource("vb/bootstrap").then((e=>e()))})))),!0}handleLogout(e){r.logout().catch((e=>{e&&l.error(e)})).then((()=>{window.location.href="index.html"}))}vbGetAuthHeader(){return r.getHeaders()}}})),define("vb/private/types/multiServiceDataProvider",["vb/private/log","vb/private/constants","vb/helpers/mixin","vb/private/types/dataProviders/multiServiceDataProviderUtils","vb/private/types/builtinExtendedTypeMixin","vb/types/eventTargetMixin","vb/private/types/dataProviderConstants"],((e,t,i,r,n,s,a)=>{const o=e.getLogger("/vb/types/MultiServiceDataProvider");class c extends(i().with(s,n)){constructor(){super(),this.initialized=!1,this.log=o,this.sdpRefsByType=void 0}init(e,t,i){super.init(e,t,i),this.definition=t}activate(){const{dataProviders:e}=this.getValue();e&&r.isConfigurationValid(e)?(e.fetchFirst&&void 0===this.fetchFirst&&r.initFetchFirstMethods(this),e.fetchByKeys&&void 0===this.fetchByKeys&&r.initFetchByKeysMethods(this),e.fetchByOffset&&void 0===this.fetchByOffset&&r.initFetchByOffsetMethods(this)):this.log.error("MultiServiceDataProvider",this.id,"has no dataProviders set!",this.state)}dispose(){this.removeAllEventListeners();let e=this.getDataProviderByType(a.DataProviderFetchType.FETCH_FIRST);e&&e.getLifecycleStageChangedSignal().removeAll(),e=this.getDataProviderByType(a.DataProviderFetchType.FETCH_BY_KEYS),e&&e.getLifecycleStageChangedSignal().removeAll(),e=this.getDataProviderByType(a.DataProviderFetchType.FETCH_BY_OFFSET),e&&e.getLifecycleStageChangedSignal().removeAll()}getDataProviderByType(e){return this.sdpRefsByType?this.sdpRefsByType[e]:r.getDataProviderByType(this,e)}getVariableStageChangeCallback(e){return(t,i)=>this.handleVariableLifecycleStageChange(t,e,i)}getDefinitionValue(){return this.definition.defaultValue}getUniqueSDPReferences(){const e=this.getValue();return!this.sdpRefsByType&&e&&(this.sdpRefsByType=r.getSDPReferencesByType(this)),new Set(Object.values(this.sdpRefsByType||{}))}handleVariableLifecycleStageChange(e,i,r){e===t.VariableLifecycleStage.DISPOSE&&(this.sdpRefsByType=this.sdpRefsByType||{},this.sdpRefsByType[i]=r)}addEventListener(e,t){this.getUniqueSDPReferences().forEach((i=>{i.addEventListener(e,t)}))}removeEventListener(e,t){const i=this.getUniqueSDPReferences();0===i.size&&this.log.warn("MultiServiceDataProvider",this.id,"unable to remove listeners registered with dataProvider because the value appears to have been cleared"),i.forEach((i=>{i.removeEventListener(e,t)}))}removeAllEventListeners(){this.getUniqueSDPReferences().forEach((e=>{e.removeAllEventListeners()}))}handleDataProviderEvent(e){try{this.dispatchEvent(e)}catch(t){const i=`unable to process event ${e.type} for data provider due to error ${t}`;throw this.log.error(i),i}return!1}getTypeDefinition(){return{type:{dataProviders:{fetchFirst:"vb/ServiceDataProvider",fetchByKeys:"vb/ServiceDataProvider",fetchByOffset:"vb/ServiceDataProvider"}},resolved:!0}}}return c})),define("vb/private/urlMapper",["vb/private/constants","vb/private/log","vb/private/utils","vb/private/services/serviceUtils","vb/private/services/servicesLoader","vb/private/services/serviceConstants","urijs/URI"],((e,t,i,r,n,s,a)=>{const o=t.getLogger("/vb/private/urlMapper"),c=["ics"],l=[],h="/describe";function p(t){const i=t;if(i&&i.metadata){const t=i||{};if(i.metadata.path&&i.metadata.path.endsWith(h)){const n=i.metadata.extensions&&i.metadata.extensions.headers||{};if(Object.keys(n).length>0){const n=r.getExtensionsFromMetadata("",i.metadata,t);delete n.headers[e.Headers.VB_INFO_EXTENSION],i.headers=n.headers}}}return i}const u={[h]:{augmentMapping:p}};function d(t,i){const r=t.url.split(e.PATH_SEPARATOR).length-1,n=i.url.split(e.PATH_SEPARATOR).length-1;if(t.submapping||i.submapping){if(t.submapping&&!i.submapping)return 1;if(i.submapping&&!t.submapping)return-1}if(r===n){const e=this.namespaces.indexOf(t.namespace),r=this.namespaces.indexOf(i.namespace),n=e>=0?this.namespaces.length-e:e,s=r>=0?this.namespaces.length-r:r;return n!==s?Math.sign(n-s):t.url===i.url?0:t.url<i.url?-1:1}return n-r}class g{constructor(e,t,i={}){this.protocolRegistry=e,this.protocolRegistry.registryModified.add((()=>this.handleProtocolRegistryChange())),this.protocolRegistry.opened.add(((e,t,i)=>this.handleCatalogReference(e,t,i))),this.catalogTypesToSkip=i.urlMapping&&i.urlMapping.typesToSkip||c,this.segmentMinimum=i.urlMapping&&i.urlMapping.segmentMinimum||2,n.opened.add(((e,t,i)=>this.handleServiceReferences(t,i))),this._externalMapping={},this.namespaces=[],this.comparitor=d.bind(this)}getUrlMap(){return this.urlMapPromise||(this.urlMapPromise=this.protocolRegistry.getTree().then((e=>{const t={};e.forEach((e=>{this.addNamespace(e.namespace);const i=e.type||e.chain[0]&&e.chain[0].type;if(i){if(-1===l.indexOf(i)){t[i]=t[i]||{};const r=t[i][e.url];(!r||r.chain.length<e.chain.length)&&(t[i][e.url]=e)}}else o.warn(`unknown catalog object type found during url mapping ${JSON.stringify(e)}`)}));const i={};return Object.keys(t).forEach((e=>{i[e]=i[e]||[],Object.keys(t[e]).forEach((r=>{const n=t[e][r];if(this.catalogTypesToSkip.indexOf(n.serviceType)>=0)return;r!==n.url&&o.warn("url mismatch during mapping, continuing");const s=g.createMappingFromCatalogObject(n,e);this.addMapping(i[e],s)}))})),Object.keys(i).forEach((e=>{i[e].sort(this.comparitor)})),this._addAllExternalMappings(i),i})).catch((e=>(o.warn("Unable to initialize url mapping from catalog, so catalog will not be used.",e.toString()),{[s.ExtensionTypes.SERVICES]:[]})))),this.urlMapPromise}addNamespace(e){this.namespaces.indexOf(e)<0&&this.namespaces.push(e)}static createMappingFromCatalogObject(e,t){const n=g.normalizeUrl(e.url),a=r.transformResolvedCatalogObject(e,e.name,n,{}),o={url:n,type:t,metadata:a.services&&a.services.metadata,namespace:a.namespace};if(t===s.ExtensionTypes.BACKENDS){if(!e.catalogUrl)return null;o.urlToFetch=i.addTrailingSlash(n),o.url=i.addTrailingSlash(e.catalogUrl)}return Object.assign({},a.mergedExtensions,o)}static createMappingFromServicesObject(e,t){const i=g.normalizeUrl(e.url);return Object.assign({},e,{url:i,type:s.ExtensionTypes.SERVICES,namespace:t})}getUrlMapping(t){const i=g.normalizeUrl(t);return this.getUrlMap().then((n=>{let a=this._findServiceMapping(n[s.ExtensionTypes.SERVICES]||[],t,i);return a||(a=this._findBackendMapping(n[s.ExtensionTypes.BACKENDS]||[],t)),a?this.isAnonymousPageAccessAllowed().then((i=>{const n=r.getHeadersAndUrlForPreprocessing(a.headers,a.urlToFetch||t,i);return n&&(a.urlToFetch=n),a.headers[e.Headers.PROTOCOL_OVERRIDE_HEADER]&&o.warn("URL mapping found an HTTP request; this will not work for Progressive Web Apps","Requests should be served from HTTPS"),a})):a})).then((t=>{const i=t;return i&&i.headers[e.Headers.VB_INFO_EXTENSION]&&delete i.headers[e.Headers.VB_INFO_EXTENSION],i}))}_findServiceMapping(e,t,i){let r;return e.some((e=>{let t=!1;return e.metadata&&e.metadata.path&&(t=i.startsWith(e.url+e.metadata.path)),(t||i.startsWith(e.url))&&(r=Object.assign({},e),r.headers=Object.assign({},r.headers),t?p(r):Object.keys(u).some((e=>!!i.endsWith(e)&&(u[e].augmentMapping(r),!0))),delete r.metadata,delete r.submapping,o.info(`found mapping for ${i}`),o.info(`mapping: ${JSON.stringify(r)}`)),r})),r}_findBackendMapping(e,t){let i;return e.some((e=>{if(t.startsWith(e.url)){const r=t.substring(e.url.length),n=e.urlToFetch+r;i=Object.assign({},e,{urlToFetch:n}),o.info(`found mapping for ${t}`),o.info(`mapping: ${JSON.stringify(i)}`)}return i})),i}handleProtocolRegistryChange(){this.urlMapPromise=null}handleCatalogReference(e,t,i){return t&&t.chain&&t.chain.length?this.getUrlMap().then((e=>{const i=t.type||t.chain[0]&&t.chain[0].type;if(i&&-1===l.indexOf(i)){const r=g.createMappingFromCatalogObject(t,i);this._addExternalMapping(e,i,r)}})):Promise.resolve()}handleServiceReferences(e,t){return Array.isArray(e)?this.getUrlMap().then((i=>{e.forEach((e=>{const r=g.createMappingFromServicesObject(e,t);this._addExternalMapping(i,s.ExtensionTypes.SERVICES,r)}))})):Promise.resolve()}_addExternalMapping(e,t,i){if(t&&i){const r=this._externalMapping[t]||(this._externalMapping[t]=[]);if(e){const n=e[t]||(e[t]=[]);this.addMapping(n,i)&&r.push(i)}else r.push(i)}}_addAllExternalMappings(e){Object.keys(this._externalMapping).forEach((t=>{const i=this._externalMapping[t],r=e[t]||(e[t]=[]);i.forEach((e=>{this.addMapping(r,e)}))}))}addMapping(t,i){if(t){const r=new a(i.url);if(i.type===s.ExtensionTypes.SERVICES&&r.protocol()===e.VbProtocols.CATALOG)return o.warn("Skip URL mapping for a service that resolves to vb-catalog.",i.ur),!1;const n=t&&t.find((e=>e.url===i.url));if(!n||n.submapping){if(t.push(i),r.protocol()!==e.VbProtocols.CATALOG){let e=r.segment().length;const n=Math.max(this.segmentMinimum,1)-1;for(;e-n>0;e-=1){r.segment(e-1,"");const n=Object.assign({submapping:!0},i,{url:r.toString()});t.push(n)}}return t.sort(this.comparitor),!0}}return!1}isAnonymousPageAccessAllowed(){return i.getResource("vb/private/stateManagement/router").then((e=>{const t=e.getCurrentPage();return t&&!t.isAuthenticationRequired()}))}static normalizeUrl(e=""){let t;g.portRemovedByRequest?t=a.parse(new Request(e).url):(t=a.parse(e),t.port&&("https"===t.protocol&&"443"===t.port||"http"===t.protocol&&"80"===t.port)&&(t.port=null)),t.hostname=t.hostname&&t.hostname.toLowerCase();let r=a.build(t).toString();return r=i.removeTrailingSlash(r),r}}try{g.portRemovedByRequest=new Request("https://foo:433/bar").url.indexOf(":433")<0}catch(e){g.portRemovedByRequest=!1}return g})),define("vb/private/vx/appUiInfos",["vb/private/log"],(e=>{const t=e.getLogger("/vb/private/vx/AppUiInfos");return class{constructor(){this.info={},this.extension={},this.urlIdToAppId={},this.log=t}static getAppUiInfoType(){return{id:"string",urlId:"string",displayName:"string",description:"string",defaultPage:"string",defaultFlow:"string",applicationStripe:"string",pillarTheme:"string",pillarThemeMode:"string",icon:"string",usage:"string",menuDisplayName:"string",extensible:"boolean"}}add(e,t,i={id:e}){this.info[e]=i,this.extension[e]?this.log.warn("App UI",e,"content has been redefined by extension",t.id):this.log.info("Found App UI",e,"in extension",t.id),this.extension[e]=t,i.urlId||(i.urlId=e),this.urlIdToAppId[i.urlId]=e}hasAppUI(){return this.getAppUiIds().length>0}exist(e){return!!this.info[e]}getAppUiIds(){return Object.keys(this.info)}getInfo(e){return this.info[e]}getExtension(e){return this.extension[e]}getAppUiIdFromUrlId(e){return this.urlIdToAppId[e]}getUrlIdFromAppId(e){return e?this.info[e].urlId:e}validateNavigation(e){}}})),define("vb/private/vx/baseExtension",["vb/private/constants","vb/private/utils","vb/private/log","vb/private/monitoring/loadMonitorOptions","vb/errors/httpError"],((e,t,i,r,n)=>{const s=i.getLogger("/vb/private/vx/baseExtension",[{name:"greenInfo",severity:"info",style:"green"}]);return class{constructor(t,i,r){this.id=t.id,this.registry=r,this.version=t.version,this.baseUrlDef=i,this.baseUrl=`${e.EXTENSION_PATH}${this.id}/`,this.files=t.files||[],this._initPromise=null,this.log=s}init(){return this._initPromise||(this._initPromise=this._initBundles(),Object.freeze(this)),this._initPromise}_initBundles(){return Promise.resolve().then((()=>{const e=this.findBundleUrl();let t;return e?t=this.loadBundle(e):(this.log.info("Applying extension",this.id,"version:",this.version,"without bundle"),this.registry.addRequireMapping(this.buildMapping())),t}))}getAbsoluteUrl(){return""}extendsBaseArtifact(){return!0}isValid(){return this.baseUrlDef&&this.id&&this.files&&this.files.length>0}fileExists(e){if(this.files.indexOf(e)>=0)return!0;throw new n(404,null,`${e} not found.`)}getRequiredExtensions(){return[]}findBundleUrl(){let e;const t=this.files.find((e=>e.indexOf("vb-app-bundle.js")>0));return t&&(e=`${this.baseUrlDef}/${t}`,e=requirejs.toUrl(e)),e}loadBundle(e){const i=new r(r.SPAN_NAMES.LOAD_EXTENSION_BUNDLE,`Extension ${this.id} bundle load`,this);return this.log.monitor(i,(i=>t.getResource(e).then((()=>{this.log.greenInfo("Extension",this.id,"version:",this.version,"is forcing a bundle load",i())})).catch((e=>{throw i(e),e}))))}buildMapping(){return{[t.removeTrailingSlash(this.baseUrl)]:this.baseUrlDef}}}})),define("vb/private/vx/baseExtensionAdapter",["vb/private/log","vb/private/configuration","vb/private/utils","urijs/URI","vbc/private/monitorOptions"],((e,t,i,r,n)=>{const s=e.getLogger("/vb/stateManagement/vx/extensionAdapter",[{name:"greenInfo",severity:"info",style:"green"}]),a="vbdt:preferExtensionVersion";return class{constructor(e){this.log=s,this.registryUrl=e}static getExtensionVersion(){let e=new r(window.location.href).search(!0)[a];return e?window.sessionStorage.setItem(a,e):(e=window.sessionStorage.getItem(a),e||(e=t.getSandboxId(),e&&(e=`$${encodeURIComponent(e)}`))),e}getFetchManifestPromise(e){const t=new n(n.SPAN_NAMES.LOAD_EXTENSION_MANIFEST,`extension manifest load ${e.url}`);return this.log.monitor(t,(t=>fetch(e).then((i=>{if(!i.ok)throw new Error(`Response not OK when fetching extension at: ${e.url}`);return this.log.greenInfo("Extension manifest loaded",t()),i.json()}))))}}})),define("vb/private/vx/extensionAdapterFactory",["vb/private/utils"],(e=>class{static get(t="v1",i=window.vbInitConfig||{}){let r,n="baseExtensionAdapter";if("v2"===t&&(r=e.cleanString(i.DIGEST_ENDPOINT)),r)n="endpointExtensionAdapter";else{if(r=e.cleanString(i.REGISTRY_URL),!r)return Promise.resolve();if(0===r.indexOf("http")){n="remoteExtensionAdapter";const i=r.indexOf("vxmanifest");i>0&&(r=r.substring(0,i)),"v2"===t&&(r=`${e.addTrailingSlash(r)}vxmanifest/v2/digests/`)}else n="localExtensionAdapter"}return e.getResource(`vb/private/vx/${t}/${n}`).then((e=>new e(r)))}})),define("vb/private/vx/baseExtensionRegistry",["vb/private/vx/extensionAdapterFactory","vb/private/vx/appUiInfos","vb/private/configLoader","vb/private/constants","vb/private/utils","urijs/URI","vb/private/log"],((e,t,i,r,n,s,a)=>{const o=a.getLogger("/vb/private/vx/baseExtensionRegistry"),c=(e,t)=>{Array.isArray(e)&&Array.isArray(t)&&e.forEach((e=>{let i=0;for(;i<t.length&&t[i].id!==e.id;i+=1);t.splice(i,1,e)}))};return class{constructor(e,t){this.applicationConfigCallback=e,this.runtimeEnvironmentCallback=t,this.fetchManifestPromise=null,this.loadExtensionsPromise=null,this.extensions={},this.log=o}static get extensionManagerVersion(){throw Error("need to override extensionManagerVersion")}initialize(){return this.initiateLoadManifest().then((e=>{!1===e&&(this.loadExtensionsPromise=Promise.resolve([]),this.log.info("No extension registry defined."))}))}_loadManifest(){return Promise.resolve().then((()=>{const e=[this.fetchManifestPromise,this.runtimeEnvironmentCallback().then((e=>e.getExtensionManifest()))];return Promise.all(e).then((e=>{const t=e[0],i=e[1];return i&&(c(i.extensions,t.extensions),c(i.requirejsInfo,t.requirejsInfo),c(i.appUiInfo,t.appUiInfo)),this.fetchManifestPromise=null,t}))}))}getExtensionAdapter(){return e.get(this.constructor.extensionManagerVersion)}getBasePath(e,t={extensionId:""}){return`${t.extensionId}/${e}`}getBasePathForUi(e,t){}getBasePathForLayout(e,t){}getBasePathForContainer(e,t){return"layout"===t.name?this.getBasePathForLayout(e,t):this.getBasePathForUi(e,t)}loadContainerExtensions(e,t){return this.getExtensions().then((i=>{if(0===i.length)return[];const r=[],n=this.getBasePathForContainer(e,t),s=t.constructor.extensionClass,a=`${n}${t.resourceName}${s.resourceSuffix}`;return i.forEach((e=>{if((e.files||[]).indexOf(a)>=0){const i=new s(e,n,t),a=i.load().then((()=>i));r.push(a)}})),Promise.all(r)}))}getAppUiInfos(){return Promise.resolve(new t)}getExtensions(){return this.loadExtensionsPromise=this.loadExtensionsPromise||this.getLoadManifestPromise().then((e=>{const t=[];(e.extensions||[]).forEach((i=>{const r=i.id,n=this.createExtension(i,e.appUiInfo&&e.appUiInfo[r],e.bundlesInfo&&e.bundlesInfo[r],e.bundledResources&&e.bundledResources[r],e.components&&e.components[r]);n.isValid()?(t.push(n),this.extensions[r]=n):this.log.error("Invalid manifest for extension:",r,"version:",n.version)}));const i=t.filter((e=>e.extendsBaseArtifact())).map((e=>e.init()));return Promise.all(i).then((()=>t))})),this.loadExtensionsPromise}getExtensionById(e){return this.extensions[e]}getExtensionDependencies(e,t){return[]}addRequireMapping(e){i.setConfiguration({paths:e})}loadLayoutExtensions(e,t=[],i={}){return this.getExtensions().then((e=>this.getExtensionDependencies(e,{id:i.extensionId}))).then((r=>{const n=this.getBasePathForLayout(e,i),s=this.createLayoutMaps(r,n),a=this.loadLayoutMaps(s,t);return Promise.all(a).then((e=>{const t={};e.forEach((e=>{e&&(t[e.name]=t[e.name]||{},t[e.name][e.type]=e.contents,t[e.name]._extInfo=t[e.name]._extInfo||{paths:{}},t[e.name]._extInfo.paths[e.type]=e.loaderPath)}));const i=[];return Object.keys(t).forEach((e=>{i.push(Object.assign({name:e},t[e]))})),i})).catch((e=>(this.log.error("Problem loading layout extensions, returning no extensions",e),[])))}))}loadServicesModel(e,t){const i={};return this.getExtensions().then((r=>{const n=r.find((t=>t.id===e));return n?n.files.forEach((r=>{let n,s;const a=r.match(this.constructor.serviceRegex);if(a&&(s=a[0],n=a[1]),n&&s){const r=t&&t.serviceFileMap&&t.serviceFileMap[n];r?r!==s&&this.log.warn("Extension",e,"contains service metadata ",s,". The declared file will be used instead: ",r):i[n]=s}})):this.log.warn("Unable to find extension services for extension, continuing: ",n),this.findCatalog(n)})).then((r=>{const s=Object.assign({extensionServiceMap:i},t);return r&&(s.extensions=s.extensions||{},s.extensions.catalogPaths={[e]:r}),n.getResource("vb/private/services/extensionServices").then((e=>new e(s)))}))}findCatalog(e){let t;return e.files.some((i=>(this.constructor.catalogRegex.test(i)&&(t=`${r.EXTENSION_PATH}${e.id}/${i}`),!!t))),t}createLayoutMaps(e,t){const i={};return e.forEach((e=>{const{extension:r}=e,a=r.files||[],o=r.baseUrlDef,c=new s(n.addTrailingSlash(t));a.filter((e=>c.equals(new s(e).filename("")))).forEach((e=>{const t=e.split("/"),n=t.pop(),s=t.join("/");i[s]=i[s]||{},i[s][r.id]=i[s][r.id]||{id:r.id,name:r.id,baseUrlDef:o,files:[]},i[s][r.id].files.push(n)}));const l=this.getBasePathForLayout(t,{extensionId:r.id});Object.assign(i,this.createLayoutMaps(e.dependencies,l))})),i}loadLayoutMaps(e,t){const i=[];return Object.keys(e).forEach((s=>{const a=e[s];Object.keys(a).forEach((a=>{const o=e[s][a];o.files.forEach((e=>{const a=t.find((t=>t.extensionFile&&t.extensionFile.endsWith(e)));let c=e;if(a){const t=`${s}/${c}`,l=this.getExtensionById(o.id);if(l)try{l.fileExists(t)}catch(e){return this.log.info("No",a.property,"for",c,"skipping."),null}a.removeExtRelative&&(c=n.removeFileExtension(c));const h=`${r.EXTENSION_PATH}${o.id}/${s}/${c}`,p=a.extnLoader(h).then((e=>({name:o.name,contents:e,pathKey:s,loaderPath:h,type:a.property}))).catch((t=>(this.log.error("Problem loading layout extensions, skipping:",e,"error:",t),null)));i.push(p)}}))}))})),i}loadTranslationExtensions(e,t){return Promise.resolve([])}getTranslations(){return Promise.resolve([])}}})),define("vb/private/vx/v1/extension",["vb/private/vx/baseExtension","vb/private/constants"],((e,t)=>class extends e{constructor(e,t){super(e,e.ui&&e.ui.baseUrl,t)}getAbsoluteUrl(){return`${this.baseUrlDef}/${t.ExtensionFolders.SELF}/`}})),define("vb/private/vx/v1/extensionRegistry",["vb/private/vx/baseExtensionRegistry","vb/private/vx/v1/extension"],((e,t)=>{const i=/^self\/services\/([\w_$-]*)\/openapi[\w.]*\.json$/,r=/^self\/services\/catalog.json$/;return class extends e{static get extensionManagerVersion(){return"v1"}static get serviceRegex(){return i}static get catalogRegex(){return r}createExtension(e){return new t(e,this)}initiateLoadManifest(){return Promise.all([this.getExtensionAdapter(),this.applicationConfigCallback()]).then((([e,t])=>!!e&&(this.fetchManifestPromise=e.initiateFetchManifest(t.id),!0)))}getLoadManifestPromise(){return this._loadManifest().catch((e=>(this.log.error("Error loading extension registry, running baseline application",e),{})))}getBasePathForUi(e,t){return this.getBasePath(e,t)}getBasePathForLayout(e,t){return this.getBasePath(e,t)}getExtensionDependencies(e,t){const i=[];return e.forEach((e=>{const t={extension:e,dependencies:[]};i.push(t)})),i}}})),define("vb/private/vx/v1/localExtensionAdapter",["vb/private/vx/baseExtensionAdapter","vb/private/utils"],((e,t)=>class extends e{initiateFetchManifest(e){return Promise.resolve().then((()=>{if(!e)throw new Error("Cannot load extension, application id is not defined");return this.log.info("Loading extensions from local file",this.registryUrl,"using extension manager v1."),t.loadAndParse(this.registryUrl).then((e=>{const i=e.extensions||[],r={},n=[];return i.forEach((e=>{r[e.id]=e.ui,n.push(t.loadAndParse(`${e.ui.baseUrl}/manifest.json`))})),Promise.all(n).then((e=>(e.forEach((e=>{e.ui={baseUrl:r[e.id].baseUrl}})),{extensions:e})))}))}))}})),define("vb/private/vx/v1/remoteExtensionAdapter",["vb/private/vx/baseExtensionAdapter","vb/private/utils","urijs/URI"],((e,t,i)=>class extends e{initiateFetchManifest(e){return Promise.resolve().then((()=>{if(!e)throw new Error("Cannot load extension, application id is not defined");const t=this.constructor.getExtensionVersion(),i=this.buildUrl(e,t);this.log.info("Loading extensions at",i,"using extension manager v1.");const r=new Request(i);return this.getFetchManifestPromise(r).then((t=>{const i=t||{};return i.extensions=i.extensions||[],this.log.info("Found",i.extensions.length,"extension(s) for application",e),i}))}))}buildUrl(e,r){const n=new i(`${t.addTrailingSlash(this.registryUrl)}vxmanifest/v1/applications`);return n.segmentCoded(e),n.segment("ui-manifest"),r&&n.search(`preferExtensionVersion=${r}`),n.href()}})),define("vb/private/vx/v2/endpointExtensionAdapter",["vb/private/vx/baseExtensionAdapter","urijs/URI","vb/private/utils","vbsw/private/constants"],((e,t,i,r)=>class extends e{initiateFetchManifest(){return Promise.resolve().then((()=>{const e=this.buildUrl();this.log.info("Loading extensions at",e,"using extension manager v2.");const t=new Request(e);return t.headers.set(r.USE_CACHED_RESPONSE_WHEN_OFFLINE,"true"),this.getFetchManifestPromise(t).then((e=>{const t=e&&e.digest||{},i=t.runtime||[],r=t["requirejs-info"]||[],n={extensions:i,appUiInfo:t["app-ui-info"]||[],requirejsInfo:r};return this.log.info("Found",n.extensions.length,"extension(s)."),n}))}))}getUri(){const e=new t(this.registryUrl);return e.search("type=runtime,requirejs-info,app-ui-info"),e}buildUrl(){return this.getUri().href()}})),define("vb/private/vx/v2/extension",["vb/private/vx/baseExtension","vb/private/configLoader","vb/private/constants","vb/private/utils"],((e,t,i,r)=>{const n=new RegExp(`^${i.DefaultPaths.UI}base/|^${i.DefaultPaths.LAYOUTS}base/|^${i.DefaultPaths.TRANSLATIONS}base/`);return class extends e{constructor(e,t,i=[],n=[],s={},a){super(e,e.baseUrl,a),this.appUiInfo={};if((t&&t.applications||[]).forEach((e=>{this.appUiInfo[e.id]=e})),this.componentsRequirejs=s,i.length>0){const e={};this.log.info("Extension",this.id,"version:",this.version,"is using",i.length,"bundle"),i.forEach((t=>{const i=r.removeTrailingSlash(this.baseUrl),n=t.replace(i,this.baseUrlDef);e[t]=n})),this.registry.addRequireMapping(e),this.useBundles=!0}else this.useBundles=!1;n.length>0&&(this.files.length>0?this.files=[...new Set(this.files.concat(n))]:this.files=n),this.dependencies=e.dependencies||{}}getAbsoluteUrl(){return`${this.baseUrlDef}/${i.DefaultPaths.UI}${i.ExtensionFolders.SELF}/`}getAllDependencies(e){if(e.has(this))return;e.add(this);[...this.getDependentExtensions(),...this.getRequiredExtensions()].forEach((t=>{t.getAllDependencies(e)}))}init(){const e=new Set;this.getAllDependencies(e);const t=[...e];return Promise.all(t.map((e=>e.internalInit())))}internalInit(){return this._initPromise||(this._initPromise=Promise.all([this._initBundles(),this._initRequireConfig()]).then((()=>{Object.freeze(this)}))),this._initPromise}_initBundles(){return this.useBundles?Promise.resolve():super._initBundles()}_initRequireConfig(){t.addRequirejsPaths(this.componentsRequirejs,this.baseUrl),this.componentsRequirejs={}}getRequiredExtensions(){const e=[];return Object.keys(this.dependencies).forEach((t=>{const i=this.registry.extensions[t];i?e.push(i):this.log.warn("Extension",this.id,"depends on extension",t,"that does not exist.")})),e}getDependentExtensions(){const e=[];return Object.entries(this.registry.extensions).forEach((([t,i])=>{i.dependencies[this.id]&&e.push(i)})),e}extendsBaseArtifact(){return this.files.some((e=>n.test(e)))}getAppUiInfo(e){return this.appUiInfo[e]||{id:e}}}})),define("vb/private/vx/v2/extensionRegistry",["vb/private/vx/baseExtensionRegistry","vb/private/vx/v2/extension","vb/private/configLoader","compare-versions","vb/private/constants","vb/private/utils"],((e,t,i,r,n,s)=>{const a=new RegExp(`^${n.DefaultPaths.UI}${n.ExtensionFolders.SELF}/${n.DefaultPaths.APPLICATIONS}(.*)/app.json$`),o=new RegExp(`^${n.DefaultPaths.SERVICES}${n.ExtensionFolders.SELF}/([\\w_$-]*)/openapi[\\w.]*\\.json$`),c=new RegExp(`^${n.DefaultPaths.SERVICES}${n.ExtensionFolders.SELF}/catalog.json$`);return class extends e{static get extensionManagerVersion(){return"v2"}static get serviceRegex(){return o}static get catalogRegex(){return c}createExtension(e,i,r,n,s){return new t(e,i,r,n,s,this)}initiateLoadManifest(){return this.getExtensionAdapter().then((e=>!!e&&(this.fetchManifestPromise=e.initiateFetchManifest(),!0)))}getLoadManifestPromise(){return this._loadManifest().then((e=>{const t={},n={},a={},o={},c={},l={};e.appUiInfo&&e.appUiInfo.forEach((e=>{e.metadata.version=e.version,o[e.id]=e.metadata})),e.appUiInfo=o,e.requirejsInfo.forEach((e=>{n[e.id]=[];const o=e.metadata;if(o){if(o.configurations){const i=o.configurations.build;if(i){if(i.bundles&&"object"==typeof i.bundles){const r=n[e.id];Object.keys(i.bundles).forEach((e=>{r.push(e)})),Object.assign(t,i.bundles)}i.bundledResources&&(a[e.id]=i.bundledResources)}}if(o.components){const t=i.getEvaluatedSafe(o.components);Object.keys(t).forEach((i=>{const n=t[i],a=n.requirejs&&n.requirejs.paths;if(s.isObject(a)&&Object.keys(a).length>0){let t=a[i];t||(t=a[i=Object.keys(a)[0]]),s.isAbsoluteUrl(t)?n.version?(!c[i]||r(n.version,c[i].version)>0)&&(c[i]=n):this.log.warn("Component",i,"does not have a version property, ignoring it."):l[e.id]=s.mergeObject(l[e.id]||{},n.requirejs)}}))}}}));const h={};return Object.keys(c).forEach((e=>{const i=c[e];this.log.info("Registering component",e,"version",i.version),Object.assign(h,i.requirejs.paths),Object.assign(t,i.requirejs.bundles)})),(Object.keys(t).length>0||Object.keys(h).length>0)&&i.setConfiguration({paths:h,bundles:t}),e.bundlesInfo=n,e.bundledResources=a,e.components=l,delete e.requirejsInfo,e})).catch((e=>(this.log.error("Error loading extension registry, no App UI will be loaded",e),{})))}getBasePathForUi(e,t){return`${n.DefaultPaths.UI}${this.getBasePath(e,t)}`}getBasePathForLayout(e,t){let i=e;i.startsWith(n.DefaultPaths.LAYOUTS)||i.startsWith(n.DefaultPaths.UI)||(i=`${n.DefaultPaths.UI}${i}`);const r=s.addTrailingSlash(i).split("/");return"base"===t.extensionId?r.splice(1,0,"base"):"base"!==r[1]&&(r[1]=t.extensionId),r.join("/")}getAppUiInfos(){return super.getAppUiInfos().then((e=>this.runtimeEnvironmentCallback().then((e=>e.disableAppUis())).then((t=>!0===t?e:this.getExtensions().then((t=>(t.forEach((t=>{const i=t.appUiInfo&&Object.values(t.appUiInfo)||[];if(i.length>0)i.forEach((i=>{e.add(i.id,t,i)}));else{(t.files||[]).forEach((i=>{const r=i.match(a),n=r&&r[1];n&&e.add(n,t)}))}})),e)))))))}loadTranslationExtensions(e,t){return this.getExtensions().then((i=>{const r=[],s=`${`${n.DefaultPaths.TRANSLATIONS}${this.getBasePath(e,t)}`}-x`,a=t.constructor.extensionClass,o=`${s}.js`;return i.forEach((e=>{if((e.files||[]).indexOf(o)>=0){const i=new a(e,s,t),n=i.load().then((()=>i));r.push(n)}})),Promise.all(r)}))}getExtensionDependencies(e,{id:t="base",version:i=0}={}){const r=[];return e.forEach((i=>{const n=i.dependencies[t];if("base"===t&&!n||n){const t={extension:i,dependencies:this.getExtensionDependencies(e,i)};r.push(t)}})),r}getTranslations(){return this.getExtensions().then((e=>{const t={};return e.forEach((e=>{try{e.fileExists("translations/translations-config.json")&&(t[e.id]=e)}catch(e){}})),t}))}}})),define("vb/private/vx/v2/localExtensionAdapter",["vb/private/vx/baseExtensionAdapter","vb/private/utils"],((e,t)=>class extends e{initiateFetchManifest(){return Promise.resolve().then((()=>(this.log.info("Loading extensions from local file",this.registryUrl,"using extension manager v2."),t.loadAndParse(this.registryUrl).then((e=>{const i=e.extensions||[],r={},n=[];return i.forEach((e=>{r[e.id]=e,n.push(t.loadAndParse(`${e.baseUrl}/manifest.json`))})),Promise.all(n).then((e=>{const i=[];let n;return e.forEach((e=>{if(e.baseUrl=r[e.id].baseUrl,e.dependencies){const i=t.cloneObject(e.dependencies);e.dependencies={},i.forEach((t=>{e.dependencies[t.id]=t.version}))}e["app-ui-info"]&&(n=n||[],n.push({id:e.id,version:e.version,metadata:e["app-ui-info"].metadata})),e["requirejs-info"]&&i.push({id:e.id,version:e.version,metadata:e["requirejs-info"].metadata})})),{extensions:e,appUiInfo:n,requirejsInfo:i}}))})))))}})),define("vb/private/vx/v2/remoteExtensionAdapter",["vb/private/vx/v2/endpointExtensionAdapter","vb/private/utils"],((e,t)=>class extends e{static getExtensionVersion(){const i=e.getExtensionVersion();if(!i){const e=t.cleanString(window.vbInitConfig&&window.vbInitConfig.REGISTRY_DIGEST_VERSION);return e?encodeURIComponent(e):"latest"}return i}getUri(){const e=super.getUri(),t=this.constructor.getExtensionVersion();return e.segment(t),e}})),define("vb/types/extendedTypeMixin",["vb/types/extendedType","vb/private/stateManagement/stateUtils"],((e,t)=>{class i{callActionChain(e,t={},i){return this.handler.callActionChain(e,t,i)}setupVariableProperties(e,t,i,r){Object.keys(e).forEach((e=>{Object.defineProperty(this,e,this.getVariablePropertyDefinition(e,t,i,r))}))}getVariablePropertyDefinition(e,i,r,n){return t.getVariablePropertyDefinition(this,e,i,r,n)}}return t=>{class r extends t{}return((e,...t)=>{const i=e;t.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((t=>{i.prototype[t]||(i.prototype[t]=e.prototype[t])}))}))})(r,i,e),r}})),define("vb/types/factories/typeFactory",[],(()=>class{static createInstance(e){throw new Error("method unsupported!")}})),define("vb/types/factories/multiServiceDataProviderFactory",["vb/types/factories/typeFactory","vb/private/types/dataProviders/dynamicMultiServiceDataProvider"],((e,t)=>class extends e{static createInstance(e={}){const{dataProviderOptions:i,serviceOptions:r,vbContext:n}=e;return Promise.resolve(new t(i,r,n))}})),define("vb/types/factories/serviceDataProviderFactory",["vb/types/factories/typeFactory","vb/private/types/dataProviders/dynamicServiceDataProvider"],((e,t)=>class extends e{static createInstance(e={}){const{dataProviderOptions:i,serviceOptions:r,vbContext:n}=e;return Promise.resolve(new t(i,r,n))}})),define("text!vb/types/instanceFactory/builtinTypes.json",[],(function(){return'{\n  "types": {\n    "vb/ServiceDataProvider2": {\n      "typeDef": "./vbServiceDataProvider2/index.d.ts"\n    },\n    "vb/MultiServiceDataProvider2": {\n      "typeDef": "./vbMultiServiceDataProvider2/index.d.ts"\n    }\n  }\n}\n'})),define("text!vb/types/instanceFactory/vbMultiServiceDataProvider2/index.d.ts",[],(function(){return"/**\n * @license\n * Copyright (c) 2014, 2020, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\n/**\n * Typescript Declaration for the vb/MultiServiceDataProvider2 class used with Instance Factory variables.\n */\ndeclare class MultiServiceDataProvider2 {\n  /**\n   * defines properties used to initialize MSDP2. Refer to docs for MultiServiceDataProvider2.js\n   * @param options\n   */\n  constructor(options: {\n    dataProviders: {\n      fetchFirst: object,\n      fetchByKeys?: object,\n      fetchByOffset?: object,\n    },\n  });\n}\n\nexport = MultiServiceDataProvider2;\n"})),define("text!vb/types/instanceFactory/vbServiceDataProvider2/index.d.ts",[],(function(){return"/**\n * @license\n * Copyright (c) 2014, 2020, Oracle and/or its affiliates.\n * Licensed under The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\n\n/**\n * Typescript Declaration for the vb/ServiceDataProvider2 class used with Instance Factory variables.\n */\n\ndeclare class ServiceDataProvider2 {\n  /**\n   * defines properties used to initialize SDP2. Refer to docs for ServiceDataProvider2.js\n   * @param options\n   */\n  constructor(options: {\n    capabilities?: {\n      sort?: {\n        attributes: string,\n      },\n      filter?: {\n        operators: string[],\n        textFilter: boolean,\n      },\n      fetchByKeys?: {\n        implementation: string,\n        multiKeyLookup: string,\n      },\n      fetchByOffset?: {\n        implementation: string,\n      },\n      fetchFirst?: {\n        implementation: string,\n      },\n    },\n    endpoint: string,\n    fetchChainId?: string,\n    headers?: object,\n    itemsPath?: string,\n    keyAttributes?: string | string[];\n    mergeTransformOptions?: string,\n    pagingCriteria?: {\n      offset: number,\n      size: number,\n      maxSize: number,\n      iterationLimit: number,\n    },\n    responseType?: string,\n    totalSize?: number,\n    transforms?: {\n      request: {\n        paginate: string,\n        query: string,\n        filter: string,\n        sort: string,\n        select: string,\n        body: string,\n      },\n      response: {\n        paginate: string,\n        body: string,\n      },\n    },\n    transformsContext?: object,\n    uriParameters?: object,\n  });\n}\nexport = ServiceDataProvider2;\n"})),define("vb/types/instanceFactory/loader",["text!./builtinTypes.json","text!./vbMultiServiceDataProvider2/index.d.ts","text!./vbServiceDataProvider2/index.d.ts"],(()=>{})),define("vbsw/helpers/serviceWorkerHelpers",["vbsw/private/serviceWorkerManager","vbsw/private/utils"],((e,t)=>class{static isOnline(){return e.getInstance().isOnline()}static forceOffline(t){return e.getInstance().forceOffline(t)}static setOfflineHandlerOptions(t){return e.getInstance().setOfflineHandlerOptions(t)}static syncOfflineData(t){return e.getInstance().syncOfflineData(t)}static getOfflineSyncLog(){return e.getInstance().getOfflineSyncLog()}static insertOfflineSyncRequest(t,i){return e.getInstance().insertOfflineSyncRequest(t,i)}static removeOfflineSyncRequest(t){return e.getInstance().removeOfflineSyncRequest(t)}static updateOfflineSyncRequest(t,i){return e.getInstance().updateOfflineSyncRequest(t,i)}static installMainThreadMessageHandler(t){try{if(window)return e.getInstance().installMessageHandler(t)}catch(e){}}static uninstallMainThreadMessageHandler(t){try{if(window)return e.getInstance().uninstallMessageHandler(t)}catch(e){}}static invokeMainThreadMessageHandlerMethod(e,i,...r){return t.postMessage(e,{method:i,args:r})}})),requirejs.config({map:{"*":{main:"vbsw/main"}}}),define("vbsw/main",(function(){})),define("vbsw/private/headerUtils",["vbsw/private/constants"],(e=>{const t=["Accept","Accept-Language","Content-Type","Content-Language","Content-Encoding","ETag","If-Match","If-None-Match","Cache-Control","Vary","Last-Modified","If-Modified-Since","If-Unmodified-Since","Expires","Prefer","vb-.*"],i=[...t,"Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Proxy-.*","Sec-.*","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"],r=new RegExp(`^(${i.join("|")})$`,"i"),n=/^x-oracle.*/i;class s{static needsPrefixForProxy(e,t){return!r.test(e)&&(n.test(e)||t.indexOf(e)>=0)}static prefixHeaderForProxy(t,i){const r=`${e.HEADER_PROXY_HEADER_PREFIX}${i}`,n=t.headers.get(i);t.headers.set(r,n),t.headers.delete(i)}}return s.browserSuppliedHeaders=t,s})),define("vbsw/private/plugins/abstractAuthHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbc/private/constants"],((e,t)=>{const i=/^https/;return class extends e{deriveUrlKey(e){throw new Error("Should be implemented by specific subclass")}handleRequestHook(r){return Promise.resolve().then((()=>{const n=JSON.parse(r.headers.get(t.Headers.VB_INFO_EXTENSION));if(!n)return r;const s=r.headers.get(t.Headers.PROTOCOL_OVERRIDE_HEADER),a=n.tokenRelayUrls;let o;a&&(o=a[this.deriveUrlKey(r)]);const c=n.proxyUrls;let l=c&&c[this.deriveUrlKey(r)];l||(l=n.proxyUrl);const h=n[t.Headers.INHERIT],p=n[t.Headers.VB_DT_AUTHENTICATION],u=p&&!1===p.inherit;if(h&&!u)r.headers.set("vb-inherit-authentication","not-handled"),l&&r.headers.set("vb-inherit-authentication-fallback",l);else if(o)r.headers.set("vb-token-relay-url",o),p&&r.headers.set("vb-token-relay-authentication",JSON.stringify(p));else if(l){const t=l.endsWith("/")?l.substring(0,l.length-1):l;let n=r.url.replace(":/","");return s&&(n=n.replace(i,s)),console.log("Before fetch handler plugin"),e.getRequestConfig(r,this.fetchHandler).then((e=>{const i=this.fetchHandler.createRequest(`${t}/${n}`,e);return p&&"direct"!==p.type&&(i.headers.set("Breeze-Design-Whitelist","true"),Object.entries(p).reduce(((e,[t,i])=>(e.set(`Breeze-${t}`,i),e)),i.headers)),i}))}return r}))}}})),define("vbsw/private/plugins/anonymousAuthHandlerPlugin",["vbsw/private/plugins/abstractAuthHandlerPlugin"],(e=>class extends e{deriveUrlKey(e){return"anonymous"}})),define("vbsw/private/plugins/authenticatedAuthHandlerPlugin",["vbsw/private/plugins/abstractAuthHandlerPlugin"],(e=>class extends e{deriveUrlKey(e){return"authenticated"}})),define("vbsw/private/plugins/authHeaderHandlerPlugin",["vbsw/api/fetchHandlerPlugin","urijs/URI"],((e,t)=>{const i=/\/ic\/builder\/(design|deployment|rt)\/[^\/]+\/[^\/]*(\/resources\/(data(mgr)?|vbprocess)|(\/resources)?\/services)(\/.+)?/;return class extends e{constructor(e,t={}){super(e,t),this.authType=t.isAnonymous?"Public":"Session",this.regex=t.regex?new RegExp(t.regex):i}handleRequestHook(e){let i=e.url.match(this.regex);if(!i&&e.url.indexOf("../")>=0){i=new t(e.url).normalize().toString().match(this.regex)}return i&&e.headers.set("Authorization",this.authType),Promise.resolve()}}})),define("vbsw/private/plugins/authPostprocessorHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/constants","vbsw/private/headerUtils"],((e,t,i)=>{class r extends e{handleRequestHook(e){const n=[],s=[],a=e.headers.get(t.PROXY_HEADERNAME_HEADER);let o;try{o=a?JSON.parse(a).map((e=>e.toLowerCase())):null}catch(e){console.error("Error parsing value for internal header",t.PROXY_HEADERNAME_HEADER,e)}for(const a of e.headers.keys())o&&i.needsPrefixForProxy(a,o)?s.push(a):r.VB_HEADER_REGEX.test(a)&&!a.startsWith(t.HEADER_PROXY_PREFIX)&&n.push(a);return s.forEach((t=>{i.prefixHeaderForProxy(e,t)})),n.forEach((t=>{e.headers.delete(t)})),Promise.resolve()}}return r.VB_HEADER_REGEX=/^vb-.*/,r})),define("vbsw/private/plugins/authPreprocessorHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/constants","vbc/private/constants","vbc/private/log","vbsw/private/utils"],((e,t,i,r,n)=>{const s=/^https/,a=r.getLogger("/vbsw/private/plugins/authPreprocessorHandlerPlugin"),o={ALWAYS:"always",CORS:"cors"},c=["cloud","oauth2_client_credentials","oauth2_user_assertion","oauth2_resource_owner"],l=[t.AuthenticationType.BASIC,t.AuthenticationType.HTTP_SIGNATURE_OCI],h=c.concat(l),p={accept:"*/*"};class u extends e{constructor(e,i={}){super(e,i),this.defaultAuthentication=i.defaultAuthentication||{};const r=e.fetchHandler.config&&e.fetchHandler.config.userConfig;this.passthroughs=i.passthroughs||r&&r.configuration&&r.configuration.passthroughs||[],this.defaultAuthenticationType=this.defaultAuthentication.type,this.defaultAuthenticationType&&this.defaultAuthenticationType!==t.AuthenticationType.NONE||(this.defaultAuthenticationType=t.AuthenticationType.ORACLE_CLOUD),this.isAnonymous=i.isAnonymous,this.urlMapperClient=this.fetchHandler&&this.fetchHandler.urlMapperClient}static get forceProxy(){return o}static get tokenRelayTypes(){return c}static get alwaysProxyTypes(){return h}getUrlKey(e,t){return e?"anonymous":"authenticated"}static getTokenRelayUrlFromRequest(e){const t=e.headers.get(i.Headers.VB_INFO_EXTENSION);if(t){const e=JSON.parse(t);if(e.resolvedTokenRelayUrl)return e.resolvedTokenRelayUrl}return null}enforceCORS(){return!0}useProxyForProtocol(e,t){return e.headers.get(i.Headers.PROTOCOL_OVERRIDE_HEADER)&&(void 0===t.forceProxy||null===t.forceProxy)}supportsTokenRelay(e){return c.indexOf(e)>=0}processInfoExtension(e,i){const r=e.proxyUrl||e.proxyUrls||e.tokenRelayUrls,n=this.useProxyForProtocol(i,e);if(!r&&(e.forceProxy||e.authentication||n)){const r=this.isInheritDisabledForDT(e);let s,a,c=t.AuthenticationType.DIRECT;const h=this.getUrlKey(this.isAnonymous,i);if("anonymous"===h&&!0!==e.anonymousAccess)return{authenticationType:c};let p;if(e.authentication){if(p=e.authentication[h],this.isPassthrough(p))return{passthroughProperties:Object.assign({},p)};if(p&&"as_authenticated_user"===p.type&&(p=e.authentication.authenticated),p&&l.indexOf(p.type)>=0&&(e.forceProxy=o.ALWAYS),p&&"propagate"===p.type&&(c=this.defaultAuthenticationType,(c===t.AuthenticationType.BASIC||c===t.AuthenticationType.IMPLICIT&&!r||c===t.AuthenticationType.OAUTH)&&!this.isAnonymous))return{authenticationType:c}}return c===t.AuthenticationType.ORACLE_CLOUD||e.forceProxy===o.ALWAYS||r&&c===t.AuthenticationType.IMPLICIT||e.forceProxy===o.CORS&&this.enforceCORS()||n?(c=t.AuthenticationType.ORACLE_CLOUD,s=e.resolvedProxyUrl):e.forceProxy!==o.CORS&&e.forceProxy||!p||!this.supportsTokenRelay(p.type)?c=t.AuthenticationType.DIRECT:(c=t.AuthenticationType.TOKEN_RELAY,a=e.resolvedTokenRelayUrl),{authenticationType:c,proxyUrl:s,tokenRelayUrl:a,trap2Enabled:e.trapEnabled,authentication:p,isLegacy:!1,passthroughProperties:null}}return this.processLegacyInfoExtension(e,i)}processLegacyInfoExtension(e,r){const n=e[i.Headers.VB_DT_AUTHENTICATION],s=this.isInheritDisabledForDT(e),a=e[i.Headers.INHERIT]&&!s;let o=e.authenticationType;a&&(o=this.defaultAuthenticationType);const c=e.proxyUrls||{},l=e.tokenRelayUrls||{};let h,p,u;return a&&this.isAnonymous?(u=this.getUrlKey(!0,r),h=c[u],p=l[u],o=p?t.AuthenticationType.TOKEN_RELAY:h?t.AuthenticationType.ORACLE_CLOUD:t.AuthenticationType.DIRECT):(u=this.getUrlKey(this.isAnonymous,r),h=c[u],p=l[u]),h||(h=e.proxyUrl),o||(o=p?t.AuthenticationType.TOKEN_RELAY:h?t.AuthenticationType.ORACLE_CLOUD:t.AuthenticationType.DIRECT),{authenticationType:o,proxyUrl:h,tokenRelayUrl:p,authentication:n,isLegacy:!0}}isInheritDisabledForDT(e){const t=e[i.Headers.VB_DT_AUTHENTICATION];return t&&!1===t.inherit}isPassthrough(e){return e&&this.passthroughs.indexOf(e.type)>=0}handleRequestHook(r,n){return Promise.resolve().then((()=>{const e=r.headers.get(i.Headers.VB_INFO_EXTENSION);return null==e?this.getExtensionFromMapping(r,n):JSON.parse(e)})).then((n=>{if(!n)return r;const{authenticationType:a,proxyUrl:o,tokenRelayUrl:c,trap2Enabled:l,authentication:h,isLegacy:p,passthroughProperties:d}=this.processInfoExtension(n,r);if(d)return this.setPassthroughHeaders(r,d);const g=[];if(!p&&a===t.AuthenticationType.ORACLE_CLOUD&&o)for(const e of r.headers.keys())g.push(e);return r.headers.set(t.AUTHENTICATION_TYPE_HEADER,a),Promise.resolve().then((()=>n.urlToFetch?e.getRequestConfig(r,this.fetchHandler).then((e=>this.fetchHandler.createRequest(n.urlToFetch,e))):r)).then((r=>{if(a===t.AuthenticationType.TOKEN_RELAY)r.headers.set(t.TOKEN_RELAY_URL_HEADER,c),l&&r.headers.set(t.TRAP_2_ENABLED_HEADER,"true"),h&&r.headers.set(t.TOKEN_RELAY_AUTH_HEADER,JSON.stringify(h));else if(a===t.AuthenticationType.ORACLE_CLOUD&&o){const a=o.endsWith("/")?o.substring(0,o.length-1):o;let c=r.url.replace(":/","");const h=r.headers.get(i.Headers.PROTOCOL_OVERRIDE_HEADER);return h&&(c=c.replace(s,h)),l&&n.trapScope&&(n[t.ORASASS_SCOPE]=n.trapScope,r.headers.set(i.Headers.VB_INFO_EXTENSION,JSON.stringify(n))),e.getRequestConfig(r,this.fetchHandler).then((e=>(p||u.addPostProcessingHeader(e,g),this.fetchHandler.createRequest(`${a}/${c}`,e))))}return r}))}))}setPassthroughHeaders(e,i){return i&&e.headers.set(t.HEADER_PASSTHROUGH,JSON.stringify(i)),e}getExtensionFromMapping(e,t){return this.urlMapperClient?this.urlMapperClient.getMapping(e,t).then((t=>(t&&this.applyMapping(e,t),t))):Promise.resolve(null)}applyMapping(e,t){if(t){const r=JSON.stringify(t);a.info("UrlMapper found mapping for: ",e.url,r),Object.keys(t.headers).forEach((i=>{const r=e.headers.get(i);(null==r||p[i.toLowerCase()]===r&&n.isWorkerThread())&&e.headers.set(i,t.headers[i])})),e.headers.set(i.Headers.VB_INFO_EXTENSION,r)}return e}static addPostProcessingHeader(e,i){e.headers[t.PROXY_HEADERNAME_HEADER]=JSON.stringify(i||[])}}return u})),define("vbsw/private/plugins/authPublicHandlerPlugin",["vbsw/api/fetchHandlerPlugin","urijs/URI"],((e,t)=>{const i=/\/ic\/builder\/(design|deployment)\/[\w\d]+\/(((\d+\.)+\d+)|(\d+))\/resources\/(data(mgr)?|vbprocess)(\/.+)?/,r=/\/ic\/builder\/rt\/[\w\d]+\/(((\d+\.)+\d+)|(\d+)|(live))(\/resources\/(data|vbprocess)|(\/resources)?\/services)(\/.+)?/;return class extends e{handleRequestHook(e){let n=e.url.match(r)||e.url.match(i);if(!n&&e.url.indexOf("../")>=0){const s=new t(e.url).normalize().toString();n=s.match(r)||s.match(i)}return n&&e.headers.set("Authorization","Public"),Promise.resolve()}}})),define("vbsw/private/plugins/authSessionHandlerPlugin",["vbsw/api/fetchHandlerPlugin","urijs/URI"],((e,t)=>{const i=/\/ic\/builder\/(design|deployment)\/[\w\d]+\/(((\d+\.)+\d+)|(\d+))\/resources\/(data(mgr)?|vbprocess)(\/.+)?/,r=/\/ic\/builder\/rt\/[\w\d]+\/(((\d+\.)+\d+)|(\d+)|(live))(\/resources\/(data|vbprocess)|(\/resources)?\/services)(\/.+)?/;return class extends e{handleRequestHook(e){let n=e.url.match(r)||e.url.match(i);if(!n&&e.url.indexOf("../")>=0){const s=new t(e.url).normalize().toString();n=s.match(r)||s.match(i)}return n&&e.headers.set("Authorization","Session"),Promise.resolve()}}})),define("vbsw/private/plugins/csrfTokenHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/utils"],((e,t)=>{const i="X-appbuilder-client-id",r="X-invalid-appbuilder-client-id";return class extends e{constructor(e,i={}){super(e),this.vbCsrfToken=i.csrfToken;const r=i&&i.regex?i.regex:t.getRegexForAppScope(this.fetchHandler.scope,this.fetchHandler.config);this.scopeRegEx=new RegExp(r),this.versionIdRegEx=i.versionId?new RegExp(i.versionId):null}static get csrfTokenHeader(){return i}static get invalidCsrfTokenHeader(){return r}getCsrfToken(){return this.vbCsrfToken?Promise.resolve(this.vbCsrfToken):this.stateCache.get(i).then((e=>(this.vbCsrfToken=e,e)))}refreshCsrfToken(e){const t=e.headers.get(i);return t&&t!==this.vbCsrfToken?(this.vbCsrfToken=t,this.stateCache.put(i,t)):Promise.resolve()}handleRequestHook(e){return!e.url.match(this.scopeRegEx)||this.versionIdRegEx&&e.url.match(this.versionIdRegEx)?Promise.resolve():this.getCsrfToken().then((t=>{e.headers.set(i,t)}))}handleResponseHook(e,t,i){if(i.url.match(this.scopeRegEx)&&(!this.versionIdRegEx||!i.url.match(this.versionIdRegEx))){if(403===e.status&&e.headers.get(r))return this.refreshCsrfToken(e).then((()=>!0));if(e.ok)return this.refreshCsrfToken(e).then((()=>!1))}return Promise.resolve(!1)}}})),define("vbsw/private/plugins/fallbackInheritedAuthHandlerPlugin",["vbsw/private/plugins/abstractAuthHandlerPlugin","vbc/private/constants"],((e,t)=>class extends e{deriveUrlKey(e){return"authenticated"}handleRequestHook(e){const i=e.headers.get("vb-inherit-authentication");if(i&&"not-handled"===i){const i=e.headers.get("vb-inherit-authentication-fallback");if(i)return e.headers.set(t.Headers.VB_INFO_EXTENSION,JSON.stringify({proxyUrls:{authenticated:i}})),e.headers.delete(t.Headers.PROTOCOL_OVERRIDE_HEADER),super.handleRequestHook(e)}return Promise.resolve()}})),define("vbsw/private/plugins/generalHeadersHandlerPlugin",["vbsw/api/fetchHandlerPlugin"],(e=>class extends e{constructor(e,t){super(e),this.headers=t||{}}handleRequestHook(e){return Object.keys(this.headers).forEach((t=>{e.headers.get(t)||e.headers.set(t,this.headers[t])})),Promise.resolve()}})),define("vbsw/private/plugins/headerTidyHandlerPlugin",["vbsw/api/fetchHandlerPlugin"],(e=>{const t=/^vb-.*/;return class extends e{handleRequestHook(e){const i=[];for(const r of e.headers.keys())t.test(r)&&!r.startsWith(Constants.HEADER_PROXY_PREFIX)&&i.push(r);return i.forEach((t=>{e.headers.delete(t)})),Promise.resolve()}}})),define("vbsw/private/plugins/implicitFlowHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/utils","vbsw/private/constants"],((e,t,i)=>{class r extends e{constructor(e,t){super(e);const r=t.allowedScopes||[];this.allowedScopes=r.map((e=>{const t=e.split("fqs://"),i=t[0],r=t.length>1&&t[1]?t[1]:i,n=i.replace(":443","(:443)?");return{scope:r,regEx:new RegExp(n,"i")}})),this.cachedTokenPromises={},this.invalidateTokenPromises={},this.jwtClockSkewTolerance=t&&t.jwtClockSkewTolerance||i.DEFAULT_CLOCK_SKEW_TOLERANCE}getAuthHeader(e,i){let n=this.cachedTokenPromises[i];if(!n){const s=r.getCachedTokenUrl(i);n=this.stateCache.get(s).then((r=>{if(r)return r;const n={method:"vbRefreshImplicitFlowAccessToken",args:[i]};return t.postMessage(e,n).then((e=>this.cacheAuthToken(s,e)))})).catch((e=>{console.log(e),delete this.cachedTokenPromises[i]})),this.cachedTokenPromises[i]=n}return n.then((r=>r?t.checkJwtExpiration(r.expiration,this.jwtClockSkewTolerance)?this.refreshAuthHeader(e,i):r.token:null))}refreshAuthHeader(e,t){let i=this.invalidateTokenPromises[t];if(!i){const n=r.getCachedTokenUrl(t);i=this.stateCache.delete(n).then((()=>(delete this.cachedTokenPromises[t],this.getAuthHeader(e,t).then((e=>(delete this.invalidateTokenPromises[t],e)))))),this.invalidateTokenPromises[t]=i}return i}matchScope(e){const t=this.allowedScopes.find((t=>e.match(t.regEx)));return t?t.scope:null}static getCachedTokenUrl(e){return`${e}vbImplicitFlowCachedToken`}cacheAuthToken(e,i){const r={token:i,expiration:t.extractJwtExpiration(i)};return this.stateCache.put(e,r).then((()=>r))}handleRequestHook(e,t){if(e.headers.get(i.AUTHENTICATION_TYPE_HEADER)===i.AuthenticationType.IMPLICIT){const r=e.headers,n=this.matchScope(e.url);if(n)return this.getAuthHeader(t,n).then((e=>{const t=r.get(i.ALT_AUTHORIZATION_HEADER_NAME)||"Authorization";r.set(t,e)}))}return Promise.resolve()}}return r})),define("vbsw/private/plugins/mobileAuthHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/plugins/authHeaderHandlerPlugin","urijs/URI","vbsw/private/constants","vbc/private/constants","vbsw/private/utils"],((e,t,i,r,n,s)=>class extends e{constructor(e,i){super(e),this.currentUserUrl=i.currentUserUrl||"",this.currentUserUrlRegEx=new RegExp(this.currentUserUrl.replace(":443","(:443)?"),"i");const r=i.allowedScopes||[];this.allowedScopes=r.map((e=>{const t=e.replace(":443","(:443)?");return{scope:e,regEx:new RegExp(t,"i")}})),this.appScopeRegEx=new RegExp(s.getRegexForAppScope(this.fetchHandler.scope)),this.authHeaderHandlerPlugin=new t(e,{isAnonymous:!0})}matchScope(e){const t=this.allowedScopes.find((t=>e.match(t.regEx)));return t?t.scope:null}handleRequestHook(e,t){if("true"===e.headers.get(n.Headers.ALLOW_ANONYMOUS_ACCESS_HEADER))return this.authHeaderHandlerPlugin.handleRequestHook(e);const i=e.headers.get(r.AUTHENTICATION_TYPE_HEADER);if(i===r.AuthenticationType.BASIC||i===r.AuthenticationType.ORACLE_CLOUD||i===r.AuthenticationType.DIRECT&&e.url.match(this.appScopeRegEx)||i===r.AuthenticationType.OAUTH&&this.matchScope(e.url)||e.url.match(this.currentUserUrlRegEx)){const i={method:"vbGetAuthHeader"};return s.postMessage(t,i).then((t=>{Object.keys(t).forEach((i=>{e.headers.set(i,t[i])}))}))}return Promise.resolve()}})),define("vbsw/private/plugins/mobileAuthPreprocessorHandlerPlugin",["vbsw/private/plugins/authPreprocessorHandlerPlugin"],(e=>class extends e{constructor(e,t={}){super(e,t)}enforceCORS(){return!1}useProxyForProtocol(e,t){return e.url.startsWith("http:")||super.useProxyForProtocol(e,t)}})),define("vbsw/private/plugins/multiTenantCsrfTokenHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/constants"],((e,t)=>{const i="X-CSRF-TOKEN";return class extends e{constructor(e,t={}){super(e);const{orgId:i,vbServer:r,serverRoot:n=""}=t;i&&r?(this.profileUrl=`${r}/${n}${i}/api2/profile`,this.vbServerRegEx=new RegExp(r)):(this.profileUrl=null,this.vbServerRegEx=null),this.vbCsrfToken=void 0}static get csrfTokenHeader(){return i}getCsrfToken(){return Promise.resolve().then((()=>void 0===this.vbCsrfToken?this.refreshCsrfToken().then((()=>this.vbCsrfToken)):this.vbCsrfToken))}refreshCsrfToken(){return Promise.resolve().then((()=>{if(this.profileUrl){const e={method:"GET",credentials:"same-origin",cache:"no-cache",headers:{[t.AUTHENTICATION_TYPE_HEADER]:t.AuthenticationType.ORACLE_CLOUD}},r=new Request(this.profileUrl,e);return this.fetchHandler.handleRequest(r).then((e=>(this.vbCsrfToken=e.headers.get(i),this.vbCsrfToken)))}return null}))}handleRequestHook(e){return Promise.resolve().then((()=>{if("GET"!==e.method.toUpperCase()&&this.vbServerRegEx&&e.url.match(this.vbServerRegEx))return this.getCsrfToken().then((t=>{t&&e.headers.set(i,t)}))}))}handleResponseHook(e,t){return Promise.resolve().then((()=>!(403!==e.status||"GET"===t.method.toUpperCase()||!this.vbServerRegEx||!t.url.match(this.vbServerRegEx))&&this.refreshCsrfToken().then((()=>!0))))}}})),define("vbsw/private/plugins/resourceChangedPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/utils","vbc/private/log"],((e,t,i)=>{const r=i.getLogger("/vb/private/plugins/resourceChangedPlugin"),n="x-vb-changed-header",s=/(app-flow.json|\.css)$/;class a extends e{constructor(e,i={}){super(e),this.contextRoot=i.contextRoot||"/",this.versionId=i.versionId,this.skipRegex=i.skipRegex||s;const r=t.getRegexForAppScope(this.fetchHandler.scope,this.fetchHandler.config);this.scopeRegEx=new RegExp(r)}handleRequestHook(e){return Promise.resolve().then((()=>(this.shouldProcess(e)&&e.headers.set("x-vb-application-version",this.versionId),null)))}handleResponseHook(e,t,i,r){return Promise.resolve().then((()=>!!this.shouldProcess(i)&&a.checkIfResourceChanged(i.url,e,r)))}shouldProcess(e){return this.versionId&&e.url.match(this.scopeRegEx)&&!this.skipRegex.test(e.url)}static checkIfResourceChanged(e,t,i){return Promise.resolve().then((()=>{const r=t.headers.get(n);return 400===t.status&&r&&"false"!==r?a.fireResourceChangeEvent(e,t,i):null}))}static fireResourceChangeEvent(e,i,s){return i.clone().text().then((t=>({method:"vbResourceChanged",args:[e,t,i.headers.get(n)]}))).then((e=>t.postMessage(s,e))).then((e=>(r.fine("fireResourceChangeEvent message complete"),e))).catch((e=>(r.error("fireResourceChangeEvent message error",e),!1)))}}return a})),define("vbsw/private/plugins/sessionExpirePlugin",["vbsw/api/fetchHandlerPlugin","vbc/private/log","vbsw/private/utils"],((e,t,i)=>{const r=Symbol("beRootRequest"),n=t.getLogger("/vbsw/private/plugins/sessionExpirePlugin");class s extends e{constructor(e,t={}){if(super(e),this.contextRoot=t.contextRoot||"/",this.idcsHost=t.idcsHost,this.backendRootUrl=t.backendRootUrl,this.idcsHost){const e=this.idcsHost.match(/^(.+):\d+/);e&&e.length>=2&&(this.idcsHost=e[1])}}handleResponseHook(e,t,i,n){if(!0===t[r])return Promise.resolve(!1);const s=e.headers.get("vb-proxy-status-actual");if(s&&s.startsWith(401))return Promise.resolve(!1);const a=this._getBackendRootURL();return 401===e.status&&i.url.startsWith(a)&&e.headers.get("X-AppBuilder-Unauthorized")||"opaque"===e.type&&!1===e.ok&&0===e.status&&i.url.startsWith(a)&&"no-cors"===i.mode?this._fireSessionExpiredEvent(i.url,n):"cors"===e.type&&!0===e.redirected&&200===e.status&&!0===e.ok&&e.url.startsWith(this.idcsHost)&&i.url.startsWith(a)&&"cors"===i.mode?this._fireSessionExpiredEvent(t.url,n):Promise.resolve(!1)}_getBackendRootURL(){return this.backendRootUrl?this.backendRootUrl:`${self.location.origin}${this.contextRoot}`}handleErrorHook(e,t,i,s){const a=this._getBackendRootURL();if(!i.url.startsWith(a)||!0===t[r])return Promise.resolve(!1);const o=new Request(a,{redirect:"manual"});return o[r]=!0,fetch(o).then((e=>{if(200!==e.status||e.redirected){if("opaqueredirect"===e.type)return this._fireSessionExpiredEvent(t.url,s)}else;return!1})).catch((e=>(n.error("A testing request to domain root resource",a,"has failed even if redirect mode had been set to manual",e),!1)))}_fireSessionExpiredEvent(e,t){n.info("session expire detected for",e);const r={method:s.vbSessionExpired,args:[e]};return i.postMessage(t,r).then((e=>(e?n.info("SSO session has been successfully refreshed"):n.warn("Couldn't refresh SSO session"),e))).catch((e=>(n.error("An attempt to refresh SSO session has failed:",e),!1)))}}return s.vbSessionExpired="vbSessionExpired",s})),define("vbsw/private/plugins/sessionTrackingHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/utils"],((e,t)=>{const i="vb-day-session-tracking",r="VBCS_SESSION_TRACKING",n="X-Oracle-ABCS-SessionId",s="X-Oracle-ABCS-UserId",a="@@@";return class extends e{constructor(e,t){super(e,t),this.userId=t.userId,this.cookieDuration=60*(t.cookieDuration||24)*60*1e3,this.cachedSessionCookiePromise=null,this.refreshSessionCookiePromise=null}static get requestTrackingHeader(){return i}static get sessionTrackingHeader(){return n}static get sessionTrackingUserHeader(){return s}static get sessionTrackingHeaderDelimiter(){return a}getSessionTrackingHeader(e){return this.cachedSessionCookiePromise||(this.cachedSessionCookiePromise=t.getCookie(e,r).then((t=>t||this.createSessionTrackingCookie(e)))),this.cachedSessionCookiePromise.then((i=>i.userId!==this.userId||i.expires<t.getEpochTime(!0)?(this.refreshSessionCookiePromise||(this.refreshSessionCookiePromise=this.createSessionTrackingCookie(e).then((()=>(this.cachedSessionCookiePromise=null,this.getSessionTrackingHeader(e).then((e=>(this.refreshSessionCookiePromise=null,e))))))),this.refreshSessionCookiePromise):i.header))}createSessionTrackingCookie(e){const i={userId:this.userId,header:`${t.generateUID()}@@@${this.userId}`,expires:t.getEpochTime(!0)+this.cookieDuration};return t.setCookie(e,r,i).then((()=>i))}handleRequestHook(e,t){if("enabled"===e.headers.get(i)){const i=e.headers;return this.getSessionTrackingHeader(t).then((e=>{if(e){const t=e.split(a);2===t.length&&(i.set(n,t[0]),i.set(s,t[1]))}}))}return Promise.resolve()}}})),define("vbsw/private/plugins/tokenRelayHandlerPlugin",["vbsw/api/fetchHandlerPlugin","vbsw/private/utils","vbsw/private/constants","vbsw/private/plugins/authPreprocessorHandlerPlugin","vbc/private/log"],((e,t,i,r,n)=>{const s=i.TOKEN_RELAY_URL_HEADER,a=i.TOKEN_RELAY_AUTH_HEADER,o=n.getLogger("/vbsw/private/plugins/tokenRelayHandlerPlugin");return class extends e{constructor(e,t){super(e),this.cachedTokenPromises={},this.invalidateTokenPromises={},this.jwtClockSkewTolerance=t&&t.jwtClockSkewTolerance||i.DEFAULT_CLOCK_SKEW_TOLERANCE}static get tokenRelayUrlHeader(){return s}static get tokenRelayAuthenticationHeader(){return a}processTokenRelayAuthentication(e,t,i){}getAuthHeader(e,r,n,s){let a=this.cachedTokenPromises[e];return a||(a=this.stateCache.get(e).then((t=>{if(t)return t;const a={method:"POST",credentials:"same-origin",cache:"no-cache",headers:{[i.AUTHENTICATION_TYPE_HEADER]:i.AuthenticationType.ORACLE_CLOUD}};if(s){const e={grant_type:"urn:oracle:implicit"};a.body=JSON.stringify(e),a.headers["Content-Type"]="application/json"}const o=new Request(e,a);return this.processTokenRelayAuthentication(o,r,n),this.fetchHandler.handleRequest(o).then((t=>{if(t.ok)return t.json().then((t=>this.cacheAuthToken(e,t,s)));throw new Error(t.statusText)}))})).catch((t=>{console.error(t),delete this.cachedTokenPromises[e]})),this.cachedTokenPromises[e]=a),a.then((i=>i?t.checkJwtExpiration(i.expiration,this.jwtClockSkewTolerance)?this.invalidateCachedToken(e).then((()=>(o.info("Token for",e,"has expired. Fetching a new token."),this.getAuthHeader(e,r,n,s)))):i.token.authenticationHeader:null))}invalidateCachedToken(e,t){let i=this.invalidateTokenPromises[e];return i||(i=this.stateCache.delete(e).then((()=>{if(t){const i={headers:{"WWW-Authenticate":t}},r={method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)},n=new Request(`${e}/invalidate`,r);return this.fetchHandler.handleRequest(n).then((e=>307===e.status)).catch((e=>(console.error(e),!1)))}return o.info("Authorization token for",e,"is invalidated"),Promise.resolve(!0)})),this.invalidateTokenPromises[e]=i),i.then((t=>(delete this.invalidateTokenPromises[e],delete this.cachedTokenPromises[e],t)))}cacheAuthToken(e,i,r){let n=i.authenticationHeader,s=null;r?(n=`Bearer ${i.access_token}`,i.expires_in&&(s={time:t.getEpochTime()+i.expires_in,skew:0})):(n=i.authenticationHeader,s=t.extractJwtExpiration(i.authenticationHeader));const a={token:{authenticationHeader:n},expiration:s};return this.stateCache.put(e,a).then((()=>a))}handleRequestHook(e){const t=e.headers.get(i.TOKEN_RELAY_URL_HEADER);if(t){const r=e.headers.get(i.TOKEN_RELAY_AUTH_HEADER),n=r?JSON.parse(r):void 0,s=!!t&&"true"===e.headers.get(i.TRAP_2_ENABLED_HEADER);return this.getAuthHeader(t,n,e.url,s).then((t=>{if(t){const{headers:r}=e,n=r.get(i.ALT_AUTHORIZATION_HEADER_NAME)||"Authorization";r.set(n,t)}return Promise.resolve()}))}return Promise.resolve()}handleResponseHook(e,t,i,n){return Promise.resolve().then((()=>{if(401===e.status){const e=i.headers.get("Authorization");if(o.info("401 response detected for",t.url,"with authorization header",e),e){const i=r.getTokenRelayUrlFromRequest(t);if(o.info("Look up token relay url",i),i){return(this.cachedTokenPromises[i]||Promise.resolve()).then((t=>!(!t||t.token.authenticationHeader!==e)&&(o.info("Invalidating cached authorization token"),this.invalidateCachedToken(i).then((()=>!0)))))}}}return!1}))}}})),e='/**\n  Copyright (c) 2021, Oracle and/or its affiliates.\n  The Universal Permissive License (UPL), Version 1.0\n*/\n\n/* Pass down oj-flex set on oj-vb-fragment to the nested oj-module */\noj-vb-fragment.oj-flex > oj-module {\n    box-sizing: border-box;\n    display: flex;\n    flex: auto;\n    flex-wrap: wrap;\n}\n/**\n  Copyright (c) 2015, 2018, Oracle and/or its affiliates.\n  The Universal Permissive License (UPL), Version 1.0\n*/\n\n/* Pass down oj-flex set on oj-vb-content to the nested oj-module */\noj-vb-content.oj-flex > oj-module {\n    box-sizing: border-box;\n    display: flex;\n    flex: auto;\n    flex-wrap: wrap;\n}oj-vb-list-item .vbcs-list-item {\n  padding: 5px;\n}\n\noj-vb-list-item .vbcs-list-item__title1,\noj-vb-list-item .vbcs-list-item__value1 {\n  font-size: 14px;\n}\n\noj-vb-list-item .vbcs-list-item__title2,\noj-vb-list-item .vbcs-list-item__value2 {\n  color: #737373;\n  font-size: 12px;\n}\n\noj-vb-list-item .vbcs-list-item__image {\n  width: 32px;\n  height: 32px;\n}\n\n/* Special styling for mobile page templates only */\noj-ext-mobile-page-template oj-vb-list-item .vbcs-list-item {\n  /* This will make the default single item height as 49px */\n  padding: unset;\n  min-height: 32px;\n}\n\noj-ext-mobile-page-template oj-vb-list-item .vbcs-list-item p {\n  margin-bottom: 0;\n}\n\n/* use default font (inherited or initial) value for the title or the end text*/\noj-ext-mobile-page-template oj-vb-list-item .vbcs-list-item__title1,\noj-ext-mobile-page-template oj-vb-list-item .vbcs-list-item__value1,\noj-ext-mobile-page-template oj-vb-list-item *[slot="title1"],\noj-ext-mobile-page-template oj-vb-list-item *[slot="value1"] {\n  font-size: unset;\n}\n\n/* use a smaller and lighter font for the secondary items in the row*/\noj-ext-mobile-page-template oj-vb-list-item .vbcs-list-item__title2,\noj-ext-mobile-page-template oj-vb-list-item .vbcs-list-item__value2,\noj-ext-mobile-page-template oj-vb-list-item *[slot="title2"],\noj-ext-mobile-page-template oj-vb-list-item *[slot="value2"] {\n  /* Use CSS variables from JET */\n  color: var(--oj-secondary-text-color);\n  font-size: var(--oj-small-font-size);\n}\n\n/* Override JET android theme to enable drill down in android.\n   Many of the android native apps (for e.g. settings) have the drilldown icons */\noj-ext-mobile-page-template.oj-ext-android-theme oj-vb-list-item .oj-listview-drill-icon {\n  display: unset;\n  color: var(--oj-neutral-color11);\n}\n\noj-ext-mobile-page-template.oj-ext-android-theme oj-vb-list-item .oj-listview-drill-icon:before {\n  content: "\\e612";\n}.messagebar-slide-up, .messagebar-slide-down {\n    display: flex;\n    flex: 1 0 auto;\n    /* display: inline-block; */\n    max-height: 0;\n    overflow-y: hidden;\n    -webkit-transition: max-height 1s ease-in-out;\n    -moz-transition: max-height 1s ease-in-out;\n    -o-transition: max-height 1s ease-in-out;\n    transition: max-height 1s ease-in-out;\n    width: 100%;\n}\n\n.messagebar-slide-down {\n    max-height: 10em;\n}\n\n\n/**\n * this class is appended to the component classes\n */\n.vb-messages {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 100%;\n}\n\n\n.messagebar-hidden {\n    display: none;\n}\n\n.messagebar-pull-right {\n    float: right; }\n\n.messagebar-pull-left {\n    float: left; }\n\n#messagebar-confirmation-error-note {\n    position: relative;\n    z-index: 112;\n    width: 100%;\n    display: -ms-flexbox;\n    display: flex;\n    -ms-flex-align: center;\n    align-items: center;\n    -ms-flex-direction: column;\n    flex-direction: column; }\n\n.messagebar-confirmation-error-note {\n    width: 100%;\n    max-width: 100%;\n    position: relative;\n    line-height: 35px;\n    z-index: 113;\n    /* vb-app-skeleton display: none; */\n    border-bottom: 1px solid transparent; }\n\n.messagebar-confirmation-error-note.messagebar-confirmation-note {\n    background-color: #d6f1de;\n    border-color: #c3ebcf; }\n\n/* todo: need to fix this */\n.messagebar-confirmation-error-note-image {\n    margin-top: 10px;\n}\n\n.messagebar-confirmation-error-note.messagebar-info-note {\n    background-color: #d9edf8;\n    border-color: #bfe4f8; }\n\n.messagebar-confirmation-error-note.messagebar-error-note {\n    background-color: #ffdfdf;\n    border-color: #ffc5c5; }\n\n\n.messagebar-confirmation-error-note.messagebar-warning-note {\n    background-color: #ffeaca;\n    border-color: #ffe0b0; }\n\n\n.messagebar-confirmation-error-note .messagebar-confirmation-error-note-wrap {\n    max-width: 1395px;\n    margin: 0px auto 0px auto;\n    min-height: 35px;\n    position: relative; }\n\n.messagebar-confirmation-error-note .messagebar-confirmation-error-note-wrap:before {\n    position: absolute;\n    top: 3px; }\n\n@media screen and (max-width: 1440px) {\n    .messagebar-confirmation-error-note .messagebar-confirmation-error-note-wrap {\n        margin: 0px 10px 0px 10px; }\n}\n\n.messagebar-confirmation-error-note .messagebar-confirmation-error-note-text {\n    margin-left: 20px; /** 27px; **/\n    -ms-flex: 1;\n    flex: 1;\n    max-height: 200px;\n    overflow-y: auto;\n    font-size: 1rem;\n    color: black; }\n\n.messagebar-confirmation-error-note button {\n    margin: 0px; }\n\n.messagebar-confirmation-error-note button:not(:last-of-type) {\n    margin-right: 10px; }\n\n.messagebar-confirmation-error-note .messagebar-confirmation-error-note-counter {\n  display: inline-block;\n  background-color: white;\n  border-radius: 12px;\n  padding: 4px;\n  line-height: 16px;\n  margin-left: 4px;\n  text-align: right;\n}\n\n.messagebar-confirmation-error-note.messagebar-error-note .messagebar-confirmation-error-note-counter {\n    background-color: #dfbfbf;\n}\n\n.messagebar-confirmation-error-note.messagebar-warning-note .messagebar-confirmation-error-note-counter {\n    background-color: #dfcaaa;\n}\n\n.messagebar-confirmation-error-note.messagebar-confirmation-note .messagebar-confirmation-error-note-counter {\n    background-color: #b6d1be;\n}\n\n.messagebar-confirmation-error-note.messagebar-info-note .messagebar-confirmation-error-note-counter {\n    background-color: #b9cdd8;\n}\n\noj-vb-message-bar .cancel-icon {\n    height: 16px;\n    width: 16px;\n    background-size: 16px 16px;\n    cursor: pointer; }\n\noj-vb-message-bar .cancel-icon:before {\n    content: " ";\n    height: 16px;\n    width: 16px;\n    display: inline-block;\n    background-repeat: no-repeat;\n    background-image: url(../../src/vb/components/messagebar/images/func_delete_16_sprite.png);\n    background-position: 0px 0px; }\n\noj-vb-message-bar .oj-default .cancel-icon:before, .oj-focus-only .cancel-icon:before {\n    background-position: 0px 0px; }\n\noj-vb-message-bar .oj-hover .cancel-icon:before, .oj-hover.oj-selected .cancel-icon:before {\n    background-position: -16px 0px; }\n\noj-vb-message-bar .oj-active .cancel-icon:before, .oj-selected .cancel-icon:before {\n    background-position: -64px 0px; }\n\noj-vb-message-bar .oj-disabled .cancel-icon:before {\n    background-position: -48px 0px; }\n\n/**\n  Copyright (c) 2022, Oracle and/or its affiliates.\n  The Universal Permissive License (UPL), Version 1.0\n*/\n\n/* Pass down oj-flex set on oj-vb-switcher to the nested oj-module */\noj-vb-switcher.oj-flex > oj-module {\n    box-sizing: border-box;\n    display: flex;\n    flex: auto;\n    flex-wrap: wrap;\n}',t=document,i="appendChild",r="styleSheet",(n=t.createElement("style")).type="text/css",t.getElementsByTagName("head")[0][i](n),n[r]?n[r].cssText=e:n[i](t.createTextNode(e)),require(["main"])}();
//# sourceMappingURL=visual-runtime.js.map